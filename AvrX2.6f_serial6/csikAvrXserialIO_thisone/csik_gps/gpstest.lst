GAS LISTING /var/tmp//ccvnAEfo.s 			page 1


   1               		.file	"gpstest.c"
   2               		.arch atmega32
   3               	__SREG__ = 0x3f
   4               	__SP_H__ = 0x3e
   5               	__SP_L__ = 0x3d
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   8               		.global __do_copy_data
   9               		.global __do_clear_bss
  10               		.stabs	"/opt/local/avr/avrlib/freedomflies/AvrX2.6f_serial6/csikAvrXserialIO_thisone/csik_gps/",10
  11               		.stabs	"gpstest.c",100,0,2,.Ltext0
  12               		.text
  13               	.Ltext0:
  14               		.stabs	"gcc2_compiled.",60,0,0,0
  15               		.stabs	"int:t(0,1)=r(0,1);-32768;32767;",128,0,0,0
  16               		.stabs	"char:t(0,2)=r(0,2);0;127;",128,0,0,0
  17               		.stabs	"long int:t(0,3)=@s32;r(0,3);020000000000;017777777777;",128,0,0,0
  18               		.stabs	"unsigned int:t(0,4)=r(0,4);0;0177777;",128,0,0,0
  19               		.stabs	"long unsigned int:t(0,5)=@s32;r(0,5);0;037777777777;",128,0,0,0
  20               		.stabs	"long long int:t(0,6)=@s64;r(0,6);01000000000000000000000;0777777777777777777777;",128,0,0,
  21               		.stabs	"long long unsigned int:t(0,7)=@s64;r(0,7);0;01777777777777777777777;",128,0,0,0
  22               		.stabs	"short int:t(0,8)=r(0,8);-32768;32767;",128,0,0,0
  23               		.stabs	"short unsigned int:t(0,9)=r(0,9);0;0177777;",128,0,0,0
  24               		.stabs	"signed char:t(0,10)=@s8;r(0,10);-128;127;",128,0,0,0
  25               		.stabs	"unsigned char:t(0,11)=@s8;r(0,11);0;255;",128,0,0,0
  26               		.stabs	"float:t(0,12)=r(0,1);4;0;",128,0,0,0
  27               		.stabs	"double:t(0,13)=r(0,1);4;0;",128,0,0,0
  28               		.stabs	"long double:t(0,14)=r(0,1);4;0;",128,0,0,0
  29               		.stabs	"void:t(0,15)=(0,15)",128,0,0,0
  30               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/../../../../avr/include/avr/io.h",130,0,0,0
  31               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/../../../../avr/include/avr/sfr_defs.h",130,0,0,0
  32               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/../../../../avr/include/inttypes.h",130,0,0,0
  33               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/../../../../avr/include/stdint.h",130,0,0,0
  34               		.stabs	"int8_t:t(4,1)=(0,10)",128,0,116,0
  35               		.stabs	"uint8_t:t(4,2)=(0,11)",128,0,117,0
  36               		.stabs	"int16_t:t(4,3)=(0,1)",128,0,118,0
  37               		.stabs	"uint16_t:t(4,4)=(0,4)",128,0,119,0
  38               		.stabs	"int32_t:t(4,5)=(0,3)",128,0,120,0
  39               		.stabs	"uint32_t:t(4,6)=(0,5)",128,0,121,0
  40               		.stabs	"int64_t:t(4,7)=(0,6)",128,0,122,0
  41               		.stabs	"uint64_t:t(4,8)=(0,7)",128,0,123,0
  42               		.stabs	"intptr_t:t(4,9)=(4,3)",128,0,135,0
  43               		.stabs	"uintptr_t:t(4,10)=(4,4)",128,0,140,0
  44               		.stabs	"int_least8_t:t(4,11)=(4,1)",128,0,152,0
  45               		.stabs	"uint_least8_t:t(4,12)=(4,2)",128,0,157,0
  46               		.stabs	"int_least16_t:t(4,13)=(4,3)",128,0,162,0
  47               		.stabs	"uint_least16_t:t(4,14)=(4,4)",128,0,167,0
  48               		.stabs	"int_least32_t:t(4,15)=(4,5)",128,0,172,0
  49               		.stabs	"uint_least32_t:t(4,16)=(4,6)",128,0,177,0
  50               		.stabs	"int_least64_t:t(4,17)=(4,7)",128,0,182,0
  51               		.stabs	"uint_least64_t:t(4,18)=(4,8)",128,0,187,0
  52               		.stabs	"int_fast8_t:t(4,19)=(4,1)",128,0,200,0
  53               		.stabs	"uint_fast8_t:t(4,20)=(4,2)",128,0,205,0
  54               		.stabs	"int_fast16_t:t(4,21)=(4,3)",128,0,210,0
  55               		.stabs	"uint_fast16_t:t(4,22)=(4,4)",128,0,215,0
  56               		.stabs	"int_fast32_t:t(4,23)=(4,5)",128,0,220,0
  57               		.stabs	"uint_fast32_t:t(4,24)=(4,6)",128,0,225,0
GAS LISTING /var/tmp//ccvnAEfo.s 			page 2


  58               		.stabs	"int_fast64_t:t(4,25)=(4,7)",128,0,230,0
  59               		.stabs	"uint_fast64_t:t(4,26)=(4,8)",128,0,235,0
  60               		.stabs	"intmax_t:t(4,27)=(4,7)",128,0,249,0
  61               		.stabs	"uintmax_t:t(4,28)=(4,8)",128,0,254,0
  62               		.stabn	162,0,0,0
  63               		.stabs	"int_farptr_t:t(3,1)=(4,5)",128,0,76,0
  64               		.stabs	"uint_farptr_t:t(3,2)=(4,6)",128,0,80,0
  65               		.stabn	162,0,0,0
  66               		.stabn	162,0,0,0
  67               		.stabn	162,0,0,0
  68               		.stabs	"/opt/local/avr/sixcode/uart.h",130,0,0,0
  69               		.stabs	"./global.h",130,0,0,0
  70               		.stabs	"/opt/local/avr/sixcode/avrlibtypes.h",130,0,0,0
  71               		.stabs	"u08:t(7,1)=(0,11)",128,0,32,0
  72               		.stabs	"s08:t(7,2)=(0,10)",128,0,33,0
  73               		.stabs	"u16:t(7,3)=(0,9)",128,0,34,0
  74               		.stabs	"s16:t(7,4)=(0,8)",128,0,35,0
  75               		.stabs	"u32:t(7,5)=(0,5)",128,0,36,0
  76               		.stabs	"s32:t(7,6)=(0,3)",128,0,37,0
  77               		.stabs	"u64:t(7,7)=(0,7)",128,0,38,0
  78               		.stabs	"s64:t(7,8)=(0,6)",128,0,39,0
  79               		.stabs	"BOOL:t(7,9)=(0,11)",128,0,69,0
  80               		.stabs	"BYTE:t(7,10)=(0,11)",128,0,70,0
  81               		.stabs	"WORD:t(7,11)=(0,4)",128,0,71,0
  82               		.stabs	"DWORD:t(7,12)=(0,5)",128,0,72,0
  83               		.stabs	"UCHAR:t(7,13)=(0,11)",128,0,74,0
  84               		.stabs	"UINT:t(7,14)=(0,4)",128,0,75,0
  85               		.stabs	"USHORT:t(7,15)=(0,9)",128,0,76,0
  86               		.stabs	"ULONG:t(7,16)=(0,5)",128,0,77,0
  87               		.stabs	"CHAR:t(7,17)=(0,2)",128,0,79,0
  88               		.stabs	"INT:t(7,18)=(0,1)",128,0,80,0
  89               		.stabs	"LONG:t(7,19)=(0,3)",128,0,81,0
  90               		.stabn	162,0,0,0
  91               		.stabn	162,0,0,0
  92               		.stabs	"/opt/local/avr/sixcode/buffer.h",130,0,0,0
  93               		.stabs	"struct_cBuffer:T(8,1)=s8dataptr:(8,2)=*(0,11),0,16;size:(0,9),16,16;datalength:(0,9),32,16
  94               		.stabs	"cBuffer:t(8,3)=(8,1)",128,0,47,0
  95               		.stabn	162,0,0,0
  96               		.stabn	162,0,0,0
  97               		.stabs	"/opt/local/avr/sixcode/rprintf.h",130,0,0,0
  98               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/../../../../avr/include/avr/pgmspace.h",130,0,0,0
  99               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/include/stddef.h",130,0,0,0
 100               		.stabs	"size_t:t(11,1)=(0,4)",128,0,214,0
 101               		.stabn	162,0,0,0
 102               		.stabs	"prog_void:t(10,1)=(10,2)=(10,2)",128,0,203,0
 103               		.stabs	"prog_char:t(10,3)=(10,4)=@s8;r(10,4);-128;127;",128,0,204,0
 104               		.stabs	"prog_uchar:t(10,5)=(10,6)=@s8;r(10,6);0;255;",128,0,205,0
 105               		.stabs	"prog_int8_t:t(10,7)=(10,4)",128,0,207,0
 106               		.stabs	"prog_uint8_t:t(10,8)=(10,6)",128,0,208,0
 107               		.stabs	"prog_int16_t:t(10,9)=(10,10)=(0,1)",128,0,209,0
 108               		.stabs	"prog_uint16_t:t(10,11)=(10,12)=(0,4)",128,0,210,0
 109               		.stabs	"prog_int32_t:t(10,13)=(10,14)=(0,3)",128,0,211,0
 110               		.stabs	"prog_uint32_t:t(10,15)=(10,16)=(0,5)",128,0,212,0
 111               		.stabs	"prog_int64_t:t(10,17)=(10,18)=(0,6)",128,0,213,0
 112               		.stabs	"prog_uint64_t:t(10,19)=(10,20)=(0,7)",128,0,214,0
 113               		.stabn	162,0,0,0
 114               		.stabn	162,0,0,0
GAS LISTING /var/tmp//ccvnAEfo.s 			page 3


 115               		.stabs	"nmeap.h",130,0,0,0
 116               		.stabs	"nmeap_callout_t:t(12,1)=(12,2)=*(12,3)=f(0,15)",128,0,75,0
 117               		.stabs	"nmeap_sentence_parser_t:t(12,4)=(12,5)=*(12,6)=f(0,1)",128,0,87,0
 118               		.stabs	"nmeap_def.h",130,0,0,0
 119               		.stabs	"nmeap_sentence:T(13,1)=s14name:(13,2)=ar(13,3)=r(13,3);0;0177777;;0;5;(0,2),0,48;id:(0,1),
 120               		.stabs	"nmeap_sentence_t:t(13,5)=(13,1)",128,0,34,0
 121               		.stabs	"nmeap_context:T(13,6)=s718sentence:(13,7)=ar(13,3);0;7;(13,5),0,896;sentence_count:(0,1),8
 122               		.stabs	"nmeap_context_t:t(13,11)=(13,6)",128,0,70,0
 123               		.stabn	162,0,0,0
 124               		.stabs	"nmeap_gga:T(12,7)=s28latitude:(0,13),0,32;longitude:(0,13),32,32;altitude:(0,13),64,32;tim
 125               		.stabs	"nmeap_gga_t:t(12,8)=(12,7)",128,0,114,0
 126               		.stabs	"nmeap_rmc:T(12,9)=s29time:(0,5),0,32;warn:(0,2),32,8;latitude:(0,13),40,32;longitude:(0,13
 127               		.stabs	"nmeap_rmc_t:t(12,10)=(12,9)",128,0,128,0
 128               		.stabn	162,0,0,0
 129               		.stabs	"nmeap01.c",130,0,0,0
 130               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/../../../../avr/include/stdio.h",130,0,0,0
 131               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/include/stdarg.h",130,0,0,0
 132               		.stabs	"__gnuc_va_list:t(16,1)=(16,2)=*(0,15)",128,0,43,0
 133               		.stabs	"va_list:t(16,3)=(16,1)",128,0,105,0
 134               		.stabn	162,0,0,0
 135               		.stabs	"__file:T(15,1)=s14buf:(13,10),0,16;unget:(0,11),16,8;flags:(4,2),24,8;size:(0,1),32,16;len
 136               		.stabn	162,0,0,0
 137               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/../../../../avr/include/stdlib.h",130,0,0,0
 138               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/include/stddef.h",130,0,0,0
 139               		.stabs	"wchar_t:t(18,1)=(0,1)",128,0,326,0
 140               		.stabn	162,0,0,0
 141               		.stabs	"div_t:t(17,1)=(17,2)=s4quot:(0,1),0,16;rem:(0,1),16,16;;",128,0,69,0
 142               		.stabs	"ldiv_t:t(17,3)=(17,4)=s8quot:(0,3),0,32;rem:(0,3),32,32;;",128,0,75,0
 143               		.stabs	"__compar_fn_t:t(17,5)=(17,6)=*(17,7)=f(0,1)",128,0,78,0
 144               		.stabn	162,0,0,0
 145               		.stabn	162,0,0,0
 146               		.stabs	"gpsmath.c",130,0,0,0
 147               		.stabs	"./gpsmath.h",130,0,0,0
 148               		.stabs	"waypoint:T(20,1)=s8lat:(0,13),0,32;lon:(0,13),32,32;;",128,0,0,0
 149               		.stabn	162,0,0,0
 150               		.stabn	162,0,0,0
 151               		.stabs	"/opt/local/avr/sixcode/i2c.h",130,0,0,0
 152               		.stabs	" :T(21,1)=eI2C_IDLE:0,I2C_BUSY:1,I2C_MASTER_TX:2,I2C_MASTER_RX:3,I2C_SLAVE_TX:4,I2C_SLAVE_
 153               		.stabs	"eI2cStateType:t(21,2)=(21,1)",128,0,124,0
 154               		.stabn	162,0,0,0
 155               	.global	stackem_pointer
 156               	.global	stackem_pointer
 157               		.section .bss
 158               		.type	stackem_pointer, @object
 159               		.size	stackem_pointer, 1
 160               	stackem_pointer:
 161 0000 00        		.skip 1,0
 162               	.global	localBufferLength
 163               		.data
 164               		.type	localBufferLength, @object
 165               		.size	localBufferLength, 1
 166               	localBufferLength:
 167 0000 20        		.byte	32
 168               	.global	localBuffer
 169               		.type	localBuffer, @object
 170               		.size	localBuffer, 34
 171               	localBuffer:
GAS LISTING /var/tmp//ccvnAEfo.s 			page 4


 172 0001 5468 6973 		.string	"This should be filling with data!"
 172      2073 686F 
 172      756C 6420 
 172      6265 2066 
 172      696C 6C69 
 173               		.text
 174               		.stabs	"nmeap_altitude:F(0,13)",36,0,152,nmeap_altitude
 175               		.stabs	"palt:P(0,16)=*(0,17)=k(0,2)",64,0,151,30
 176               		.stabs	"punits:P(0,16)",64,0,151,28
 177               	.global	nmeap_altitude
 178               		.type	nmeap_altitude, @function
 179               	nmeap_altitude:
 180               		.stabd	46,0,0
 181               		.stabs	"nmeap01.c",132,0,0,.Ltext1
 182               	.Ltext1:
   1:nmeap01.c     **** /*
   2:nmeap01.c     **** Copyright (c) 2005, David M Howard (daveh at dmh2000.com)
   3:nmeap01.c     **** All rights reserved.
   4:nmeap01.c     **** 
   5:nmeap01.c     **** This product is licensed for use and distribution under the BSD Open Source License.
   6:nmeap01.c     **** see the file COPYING for more details.
   7:nmeap01.c     **** 
   8:nmeap01.c     **** THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" 
   9:nmeap01.c     **** AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE 
  10:nmeap01.c     **** IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE 
  11:nmeap01.c     **** ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE 
  12:nmeap01.c     **** LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, 
  13:nmeap01.c     **** OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT 
  14:nmeap01.c     **** OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; 
  15:nmeap01.c     **** OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, 
  16:nmeap01.c     **** WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE 
  17:nmeap01.c     **** OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, 
  18:nmeap01.c     **** EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. 
  19:nmeap01.c     **** 
  20:nmeap01.c     **** */
  21:nmeap01.c     **** 
  22:nmeap01.c     **** /**
  23:nmeap01.c     ****  * nmeap01.c
  24:nmeap01.c     ****  * nmeap gps data parser
  25:nmeap01.c     ****  * 
  26:nmeap01.c     ****  * see the file COPYING for terms of the licnese
  27:nmeap01.c     **** */ 
  28:nmeap01.c     ****  
  29:nmeap01.c     ****  
  30:nmeap01.c     **** #include <stdio.h>
  31:nmeap01.c     **** #include <stdlib.h>
  32:nmeap01.c     **** #include <string.h>
  33:nmeap01.c     **** #include <ctype.h>
  34:nmeap01.c     **** #include "nmeap.h"#include "assert.h" 
  35:nmeap01.c     **** #include <math.h>
  36:nmeap01.c     **** 
  37:nmeap01.c     **** /* this only works if you are sure you have an upper case hex digit */
  38:nmeap01.c     **** #define HEXTOBIN(ch) ((ch <= '9') ? ch - '0' : ch - ('A' - 10))
  39:nmeap01.c     **** 
  40:nmeap01.c     **** /* forward references */
  41:nmeap01.c     **** int nmeap_init(nmeap_context_t *context,void *user_data);
  42:nmeap01.c     **** int nmeap_addParser(nmeap_context_t         *context,
GAS LISTING /var/tmp//ccvnAEfo.s 			page 5


  43:nmeap01.c     **** 					 const char             *sentence_name,
  44:nmeap01.c     **** 					 nmeap_sentence_parser_t sentence_parser,
  45:nmeap01.c     **** 					 nmeap_callout_t         sentence_callout,
  46:nmeap01.c     ****                      void                  *sentence_data
  47:nmeap01.c     **** 					 );
  48:nmeap01.c     **** int nmeap_tokenize(nmeap_context_t *context);
  49:nmeap01.c     **** int nmeap_process(nmeap_context_t *context);
  50:nmeap01.c     **** int nmeap_parse(nmeap_context_t *context,char ch);
  51:nmeap01.c     **** int nmeap_parseBuffer(nmeap_context_t *context,const char *buffer,int *length);
  52:nmeap01.c     **** 
  53:nmeap01.c     **** /**
  54:nmeap01.c     ****  * get a latitude out of a pair of nmea tokens 
  55:nmeap01.c     ****  */
  56:nmeap01.c     **** double nmeap_latitude(const char *plat,const char *phem)
  57:nmeap01.c     **** {
  58:nmeap01.c     ****     double lat;
  59:nmeap01.c     ****     int    deg;
  60:nmeap01.c     ****     double min;
  61:nmeap01.c     ****     int    ns;
  62:nmeap01.c     ****     
  63:nmeap01.c     ****     assert(plat != 0);
  64:nmeap01.c     ****     assert(phem != 0);
  65:nmeap01.c     ****     
  66:nmeap01.c     ****     if (*plat == 0) {
  67:nmeap01.c     ****         return 0.0;
  68:nmeap01.c     ****     }
  69:nmeap01.c     ****     if (*phem == 0) {
  70:nmeap01.c     ****         return 0.0;
  71:nmeap01.c     ****     }
  72:nmeap01.c     ****     
  73:nmeap01.c     ****     /* north lat is +, south lat is - */
  74:nmeap01.c     ****     if (*phem == 'N') {
  75:nmeap01.c     ****         ns = 1;
  76:nmeap01.c     ****     }
  77:nmeap01.c     ****     else {
  78:nmeap01.c     ****         ns = -1;
  79:nmeap01.c     ****     }
  80:nmeap01.c     ****     
  81:nmeap01.c     ****     /* latitude is degrees, minutes, fractional minutes */
  82:nmeap01.c     ****     /* no validation is performed on the token. it better be good.*/
  83:nmeap01.c     ****     /* if it comes back 0.0 then probably the token was bad */
  84:nmeap01.c     ****     lat = atof(plat);
  85:nmeap01.c     ****     
  86:nmeap01.c     ****     /* extract the degree part */
  87:nmeap01.c     ****     deg = (int)(lat / 100.0);
  88:nmeap01.c     ****     
  89:nmeap01.c     ****     /* mask out the degrees */
  90:nmeap01.c     ****     min = lat - (deg * 100.0);
  91:nmeap01.c     ****     
  92:nmeap01.c     ****     /* compute the actual latitude in degrees.decimal-degrees */
  93:nmeap01.c     ****     lat = (deg + (min / 60.0)) * ns;
  94:nmeap01.c     ****     
  95:nmeap01.c     ****     return lat;
  96:nmeap01.c     **** }
  97:nmeap01.c     **** 
  98:nmeap01.c     **** 
  99:nmeap01.c     **** 
GAS LISTING /var/tmp//ccvnAEfo.s 			page 6


 100:nmeap01.c     **** /**
 101:nmeap01.c     ****  * get a longitude out of a pair of nmea tokens 
 102:nmeap01.c     ****  */
 103:nmeap01.c     **** double nmeap_longitude(const char *plon,const char *phem)
 104:nmeap01.c     **** {
 105:nmeap01.c     ****     double lon;
 106:nmeap01.c     ****     int    deg;
 107:nmeap01.c     ****     double min;
 108:nmeap01.c     ****     int    ew;
 109:nmeap01.c     ****     
 110:nmeap01.c     ****     assert(plon != 0);
 111:nmeap01.c     ****     assert(phem != 0);
 112:nmeap01.c     ****     
 113:nmeap01.c     ****     if (*plon == 0) {
 114:nmeap01.c     ****         return 0.0;
 115:nmeap01.c     ****     }
 116:nmeap01.c     ****     if (*phem == 0) {
 117:nmeap01.c     ****         return 0.0;
 118:nmeap01.c     ****     }
 119:nmeap01.c     ****     
 120:nmeap01.c     ****     /* west long is negative, east long is positive */
 121:nmeap01.c     ****     if (*phem == 'E') {
 122:nmeap01.c     ****         ew = 1;
 123:nmeap01.c     ****     }
 124:nmeap01.c     ****     else {
 125:nmeap01.c     ****         ew = -1;
 126:nmeap01.c     ****     }
 127:nmeap01.c     ****     
 128:nmeap01.c     ****     /* longitude is degrees, minutes, fractional minutes */
 129:nmeap01.c     ****     /* no validation is performed on the token. it better be good.*/
 130:nmeap01.c     ****     /* if it comes back 0.0 then probably the token was bad */
 131:nmeap01.c     ****     lon = atof(plon);
 132:nmeap01.c     ****     
 133:nmeap01.c     ****     /* extract the degree part */
 134:nmeap01.c     ****     deg = (int)(lon / 100.0);
 135:nmeap01.c     ****     
 136:nmeap01.c     ****     /* mask out the degrees */
 137:nmeap01.c     ****     min = lon - (deg * 100.0);
 138:nmeap01.c     ****     
 139:nmeap01.c     ****     /* compute the actual lonitude in degrees.decimal-degrees */
 140:nmeap01.c     ****     lon = (deg + (min / 60.0)) * ew;
 141:nmeap01.c     **** 
 142:nmeap01.c     ****     
 143:nmeap01.c     ****     return lon;
 144:nmeap01.c     **** }
 145:nmeap01.c     **** 
 146:nmeap01.c     **** /**
 147:nmeap01.c     ****  * get an altitude longitude out of a pair of nmea tokens
 148:nmeap01.c     ****  * ALTITUDE is returned in METERS 
 149:nmeap01.c     ****  */
 150:nmeap01.c     **** double nmeap_altitude(const char *palt,const char *punits)
 151:nmeap01.c     **** {
 152:nmeap01.c     ****     double alt;
 183               		.stabn	68,0,152,.LM0-nmeap_altitude
 184               	.LM0:
 185               	/* prologue: frame size=0 */
 186 0000 CF93      		push r28
GAS LISTING /var/tmp//ccvnAEfo.s 			page 7


 187 0002 DF93      		push r29
 188               	/* prologue end (size=2) */
 189 0004 FC01      		movw r30,r24
 190 0006 EB01      		movw r28,r22
 153:nmeap01.c     ****     
 154:nmeap01.c     ****     if (*palt == 0) {
 155:nmeap01.c     ****         return 0.0;
 191               		.stabn	68,0,155,.LM1-nmeap_altitude
 192               	.LM1:
 193 0008 8081      		ld r24,Z
 194 000a 8823      		tst r24
 195 000c 29F4      		brne .L2
 196               		.stabn	68,0,155,.LM2-nmeap_altitude
 197               	.LM2:
 198 000e 60E0      		ldi r22,lo8(0x0)
 199 0010 70E0      		ldi r23,hi8(0x0)
 200 0012 80E0      		ldi r24,hlo8(0x0)
 201 0014 90E0      		ldi r25,hhi8(0x0)
 202 0016 0EC0      		rjmp .L4
 203               	.L2:
 156:nmeap01.c     ****     }
 157:nmeap01.c     ****     
 158:nmeap01.c     ****     /* convert with no error checking */
 159:nmeap01.c     ****     alt = atof(palt);
 160:nmeap01.c     ****     
 204               		.stabn	68,0,160,.LM3-nmeap_altitude
 205               	.LM3:
 206 0018 CF01      		movw r24,r30
 207 001a 0E94 0000 		call atof
 161:nmeap01.c     ****     if (*punits == 'M') {
 162:nmeap01.c     ****         /* already in meters */ 
 208               		.stabn	68,0,162,.LM4-nmeap_altitude
 209               	.LM4:
 210 001e 2881      		ld r18,Y
 211 0020 2D34      		cpi r18,lo8(77)
 212 0022 41F0      		breq .L4
 163:nmeap01.c     ****     }
 164:nmeap01.c     ****     else if (*punits == 'F') {
 165:nmeap01.c     ****         /* convert to feet */
 213               		.stabn	68,0,165,.LM5-nmeap_altitude
 214               	.LM5:
 215 0024 2634      		cpi r18,lo8(70)
 216 0026 31F4      		brne .L4
 166:nmeap01.c     ****         alt = alt * 3.2808399;
 167:nmeap01.c     ****     }
 217               		.stabn	68,0,167,.LM6-nmeap_altitude
 218               	.LM6:
 219 0028 28E4      		ldi r18,lo8(0x4051f948)
 220 002a 39EF      		ldi r19,hi8(0x4051f948)
 221 002c 41E5      		ldi r20,hlo8(0x4051f948)
 222 002e 50E4      		ldi r21,hhi8(0x4051f948)
 223 0030 0E94 0000 		call __mulsf3
 224               	.L4:
 225               	/* epilogue: frame size=0 */
 226 0034 DF91      		pop r29
 227 0036 CF91      		pop r28
 228 0038 0895      		ret
GAS LISTING /var/tmp//ccvnAEfo.s 			page 8


 229               	/* epilogue end (size=3) */
 230               	/* function nmeap_altitude size 29 (24) */
 231               		.size	nmeap_altitude, .-nmeap_altitude
 232               		.stabs	"alt:r(0,13)",64,0,153,22
 233               		.stabn	192,0,0,nmeap_altitude-nmeap_altitude
 234               		.stabn	224,0,0,.Lscope0-nmeap_altitude
 235               	.Lscope0:
 236               		.stabs	"",36,0,0,.Lscope0-nmeap_altitude
 237               		.stabd	78,0,0
 238               		.stabs	"nmeap_tokenize:F(0,1)",36,0,236,nmeap_tokenize
 239               		.stabs	"context:P(0,18)=*(13,11)",64,0,235,30
 240               	.global	nmeap_tokenize
 241               		.type	nmeap_tokenize, @function
 242               	nmeap_tokenize:
 243               		.stabd	46,0,0
 168:nmeap01.c     ****     
 169:nmeap01.c     ****     return alt;
 170:nmeap01.c     **** }
 171:nmeap01.c     **** 
 172:nmeap01.c     **** /**
 173:nmeap01.c     ****  * initialize an NMEA parser
 174:nmeap01.c     ****  */
 175:nmeap01.c     **** int nmeap_init(nmeap_context_t *context,void *user_data)
 176:nmeap01.c     **** {
 177:nmeap01.c     ****     assert(context != 0);
 178:nmeap01.c     **** 
 179:nmeap01.c     ****     memset(context,0,sizeof(*context));
 180:nmeap01.c     **** 
 181:nmeap01.c     ****     context->user_data = user_data;
 182:nmeap01.c     **** 
 183:nmeap01.c     ****     return 0;    
 184:nmeap01.c     **** }
 185:nmeap01.c     **** 
 186:nmeap01.c     ****  
 187:nmeap01.c     **** /**
 188:nmeap01.c     ****  * register an NMEA sentence parser
 189:nmeap01.c     ****  */
 190:nmeap01.c     **** int nmeap_addParser(nmeap_context_t         *context,
 191:nmeap01.c     **** 					 const char             *sentence_name,
 192:nmeap01.c     **** 					 nmeap_sentence_parser_t sentence_parser,
 193:nmeap01.c     **** 					 nmeap_callout_t         sentence_callout,
 194:nmeap01.c     ****                      void                  *sentence_data
 195:nmeap01.c     **** 					 )
 196:nmeap01.c     **** {
 197:nmeap01.c     ****     nmeap_sentence_t *s = 0;
 198:nmeap01.c     ****     
 199:nmeap01.c     ****     /* runtime error */
 200:nmeap01.c     ****     assert(context != 0);
 201:nmeap01.c     ****     
 202:nmeap01.c     ****     /* sentence capacity overflow */
 203:nmeap01.c     ****     if (context->sentence_count >= NMEAP_MAX_SENTENCES) {
 204:nmeap01.c     ****         return -1;
 205:nmeap01.c     ****     }
 206:nmeap01.c     ****     
 207:nmeap01.c     ****     /* point at next empty sentence buffer */
 208:nmeap01.c     ****     s = &context->sentence[context->sentence_count];
 209:nmeap01.c     ****     
GAS LISTING /var/tmp//ccvnAEfo.s 			page 9


 210:nmeap01.c     ****     /* advance sentence data count */
 211:nmeap01.c     ****     context->sentence_count++;
 212:nmeap01.c     ****     
 213:nmeap01.c     ****     /* clear the sentence data */
 214:nmeap01.c     ****     memset(s,0,sizeof(*s));
 215:nmeap01.c     ****     
 216:nmeap01.c     ****     /* name */
 217:nmeap01.c     ****     strncpy(s->name,sentence_name,NMEAP_MAX_SENTENCE_NAME_LENGTH);
 218:nmeap01.c     ****     
 219:nmeap01.c     ****     /* parser */
 220:nmeap01.c     ****     s->parser = sentence_parser;
 221:nmeap01.c     ****     
 222:nmeap01.c     ****     /* callout */
 223:nmeap01.c     ****     s->callout = sentence_callout;
 224:nmeap01.c     ****     
 225:nmeap01.c     ****     /* data */
 226:nmeap01.c     ****     s->data    = sentence_data;
 227:nmeap01.c     **** 
 228:nmeap01.c     ****     return 0;
 229:nmeap01.c     **** }
 230:nmeap01.c     **** 
 231:nmeap01.c     **** /** 
 232:nmeap01.c     ****  * tokenize a buffer
 233:nmeap01.c     ****  */
 234:nmeap01.c     **** int nmeap_tokenize(nmeap_context_t *context)
 235:nmeap01.c     **** {
 236:nmeap01.c     ****     char *s;
 244               		.stabn	68,0,236,.LM7-nmeap_tokenize
 245               	.LM7:
 246               	/* prologue: frame size=0 */
 247               	/* prologue end (size=0) */
 248 003a FC01      		movw r30,r24
 237:nmeap01.c     ****     int   tokens;
 238:nmeap01.c     ****     int   state;
 239:nmeap01.c     ****     
 240:nmeap01.c     ****     /* first token is header. assume it is there */
 241:nmeap01.c     ****     tokens = 0;
 242:nmeap01.c     ****     s = context->input;
 243:nmeap01.c     ****     context->token[tokens] = s;
 249               		.stabn	68,0,243,.LM8-nmeap_tokenize
 250               	.LM8:
 251 003c DC01      		movw r26,r24
 252 003e AE58      		subi r26,lo8(-(114))
 253 0040 BF4F      		sbci r27,hi8(-(114))
 244:nmeap01.c     ****     
 254               		.stabn	68,0,244,.LM9-nmeap_tokenize
 255               	.LM9:
 256 0042 E258      		subi r30,lo8(-(382))
 257 0044 FE4F      		sbci r31,hi8(-(382))
 258 0046 A193      		st Z+,r26
 259 0048 B193      		st Z+,r27
 260 004a 41E0      		ldi r20,lo8(1)
 261 004c 50E0      		ldi r21,hi8(1)
 262 004e 20E0      		ldi r18,lo8(0)
 263 0050 30E0      		ldi r19,hi8(0)
 264 0052 19C0      		rjmp .L9
 265               	.L10:
GAS LISTING /var/tmp//ccvnAEfo.s 			page 10


 245:nmeap01.c     ****     /* get rest of tokens */
 246:nmeap01.c     ****     tokens = 1;
 247:nmeap01.c     ****     state = 0;
 248:nmeap01.c     ****     while((*s != 0)&&(tokens < NMEAP_MAX_TOKENS)) {
 249:nmeap01.c     ****         switch(state) {
 250:nmeap01.c     ****         case 0:
 266               		.stabn	68,0,250,.LM10-nmeap_tokenize
 267               	.LM10:
 268 0054 2115      		cp r18,__zero_reg__
 269 0056 3105      		cpc r19,__zero_reg__
 270 0058 21F0      		breq .L12
 271 005a 2130      		cpi r18,1
 272 005c 3105      		cpc r19,__zero_reg__
 273 005e 81F4      		brne .L11
 274 0060 06C0      		rjmp .L13
 275               	.L12:
 251:nmeap01.c     ****             /* looking for end of a token */
 252:nmeap01.c     ****             if (*s == ',') {
 253:nmeap01.c     ****                 /* delimit at the comma */
 276               		.stabn	68,0,253,.LM11-nmeap_tokenize
 277               	.LM11:
 278 0062 8C32      		cpi r24,lo8(44)
 279 0064 69F4      		brne .L11
 254:nmeap01.c     ****                 *s    = 0;
 255:nmeap01.c     ****                 /* new token */
 280               		.stabn	68,0,255,.LM12-nmeap_tokenize
 281               	.LM12:
 282 0066 1C92      		st X,__zero_reg__
 283 0068 21E0      		ldi r18,lo8(1)
 284 006a 30E0      		ldi r19,hi8(1)
 285 006c 0BC0      		rjmp .L15
 286               	.L13:
 256:nmeap01.c     ****                 state = 1;
 257:nmeap01.c     ****             }
 258:nmeap01.c     ****             break;
 259:nmeap01.c     ****         case 1:
 260:nmeap01.c     ****             /* start of next token, might be another comma */
 261:nmeap01.c     ****             context->token[tokens++] = s;
 262:nmeap01.c     ****             if (*s == ',') {
 287               		.stabn	68,0,262,.LM13-nmeap_tokenize
 288               	.LM13:
 289 006e A193      		st Z+,r26
 290 0070 B193      		st Z+,r27
 291 0072 4F5F      		subi r20,lo8(-(1))
 292 0074 5F4F      		sbci r21,hi8(-(1))
 263:nmeap01.c     ****                 /* delimit at the comma */
 293               		.stabn	68,0,263,.LM14-nmeap_tokenize
 294               	.LM14:
 295 0076 8C91      		ld r24,X
 296 0078 8C32      		cpi r24,lo8(44)
 297 007a 11F4      		brne .L11
 264:nmeap01.c     ****                 *s    = 0;
 265:nmeap01.c     ****             }
 298               		.stabn	68,0,265,.LM15-nmeap_tokenize
 299               	.LM15:
 300 007c 1C92      		st X,__zero_reg__
 301 007e 02C0      		rjmp .L15
GAS LISTING /var/tmp//ccvnAEfo.s 			page 11


 302               	.L11:
 303 0080 20E0      		ldi r18,lo8(0)
 304 0082 30E0      		ldi r19,hi8(0)
 305               	.L15:
 266:nmeap01.c     ****             else {   
 267:nmeap01.c     ****                 /* not a comma */
 268:nmeap01.c     ****                 state = 0;
 269:nmeap01.c     ****             }
 270:nmeap01.c     ****             break;
 271:nmeap01.c     ****         default:
 272:nmeap01.c     ****             state = 0;
 273:nmeap01.c     ****             break;
 274:nmeap01.c     ****         }
 275:nmeap01.c     ****         
 276:nmeap01.c     ****         // next character
 277:nmeap01.c     ****         s++;
 278:nmeap01.c     ****     }
 306               		.stabn	68,0,278,.LM16-nmeap_tokenize
 307               	.LM16:
 308 0084 1196      		adiw r26,1
 309               	.L9:
 310               		.stabn	68,0,249,.LM17-nmeap_tokenize
 311               	.LM17:
 312 0086 8C91      		ld r24,X
 313 0088 8823      		tst r24
 314 008a 19F0      		breq .L17
 315 008c 4831      		cpi r20,24
 316 008e 5105      		cpc r21,__zero_reg__
 317 0090 0CF3      		brlt .L10
 318               	.L17:
 279:nmeap01.c     ****     return tokens;
 280:nmeap01.c     **** }
 281:nmeap01.c     **** 
 319               		.stabn	68,0,281,.LM18-nmeap_tokenize
 320               	.LM18:
 321 0092 CA01      		movw r24,r20
 322               	/* epilogue: frame size=0 */
 323 0094 0895      		ret
 324               	/* epilogue end (size=1) */
 325               	/* function nmeap_tokenize size 46 (45) */
 326               		.size	nmeap_tokenize, .-nmeap_tokenize
 327               		.stabs	"s:r(13,10)",64,0,237,26
 328               		.stabs	"tokens:r(0,1)",64,0,238,20
 329               		.stabs	"state:r(0,1)",64,0,239,18
 330               		.stabn	192,0,0,nmeap_tokenize-nmeap_tokenize
 331               		.stabn	224,0,0,.Lscope1-nmeap_tokenize
 332               	.Lscope1:
 333               		.stabs	"",36,0,0,.Lscope1-nmeap_tokenize
 334               		.stabd	78,0,0
 335               		.stabs	"nmeap_process:F(0,1)",36,0,287,nmeap_process
 336               		.stabs	"context:P(0,18)",64,0,286,28
 337               	.global	nmeap_process
 338               		.type	nmeap_process, @function
 339               	nmeap_process:
 340               		.stabd	46,0,0
 282:nmeap01.c     **** /**
 283:nmeap01.c     ****  * process a sentence 
GAS LISTING /var/tmp//ccvnAEfo.s 			page 12


 284:nmeap01.c     ****  */
 285:nmeap01.c     **** int nmeap_process(nmeap_context_t *context)
 286:nmeap01.c     **** {
 287:nmeap01.c     ****     int id = 0;
 341               		.stabn	68,0,287,.LM19-nmeap_process
 342               	.LM19:
 343               	/* prologue: frame size=0 */
 344 0096 CF92      		push r12
 345 0098 DF92      		push r13
 346 009a EF92      		push r14
 347 009c FF92      		push r15
 348 009e 0F93      		push r16
 349 00a0 1F93      		push r17
 350 00a2 CF93      		push r28
 351 00a4 DF93      		push r29
 352               	/* prologue end (size=8) */
 353 00a6 EC01      		movw r28,r24
 288:nmeap01.c     ****     int i;
 289:nmeap01.c     ****     nmeap_sentence_t *s;
 290:nmeap01.c     **** 	
 291:nmeap01.c     ****     /* copy the input to a debug buffer */
 292:nmeap01.c     ****     /* remove debug_input when everything is working. */
 293:nmeap01.c     ****     strncpy(context->debug_input,context->input,sizeof(context->debug_input));
 294:nmeap01.c     ****     
 354               		.stabn	68,0,294,.LM20-nmeap_process
 355               	.LM20:
 356 00a8 BC01      		movw r22,r24
 357 00aa 6E58      		subi r22,lo8(-(114))
 358 00ac 7F4F      		sbci r23,hi8(-(114))
 359 00ae 40E0      		ldi r20,lo8(256)
 360 00b0 51E0      		ldi r21,hi8(256)
 361 00b2 8453      		subi r24,lo8(-(460))
 362 00b4 9E4F      		sbci r25,hi8(-(460))
 363 00b6 0E94 0000 		call strncpy
 295:nmeap01.c     ****     /* tokenize the input */
 296:nmeap01.c     ****     context->tokens = nmeap_tokenize(context);
 297:nmeap01.c     ****     
 364               		.stabn	68,0,297,.LM21-nmeap_process
 365               	.LM21:
 366 00ba CE01      		movw r24,r28
 367 00bc 0E94 0000 		call nmeap_tokenize
 368 00c0 C255      		subi r28,lo8(-(430))
 369 00c2 DE4F      		sbci r29,hi8(-(430))
 370 00c4 9983      		std Y+1,r25
 371 00c6 8883      		st Y,r24
 372 00c8 CE5A      		subi r28,lo8(-(-430))
 373 00ca D140      		sbci r29,hi8(-(-430))
 374 00cc EE24      		clr r14
 375 00ce FF24      		clr r15
 376 00d0 CC24      		clr r12
 377 00d2 DD24      		clr r13
 378 00d4 8E01      		movw r16,r28
 379 00d6 1EC0      		rjmp .L21
 380               	.L22:
 298:nmeap01.c     ****     /* try to find a matching sentence parser */
 299:nmeap01.c     ****     /* this search is O(n). it has a lot of potential for optimization, at the expense of complexit
 300:nmeap01.c     ****     /* binary search instead of linear (have to keep sentences in sorted order) O(NlogN) */
GAS LISTING /var/tmp//ccvnAEfo.s 			page 13


 301:nmeap01.c     ****     /* OR, when sentences are added, create a TRIE structure to find the names with a constant time
 302:nmeap01.c     ****     for(i=0;i<context->sentence_count;i++) {
 303:nmeap01.c     ****         s = &context->sentence[i];
 304:nmeap01.c     ****         assert(s != 0);
 305:nmeap01.c     ****         if (strncmp(context->input_name,s->name,5) == 0) {
 381               		.stabn	68,0,305,.LM22-nmeap_process
 382               	.LM22:
 383 00d8 0115      		cp r16,__zero_reg__
 384 00da 1105      		cpc r17,__zero_reg__
 385 00dc 09F4      		brne .L23
 386               	.L29:
 387 00de FFCF      		rjmp .L29
 388               	.L23:
 306:nmeap01.c     ****             /* found a match, call its parser */
 389               		.stabn	68,0,306,.LM23-nmeap_process
 390               	.LM23:
 391 00e0 45E0      		ldi r20,lo8(5)
 392 00e2 50E0      		ldi r21,hi8(5)
 393 00e4 B801      		movw r22,r16
 394 00e6 CE01      		movw r24,r28
 395 00e8 8A58      		subi r24,lo8(-(374))
 396 00ea 9E4F      		sbci r25,hi8(-(374))
 397 00ec 0E94 0000 		call strncmp
 398 00f0 892B      		or r24,r25
 399 00f2 59F4      		brne .L25
 307:nmeap01.c     ****             id = (*context->sentence[i].parser)(context,s);
 308:nmeap01.c     ****             if (id > 0) {
 400               		.stabn	68,0,308,.LM24-nmeap_process
 401               	.LM24:
 402 00f4 F801      		movw r30,r16
 403 00f6 2085      		ldd r18,Z+8
 404 00f8 3185      		ldd r19,Z+9
 405 00fa B801      		movw r22,r16
 406 00fc CE01      		movw r24,r28
 407 00fe F901      		movw r30,r18
 408 0100 0995      		icall
 409 0102 7C01      		movw r14,r24
 309:nmeap01.c     ****                 break;
 410               		.stabn	68,0,309,.LM25-nmeap_process
 411               	.LM25:
 412 0104 1816      		cp __zero_reg__,r24
 413 0106 1906      		cpc __zero_reg__,r25
 414 0108 74F0      		brlt .L27
 415               	.L25:
 416               		.stabn	68,0,303,.LM26-nmeap_process
 417               	.LM26:
 418 010a 0894      		sec
 419 010c C11C      		adc r12,__zero_reg__
 420 010e D11C      		adc r13,__zero_reg__
 421 0110 025F      		subi r16,lo8(-(14))
 422 0112 1F4F      		sbci r17,hi8(-(14))
 423               	.L21:
 424 0114 C059      		subi r28,lo8(-(112))
 425 0116 DF4F      		sbci r29,hi8(-(112))
 426 0118 8881      		ld r24,Y
 427 011a 9981      		ldd r25,Y+1
 428 011c C057      		subi r28,lo8(-(-112))
GAS LISTING /var/tmp//ccvnAEfo.s 			page 14


 429 011e D040      		sbci r29,hi8(-(-112))
 430 0120 C816      		cp r12,r24
 431 0122 D906      		cpc r13,r25
 432 0124 CCF2      		brlt .L22
 433               	.L27:
 310:nmeap01.c     ****             }
 311:nmeap01.c     ****         }
 312:nmeap01.c     ****     }
 313:nmeap01.c     ****         
 314:nmeap01.c     ****     return id;
 315:nmeap01.c     **** }
 316:nmeap01.c     **** 
 434               		.stabn	68,0,316,.LM27-nmeap_process
 435               	.LM27:
 436 0126 C701      		movw r24,r14
 437               	/* epilogue: frame size=0 */
 438 0128 DF91      		pop r29
 439 012a CF91      		pop r28
 440 012c 1F91      		pop r17
 441 012e 0F91      		pop r16
 442 0130 FF90      		pop r15
 443 0132 EF90      		pop r14
 444 0134 DF90      		pop r13
 445 0136 CF90      		pop r12
 446 0138 0895      		ret
 447               	/* epilogue end (size=9) */
 448               	/* function nmeap_process size 82 (65) */
 449               		.size	nmeap_process, .-nmeap_process
 450               		.stabs	"id:r(0,1)",64,0,288,14
 451               		.stabs	"i:r(0,1)",64,0,289,12
 452               		.stabn	192,0,0,nmeap_process-nmeap_process
 453               		.stabn	224,0,0,.Lscope2-nmeap_process
 454               	.Lscope2:
 455               		.stabs	"",36,0,0,.Lscope2-nmeap_process
 456               		.stabd	78,0,0
 457               		.stabs	"nmeap_parse:F(0,1)",36,0,342,nmeap_parse
 458               		.stabs	"context:P(0,18)",64,0,341,28
 459               		.stabs	"ch:P(0,2)",64,0,341,13
 460               	.global	nmeap_parse
 461               		.type	nmeap_parse, @function
 462               	nmeap_parse:
 463               		.stabd	46,0,0
 317:nmeap01.c     **** /**
 318:nmeap01.c     ****                  +-5-+              +---+
 319:nmeap01.c     ****                  v   |              v   |
 320:nmeap01.c     ****  +------+       +------+           +------+         +------+         +------+
 321:nmeap01.c     ****  |   0  |--$--> |1-hdr |--alnum--> |2-data|----\r-->| 6-LF |---\n--->| done |--> 0
 322:nmeap01.c     ****  +------+       +------+           +------+         +------+         +------+
 323:nmeap01.c     ****                                     |                 ^
 324:nmeap01.c     ****                                     *                 +--------\r-------+
 325:nmeap01.c     ****                                     V                                   |
 326:nmeap01.c     ****                                  +------+           +------+         +------+
 327:nmeap01.c     ****                                  |3-cks |--xdigit-->|4-cks |-xdigit->| 5-CR |
 328:nmeap01.c     ****                                  +------+           +------+         +------+
 329:nmeap01.c     ****                                  
 330:nmeap01.c     **** return to start conditions:
 331:nmeap01.c     **** 1. buffer overflow
GAS LISTING /var/tmp//ccvnAEfo.s 			page 15


 332:nmeap01.c     **** 2. invalid character for state
 333:nmeap01.c     **** 
 334:nmeap01.c     **** checksum calculation
 335:nmeap01.c     **** two hex digits represent the XOR of all characters between, but not
 336:nmeap01.c     **** including, the "$" and "*".  A checksum is required on some
 337:nmeap01.c     **** sentences.
 338:nmeap01.c     **** 
 339:nmeap01.c     **** */
 340:nmeap01.c     **** int nmeap_parse(nmeap_context_t *context,char ch)
 341:nmeap01.c     **** {
 342:nmeap01.c     ****     int status = 0;
 464               		.stabn	68,0,342,.LM28-nmeap_parse
 465               	.LM28:
 466               	/* prologue: frame size=0 */
 467 013a 8F92      		push r8
 468 013c 9F92      		push r9
 469 013e AF92      		push r10
 470 0140 BF92      		push r11
 471 0142 DF92      		push r13
 472 0144 EF92      		push r14
 473 0146 FF92      		push r15
 474 0148 0F93      		push r16
 475 014a 1F93      		push r17
 476 014c CF93      		push r28
 477 014e DF93      		push r29
 478               	/* prologue end (size=11) */
 479 0150 EC01      		movw r28,r24
 480 0152 D62E      		mov r13,r22
 343:nmeap01.c     ****     
 344:nmeap01.c     ****     /* check for input buffer overrun first to avoid duplicating code in the
 345:nmeap01.c     ****     individual states
 346:nmeap01.c     ****     */
 347:nmeap01.c     ****     if (context->input_count >= (sizeof(context->input)-1)) {
 348:nmeap01.c     ****         /* input buffer overrun, restart state machine */
 481               		.stabn	68,0,348,.LM29-nmeap_parse
 482               	.LM29:
 483 0154 92E7      		ldi r25,lo8(370)
 484 0156 892E      		mov r8,r25
 485 0158 91E0      		ldi r25,hi8(370)
 486 015a 992E      		mov r9,r25
 487 015c 8C0E      		add r8,r28
 488 015e 9D1E      		adc r9,r29
 489 0160 F401      		movw r30,r8
 490 0162 8081      		ld r24,Z
 491 0164 9181      		ldd r25,Z+1
 492 0166 8F3F      		cpi r24,255
 493 0168 9105      		cpc r25,__zero_reg__
 494 016a 40F0      		brlo .L31
 349:nmeap01.c     ****         context->input_state = 0;
 350:nmeap01.c     ****         /* reset input count */
 495               		.stabn	68,0,350,.LM30-nmeap_parse
 496               	.LM30:
 497 016c CC58      		subi r28,lo8(-(372))
 498 016e DE4F      		sbci r29,hi8(-(372))
 499 0170 1982      		std Y+1,__zero_reg__
 500 0172 1882      		st Y,__zero_reg__
 501 0174 C457      		subi r28,lo8(-(-372))
GAS LISTING /var/tmp//ccvnAEfo.s 			page 16


 502 0176 D140      		sbci r29,hi8(-(-372))
 351:nmeap01.c     ****         context->input_count = 0;
 352:nmeap01.c     ****     }
 503               		.stabn	68,0,352,.LM31-nmeap_parse
 504               	.LM31:
 505 0178 1182      		std Z+1,__zero_reg__
 506 017a 1082      		st Z,__zero_reg__
 507               	.L31:
 353:nmeap01.c     ****     
 354:nmeap01.c     ****     /* store the byte */
 355:nmeap01.c     ****     context->input[context->input_count] = ch;
 356:nmeap01.c     ****     
 508               		.stabn	68,0,356,.LM32-nmeap_parse
 509               	.LM32:
 510 017c F401      		movw r30,r8
 511 017e 8081      		ld r24,Z
 512 0180 9181      		ldd r25,Z+1
 513 0182 8C01      		movw r16,r24
 514 0184 0C0F      		add r16,r28
 515 0186 1D1F      		adc r17,r29
 516 0188 0E58      		subi r16,lo8(-(114))
 517 018a 1F4F      		sbci r17,hi8(-(114))
 518 018c F801      		movw r30,r16
 519 018e D082      		st Z,r13
 520 0190 0257      		subi r16,lo8(-(-114))
 521 0192 1040      		sbci r17,hi8(-(-114))
 357:nmeap01.c     ****     /* next buffer position */
 358:nmeap01.c     ****     context->input_count++;
 359:nmeap01.c     ****     
 522               		.stabn	68,0,359,.LM33-nmeap_parse
 523               	.LM33:
 524 0194 7C01      		movw r14,r24
 525 0196 0894      		sec
 526 0198 E11C      		adc r14,__zero_reg__
 527 019a F11C      		adc r15,__zero_reg__
 528 019c F401      		movw r30,r8
 529 019e F182      		std Z+1,r15
 530 01a0 E082      		st Z,r14
 360:nmeap01.c     ****     /* run it through the lexical scanner */
 361:nmeap01.c     ****     switch(context->input_state) {
 362:nmeap01.c     ****     /* LOOKING FOR $ */
 531               		.stabn	68,0,362,.LM34-nmeap_parse
 532               	.LM34:
 533 01a2 84E7      		ldi r24,lo8(372)
 534 01a4 A82E      		mov r10,r24
 535 01a6 81E0      		ldi r24,hi8(372)
 536 01a8 B82E      		mov r11,r24
 537 01aa AC0E      		add r10,r28
 538 01ac BD1E      		adc r11,r29
 539 01ae F501      		movw r30,r10
 540 01b0 8081      		ld r24,Z
 541 01b2 9181      		ldd r25,Z+1
 542 01b4 8330      		cpi r24,3
 543 01b6 9105      		cpc r25,__zero_reg__
 544 01b8 09F4      		brne .+2
 545 01ba 5EC0      		rjmp .L37
 546 01bc 8430      		cpi r24,4
GAS LISTING /var/tmp//ccvnAEfo.s 			page 17


 547 01be 9105      		cpc r25,__zero_reg__
 548 01c0 54F4      		brge .L41
 549 01c2 8130      		cpi r24,1
 550 01c4 9105      		cpc r25,__zero_reg__
 551 01c6 29F1      		breq .L35
 552 01c8 8230      		cpi r24,2
 553 01ca 9105      		cpc r25,__zero_reg__
 554 01cc 0CF0      		brlt .+2
 555 01ce 3FC0      		rjmp .L36
 556 01d0 892B      		or r24,r25
 557 01d2 69F0      		breq .L34
 558 01d4 06C1      		rjmp .L33
 559               	.L41:
 560 01d6 8530      		cpi r24,5
 561 01d8 9105      		cpc r25,__zero_reg__
 562 01da 09F4      		brne .+2
 563 01dc A2C0      		rjmp .L39
 564 01de 8530      		cpi r24,5
 565 01e0 9105      		cpc r25,__zero_reg__
 566 01e2 0CF4      		brge .+2
 567 01e4 66C0      		rjmp .L38
 568 01e6 0697      		sbiw r24,6
 569 01e8 09F0      		breq .+2
 570 01ea FBC0      		rjmp .L33
 571 01ec A4C0      		rjmp .L40
 572               	.L34:
 363:nmeap01.c     ****     case 0:
 364:nmeap01.c     ****         if (ch == '$') {
 365:nmeap01.c     ****             /*look for id */
 573               		.stabn	68,0,365,.LM35-nmeap_parse
 574               	.LM35:
 575 01ee F4E2      		ldi r31,lo8(36)
 576 01f0 DF16      		cp r13,r31
 577 01f2 59F4      		brne .L42
 366:nmeap01.c     ****             context->input_state = 1;
 367:nmeap01.c     ****             context->ccks        = 0;
 578               		.stabn	68,0,367,.LM36-nmeap_parse
 579               	.LM36:
 580 01f4 81E0      		ldi r24,lo8(1)
 581 01f6 90E0      		ldi r25,hi8(1)
 582 01f8 F501      		movw r30,r10
 583 01fa 9183      		std Z+1,r25
 584 01fc 8083      		st Z,r24
 368:nmeap01.c     **** 			context->icks        = 0;
 585               		.stabn	68,0,368,.LM37-nmeap_parse
 586               	.LM37:
 587 01fe C358      		subi r28,lo8(-(381))
 588 0200 DE4F      		sbci r29,hi8(-(381))
 589 0202 1882      		st Y,__zero_reg__
 369:nmeap01.c     ****         }
 590               		.stabn	68,0,369,.LM38-nmeap_parse
 591               	.LM38:
 592 0204 FE01      		movw r30,r28
 593 0206 1292      		st -Z,__zero_reg__
 594 0208 FEC0      		rjmp .L74
 595               	.L42:
 370:nmeap01.c     ****         else {
GAS LISTING /var/tmp//ccvnAEfo.s 			page 18


 371:nmeap01.c     ****             /* header error, start over */
 372:nmeap01.c     ****             context->err_hdr++;
 373:nmeap01.c     ****             context->input_state = 0;
 596               		.stabn	68,0,373,.LM39-nmeap_parse
 597               	.LM39:
 598 020a FE01      		movw r30,r28
 599 020c EC54      		subi r30,lo8(-(436))
 600 020e FE4F      		sbci r31,hi8(-(436))
 601 0210 D6C0      		rjmp .L75
 602               	.L35:
 374:nmeap01.c     ****             context->input_count = 0;
 375:nmeap01.c     ****         }
 376:nmeap01.c     ****         break;
 377:nmeap01.c     ****     /* LOOKING FOR 5 CHARACTER SENTENCE ID */
 378:nmeap01.c     ****     case 1:
 379:nmeap01.c     ****         /* allow numbers even though it isn't usually done */
 380:nmeap01.c     ****         /* a proprietary id might have a numeral */
 381:nmeap01.c     ****         if (isalnum(ch)) {
 382:nmeap01.c     ****             /* store name separately */
 603               		.stabn	68,0,382,.LM40-nmeap_parse
 604               	.LM40:
 605 0212 8D2D      		mov r24,r13
 606 0214 9927      		clr r25
 607 0216 87FD      		sbrc r24,7
 608 0218 9095      		com r25
 609 021a 0E94 0000 		call isalnum
 610 021e 892B      		or r24,r25
 611 0220 91F0      		breq .L45
 383:nmeap01.c     ****             context->input_name[context->input_count - 2] = ch;
 384:nmeap01.c     ****             /* checksum */
 612               		.stabn	68,0,384,.LM41-nmeap_parse
 613               	.LM41:
 614 0222 0B58      		subi r16,lo8(-(373))
 615 0224 1E4F      		sbci r17,hi8(-(373))
 616 0226 F801      		movw r30,r16
 617 0228 D082      		st Z,r13
 385:nmeap01.c     ****             context->ccks ^= ch;
 386:nmeap01.c     ****             /* end of header? */
 618               		.stabn	68,0,386,.LM42-nmeap_parse
 619               	.LM42:
 620 022a FE01      		movw r30,r28
 621 022c E358      		subi r30,lo8(-(381))
 622 022e FE4F      		sbci r31,hi8(-(381))
 623 0230 8081      		ld r24,Z
 624 0232 8D25      		eor r24,r13
 625 0234 8083      		st Z,r24
 387:nmeap01.c     ****             if (context->input_count >= 6) {
 388:nmeap01.c     ****                 /* yes, get body */
 626               		.stabn	68,0,388,.LM43-nmeap_parse
 627               	.LM43:
 628 0236 F6E0      		ldi r31,lo8(6)
 629 0238 EF16      		cp r14,r31
 630 023a F104      		cpc r15,__zero_reg__
 631 023c 0CF4      		brge .+2
 632 023e E3C0      		rjmp .L74
 389:nmeap01.c     ****                 context->input_state = 2;
 390:nmeap01.c     ****             }
GAS LISTING /var/tmp//ccvnAEfo.s 			page 19


 633               		.stabn	68,0,390,.LM44-nmeap_parse
 634               	.LM44:
 635 0240 82E0      		ldi r24,lo8(2)
 636 0242 90E0      		ldi r25,hi8(2)
 637 0244 74C0      		rjmp .L76
 638               	.L45:
 391:nmeap01.c     ****         }
 392:nmeap01.c     ****         else {
 393:nmeap01.c     ****             /* bad character, start over */
 394:nmeap01.c     ****             context->err_id++;
 395:nmeap01.c     ****             context->input_state = 0;
 639               		.stabn	68,0,395,.LM45-nmeap_parse
 640               	.LM45:
 641 0246 FE01      		movw r30,r28
 642 0248 E054      		subi r30,lo8(-(448))
 643 024a FE4F      		sbci r31,hi8(-(448))
 644 024c B8C0      		rjmp .L75
 645               	.L36:
 396:nmeap01.c     ****             context->input_count = 0;
 397:nmeap01.c     ****         }
 398:nmeap01.c     ****         break;
 399:nmeap01.c     ****     /* LOOKING FOR CR OR CHECKSUM INDICATOR */
 400:nmeap01.c     ****     case 2:
 401:nmeap01.c     ****         if (ch == '*') {
 402:nmeap01.c     ****             /* this sentence has a checksum */
 646               		.stabn	68,0,402,.LM46-nmeap_parse
 647               	.LM46:
 648 024e FAE2      		ldi r31,lo8(42)
 649 0250 DF16      		cp r13,r31
 650 0252 19F4      		brne .L49
 403:nmeap01.c     ****             context->input_state = 3;
 404:nmeap01.c     ****         }
 651               		.stabn	68,0,404,.LM47-nmeap_parse
 652               	.LM47:
 653 0254 83E0      		ldi r24,lo8(3)
 654 0256 90E0      		ldi r25,hi8(3)
 655 0258 6AC0      		rjmp .L76
 656               	.L49:
 657 025a FE01      		movw r30,r28
 658 025c E358      		subi r30,lo8(-(381))
 659 025e FE4F      		sbci r31,hi8(-(381))
 405:nmeap01.c     ****         else if (ch == '\r') {
 406:nmeap01.c     ****             /* carriage return, no checksum, force a match */
 660               		.stabn	68,0,406,.LM48-nmeap_parse
 661               	.LM48:
 662 0260 8DE0      		ldi r24,lo8(13)
 663 0262 D816      		cp r13,r24
 664 0264 29F4      		brne .L51
 407:nmeap01.c     **** 			context->icks = 0;
 408:nmeap01.c     **** 			context->ccks = 0;
 665               		.stabn	68,0,408,.LM49-nmeap_parse
 666               	.LM49:
 667 0266 C458      		subi r28,lo8(-(380))
 668 0268 DE4F      		sbci r29,hi8(-(380))
 669 026a 1882      		st Y,__zero_reg__
 409:nmeap01.c     ****             context->input_state = 6;
 670               		.stabn	68,0,409,.LM50-nmeap_parse
GAS LISTING /var/tmp//ccvnAEfo.s 			page 20


 671               	.LM50:
 672 026c 1082      		st Z,__zero_reg__
 673 026e 5DC0      		rjmp .L77
 674               	.L51:
 410:nmeap01.c     ****         }
 411:nmeap01.c     ****         else {
 412:nmeap01.c     ****             /* continue accumulating data */
 413:nmeap01.c     ****             /* checksum */
 414:nmeap01.c     ****             context->ccks ^= ch;
 415:nmeap01.c     ****         }
 675               		.stabn	68,0,415,.LM51-nmeap_parse
 676               	.LM51:
 677 0270 8081      		ld r24,Z
 678 0272 8D25      		eor r24,r13
 679 0274 8083      		st Z,r24
 680 0276 C7C0      		rjmp .L74
 681               	.L37:
 416:nmeap01.c     ****         break;
 417:nmeap01.c     ****     /* LOOKING FOR FIRST CHECKSUM CHARACTER */
 418:nmeap01.c     ****     case 3:
 419:nmeap01.c     ****         /* must be upper case hex digit */
 420:nmeap01.c     ****         if (isxdigit(ch) && (ch <= 'F')) {
 421:nmeap01.c     ****             /* got first checksum byte */
 682               		.stabn	68,0,421,.LM52-nmeap_parse
 683               	.LM52:
 684 0278 0D2D      		mov r16,r13
 685 027a 1127      		clr r17
 686 027c 07FD      		sbrc r16,7
 687 027e 1095      		com r17
 688 0280 C801      		movw r24,r16
 689 0282 0E94 0000 		call isxdigit
 690 0286 892B      		or r24,r25
 691 0288 B1F1      		breq .L59
 692 028a F6E4      		ldi r31,lo8(70)
 693 028c FD15      		cp r31,r13
 694 028e 9CF1      		brlt .L59
 422:nmeap01.c     ****             context->input_state = 4;
 423:nmeap01.c     ****             context->icks = HEXTOBIN(ch) << 4;
 695               		.stabn	68,0,423,.LM53-nmeap_parse
 696               	.LM53:
 697 0290 84E0      		ldi r24,lo8(4)
 698 0292 90E0      		ldi r25,hi8(4)
 699 0294 F501      		movw r30,r10
 700 0296 9183      		std Z+1,r25
 701 0298 8083      		st Z,r24
 424:nmeap01.c     ****         }
 702               		.stabn	68,0,424,.LM54-nmeap_parse
 703               	.LM54:
 704 029a F9E3      		ldi r31,lo8(57)
 705 029c FD15      		cp r31,r13
 706 029e 14F4      		brge .L73
 707 02a0 0753      		subi r16,lo8(-(-55))
 708 02a2 1040      		sbci r17,hi8(-(-55))
 709               	.L73:
 710 02a4 802F      		mov r24,r16
 711 02a6 8295      		swap r24
 712 02a8 807F      		andi r24,0xf0
GAS LISTING /var/tmp//ccvnAEfo.s 			page 21


 713 02aa C458      		subi r28,lo8(-(380))
 714 02ac DE4F      		sbci r29,hi8(-(380))
 715 02ae 8883      		st Y,r24
 716 02b0 AAC0      		rjmp .L74
 717               	.L38:
 425:nmeap01.c     ****         else {
 426:nmeap01.c     ****             /* input error, restart */
 427:nmeap01.c     ****             context->err_cks++;
 428:nmeap01.c     ****             context->input_state = 0;
 429:nmeap01.c     ****             context->input_count = 0;
 430:nmeap01.c     ****         }
 431:nmeap01.c     ****         break;
 432:nmeap01.c     ****         /* LOOKING FOR SECOND CHECKSUM CHARACTER */
 433:nmeap01.c     ****     case 4:
 434:nmeap01.c     ****         /* must be upper case hex digit */
 435:nmeap01.c     ****         if (isxdigit(ch) && (ch <= 'F')) {
 436:nmeap01.c     ****             /* got second checksum byte */
 718               		.stabn	68,0,436,.LM55-nmeap_parse
 719               	.LM55:
 720 02b2 8D2D      		mov r24,r13
 721 02b4 9927      		clr r25
 722 02b6 87FD      		sbrc r24,7
 723 02b8 9095      		com r25
 724 02ba 0E94 0000 		call isxdigit
 725 02be 892B      		or r24,r25
 726 02c0 D1F0      		breq .L59
 727 02c2 86E4      		ldi r24,lo8(70)
 728 02c4 8D15      		cp r24,r13
 729 02c6 BCF0      		brlt .L59
 437:nmeap01.c     ****             context->input_state = 5;
 438:nmeap01.c     ****             context->icks += HEXTOBIN(ch);
 730               		.stabn	68,0,438,.LM56-nmeap_parse
 731               	.LM56:
 732 02c8 85E0      		ldi r24,lo8(5)
 733 02ca 90E0      		ldi r25,hi8(5)
 734 02cc F501      		movw r30,r10
 735 02ce 9183      		std Z+1,r25
 736 02d0 8083      		st Z,r24
 439:nmeap01.c     ****         }
 737               		.stabn	68,0,439,.LM57-nmeap_parse
 738               	.LM57:
 739 02d2 C458      		subi r28,lo8(-(380))
 740 02d4 DE4F      		sbci r29,hi8(-(380))
 741 02d6 2881      		ld r18,Y
 742 02d8 CC57      		subi r28,lo8(-(-380))
 743 02da D140      		sbci r29,hi8(-(-380))
 744 02dc F9E3      		ldi r31,lo8(57)
 745 02de FD15      		cp r31,r13
 746 02e0 1CF0      		brlt .L62
 747 02e2 6D2D      		mov r22,r13
 748 02e4 6053      		subi r22,lo8(-(-48))
 749 02e6 02C0      		rjmp .L64
 750               	.L62:
 751 02e8 6D2D      		mov r22,r13
 752 02ea 6753      		subi r22,lo8(-(-55))
 753               	.L64:
 754 02ec C458      		subi r28,lo8(-(380))
GAS LISTING /var/tmp//ccvnAEfo.s 			page 22


 755 02ee DE4F      		sbci r29,hi8(-(380))
 756 02f0 260F      		add r18,r22
 757 02f2 2883      		st Y,r18
 758 02f4 88C0      		rjmp .L74
 759               	.L59:
 440:nmeap01.c     ****         else {
 441:nmeap01.c     ****             /* input error, restart */
 442:nmeap01.c     ****             context->err_cks++;
 443:nmeap01.c     ****             context->input_state = 0;
 760               		.stabn	68,0,443,.LM58-nmeap_parse
 761               	.LM58:
 762 02f6 FE01      		movw r30,r28
 763 02f8 EC53      		subi r30,lo8(-(452))
 764 02fa FE4F      		sbci r31,hi8(-(452))
 765 02fc 8081      		ld r24,Z
 766 02fe 9181      		ldd r25,Z+1
 767 0300 A281      		ldd r26,Z+2
 768 0302 B381      		ldd r27,Z+3
 769 0304 0196      		adiw r24,1
 770 0306 A11D      		adc r26,__zero_reg__
 771 0308 B11D      		adc r27,__zero_reg__
 772 030a 8083      		st Z,r24
 773 030c 9183      		std Z+1,r25
 774 030e A283      		std Z+2,r26
 775 0310 B383      		std Z+3,r27
 444:nmeap01.c     ****             context->input_count = 0;
 776               		.stabn	68,0,444,.LM59-nmeap_parse
 777               	.LM59:
 778 0312 CC58      		subi r28,lo8(-(372))
 779 0314 DE4F      		sbci r29,hi8(-(372))
 780 0316 1982      		std Y+1,__zero_reg__
 781 0318 1882      		st Y,__zero_reg__
 445:nmeap01.c     ****         }
 782               		.stabn	68,0,445,.LM60-nmeap_parse
 783               	.LM60:
 784 031a FE01      		movw r30,r28
 785 031c 1292      		st -Z,__zero_reg__
 786 031e 1292      		st -Z,__zero_reg__
 787 0320 72C0      		rjmp .L74
 788               	.L39:
 446:nmeap01.c     ****         break;
 447:nmeap01.c     ****     /* LOOKING FOR CR */
 448:nmeap01.c     ****     case 5:
 449:nmeap01.c     ****         if (ch == '\r') {
 450:nmeap01.c     ****             /* carriage return */
 789               		.stabn	68,0,450,.LM61-nmeap_parse
 790               	.LM61:
 791 0322 8DE0      		ldi r24,lo8(13)
 792 0324 D816      		cp r13,r24
 793 0326 09F0      		breq .+2
 794 0328 47C0      		rjmp .L67
 795               	.L77:
 451:nmeap01.c     ****             context->input_state = 6;
 452:nmeap01.c     ****         }
 796               		.stabn	68,0,452,.LM62-nmeap_parse
 797               	.LM62:
 798 032a 86E0      		ldi r24,lo8(6)
GAS LISTING /var/tmp//ccvnAEfo.s 			page 23


 799 032c 90E0      		ldi r25,hi8(6)
 800               	.L76:
 801 032e F501      		movw r30,r10
 802 0330 9183      		std Z+1,r25
 803 0332 8083      		st Z,r24
 804 0334 68C0      		rjmp .L74
 805               	.L40:
 453:nmeap01.c     ****         else {
 454:nmeap01.c     ****             /* input error, restart */
 455:nmeap01.c     ****             context->err_crl++;
 456:nmeap01.c     ****             context->input_state = 0;
 457:nmeap01.c     ****             context->input_count = 0;
 458:nmeap01.c     ****         }
 459:nmeap01.c     ****         break;
 460:nmeap01.c     ****     /* LOOKING FOR LINE FEED */
 461:nmeap01.c     ****     case 6:
 462:nmeap01.c     ****         if (ch == '\n') {
 463:nmeap01.c     ****             /* linefeed, line complete */
 806               		.stabn	68,0,463,.LM63-nmeap_parse
 807               	.LM63:
 808 0336 FAE0      		ldi r31,lo8(10)
 809 0338 DF16      		cp r13,r31
 810 033a F1F5      		brne .L67
 464:nmeap01.c     ****             
 465:nmeap01.c     ****             /* delimit buffer */
 466:nmeap01.c     ****             context->input[context->input_count] = 0;
 467:nmeap01.c     ****             
 811               		.stabn	68,0,467,.LM64-nmeap_parse
 812               	.LM64:
 813 033c EC0E      		add r14,r28
 814 033e FD1E      		adc r15,r29
 815 0340 82E7      		ldi r24,lo8(114)
 816 0342 90E0      		ldi r25,hi8(114)
 817 0344 E80E      		add r14,r24
 818 0346 F91E      		adc r15,r25
 819 0348 F701      		movw r30,r14
 820 034a 1082      		st Z,__zero_reg__
 468:nmeap01.c     ****             /* if the checksums match, process the sentence */
 469:nmeap01.c     **** 			if (context->ccks == context->icks) {
 470:nmeap01.c     **** 				/* process */
 821               		.stabn	68,0,470,.LM65-nmeap_parse
 822               	.LM65:
 823 034c FE01      		movw r30,r28
 824 034e E358      		subi r30,lo8(-(381))
 825 0350 FE4F      		sbci r31,hi8(-(381))
 826 0352 C458      		subi r28,lo8(-(380))
 827 0354 DE4F      		sbci r29,hi8(-(380))
 828 0356 9081      		ld r25,Z
 829 0358 8881      		ld r24,Y
 830 035a CC57      		subi r28,lo8(-(-380))
 831 035c D140      		sbci r29,hi8(-(-380))
 832 035e 9817      		cp r25,r24
 833 0360 99F4      		brne .L69
 471:nmeap01.c     **** 				status = nmeap_process(context);
 472:nmeap01.c     **** 				
 834               		.stabn	68,0,472,.LM66-nmeap_parse
 835               	.LM66:
GAS LISTING /var/tmp//ccvnAEfo.s 			page 24


 836 0362 CE01      		movw r24,r28
 837 0364 0E94 0000 		call nmeap_process
 838 0368 9C01      		movw r18,r24
 473:nmeap01.c     **** 				/* count good messages */
 474:nmeap01.c     **** 				context->msgs++;
 475:nmeap01.c     **** 			}
 839               		.stabn	68,0,475,.LM67-nmeap_parse
 840               	.LM67:
 841 036a FE01      		movw r30,r28
 842 036c E055      		subi r30,lo8(-(432))
 843 036e FE4F      		sbci r31,hi8(-(432))
 844 0370 8081      		ld r24,Z
 845 0372 9181      		ldd r25,Z+1
 846 0374 A281      		ldd r26,Z+2
 847 0376 B381      		ldd r27,Z+3
 848 0378 0196      		adiw r24,1
 849 037a A11D      		adc r26,__zero_reg__
 850 037c B11D      		adc r27,__zero_reg__
 851 037e 8083      		st Z,r24
 852 0380 9183      		std Z+1,r25
 853 0382 A283      		std Z+2,r26
 854 0384 B383      		std Z+3,r27
 855 0386 10C0      		rjmp .L71
 856               	.L69:
 476:nmeap01.c     **** 			else {
 477:nmeap01.c     **** 				/* count checksum errors */
 478:nmeap01.c     **** 				context->err_cks++;
 479:nmeap01.c     **** 			}
 857               		.stabn	68,0,479,.LM68-nmeap_parse
 858               	.LM68:
 859 0388 FE01      		movw r30,r28
 860 038a EC53      		subi r30,lo8(-(452))
 861 038c FE4F      		sbci r31,hi8(-(452))
 862 038e 8081      		ld r24,Z
 863 0390 9181      		ldd r25,Z+1
 864 0392 A281      		ldd r26,Z+2
 865 0394 B381      		ldd r27,Z+3
 866 0396 0196      		adiw r24,1
 867 0398 A11D      		adc r26,__zero_reg__
 868 039a B11D      		adc r27,__zero_reg__
 869 039c 8083      		st Z,r24
 870 039e 9183      		std Z+1,r25
 871 03a0 A283      		std Z+2,r26
 872 03a2 B383      		std Z+3,r27
 873 03a4 20E0      		ldi r18,lo8(0)
 874 03a6 30E0      		ldi r19,hi8(0)
 875               	.L71:
 480:nmeap01.c     ****             
 481:nmeap01.c     ****             /* restart next time */
 482:nmeap01.c     ****             context->input_state = 0;
 483:nmeap01.c     ****             context->input_count = 0;
 876               		.stabn	68,0,483,.LM69-nmeap_parse
 877               	.LM69:
 878 03a8 CC58      		subi r28,lo8(-(372))
 879 03aa DE4F      		sbci r29,hi8(-(372))
 880 03ac 1982      		std Y+1,__zero_reg__
 881 03ae 1882      		st Y,__zero_reg__
GAS LISTING /var/tmp//ccvnAEfo.s 			page 25


 484:nmeap01.c     ****         }
 882               		.stabn	68,0,484,.LM70-nmeap_parse
 883               	.LM70:
 884 03b0 FE01      		movw r30,r28
 885 03b2 1292      		st -Z,__zero_reg__
 886 03b4 1292      		st -Z,__zero_reg__
 887 03b6 29C0      		rjmp .L44
 888               	.L67:
 485:nmeap01.c     ****         else {
 486:nmeap01.c     ****             /* input error, restart */
 487:nmeap01.c     ****             context->err_crl++;
 488:nmeap01.c     ****             context->input_state = 0;
 889               		.stabn	68,0,488,.LM71-nmeap_parse
 890               	.LM71:
 891 03b8 FE01      		movw r30,r28
 892 03ba E853      		subi r30,lo8(-(456))
 893 03bc FE4F      		sbci r31,hi8(-(456))
 894               	.L75:
 895 03be 8081      		ld r24,Z
 896 03c0 9181      		ldd r25,Z+1
 897 03c2 A281      		ldd r26,Z+2
 898 03c4 B381      		ldd r27,Z+3
 899 03c6 0196      		adiw r24,1
 900 03c8 A11D      		adc r26,__zero_reg__
 901 03ca B11D      		adc r27,__zero_reg__
 902 03cc 8083      		st Z,r24
 903 03ce 9183      		std Z+1,r25
 904 03d0 A283      		std Z+2,r26
 905 03d2 B383      		std Z+3,r27
 489:nmeap01.c     ****             context->input_count = 0;
 906               		.stabn	68,0,489,.LM72-nmeap_parse
 907               	.LM72:
 908 03d4 F501      		movw r30,r10
 909 03d6 1182      		std Z+1,__zero_reg__
 910 03d8 1082      		st Z,__zero_reg__
 490:nmeap01.c     ****         }
 911               		.stabn	68,0,490,.LM73-nmeap_parse
 912               	.LM73:
 913 03da F401      		movw r30,r8
 914 03dc 1182      		std Z+1,__zero_reg__
 915 03de 1082      		st Z,__zero_reg__
 916 03e0 12C0      		rjmp .L74
 917               	.L33:
 491:nmeap01.c     ****         break;
 492:nmeap01.c     ****     default:
 493:nmeap01.c     ****         context->err_unk++;
 494:nmeap01.c     ****         context->input_state = 0;
 918               		.stabn	68,0,494,.LM74-nmeap_parse
 919               	.LM74:
 920 03e2 FE01      		movw r30,r28
 921 03e4 E454      		subi r30,lo8(-(444))
 922 03e6 FE4F      		sbci r31,hi8(-(444))
 923 03e8 8081      		ld r24,Z
 924 03ea 9181      		ldd r25,Z+1
 925 03ec A281      		ldd r26,Z+2
 926 03ee B381      		ldd r27,Z+3
 927 03f0 0196      		adiw r24,1
GAS LISTING /var/tmp//ccvnAEfo.s 			page 26


 928 03f2 A11D      		adc r26,__zero_reg__
 929 03f4 B11D      		adc r27,__zero_reg__
 930 03f6 8083      		st Z,r24
 931 03f8 9183      		std Z+1,r25
 932 03fa A283      		std Z+2,r26
 933 03fc B383      		std Z+3,r27
 495:nmeap01.c     ****         break;
 934               		.stabn	68,0,495,.LM75-nmeap_parse
 935               	.LM75:
 936 03fe CC58      		subi r28,lo8(-(372))
 937 0400 DE4F      		sbci r29,hi8(-(372))
 938 0402 1982      		std Y+1,__zero_reg__
 939 0404 1882      		st Y,__zero_reg__
 940               	.L74:
 941 0406 20E0      		ldi r18,lo8(0)
 942 0408 30E0      		ldi r19,hi8(0)
 943               	.L44:
 496:nmeap01.c     ****     }
 497:nmeap01.c     ****             
 498:nmeap01.c     **** 	return status;
 499:nmeap01.c     **** }
 500:nmeap01.c     **** 
 944               		.stabn	68,0,500,.LM76-nmeap_parse
 945               	.LM76:
 946 040a C901      		movw r24,r18
 947               	/* epilogue: frame size=0 */
 948 040c DF91      		pop r29
 949 040e CF91      		pop r28
 950 0410 1F91      		pop r17
 951 0412 0F91      		pop r16
 952 0414 FF90      		pop r15
 953 0416 EF90      		pop r14
 954 0418 DF90      		pop r13
 955 041a BF90      		pop r11
 956 041c AF90      		pop r10
 957 041e 9F90      		pop r9
 958 0420 8F90      		pop r8
 959 0422 0895      		ret
 960               	/* epilogue end (size=12) */
 961               	/* function nmeap_parse size 374 (351) */
 962               		.size	nmeap_parse, .-nmeap_parse
 963               		.stabs	"status:r(0,1)",64,0,343,18
 964               		.stabn	192,0,0,nmeap_parse-nmeap_parse
 965               		.stabn	224,0,0,.Lscope3-nmeap_parse
 966               	.Lscope3:
 967               		.stabs	"",36,0,0,.Lscope3-nmeap_parse
 968               		.stabd	78,0,0
 969               		.stabs	"nmeap_parseBuffer:F(0,1)",36,0,506,nmeap_parseBuffer
 970               		.stabs	"context:P(0,18)",64,0,505,8
 971               		.stabs	"buffer:P(0,16)",64,0,505,22
 972               		.stabs	"length:P(0,19)=*(0,1)",64,0,505,12
 973               	.global	nmeap_parseBuffer
 974               		.type	nmeap_parseBuffer, @function
 975               	nmeap_parseBuffer:
 976               		.stabd	46,0,0
 501:nmeap01.c     **** /** 
 502:nmeap01.c     ****  * parse a buffer of nmea data
GAS LISTING /var/tmp//ccvnAEfo.s 			page 27


 503:nmeap01.c     ****  */
 504:nmeap01.c     **** int nmeap_parseBuffer(nmeap_context_t *context,const char *buffer,int *length)
 505:nmeap01.c     **** {
 506:nmeap01.c     ****     int  i;
 977               		.stabn	68,0,506,.LM77-nmeap_parseBuffer
 978               	.LM77:
 979               	/* prologue: frame size=0 */
 980 0424 8F92      		push r8
 981 0426 9F92      		push r9
 982 0428 AF92      		push r10
 983 042a BF92      		push r11
 984 042c CF92      		push r12
 985 042e DF92      		push r13
 986 0430 EF92      		push r14
 987 0432 FF92      		push r15
 988 0434 0F93      		push r16
 989 0436 1F93      		push r17
 990 0438 CF93      		push r28
 991 043a DF93      		push r29
 992               	/* prologue end (size=12) */
 993 043c 4C01      		movw r8,r24
 994 043e 6A01      		movw r12,r20
 507:nmeap01.c     ****     int  status;
 508:nmeap01.c     ****     int  rem;
 509:nmeap01.c     ****     int  tlen;
 510:nmeap01.c     ****     
 511:nmeap01.c     ****     tlen   = *length;
 512:nmeap01.c     ****     rem    = *length;
 995               		.stabn	68,0,512,.LM78-nmeap_parseBuffer
 996               	.LM78:
 997 0440 FA01      		movw r30,r20
 998 0442 0081      		ld r16,Z
 999 0444 1181      		ldd r17,Z+1
 1000 0446 5801      		movw r10,r16
 1001 0448 EE24      		clr r14
 1002 044a FF24      		clr r15
 1003 044c EB01      		movw r28,r22
 1004 044e 0CC0      		rjmp .L79
 1005               	.L80:
 513:nmeap01.c     ****     status = 0;
 514:nmeap01.c     ****     /* for each byte in the buffer */
 515:nmeap01.c     ****     for(i=0;i<tlen;i++) {
 516:nmeap01.c     ****         /* decrement remaining byte count */
 517:nmeap01.c     ****         rem--;
 518:nmeap01.c     ****         /* parse the byte */
 1006               		.stabn	68,0,518,.LM79-nmeap_parseBuffer
 1007               	.LM79:
 1008 0450 0150      		subi r16,lo8(-(-1))
 1009 0452 1040      		sbci r17,hi8(-(-1))
 519:nmeap01.c     ****         status = nmeap_parse(context,buffer[i]);
 520:nmeap01.c     ****         if (status != 0) {
 1010               		.stabn	68,0,520,.LM80-nmeap_parseBuffer
 1011               	.LM80:
 1012 0454 6881      		ld r22,Y
 1013 0456 C401      		movw r24,r8
 1014 0458 0E94 0000 		call nmeap_parse
 521:nmeap01.c     ****             /* message found or error */
GAS LISTING /var/tmp//ccvnAEfo.s 			page 28


 1015               		.stabn	68,0,521,.LM81-nmeap_parseBuffer
 1016               	.LM81:
 1017 045c 0097      		sbiw r24,0
 1018 045e 49F4      		brne .L81
 1019               		.stabn	68,0,516,.LM82-nmeap_parseBuffer
 1020               	.LM82:
 1021 0460 0894      		sec
 1022 0462 E11C      		adc r14,__zero_reg__
 1023 0464 F11C      		adc r15,__zero_reg__
 1024 0466 2196      		adiw r28,1
 1025               	.L79:
 1026 0468 EA14      		cp r14,r10
 1027 046a FB04      		cpc r15,r11
 1028 046c 8CF3      		brlt .L80
 1029 046e 80E0      		ldi r24,lo8(0)
 1030 0470 90E0      		ldi r25,hi8(0)
 1031               	.L81:
 522:nmeap01.c     ****             break;
 523:nmeap01.c     ****         }
 524:nmeap01.c     ****     }
 525:nmeap01.c     **** 	
 526:nmeap01.c     ****     /* return remaining byte count */
 527:nmeap01.c     ****     *length = rem;
 528:nmeap01.c     **** 	
 1032               		.stabn	68,0,528,.LM83-nmeap_parseBuffer
 1033               	.LM83:
 1034 0472 F601      		movw r30,r12
 1035 0474 1183      		std Z+1,r17
 1036 0476 0083      		st Z,r16
 1037               	/* epilogue: frame size=0 */
 1038 0478 DF91      		pop r29
 1039 047a CF91      		pop r28
 1040 047c 1F91      		pop r17
 1041 047e 0F91      		pop r16
 1042 0480 FF90      		pop r15
 1043 0482 EF90      		pop r14
 1044 0484 DF90      		pop r13
 1045 0486 CF90      		pop r12
 1046 0488 BF90      		pop r11
 1047 048a AF90      		pop r10
 1048 048c 9F90      		pop r9
 1049 048e 8F90      		pop r8
 1050 0490 0895      		ret
 1051               	/* epilogue end (size=13) */
 1052               	/* function nmeap_parseBuffer size 55 (30) */
 1053               		.size	nmeap_parseBuffer, .-nmeap_parseBuffer
 1054               		.stabs	"i:r(0,1)",64,0,507,14
 1055               		.stabs	"status:r(0,1)",64,0,508,24
 1056               		.stabs	"rem:r(0,1)",64,0,509,16
 1057               		.stabs	"tlen:r(0,1)",64,0,510,10
 1058               		.stabn	192,0,0,nmeap_parseBuffer-nmeap_parseBuffer
 1059               		.stabn	224,0,0,.Lscope4-nmeap_parseBuffer
 1060               	.Lscope4:
 1061               		.stabs	"",36,0,0,.Lscope4-nmeap_parseBuffer
 1062               		.stabd	78,0,0
 1063               		.stabs	"dist:F(0,13)",36,0,4,dist
 1064               		.stabs	"from:p(20,1)",160,0,4,1
GAS LISTING /var/tmp//ccvnAEfo.s 			page 29


 1065               		.stabs	"to:p(20,1)",160,0,4,9
 1066               	.global	dist
 1067               		.type	dist, @function
 1068               	dist:
 1069               		.stabd	46,0,0
 1070               		.stabs	"gpsmath.c",132,0,0,.Ltext2
 1071               	.Ltext2:
   1:gpsmath.c     **** #include <gpsmath.h>
   2:gpsmath.c     **** 
   3:gpsmath.c     **** 
   4:gpsmath.c     **** double dist(struct waypoint from, struct waypoint to){
 1072               		.stabn	68,0,4,.LM84-dist
 1073               	.LM84:
 1074               	/* prologue: frame size=20 */
 1075 0492 2F92      		push r2
 1076 0494 3F92      		push r3
 1077 0496 4F92      		push r4
 1078 0498 5F92      		push r5
 1079 049a 6F92      		push r6
 1080 049c 7F92      		push r7
 1081 049e 8F92      		push r8
 1082 04a0 9F92      		push r9
 1083 04a2 AF92      		push r10
 1084 04a4 BF92      		push r11
 1085 04a6 CF92      		push r12
 1086 04a8 DF92      		push r13
 1087 04aa EF92      		push r14
 1088 04ac FF92      		push r15
 1089 04ae 0F93      		push r16
 1090 04b0 1F93      		push r17
 1091 04b2 CF93      		push r28
 1092 04b4 DF93      		push r29
 1093 04b6 CDB7      		in r28,__SP_L__
 1094 04b8 DEB7      		in r29,__SP_H__
 1095 04ba 6497      		sbiw r28,20
 1096 04bc 0FB6      		in __tmp_reg__,__SREG__
 1097 04be F894      		cli
 1098 04c0 DEBF      		out __SP_H__,r29
 1099 04c2 0FBE      		out __SREG__,__tmp_reg__
 1100 04c4 CDBF      		out __SP_L__,r28
 1101               	/* prologue end (size=26) */
 1102 04c6 2983      		std Y+1,r18
 1103 04c8 3A83      		std Y+2,r19
 1104 04ca 4B83      		std Y+3,r20
 1105 04cc 5C83      		std Y+4,r21
 1106 04ce 6D83      		std Y+5,r22
 1107 04d0 7E83      		std Y+6,r23
 1108 04d2 8F83      		std Y+7,r24
 1109 04d4 9887      		std Y+8,r25
 1110 04d6 A986      		std Y+9,r10
 1111 04d8 BA86      		std Y+10,r11
 1112 04da CB86      		std Y+11,r12
 1113 04dc DC86      		std Y+12,r13
 1114 04de ED86      		std Y+13,r14
 1115 04e0 FE86      		std Y+14,r15
 1116 04e2 0F87      		std Y+15,r16
 1117 04e4 188B      		std Y+16,r17
GAS LISTING /var/tmp//ccvnAEfo.s 			page 30


   5:gpsmath.c     ****     double a, delta_lat, delta_lon;
   6:gpsmath.c     **** 
   7:gpsmath.c     ****     from.lat = from.lat* M_PI / 180;
 1118               		.stabn	68,0,7,.LM85-dist
 1119               	.LM85:
 1120 04e6 6981      		ldd r22,Y+1
 1121 04e8 7A81      		ldd r23,Y+2
 1122 04ea 8B81      		ldd r24,Y+3
 1123 04ec 9C81      		ldd r25,Y+4
 1124 04ee 2BED      		ldi r18,lo8(0x40490fdb)
 1125 04f0 3FE0      		ldi r19,hi8(0x40490fdb)
 1126 04f2 49E4      		ldi r20,hlo8(0x40490fdb)
 1127 04f4 50E4      		ldi r21,hhi8(0x40490fdb)
 1128 04f6 0E94 0000 		call __mulsf3
 1129 04fa 20E0      		ldi r18,lo8(0x43340000)
 1130 04fc 30E0      		ldi r19,hi8(0x43340000)
 1131 04fe 44E3      		ldi r20,hlo8(0x43340000)
 1132 0500 53E4      		ldi r21,hhi8(0x43340000)
 1133 0502 0E94 0000 		call __divsf3
 1134 0506 698B      		std Y+17,r22
 1135 0508 7A8B      		std Y+18,r23
 1136 050a 8B8B      		std Y+19,r24
 1137 050c 9C8B      		std Y+20,r25
   8:gpsmath.c     ****     to.lat = to.lat*M_PI/180;
 1138               		.stabn	68,0,8,.LM86-dist
 1139               	.LM86:
 1140 050e 6985      		ldd r22,Y+9
 1141 0510 7A85      		ldd r23,Y+10
 1142 0512 8B85      		ldd r24,Y+11
 1143 0514 9C85      		ldd r25,Y+12
 1144 0516 2BED      		ldi r18,lo8(0x40490fdb)
 1145 0518 3FE0      		ldi r19,hi8(0x40490fdb)
 1146 051a 49E4      		ldi r20,hlo8(0x40490fdb)
 1147 051c 50E4      		ldi r21,hhi8(0x40490fdb)
 1148 051e 0E94 0000 		call __mulsf3
 1149 0522 20E0      		ldi r18,lo8(0x43340000)
 1150 0524 30E0      		ldi r19,hi8(0x43340000)
 1151 0526 44E3      		ldi r20,hlo8(0x43340000)
 1152 0528 53E4      		ldi r21,hhi8(0x43340000)
 1153 052a 0E94 0000 		call __divsf3
 1154 052e 1B01      		movw r2,r22
 1155 0530 2C01      		movw r4,r24
   9:gpsmath.c     ****     from.lon = from.lon*M_PI/180;
  10:gpsmath.c     ****     to.lon = to.lon*M_PI/180;
  11:gpsmath.c     ****     
  12:gpsmath.c     ****     delta_lat = to.lat - from.lat;
  13:gpsmath.c     ****     delta_lon = to.lon - from.lon;
  14:gpsmath.c     ****     
  15:gpsmath.c     ****     a = sin(delta_lat/2) * sin(delta_lat/2) + cos(from.lat) * cos(to.lat) * sin(delta_lon/2) * sin(
 1156               		.stabn	68,0,15,.LM87-dist
 1157               	.LM87:
 1158 0532 2989      		ldd r18,Y+17
 1159 0534 3A89      		ldd r19,Y+18
 1160 0536 4B89      		ldd r20,Y+19
 1161 0538 5C89      		ldd r21,Y+20
 1162 053a 0E94 0000 		call __subsf3
 1163 053e 20E0      		ldi r18,lo8(0x3f000000)
GAS LISTING /var/tmp//ccvnAEfo.s 			page 31


 1164 0540 30E0      		ldi r19,hi8(0x3f000000)
 1165 0542 40E0      		ldi r20,hlo8(0x3f000000)
 1166 0544 5FE3      		ldi r21,hhi8(0x3f000000)
 1167 0546 0E94 0000 		call __mulsf3
 1168 054a 0E94 0000 		call sin
 1169 054e 3B01      		movw r6,r22
 1170 0550 4C01      		movw r8,r24
 1171 0552 6D85      		ldd r22,Y+13
 1172 0554 7E85      		ldd r23,Y+14
 1173 0556 8F85      		ldd r24,Y+15
 1174 0558 9889      		ldd r25,Y+16
 1175 055a 2BED      		ldi r18,lo8(0x40490fdb)
 1176 055c 3FE0      		ldi r19,hi8(0x40490fdb)
 1177 055e 49E4      		ldi r20,hlo8(0x40490fdb)
 1178 0560 50E4      		ldi r21,hhi8(0x40490fdb)
 1179 0562 0E94 0000 		call __mulsf3
 1180 0566 20E0      		ldi r18,lo8(0x43340000)
 1181 0568 30E0      		ldi r19,hi8(0x43340000)
 1182 056a 44E3      		ldi r20,hlo8(0x43340000)
 1183 056c 53E4      		ldi r21,hhi8(0x43340000)
 1184 056e 0E94 0000 		call __divsf3
 1185 0572 7B01      		movw r14,r22
 1186 0574 8C01      		movw r16,r24
 1187 0576 6D81      		ldd r22,Y+5
 1188 0578 7E81      		ldd r23,Y+6
 1189 057a 8F81      		ldd r24,Y+7
 1190 057c 9885      		ldd r25,Y+8
 1191 057e 2BED      		ldi r18,lo8(0x40490fdb)
 1192 0580 3FE0      		ldi r19,hi8(0x40490fdb)
 1193 0582 49E4      		ldi r20,hlo8(0x40490fdb)
 1194 0584 50E4      		ldi r21,hhi8(0x40490fdb)
 1195 0586 0E94 0000 		call __mulsf3
 1196 058a 20E0      		ldi r18,lo8(0x43340000)
 1197 058c 30E0      		ldi r19,hi8(0x43340000)
 1198 058e 44E3      		ldi r20,hlo8(0x43340000)
 1199 0590 53E4      		ldi r21,hhi8(0x43340000)
 1200 0592 0E94 0000 		call __divsf3
 1201 0596 9B01      		movw r18,r22
 1202 0598 AC01      		movw r20,r24
 1203 059a C801      		movw r24,r16
 1204 059c B701      		movw r22,r14
 1205 059e 0E94 0000 		call __subsf3
 1206 05a2 20E0      		ldi r18,lo8(0x3f000000)
 1207 05a4 30E0      		ldi r19,hi8(0x3f000000)
 1208 05a6 40E0      		ldi r20,hlo8(0x3f000000)
 1209 05a8 5FE3      		ldi r21,hhi8(0x3f000000)
 1210 05aa 0E94 0000 		call __mulsf3
 1211 05ae 0E94 0000 		call sin
 1212 05b2 5B01      		movw r10,r22
 1213 05b4 6C01      		movw r12,r24
 1214 05b6 A401      		movw r20,r8
 1215 05b8 9301      		movw r18,r6
 1216 05ba C401      		movw r24,r8
 1217 05bc B301      		movw r22,r6
 1218 05be 0E94 0000 		call __mulsf3
 1219 05c2 3B01      		movw r6,r22
 1220 05c4 4C01      		movw r8,r24
GAS LISTING /var/tmp//ccvnAEfo.s 			page 32


 1221 05c6 6989      		ldd r22,Y+17
 1222 05c8 7A89      		ldd r23,Y+18
 1223 05ca 8B89      		ldd r24,Y+19
 1224 05cc 9C89      		ldd r25,Y+20
 1225 05ce 0E94 0000 		call cos
 1226 05d2 7B01      		movw r14,r22
 1227 05d4 8C01      		movw r16,r24
 1228 05d6 C201      		movw r24,r4
 1229 05d8 B101      		movw r22,r2
 1230 05da 0E94 0000 		call cos
 1231 05de 9B01      		movw r18,r22
 1232 05e0 AC01      		movw r20,r24
 1233 05e2 C801      		movw r24,r16
 1234 05e4 B701      		movw r22,r14
 1235 05e6 0E94 0000 		call __mulsf3
 1236 05ea A601      		movw r20,r12
 1237 05ec 9501      		movw r18,r10
 1238 05ee 0E94 0000 		call __mulsf3
 1239 05f2 A601      		movw r20,r12
 1240 05f4 9501      		movw r18,r10
 1241 05f6 0E94 0000 		call __mulsf3
 1242 05fa 9B01      		movw r18,r22
 1243 05fc AC01      		movw r20,r24
 1244 05fe C401      		movw r24,r8
 1245 0600 B301      		movw r22,r6
 1246 0602 0E94 0000 		call __addsf3
 1247 0606 5B01      		movw r10,r22
 1248 0608 6C01      		movw r12,r24
  16:gpsmath.c     ****     a = 2 * atan2(sqrt(a), sqrt(1-a));
 1249               		.stabn	68,0,16,.LM88-dist
 1250               	.LM88:
 1251 060a 9B01      		movw r18,r22
 1252 060c AC01      		movw r20,r24
 1253 060e 60E0      		ldi r22,lo8(0x3f800000)
 1254 0610 70E0      		ldi r23,hi8(0x3f800000)
 1255 0612 80E8      		ldi r24,hlo8(0x3f800000)
 1256 0614 9FE3      		ldi r25,hhi8(0x3f800000)
 1257 0616 0E94 0000 		call __subsf3
 1258 061a 0E94 0000 		call sqrt
 1259 061e 7B01      		movw r14,r22
 1260 0620 8C01      		movw r16,r24
 1261 0622 C601      		movw r24,r12
 1262 0624 B501      		movw r22,r10
 1263 0626 0E94 0000 		call sqrt
 1264 062a A801      		movw r20,r16
 1265 062c 9701      		movw r18,r14
 1266 062e 0E94 0000 		call atan2
 1267 0632 9B01      		movw r18,r22
 1268 0634 AC01      		movw r20,r24
 1269 0636 0E94 0000 		call __addsf3
 1270 063a 20E0      		ldi r18,lo8(0x45c71800)
 1271 063c 38E1      		ldi r19,hi8(0x45c71800)
 1272 063e 47EC      		ldi r20,hlo8(0x45c71800)
 1273 0640 55E4      		ldi r21,hhi8(0x45c71800)
 1274 0642 0E94 0000 		call __mulsf3
 1275               	/* epilogue: frame size=20 */
 1276 0646 6496      		adiw r28,20
GAS LISTING /var/tmp//ccvnAEfo.s 			page 33


 1277 0648 0FB6      		in __tmp_reg__,__SREG__
 1278 064a F894      		cli
 1279 064c DEBF      		out __SP_H__,r29
 1280 064e 0FBE      		out __SREG__,__tmp_reg__
 1281 0650 CDBF      		out __SP_L__,r28
 1282 0652 DF91      		pop r29
 1283 0654 CF91      		pop r28
 1284 0656 1F91      		pop r17
 1285 0658 0F91      		pop r16
 1286 065a FF90      		pop r15
 1287 065c EF90      		pop r14
 1288 065e DF90      		pop r13
 1289 0660 CF90      		pop r12
 1290 0662 BF90      		pop r11
 1291 0664 AF90      		pop r10
 1292 0666 9F90      		pop r9
 1293 0668 8F90      		pop r8
 1294 066a 7F90      		pop r7
 1295 066c 6F90      		pop r6
 1296 066e 5F90      		pop r5
 1297 0670 4F90      		pop r4
 1298 0672 3F90      		pop r3
 1299 0674 2F90      		pop r2
 1300 0676 0895      		ret
 1301               	/* epilogue end (size=25) */
 1302               	/* function dist size 243 (192) */
 1303               		.size	dist, .-dist
 1304               	.Lscope5:
 1305               		.stabs	"",36,0,0,.Lscope5-dist
 1306               		.stabd	78,0,0
 1307               		.stabs	"bearing:F(0,13)",36,0,22,bearing
 1308               		.stabs	"from:p(20,1)",160,0,22,1
 1309               		.stabs	"to:p(20,1)",160,0,22,9
 1310               	.global	bearing
 1311               		.type	bearing, @function
 1312               	bearing:
 1313               		.stabd	46,0,0
  17:gpsmath.c     ****     a = R * a;
  18:gpsmath.c     ****     
  19:gpsmath.c     ****     return a; //in km
  20:gpsmath.c     **** }
  21:gpsmath.c     **** 
  22:gpsmath.c     **** double bearing(struct waypoint from, struct waypoint to){
 1314               		.stabn	68,0,22,.LM89-bearing
 1315               	.LM89:
 1316               	/* prologue: frame size=20 */
 1317 0678 2F92      		push r2
 1318 067a 3F92      		push r3
 1319 067c 4F92      		push r4
 1320 067e 5F92      		push r5
 1321 0680 6F92      		push r6
 1322 0682 7F92      		push r7
 1323 0684 8F92      		push r8
 1324 0686 9F92      		push r9
 1325 0688 AF92      		push r10
 1326 068a BF92      		push r11
 1327 068c CF92      		push r12
GAS LISTING /var/tmp//ccvnAEfo.s 			page 34


 1328 068e DF92      		push r13
 1329 0690 EF92      		push r14
 1330 0692 FF92      		push r15
 1331 0694 0F93      		push r16
 1332 0696 1F93      		push r17
 1333 0698 CF93      		push r28
 1334 069a DF93      		push r29
 1335 069c CDB7      		in r28,__SP_L__
 1336 069e DEB7      		in r29,__SP_H__
 1337 06a0 6497      		sbiw r28,20
 1338 06a2 0FB6      		in __tmp_reg__,__SREG__
 1339 06a4 F894      		cli
 1340 06a6 DEBF      		out __SP_H__,r29
 1341 06a8 0FBE      		out __SREG__,__tmp_reg__
 1342 06aa CDBF      		out __SP_L__,r28
 1343               	/* prologue end (size=26) */
 1344 06ac 2983      		std Y+1,r18
 1345 06ae 3A83      		std Y+2,r19
 1346 06b0 4B83      		std Y+3,r20
 1347 06b2 5C83      		std Y+4,r21
 1348 06b4 6D83      		std Y+5,r22
 1349 06b6 7E83      		std Y+6,r23
 1350 06b8 8F83      		std Y+7,r24
 1351 06ba 9887      		std Y+8,r25
 1352 06bc A986      		std Y+9,r10
 1353 06be BA86      		std Y+10,r11
 1354 06c0 CB86      		std Y+11,r12
 1355 06c2 DC86      		std Y+12,r13
 1356 06c4 ED86      		std Y+13,r14
 1357 06c6 FE86      		std Y+14,r15
 1358 06c8 0F87      		std Y+15,r16
 1359 06ca 188B      		std Y+16,r17
  23:gpsmath.c     ****     double a,b;
  24:gpsmath.c     ****     
  25:gpsmath.c     ****     from.lat = from.lat* M_PI / 180;
 1360               		.stabn	68,0,25,.LM90-bearing
 1361               	.LM90:
 1362 06cc 6981      		ldd r22,Y+1
 1363 06ce 7A81      		ldd r23,Y+2
 1364 06d0 8B81      		ldd r24,Y+3
 1365 06d2 9C81      		ldd r25,Y+4
 1366 06d4 2BED      		ldi r18,lo8(0x40490fdb)
 1367 06d6 3FE0      		ldi r19,hi8(0x40490fdb)
 1368 06d8 49E4      		ldi r20,hlo8(0x40490fdb)
 1369 06da 50E4      		ldi r21,hhi8(0x40490fdb)
 1370 06dc 0E94 0000 		call __mulsf3
 1371 06e0 20E0      		ldi r18,lo8(0x43340000)
 1372 06e2 30E0      		ldi r19,hi8(0x43340000)
 1373 06e4 44E3      		ldi r20,hlo8(0x43340000)
 1374 06e6 53E4      		ldi r21,hhi8(0x43340000)
 1375 06e8 0E94 0000 		call __divsf3
 1376 06ec 698B      		std Y+17,r22
 1377 06ee 7A8B      		std Y+18,r23
 1378 06f0 8B8B      		std Y+19,r24
 1379 06f2 9C8B      		std Y+20,r25
  26:gpsmath.c     ****     to.lat = to.lat*M_PI/180;
 1380               		.stabn	68,0,26,.LM91-bearing
GAS LISTING /var/tmp//ccvnAEfo.s 			page 35


 1381               	.LM91:
 1382 06f4 6985      		ldd r22,Y+9
 1383 06f6 7A85      		ldd r23,Y+10
 1384 06f8 8B85      		ldd r24,Y+11
 1385 06fa 9C85      		ldd r25,Y+12
 1386 06fc 2BED      		ldi r18,lo8(0x40490fdb)
 1387 06fe 3FE0      		ldi r19,hi8(0x40490fdb)
 1388 0700 49E4      		ldi r20,hlo8(0x40490fdb)
 1389 0702 50E4      		ldi r21,hhi8(0x40490fdb)
 1390 0704 0E94 0000 		call __mulsf3
 1391 0708 20E0      		ldi r18,lo8(0x43340000)
 1392 070a 30E0      		ldi r19,hi8(0x43340000)
 1393 070c 44E3      		ldi r20,hlo8(0x43340000)
 1394 070e 53E4      		ldi r21,hhi8(0x43340000)
 1395 0710 0E94 0000 		call __divsf3
 1396 0714 5B01      		movw r10,r22
 1397 0716 6C01      		movw r12,r24
  27:gpsmath.c     ****     from.lon = from.lon*M_PI/180;
  28:gpsmath.c     ****     to.lon = to.lon*M_PI/180;
  29:gpsmath.c     ****     
  30:gpsmath.c     ****     a = sin(to.lon - from.lon)*cos(to.lat);
 1398               		.stabn	68,0,30,.LM92-bearing
 1399               	.LM92:
 1400 0718 6D85      		ldd r22,Y+13
 1401 071a 7E85      		ldd r23,Y+14
 1402 071c 8F85      		ldd r24,Y+15
 1403 071e 9889      		ldd r25,Y+16
 1404 0720 2BED      		ldi r18,lo8(0x40490fdb)
 1405 0722 3FE0      		ldi r19,hi8(0x40490fdb)
 1406 0724 49E4      		ldi r20,hlo8(0x40490fdb)
 1407 0726 50E4      		ldi r21,hhi8(0x40490fdb)
 1408 0728 0E94 0000 		call __mulsf3
 1409 072c 20E0      		ldi r18,lo8(0x43340000)
 1410 072e 30E0      		ldi r19,hi8(0x43340000)
 1411 0730 44E3      		ldi r20,hlo8(0x43340000)
 1412 0732 53E4      		ldi r21,hhi8(0x43340000)
 1413 0734 0E94 0000 		call __divsf3
 1414 0738 7B01      		movw r14,r22
 1415 073a 8C01      		movw r16,r24
 1416 073c 6D81      		ldd r22,Y+5
 1417 073e 7E81      		ldd r23,Y+6
 1418 0740 8F81      		ldd r24,Y+7
 1419 0742 9885      		ldd r25,Y+8
 1420 0744 2BED      		ldi r18,lo8(0x40490fdb)
 1421 0746 3FE0      		ldi r19,hi8(0x40490fdb)
 1422 0748 49E4      		ldi r20,hlo8(0x40490fdb)
 1423 074a 50E4      		ldi r21,hhi8(0x40490fdb)
 1424 074c 0E94 0000 		call __mulsf3
 1425 0750 20E0      		ldi r18,lo8(0x43340000)
 1426 0752 30E0      		ldi r19,hi8(0x43340000)
 1427 0754 44E3      		ldi r20,hlo8(0x43340000)
 1428 0756 53E4      		ldi r21,hhi8(0x43340000)
 1429 0758 0E94 0000 		call __divsf3
 1430 075c 9B01      		movw r18,r22
 1431 075e AC01      		movw r20,r24
 1432 0760 C801      		movw r24,r16
 1433 0762 B701      		movw r22,r14
GAS LISTING /var/tmp//ccvnAEfo.s 			page 36


 1434 0764 0E94 0000 		call __subsf3
 1435 0768 3B01      		movw r6,r22
 1436 076a 4C01      		movw r8,r24
 1437 076c C601      		movw r24,r12
 1438 076e B501      		movw r22,r10
 1439 0770 0E94 0000 		call cos
 1440 0774 1B01      		movw r2,r22
 1441 0776 2C01      		movw r4,r24
  31:gpsmath.c     ****     b = cos(from.lat)*sin(to.lat) - sin(from.lat)*cos(to.lat)*cos(to.lon-from.lon);
 1442               		.stabn	68,0,31,.LM93-bearing
 1443               	.LM93:
 1444 0778 6989      		ldd r22,Y+17
 1445 077a 7A89      		ldd r23,Y+18
 1446 077c 8B89      		ldd r24,Y+19
 1447 077e 9C89      		ldd r25,Y+20
 1448 0780 0E94 0000 		call cos
 1449 0784 7B01      		movw r14,r22
 1450 0786 8C01      		movw r16,r24
 1451 0788 C601      		movw r24,r12
 1452 078a B501      		movw r22,r10
 1453 078c 0E94 0000 		call sin
 1454 0790 9B01      		movw r18,r22
 1455 0792 AC01      		movw r20,r24
 1456 0794 C801      		movw r24,r16
 1457 0796 B701      		movw r22,r14
 1458 0798 0E94 0000 		call __mulsf3
 1459 079c 5B01      		movw r10,r22
 1460 079e 6C01      		movw r12,r24
 1461 07a0 6989      		ldd r22,Y+17
 1462 07a2 7A89      		ldd r23,Y+18
 1463 07a4 8B89      		ldd r24,Y+19
 1464 07a6 9C89      		ldd r25,Y+20
 1465 07a8 0E94 0000 		call sin
 1466 07ac A201      		movw r20,r4
 1467 07ae 9101      		movw r18,r2
 1468 07b0 0E94 0000 		call __mulsf3
 1469 07b4 7B01      		movw r14,r22
 1470 07b6 8C01      		movw r16,r24
 1471 07b8 C401      		movw r24,r8
 1472 07ba B301      		movw r22,r6
 1473 07bc 0E94 0000 		call cos
 1474 07c0 9B01      		movw r18,r22
 1475 07c2 AC01      		movw r20,r24
 1476 07c4 C801      		movw r24,r16
 1477 07c6 B701      		movw r22,r14
 1478 07c8 0E94 0000 		call __mulsf3
 1479 07cc 9B01      		movw r18,r22
 1480 07ce AC01      		movw r20,r24
 1481 07d0 C601      		movw r24,r12
 1482 07d2 B501      		movw r22,r10
 1483 07d4 0E94 0000 		call __subsf3
 1484 07d8 7B01      		movw r14,r22
 1485 07da 8C01      		movw r16,r24
 1486               		.stabn	68,0,30,.LM94-bearing
 1487               	.LM94:
 1488 07dc C401      		movw r24,r8
 1489 07de B301      		movw r22,r6
GAS LISTING /var/tmp//ccvnAEfo.s 			page 37


 1490 07e0 0E94 0000 		call sin
 1491 07e4 A201      		movw r20,r4
 1492 07e6 9101      		movw r18,r2
 1493 07e8 0E94 0000 		call __mulsf3
 1494 07ec A801      		movw r20,r16
 1495 07ee 9701      		movw r18,r14
 1496 07f0 0E94 0000 		call atan2
 1497 07f4 20E0      		ldi r18,lo8(0x43340000)
 1498 07f6 30E0      		ldi r19,hi8(0x43340000)
 1499 07f8 44E3      		ldi r20,hlo8(0x43340000)
 1500 07fa 53E4      		ldi r21,hhi8(0x43340000)
 1501 07fc 0E94 0000 		call __mulsf3
 1502 0800 2BED      		ldi r18,lo8(0x40490fdb)
 1503 0802 3FE0      		ldi r19,hi8(0x40490fdb)
 1504 0804 49E4      		ldi r20,hlo8(0x40490fdb)
 1505 0806 50E4      		ldi r21,hhi8(0x40490fdb)
 1506 0808 0E94 0000 		call __divsf3
 1507               	/* epilogue: frame size=20 */
 1508 080c 6496      		adiw r28,20
 1509 080e 0FB6      		in __tmp_reg__,__SREG__
 1510 0810 F894      		cli
 1511 0812 DEBF      		out __SP_H__,r29
 1512 0814 0FBE      		out __SREG__,__tmp_reg__
 1513 0816 CDBF      		out __SP_L__,r28
 1514 0818 DF91      		pop r29
 1515 081a CF91      		pop r28
 1516 081c 1F91      		pop r17
 1517 081e 0F91      		pop r16
 1518 0820 FF90      		pop r15
 1519 0822 EF90      		pop r14
 1520 0824 DF90      		pop r13
 1521 0826 CF90      		pop r12
 1522 0828 BF90      		pop r11
 1523 082a AF90      		pop r10
 1524 082c 9F90      		pop r9
 1525 082e 8F90      		pop r8
 1526 0830 7F90      		pop r7
 1527 0832 6F90      		pop r6
 1528 0834 5F90      		pop r5
 1529 0836 4F90      		pop r4
 1530 0838 3F90      		pop r3
 1531 083a 2F90      		pop r2
 1532 083c 0895      		ret
 1533               	/* epilogue end (size=25) */
 1534               	/* function bearing size 227 (176) */
 1535               		.size	bearing, .-bearing
 1536               	.Lscope6:
 1537               		.stabs	"",36,0,0,.Lscope6-bearing
 1538               		.stabd	78,0,0
 1539               		.stabs	"addToBuffer:F(0,15)",36,0,217,addToBuffer
 1540               		.stabs	"ch:P(0,11)",64,0,217,24
 1541               	.global	addToBuffer
 1542               		.type	addToBuffer, @function
 1543               	addToBuffer:
 1544               		.stabd	46,0,0
 1545               		.stabs	"gpstest.c",132,0,0,.Ltext3
 1546               	.Ltext3:
GAS LISTING /var/tmp//ccvnAEfo.s 			page 38


   1:gpstest.c     **** //Integration test of GPs nmea parse code with No.6
   2:gpstest.c     **** //Last Modified 19Sep06 jlev
   3:gpstest.c     ****  
   4:gpstest.c     **** //----- Include Files ---------------------------------------------------------
   5:gpstest.c     **** #include <avr/io.h>		// include I/O definitions (port names, pin names, etc)
   6:gpstest.c     **** #include <avr/signal.h>	// include "signal" names (interrupt names)
   7:gpstest.c     **** #include <avr/interrupt.h>	// include interrupt support
   8:gpstest.c     **** #include "uart.h"		// include uart function library
   9:gpstest.c     **** #include "rprintf.h"	// include printf function library
  10:gpstest.c     **** #include "timer.h"		// include timer function library
  11:gpstest.c     **** #include "global.h"		// include our global settings
  12:gpstest.c     **** #include "string.h"		// use for strlen()
  13:gpstest.c     **** #include "video.h"  //user video thingy
  14:gpstest.c     **** 
  15:gpstest.c     **** 
  16:gpstest.c     **** //our nmea includes
  17:gpstest.c     **** #include "nmeap.h"
  18:gpstest.c     **** #include "nmeap_def.h"
  19:gpstest.c     **** #include "nmeap01.c"
  20:gpstest.c     **** #include "gpsmath.c"
  21:gpstest.c     **** 
  22:gpstest.c     **** //i2c includes
  23:gpstest.c     **** #include "i2c.h"		// include i2c support
  24:gpstest.c     **** #define LOCAL_ADDR		0xA0
  25:gpstest.c     **** //#define RPRINTF_FLOAT	TRUE	//This allows rprintf to print floats -- useful for lats/longs
  26:gpstest.c     **** #define USE_VID_CARD
  27:gpstest.c     **** 
  28:gpstest.c     **** unsigned char localBuffer[] = "This should be filling with data!";
  29:gpstest.c     **** unsigned char localBufferLength = 0x20;
  30:gpstest.c     **** 
  31:gpstest.c     **** static nmeap_context_t nmea;	//parser context
  32:gpstest.c     **** static int user_data;			//not sure what this is for...
  33:gpstest.c     **** static nmeap_gga_t     gga;     //data buffer for GGA sentences
  34:gpstest.c     **** static nmeap_rmc_t     rmc;     //data buffer for RMC sentences
  35:gpstest.c     **** 
  36:gpstest.c     **** static cBuffer gpsBuffer; //serial receive buffer
  37:gpstest.c     **** static char gpsBufferData[UART_RX_BUFFER_SIZE]; //allocate space in ram for buffer
  38:gpstest.c     **** void addToBuffer(unsigned char ch); //the interrupt handler
  39:gpstest.c     **** 
  40:gpstest.c     **** //i2c routines
  41:gpstest.c     **** void i2cSlaveReceiveService(u08 receiveDataLength, u08* receiveData);
  42:gpstest.c     **** u08 i2cSlaveTransmitService(u08 transmitDataLengthMax, u08* transmitData);
  43:gpstest.c     **** u08 message_sent;
  44:gpstest.c     **** 
  45:gpstest.c     **** //printing to array routines.  these are used to print floats to the i2c, since sprintf doesn't wor
  46:gpstest.c     **** //instead, we set rprintfinit(print_to_string), then at the end have a string that we send to the i
  47:gpstest.c     **** #define stackem_length 0x20
  48:gpstest.c     **** u08 stackem[stackem_length];
  49:gpstest.c     **** u08 stackem_pointer = 0;
  50:gpstest.c     **** void print_to_string(u08 the_char);
  51:gpstest.c     **** 
  52:gpstest.c     **** //----- Begin Code ------------------------------------------------------------
  53:gpstest.c     **** int main(void)
  54:gpstest.c     **** {
  55:gpstest.c     **** 	int status;
  56:gpstest.c     ****     // Test of csik's gps math code
  57:gpstest.c     ****     struct waypoint from,to;
GAS LISTING /var/tmp//ccvnAEfo.s 			page 39


  58:gpstest.c     ****     //from.lat = 50.0912;
  59:gpstest.c     ****     //from.lon = -001.50;
  60:gpstest.c     ****     // set when we get valid GPS
  61:gpstest.c     **** 	to.lat = 42.359051;
  62:gpstest.c     ****     to.lon = -71.093355;
  63:gpstest.c     **** 	// 77 Mass Ave, taken off Google Maps
  64:gpstest.c     ****     
  65:gpstest.c     **** 	//initialize i2c message_sent to 0 to see if we're getting messages...
  66:gpstest.c     **** 	message_sent = 0;
  67:gpstest.c     ****  
  68:gpstest.c     ****    
  69:gpstest.c     ****     //set uart receive rate to output from GPS
  70:gpstest.c     **** 
  71:gpstest.c     **** 	// initialize our libraries
  72:gpstest.c     **** 	// initialize the UART (serial port)
  73:gpstest.c     **** 	uartInit();
  74:gpstest.c     **** 	////PRE_INIT FOR THE VIDEO CARD//////////////////////////////
  75:gpstest.c     **** 	uartSetBaudRate(2400);
  76:gpstest.c     **** 	// make all rprintf statements use uart for output
  77:gpstest.c     **** 	rprintfInit(uartSendByte);
  78:gpstest.c     **** 	initVideo();
  79:gpstest.c     **** 	//////////////////////////////////////////////////////////////
  80:gpstest.c     **** 	uartSetBaudRate(4800);
  81:gpstest.c     **** 	// make all rprintf statements use uart for output
  82:gpstest.c     **** 	rprintfInit(uartSendByte);
  83:gpstest.c     **** 	// initialize the timer system
  84:gpstest.c     **** 	timerInit();
  85:gpstest.c     **** 	//vt100Init();
  86:gpstest.c     **** 	// clear terminal screen
  87:gpstest.c     **** 	//vt100ClearScreen();
  88:gpstest.c     **** 	//vt100SetCursorPos(1,1);
  89:gpstest.c     **** 	// print a little intro message so we know things are working
  90:gpstest.c     **** #ifndef USE_VID_CARD 
  91:gpstest.c     **** 	// print an intro message
  92:gpstest.c     **** 	rprintf("\r\nWelcome to GPS subsystem!\r\n");
  93:gpstest.c     **** #endif USE_VID_CARD
  94:gpstest.c     **** 
  95:gpstest.c     **** ////// initialize the timer system
  96:gpstest.c     **** 	timerInit();
  97:gpstest.c     ****  	timerPause(500);
  98:gpstest.c     **** 
  99:gpstest.c     **** 
 100:gpstest.c     **** ////// initialize i2c///////////////////////////////////////////////////////////////////
 101:gpstest.c     **** 	// initialize i2c function library
 102:gpstest.c     **** 	i2cInit();
 103:gpstest.c     **** 	// set local device address and allow response to general call
 104:gpstest.c     **** 	i2cSetLocalDeviceAddr(LOCAL_ADDR, TRUE);
 105:gpstest.c     **** 	// set the Slave Receive Handler function
 106:gpstest.c     **** 	// (this function will run whenever a master somewhere else on the bus
 107:gpstest.c     **** 	//  writes data to us as a slave)
 108:gpstest.c     **** 	i2cSetSlaveReceiveHandler( i2cSlaveReceiveService );
 109:gpstest.c     **** 	// set the Slave Transmit Handler function
 110:gpstest.c     **** 	// (this function will run whenever a master somewhere else on the bus
 111:gpstest.c     **** 	//  attempts to read data from us as a slave)
 112:gpstest.c     **** 	i2cSetSlaveTransmitHandler( i2cSlaveTransmitService );
 113:gpstest.c     **** 	
 114:gpstest.c     **** 	
GAS LISTING /var/tmp//ccvnAEfo.s 			page 40


 115:gpstest.c     ****    	//initialize the gps receive buffer
 116:gpstest.c     ****    	bufferInit(&gpsBuffer,gpsBufferData,UART_RX_BUFFER_SIZE);
 117:gpstest.c     **** 
 118:gpstest.c     **** 	uartSetRxHandler(addToBuffer); //custom handler	
 119:gpstest.c     **** 	
 120:gpstest.c     **** 	rprintf("set handler\r\n");
 121:gpstest.c     **** 	
 122:gpstest.c     **** 	//initialize gps library
 123:gpstest.c     **** 	status = nmeap_init(&nmea,&user_data);
 124:gpstest.c     **** 	if (status != 0) {
 125:gpstest.c     ****         rprintf("nmeap_init %d\n",status);
 126:gpstest.c     ****     }
 127:gpstest.c     ****    	// initialize gps parsers 
 128:gpstest.c     **** 	status = nmeap_addParser(&nmea,"GPGGA",nmeap_gpgga,0,&gga);
 129:gpstest.c     **** 	if (status != 0) {
 130:gpstest.c     ****         rprintf("nmeap_add GGA %d\n",status);
 131:gpstest.c     ****     }
 132:gpstest.c     ****     status = nmeap_addParser(&nmea,"GPRMC",nmeap_gprmc,0,&rmc);
 133:gpstest.c     ****     if (status != 0) {
 134:gpstest.c     ****         rprintf("nmeap_add RMC %d\n",status);
 135:gpstest.c     ****     }
 136:gpstest.c     **** 	// WHAT IS THIS?????
 137:gpstest.c     **** 	rprintf("gga.latitude = ");
 138:gpstest.c     **** 	rprintfFloat(8,gga.latitude);
 139:gpstest.c     **** 	rprintf("\r\n");
 140:gpstest.c     **** 	
 141:gpstest.c     **** 	for(;;) {
 142:gpstest.c     **** 		//set up variables for access by spi routine
 143:gpstest.c     **** 		float latitude, longitude, altitude, speed;
 144:gpstest.c     **** 		//make sure we have data
 145:gpstest.c     **** 		char ch = bufferGetFromFront(&gpsBuffer);
 146:gpstest.c     **** 		if(ch != 0) {
 147:gpstest.c     **** 				//rprintf("%c",ch); //debug
 148:gpstest.c     **** 				status = nmeap_parse(&nmea,ch);
 149:gpstest.c     **** 				switch(status) {
 150:gpstest.c     **** 					case NMEAP_GPGGA:
 151:gpstest.c     **** #ifdef USE_VID_CARD
 152:gpstest.c     **** 						writeVideoScreen(gga.latitude, gga.longitude, gga.time, gga.altitude, rmc.course, rmc.speed, 
 153:gpstest.c     **** #endif /*#define USE_VID_CARD*/
 154:gpstest.c     **** #ifndef USE_VID_CARD
 155:gpstest.c     **** 						rprintf("GGA");
 156:gpstest.c     **** 						rprintf("\tLat: ");
 157:gpstest.c     **** 						rprintfFloat(8,gga.latitude);
 158:gpstest.c     **** 						rprintf(" Lon: ");
 159:gpstest.c     **** 						rprintfFloat(8,gga.longitude);
 160:gpstest.c     **** 						rprintf(" Alt: ");
 161:gpstest.c     **** 						rprintfFloat(8,gga.altitude);
 162:gpstest.c     **** 						rprintf("\r\n");
 163:gpstest.c     **** 						
 164:gpstest.c     **** 						//print distance to 77 Mass Ave
 165:gpstest.c     **** 						from.lat = gga.latitude;
 166:gpstest.c     **** 						from.lon = gga.longitude;
 167:gpstest.c     **** 						rprintf("Dist to 77 (km): ");
 168:gpstest.c     **** 						rprintfFloat(8,dist(from,to));
 169:gpstest.c     **** 						rprintf("\r\n");
 170:gpstest.c     **** 						rprintf("Bearing to 77 (deg): ");
 171:gpstest.c     **** 						rprintfFloat(8,bearing(from,to));
GAS LISTING /var/tmp//ccvnAEfo.s 			page 41


 172:gpstest.c     **** 						rprintf("\r\n\r\n");
 173:gpstest.c     **** #endif /* NOT using vid card */
 174:gpstest.c     **** 						break;
 175:gpstest.c     **** 					case NMEAP_GPRMC:
 176:gpstest.c     **** #ifdef USE_VID_CARD
 177:gpstest.c     **** 						writeVideoScreen(gga.latitude, gga.longitude, gga.time, gga.altitude, rmc.course, rmc.speed, 
 178:gpstest.c     **** #endif /* USE_VID_CARD */
 179:gpstest.c     **** #ifndef USE_VID_CARD
 180:gpstest.c     **** 						rprintf("RMC");
 181:gpstest.c     **** 						//rprintf("\tLat: ");
 182:gpstest.c     **** 						//rprintfFloat(8,rmc.latitude);
 183:gpstest.c     **** 						//rprintf(" Lon: ");
 184:gpstest.c     **** 						//rprintfFloat(8,rmc.longitude);
 185:gpstest.c     **** 						rprintf(" Vel (kt): ");
 186:gpstest.c     **** 						rprintfFloat(8,rmc.speed);
 187:gpstest.c     **** 						rprintf(" Course over ground (deg): ")
 188:gpstest.c     **** 						rprintfFloat(8,rmc.course);
 189:gpstest.c     **** 						rprintf("\r\n");
 190:gpstest.c     **** #endif /* NOT using vid card */
 191:gpstest.c     **** 						break;
 192:gpstest.c     **** 					default:
 193:gpstest.c     **** 						break;
 194:gpstest.c     **** 			        } //end switch	
 195:gpstest.c     **** 			
 196:gpstest.c     **** 			}//	end if(ch != 0)
 197:gpstest.c     **** 			
 198:gpstest.c     **** 			//  here one would write to the video and the i2c buffer... set a mutex?  in other words, we wan
 199:gpstest.c     **** 			// use two data objects, write back and forth and switch in a single operation?
 200:gpstest.c     **** 			// write a make a readable write b make b readable
 201:gpstest.c     **** 			// writeVideoScreen(gga.latitude, gga.longitude, gga.altitude, speed, char ERROR)
 202:gpstest.c     **** 			
 203:gpstest.c     **** 			// OR, should the master give a character and then receive a value?
 204:gpstest.c     **** 			// that would seem to make more sense, but it means sort of immediate updates...
 205:gpstest.c     **** 			rprintf(".\r");
 206:gpstest.c     **** 
 207:gpstest.c     **** 			if(message_sent != 0)
 208:gpstest.c     **** 			{
 209:gpstest.c     **** 				message_sent = 1;
 210:gpstest.c     **** 				rprintf("\r\nsent i2c!");
 211:gpstest.c     **** 			}
 212:gpstest.c     **** 	} //end for
 213:gpstest.c     **** 	
 214:gpstest.c     **** 	return 0;
 215:gpstest.c     **** }
 216:gpstest.c     **** 
 217:gpstest.c     **** void addToBuffer(unsigned char ch) {
 1547               		.stabn	68,0,217,.LM95-addToBuffer
 1548               	.LM95:
 1549               	/* prologue: frame size=0 */
 1550               	/* prologue end (size=0) */
 218:gpstest.c     **** 	bufferAddToEnd(&gpsBuffer,ch);
 1551               		.stabn	68,0,218,.LM96-addToBuffer
 1552               	.LM96:
 1553 083e 682F      		mov r22,r24
 1554 0840 80E0      		ldi r24,lo8(gpsBuffer)
 1555 0842 90E0      		ldi r25,hi8(gpsBuffer)
 1556 0844 0E94 0000 		call bufferAddToEnd
GAS LISTING /var/tmp//ccvnAEfo.s 			page 42


 1557               	/* epilogue: frame size=0 */
 1558 0848 0895      		ret
 1559               	/* epilogue end (size=1) */
 1560               	/* function addToBuffer size 6 (5) */
 1561               		.size	addToBuffer, .-addToBuffer
 1562               	.Lscope7:
 1563               		.stabs	"",36,0,0,.Lscope7-addToBuffer
 1564               		.stabd	78,0,0
 1565               		.stabs	"i2cSlaveReceiveService:F(0,15)",36,0,223,i2cSlaveReceiveService
 1566               		.stabs	"receiveDataLength:P(7,1)",64,0,222,25
 1567               		.stabs	"receiveData:P(0,20)=*(7,1)",64,0,222,26
 1568               	.global	i2cSlaveReceiveService
 1569               		.type	i2cSlaveReceiveService, @function
 1570               	i2cSlaveReceiveService:
 1571               		.stabd	46,0,0
 219:gpstest.c     **** }
 220:gpstest.c     **** 
 221:gpstest.c     **** // slave operations
 222:gpstest.c     **** void i2cSlaveReceiveService(u08 receiveDataLength, u08* receiveData)
 223:gpstest.c     **** {
 1572               		.stabn	68,0,223,.LM97-i2cSlaveReceiveService
 1573               	.LM97:
 1574               	/* prologue: frame size=0 */
 1575               	/* prologue end (size=0) */
 1576 084a 982F      		mov r25,r24
 1577 084c DB01      		movw r26,r22
 224:gpstest.c     **** 	u08 i;
 225:gpstest.c     **** 
 226:gpstest.c     **** 	// this function will run when a master somewhere else on the bus
 227:gpstest.c     **** 	// addresses us and wishes to write data to us
 228:gpstest.c     **** 
 229:gpstest.c     **** 	//showByte(*receiveData);
 230:gpstest.c     **** 	cbi(PORTB, PB6);
 1578               		.stabn	68,0,230,.LM98-i2cSlaveReceiveService
 1579               	.LM98:
 1580 084e C698      		cbi 56-0x20,6
 1581 0850 20E0      		ldi r18,lo8(0)
 1582 0852 30E0      		ldi r19,hi8(0)
 1583 0854 07C0      		rjmp .L92
 1584               	.L93:
 231:gpstest.c     **** 
 232:gpstest.c     **** 	// copy the received data to a local buffer
 233:gpstest.c     **** 	for(i=0; i<receiveDataLength; i++)
 234:gpstest.c     **** 	{
 235:gpstest.c     **** 		localBuffer[i] = *receiveData++;
 1585               		.stabn	68,0,235,.LM99-i2cSlaveReceiveService
 1586               	.LM99:
 1587 0856 8D91      		ld r24,X+
 1588 0858 FF27      		clr r31
 1589 085a E050      		subi r30,lo8(-(localBuffer))
 1590 085c F040      		sbci r31,hi8(-(localBuffer))
 1591 085e 8083      		st Z,r24
 1592 0860 2F5F      		subi r18,lo8(-(1))
 1593 0862 3F4F      		sbci r19,hi8(-(1))
 1594               	.L92:
 1595 0864 E22F      		mov r30,r18
 1596               		.stabn	68,0,233,.LM100-i2cSlaveReceiveService
GAS LISTING /var/tmp//ccvnAEfo.s 			page 43


 1597               	.LM100:
 1598 0866 2917      		cp r18,r25
 1599 0868 B0F3      		brlo .L93
 236:gpstest.c     **** 	}
 237:gpstest.c     **** 	localBufferLength = receiveDataLength;
 1600               		.stabn	68,0,237,.LM101-i2cSlaveReceiveService
 1601               	.LM101:
 1602 086a 9093 0000 		sts localBufferLength,r25
 1603               	/* epilogue: frame size=0 */
 1604 086e 0895      		ret
 1605               	/* epilogue end (size=1) */
 1606               	/* function i2cSlaveReceiveService size 19 (18) */
 1607               		.size	i2cSlaveReceiveService, .-i2cSlaveReceiveService
 1608               		.stabs	"i:r(7,1)",64,0,224,30
 1609               		.stabn	192,0,0,i2cSlaveReceiveService-i2cSlaveReceiveService
 1610               		.stabn	224,0,0,.Lscope8-i2cSlaveReceiveService
 1611               	.Lscope8:
 1612               		.stabs	"",36,0,0,.Lscope8-i2cSlaveReceiveService
 1613               		.stabd	78,0,0
 1614               		.section	.progmem.data,"a",@progbits
 1615               		.type	__c.2439, @object
 1616               		.size	__c.2439, 3
 1617               	__c.2439:
 1618 0000 6420 00   		.string	"d "
 1619               		.type	__c.2436, @object
 1620               		.size	__c.2436, 3
 1621               	__c.2436:
 1622 0003 6320 00   		.string	"c "
 1623               		.type	__c.2433, @object
 1624               		.size	__c.2433, 3
 1625               	__c.2433:
 1626 0006 6720 00   		.string	"g "
 1627               		.type	__c.2430, @object
 1628               		.size	__c.2430, 3
 1629               	__c.2430:
 1630 0009 6F20 00   		.string	"o "
 1631               		.type	__c.2426, @object
 1632               		.size	__c.2426, 3
 1633               	__c.2426:
 1634 000c 6120 00   		.string	"a "
 1635               		.text
 1636               		.stabs	"i2cSlaveTransmitService:F(7,1)",36,0,255,i2cSlaveTransmitService
 1637               		.stabs	"transmitDataLengthMax:P(7,1)",64,0,254,24
 1638               		.stabs	"transmitData:P(0,20)",64,0,254,28
 1639               	.global	i2cSlaveTransmitService
 1640               		.type	i2cSlaveTransmitService, @function
 1641               	i2cSlaveTransmitService:
 1642               		.stabd	46,0,0
 238:gpstest.c     **** 	
 239:gpstest.c     **** }
 240:gpstest.c     **** 
 241:gpstest.c     **** /*
 242:gpstest.c     **** #define	 q "pitch"
 243:gpstest.c     **** #define	 w "Roll"
 244:gpstest.c     **** #define	 c "Heading"
 245:gpstest.c     **** #define	 a "Latitude"
 246:gpstest.c     **** #define	 o "Longitude"
GAS LISTING /var/tmp//ccvnAEfo.s 			page 44


 247:gpstest.c     **** #define	 z "Altitude"
 248:gpstest.c     **** #define	 b "Battery"
 249:gpstest.c     **** #define	 f "Fuel"
 250:gpstest.c     **** #define	 s "Airspeed"
 251:gpstest.c     **** #define	 g "Groundspeed"
 252:gpstest.c     **** */
 253:gpstest.c     **** 
 254:gpstest.c     **** u08 i2cSlaveTransmitService(u08 transmitDataLengthMax, u08* transmitData)
 255:gpstest.c     **** {
 1643               		.stabn	68,0,255,.LM102-i2cSlaveTransmitService
 1644               	.LM102:
 1645               	/* prologue: frame size=0 */
 1646 0870 CF93      		push r28
 1647 0872 DF93      		push r29
 1648               	/* prologue end (size=2) */
 1649 0874 EB01      		movw r28,r22
 256:gpstest.c     **** 	u08 i;
 257:gpstest.c     **** 	// this function will run when a master somewhere else on the bus
 258:gpstest.c     **** 	// addresses us and wishes to read data from us
 259:gpstest.c     **** 	
 260:gpstest.c     **** 	// I believe that this might be the place to load the response...
 261:gpstest.c     **** 	
 262:gpstest.c     **** 	//showByte(*transmitData);	
 263:gpstest.c     **** 	cbi(PORTB, PB7);
 1650               		.stabn	68,0,263,.LM103-i2cSlaveTransmitService
 1651               	.LM103:
 1652 0876 C798      		cbi 56-0x20,7
 264:gpstest.c     **** 	rprintfInit(print_to_string);
 1653               		.stabn	68,0,264,.LM104-i2cSlaveTransmitService
 1654               	.LM104:
 1655 0878 80E0      		ldi r24,lo8(pm(print_to_string))
 1656 087a 90E0      		ldi r25,hi8(pm(print_to_string))
 1657 087c 0E94 0000 		call rprintfInit
 265:gpstest.c     **** 	// temp for debugging.... CHANGE!
 266:gpstest.c     **** 	float test = -71.093355;
 267:gpstest.c     **** 	double test2 = 42.359051;
 268:gpstest.c     **** 	stackem_pointer = 0;
 1658               		.stabn	68,0,268,.LM105-i2cSlaveTransmitService
 1659               	.LM105:
 1660 0880 1092 0000 		sts stackem_pointer,__zero_reg__
 269:gpstest.c     **** 	switch(localBuffer[0])
 1661               		.stabn	68,0,269,.LM106-i2cSlaveTransmitService
 1662               	.LM106:
 1663 0884 8091 0000 		lds r24,localBuffer
 1664 0888 8436      		cpi r24,lo8(100)
 1665 088a 09F4      		brne .+2
 1666 088c 52C0      		rjmp .L100
 1667               		.stabn	68,0,269,.LM107-i2cSlaveTransmitService
 1668               	.LM107:
 1669 088e 8536      		cpi r24,lo8(101)
 1670 0890 30F4      		brsh .L103
 1671 0892 8136      		cpi r24,lo8(97)
 1672 0894 51F0      		breq .L98
 1673 0896 8336      		cpi r24,lo8(99)
 1674 0898 09F0      		breq .+2
 1675 089a 7EC0      		rjmp .L97
 1676 089c 39C0      		rjmp .L99
GAS LISTING /var/tmp//ccvnAEfo.s 			page 45


 1677               	.L103:
 1678 089e 8736      		cpi r24,lo8(103)
 1679 08a0 31F1      		breq .L101
 1680 08a2 8F36      		cpi r24,lo8(111)
 1681 08a4 09F0      		breq .+2
 1682 08a6 78C0      		rjmp .L97
 1683 08a8 11C0      		rjmp .L102
 1684               	.L98:
 270:gpstest.c     **** 	{
 271:gpstest.c     **** 		case 'a': //latitude
 272:gpstest.c     **** 			rprintf("a ");
 1685               		.stabn	68,0,272,.LM108-i2cSlaveTransmitService
 1686               	.LM108:
 1687 08aa 80E0      		ldi r24,lo8(__c.2426)
 1688 08ac 90E0      		ldi r25,hi8(__c.2426)
 1689 08ae 9F93      		push r25
 1690 08b0 8F93      		push r24
 1691 08b2 81E0      		ldi r24,lo8(1)
 1692 08b4 8F93      		push r24
 1693 08b6 0E94 0000 		call rprintf1RamRom
 273:gpstest.c     **** 			rprintfFloat(8,gga.latitude);
 1694               		.stabn	68,0,273,.LM109-i2cSlaveTransmitService
 1695               	.LM109:
 1696 08ba 4091 0000 		lds r20,gga
 1697 08be 5091 0000 		lds r21,(gga)+1
 1698 08c2 6091 0000 		lds r22,(gga)+2
 1699 08c6 7091 0000 		lds r23,(gga)+3
 1700 08ca 60C0      		rjmp .L110
 1701               	.L102:
 274:gpstest.c     **** 			//rprintfFloat(8,test2);	
 275:gpstest.c     **** 			break;
 276:gpstest.c     **** 		case 'o': //longitude
 277:gpstest.c     **** 			rprintf("o ");
 1702               		.stabn	68,0,277,.LM110-i2cSlaveTransmitService
 1703               	.LM110:
 1704 08cc 80E0      		ldi r24,lo8(__c.2430)
 1705 08ce 90E0      		ldi r25,hi8(__c.2430)
 1706 08d0 9F93      		push r25
 1707 08d2 8F93      		push r24
 1708 08d4 81E0      		ldi r24,lo8(1)
 1709 08d6 8F93      		push r24
 1710 08d8 0E94 0000 		call rprintf1RamRom
 278:gpstest.c     **** 			rprintfFloat(8,gga.longitude);
 1711               		.stabn	68,0,278,.LM111-i2cSlaveTransmitService
 1712               	.LM111:
 1713 08dc 4091 0000 		lds r20,gga+4
 1714 08e0 5091 0000 		lds r21,(gga+4)+1
 1715 08e4 6091 0000 		lds r22,(gga+4)+2
 1716 08e8 7091 0000 		lds r23,(gga+4)+3
 1717 08ec 4FC0      		rjmp .L110
 1718               	.L101:
 279:gpstest.c     **** 			//rprintfFloat(8,test);	
 280:gpstest.c     **** 			break;
 281:gpstest.c     **** 		case 'g': //groundspeed
 282:gpstest.c     **** 			rprintf("g ");
 1719               		.stabn	68,0,282,.LM112-i2cSlaveTransmitService
 1720               	.LM112:
GAS LISTING /var/tmp//ccvnAEfo.s 			page 46


 1721 08ee 80E0      		ldi r24,lo8(__c.2433)
 1722 08f0 90E0      		ldi r25,hi8(__c.2433)
 1723 08f2 9F93      		push r25
 1724 08f4 8F93      		push r24
 1725 08f6 81E0      		ldi r24,lo8(1)
 1726 08f8 8F93      		push r24
 1727 08fa 0E94 0000 		call rprintf1RamRom
 283:gpstest.c     **** 			rprintfFloat(8,rmc.speed);
 1728               		.stabn	68,0,283,.LM113-i2cSlaveTransmitService
 1729               	.LM113:
 1730 08fe 4091 0000 		lds r20,rmc+13
 1731 0902 5091 0000 		lds r21,(rmc+13)+1
 1732 0906 6091 0000 		lds r22,(rmc+13)+2
 1733 090a 7091 0000 		lds r23,(rmc+13)+3
 1734 090e 3EC0      		rjmp .L110
 1735               	.L99:
 284:gpstest.c     **** 			break;
 285:gpstest.c     **** 		case 'c':
 286:gpstest.c     **** 			rprintf("c ");
 1736               		.stabn	68,0,286,.LM114-i2cSlaveTransmitService
 1737               	.LM114:
 1738 0910 80E0      		ldi r24,lo8(__c.2436)
 1739 0912 90E0      		ldi r25,hi8(__c.2436)
 1740 0914 9F93      		push r25
 1741 0916 8F93      		push r24
 1742 0918 81E0      		ldi r24,lo8(1)
 1743 091a 8F93      		push r24
 1744 091c 0E94 0000 		call rprintf1RamRom
 287:gpstest.c     **** 			rprintfFloat(8,rmc.course);
 1745               		.stabn	68,0,287,.LM115-i2cSlaveTransmitService
 1746               	.LM115:
 1747 0920 4091 0000 		lds r20,rmc+17
 1748 0924 5091 0000 		lds r21,(rmc+17)+1
 1749 0928 6091 0000 		lds r22,(rmc+17)+2
 1750 092c 7091 0000 		lds r23,(rmc+17)+3
 1751 0930 2DC0      		rjmp .L110
 1752               	.L100:
 288:gpstest.c     **** 			break;
 289:gpstest.c     **** 		case 'd':
 290:gpstest.c     **** 			rprintf("d ");
 1753               		.stabn	68,0,290,.LM116-i2cSlaveTransmitService
 1754               	.LM116:
 1755 0932 80E0      		ldi r24,lo8(__c.2439)
 1756 0934 90E0      		ldi r25,hi8(__c.2439)
 1757 0936 9F93      		push r25
 1758 0938 8F93      		push r24
 1759 093a 81E0      		ldi r24,lo8(1)
 1760 093c 8F93      		push r24
 1761 093e 0E94 0000 		call rprintf1RamRom
 291:gpstest.c     **** 			rprintfFloat(8,rmc.date);
 1762               		.stabn	68,0,291,.LM117-i2cSlaveTransmitService
 1763               	.LM117:
 1764 0942 2091 0000 		lds r18,rmc+21
 1765 0946 3091 0000 		lds r19,(rmc+21)+1
 1766 094a 4091 0000 		lds r20,(rmc+21)+2
 1767 094e 5091 0000 		lds r21,(rmc+21)+3
 1768 0952 57FD      		sbrc r21,7
GAS LISTING /var/tmp//ccvnAEfo.s 			page 47


 1769 0954 05C0      		rjmp .L105
 1770 0956 CA01      		movw r24,r20
 1771 0958 B901      		movw r22,r18
 1772 095a 0E94 0000 		call __floatsisf
 1773 095e 14C0      		rjmp .L104
 1774               	.L105:
 1775 0960 CA01      		movw r24,r20
 1776 0962 B901      		movw r22,r18
 1777 0964 6170      		andi r22,lo8(1)
 1778 0966 7070      		andi r23,hi8(1)
 1779 0968 8070      		andi r24,hlo8(1)
 1780 096a 9070      		andi r25,hhi8(1)
 1781 096c 5695      		lsr r21
 1782 096e 4795      		ror r20
 1783 0970 3795      		ror r19
 1784 0972 2795      		ror r18
 1785 0974 622B      		or r22,r18
 1786 0976 732B      		or r23,r19
 1787 0978 842B      		or r24,r20
 1788 097a 952B      		or r25,r21
 1789 097c 0E94 0000 		call __floatsisf
 1790 0980 9B01      		movw r18,r22
 1791 0982 AC01      		movw r20,r24
 1792 0984 0E94 0000 		call __addsf3
 1793               	.L104:
 1794 0988 AB01      		movw r20,r22
 1795 098a BC01      		movw r22,r24
 1796               	.L110:
 1797 098c 88E0      		ldi r24,lo8(8)
 1798 098e 0E94 0000 		call rprintfFloat
 1799 0992 0F90      		pop __tmp_reg__
 1800 0994 0F90      		pop __tmp_reg__
 1801 0996 0F90      	 	pop __tmp_reg__
 1802               	.L97:
 292:gpstest.c     **** 			break;
 293:gpstest.c     **** 		default:
 294:gpstest.c     **** 		//	rprintf(" E");  //CE = Command Error
 295:gpstest.c     **** 			break;
 296:gpstest.c     **** 	}
 297:gpstest.c     **** 	rprintfInit(uartSendByte);
 1803               		.stabn	68,0,297,.LM118-i2cSlaveTransmitService
 1804               	.LM118:
 1805 0998 80E0      		ldi r24,lo8(pm(uartSendByte))
 1806 099a 90E0      		ldi r25,hi8(pm(uartSendByte))
 1807 099c 0E94 0000 		call rprintfInit
 1808 09a0 DE01      		movw r26,r28
 1809 09a2 05C0      		rjmp .L106
 1810               	.L107:
 298:gpstest.c     **** 	//sprintf(temp_buffer, "%f,%f",gga.latitude,gga.longitude);
 299:gpstest.c     **** 	
 300:gpstest.c     **** 	// copy the local buffer to the transmit buffer -- this buffer size is set in i2c.conf
 301:gpstest.c     **** 	for(i=0; i<=stackem_pointer; i++)
 302:gpstest.c     **** 	{
 303:gpstest.c     **** 		*transmitData++ = stackem[i];
 1811               		.stabn	68,0,303,.LM119-i2cSlaveTransmitService
 1812               	.LM119:
 1813 09a4 FF27      		clr r31
GAS LISTING /var/tmp//ccvnAEfo.s 			page 48


 1814 09a6 E050      		subi r30,lo8(-(stackem))
 1815 09a8 F040      		sbci r31,hi8(-(stackem))
 1816 09aa 8081      		ld r24,Z
 1817 09ac 8D93      		st X+,r24
 1818               	.L106:
 1819 09ae EA2F      		mov r30,r26
 1820 09b0 EC1B      		sub r30,r28
 1821               		.stabn	68,0,301,.LM120-i2cSlaveTransmitService
 1822               	.LM120:
 1823 09b2 8091 0000 		lds r24,stackem_pointer
 1824 09b6 8E17      		cp r24,r30
 1825 09b8 A8F7      		brsh .L107
 1826 09ba 8F5F      		subi r24,lo8(-(1))
 304:gpstest.c     **** 	}
 305:gpstest.c     **** 	
 306:gpstest.c     **** 	
 307:gpstest.c     **** 	//localBuffer[0]++;
 308:gpstest.c     **** 	//message_sent = 1;
 309:gpstest.c     **** 
 310:gpstest.c     **** 	return stackem_pointer+1;
 311:gpstest.c     **** }
 1827               		.stabn	68,0,311,.LM121-i2cSlaveTransmitService
 1828               	.LM121:
 1829 09bc 9927      		clr r25
 1830               	/* epilogue: frame size=0 */
 1831 09be DF91      		pop r29
 1832 09c0 CF91      		pop r28
 1833 09c2 0895      		ret
 1834               	/* epilogue end (size=3) */
 1835               	/* function i2cSlaveTransmitService size 170 (165) */
 1836               		.size	i2cSlaveTransmitService, .-i2cSlaveTransmitService
 1837               		.stabs	"i:r(7,1)",64,0,256,30
 1838               		.stabn	192,0,0,i2cSlaveTransmitService-i2cSlaveTransmitService
 1839               		.stabn	224,0,0,.Lscope9-i2cSlaveTransmitService
 1840               	.Lscope9:
 1841               		.stabs	"",36,0,0,.Lscope9-i2cSlaveTransmitService
 1842               		.stabd	78,0,0
 1843               		.stabs	"print_to_string:F(0,15)",36,0,313,print_to_string
 1844               		.stabs	"the_char:P(7,1)",64,0,312,24
 1845               	.global	print_to_string
 1846               		.type	print_to_string, @function
 1847               	print_to_string:
 1848               		.stabd	46,0,0
 312:gpstest.c     **** void print_to_string(u08 the_char)
 313:gpstest.c     **** {
 1849               		.stabn	68,0,313,.LM122-print_to_string
 1850               	.LM122:
 1851               	/* prologue: frame size=0 */
 1852               	/* prologue end (size=0) */
 314:gpstest.c     **** 	if(stackem_pointer<(stackem_length-1))  //-1 to allow for null char to still fit
 1853               		.stabn	68,0,314,.LM123-print_to_string
 1854               	.LM123:
 1855 09c4 9091 0000 		lds r25,stackem_pointer
 1856 09c8 9F31      		cpi r25,lo8(31)
 1857 09ca 68F4      		brsh .L114
 315:gpstest.c     **** 	{
 316:gpstest.c     **** 		stackem[stackem_pointer] = the_char;
GAS LISTING /var/tmp//ccvnAEfo.s 			page 49


 1858               		.stabn	68,0,316,.LM124-print_to_string
 1859               	.LM124:
 1860 09cc E92F      		mov r30,r25
 1861 09ce FF27      		clr r31
 1862 09d0 E050      		subi r30,lo8(-(stackem))
 1863 09d2 F040      		sbci r31,hi8(-(stackem))
 1864 09d4 8083      		st Z,r24
 317:gpstest.c     **** 		stackem_pointer++;
 1865               		.stabn	68,0,317,.LM125-print_to_string
 1866               	.LM125:
 1867 09d6 E92F      		mov r30,r25
 1868 09d8 EF5F      		subi r30,lo8(-(1))
 1869 09da E093 0000 		sts stackem_pointer,r30
 318:gpstest.c     **** 		stackem[stackem_pointer] = 0;
 1870               		.stabn	68,0,318,.LM126-print_to_string
 1871               	.LM126:
 1872 09de FF27      		clr r31
 1873 09e0 E050      		subi r30,lo8(-(stackem))
 1874 09e2 F040      		sbci r31,hi8(-(stackem))
 1875 09e4 1082      		st Z,__zero_reg__
 1876               	.L114:
 1877 09e6 0895      		ret
 1878               	/* epilogue: frame size=0 */
 1879               	/* epilogue: noreturn */
 1880               	/* epilogue end (size=0) */
 1881               	/* function print_to_string size 18 (18) */
 1882               		.size	print_to_string, .-print_to_string
 1883               	.Lscope10:
 1884               		.stabs	"",36,0,0,.Lscope10-print_to_string
 1885               		.stabd	78,0,0
 1886               		.stabs	"nmeap_latitude:F(0,13)",36,0,58,nmeap_latitude
 1887               		.stabs	"plat:P(0,16)",64,0,57,30
 1888               		.stabs	"phem:P(0,16)",64,0,57,26
 1889               	.global	nmeap_latitude
 1890               		.type	nmeap_latitude, @function
 1891               	nmeap_latitude:
 1892               		.stabd	46,0,0
 1893               		.stabs	"nmeap01.c",132,0,0,.Ltext4
 1894               	.Ltext4:
 1895               		.stabn	68,0,58,.LM127-nmeap_latitude
 1896               	.LM127:
 1897               	/* prologue: frame size=0 */
 1898 09e8 AF92      		push r10
 1899 09ea BF92      		push r11
 1900 09ec CF92      		push r12
 1901 09ee DF92      		push r13
 1902 09f0 EF92      		push r14
 1903 09f2 FF92      		push r15
 1904 09f4 0F93      		push r16
 1905 09f6 1F93      		push r17
 1906 09f8 CF93      		push r28
 1907 09fa DF93      		push r29
 1908               	/* prologue end (size=10) */
 1909 09fc FC01      		movw r30,r24
 1910 09fe DB01      		movw r26,r22
 1911               		.stabn	68,0,64,.LM128-nmeap_latitude
 1912               	.LM128:
GAS LISTING /var/tmp//ccvnAEfo.s 			page 50


 1913 0a00 892B      		or r24,r25
 1914 0a02 09F4      		brne .L116
 1915               	.L129:
 1916 0a04 FFCF      		rjmp .L129
 1917               	.L116:
 1918               		.stabn	68,0,65,.LM129-nmeap_latitude
 1919               	.LM129:
 1920 0a06 672B      		or r22,r23
 1921 0a08 09F4      		brne .L118
 1922               	.L130:
 1923 0a0a FFCF      		rjmp .L130
 1924               	.L118:
 1925               		.stabn	68,0,67,.LM130-nmeap_latitude
 1926               	.LM130:
 1927 0a0c 8081      		ld r24,Z
 1928 0a0e 8823      		tst r24
 1929 0a10 19F0      		breq .L131
 1930               		.stabn	68,0,70,.LM131-nmeap_latitude
 1931               	.LM131:
 1932 0a12 6C91      		ld r22,X
 1933 0a14 6623      		tst r22
 1934 0a16 29F4      		brne .L123
 1935               	.L131:
 1936 0a18 60E0      		ldi r22,lo8(0x0)
 1937 0a1a 70E0      		ldi r23,hi8(0x0)
 1938 0a1c 80E0      		ldi r24,hlo8(0x0)
 1939 0a1e 90E0      		ldi r25,hhi8(0x0)
 1940 0a20 43C0      		rjmp .L122
 1941               	.L123:
 1942               		.stabn	68,0,75,.LM132-nmeap_latitude
 1943               	.LM132:
 1944 0a22 6E34      		cpi r22,lo8(78)
 1945 0a24 19F4      		brne .L125
 1946 0a26 C1E0      		ldi r28,lo8(1)
 1947 0a28 D0E0      		ldi r29,hi8(1)
 1948 0a2a 02C0      		rjmp .L127
 1949               	.L125:
 1950 0a2c CFEF      		ldi r28,lo8(-1)
 1951 0a2e DFEF      		ldi r29,hi8(-1)
 1952               	.L127:
 1953               		.stabn	68,0,85,.LM133-nmeap_latitude
 1954               	.LM133:
 1955 0a30 CF01      		movw r24,r30
 1956 0a32 0E94 0000 		call atof
 1957 0a36 5B01      		movw r10,r22
 1958 0a38 6C01      		movw r12,r24
 1959               		.stabn	68,0,91,.LM134-nmeap_latitude
 1960               	.LM134:
 1961 0a3a 20E0      		ldi r18,lo8(0x42c80000)
 1962 0a3c 30E0      		ldi r19,hi8(0x42c80000)
 1963 0a3e 48EC      		ldi r20,hlo8(0x42c80000)
 1964 0a40 52E4      		ldi r21,hhi8(0x42c80000)
 1965 0a42 0E94 0000 		call __divsf3
 1966 0a46 0E94 0000 		call __fixsfsi
 1967 0a4a 8827      		clr r24
 1968 0a4c 77FD      		sbrc r23,7
 1969 0a4e 8095      		com r24
GAS LISTING /var/tmp//ccvnAEfo.s 			page 51


 1970 0a50 982F      		mov r25,r24
 1971 0a52 0E94 0000 		call __floatsisf
 1972 0a56 7B01      		movw r14,r22
 1973 0a58 8C01      		movw r16,r24
 1974               		.stabn	68,0,94,.LM135-nmeap_latitude
 1975               	.LM135:
 1976 0a5a 20E0      		ldi r18,lo8(0xc2c80000)
 1977 0a5c 30E0      		ldi r19,hi8(0xc2c80000)
 1978 0a5e 48EC      		ldi r20,hlo8(0xc2c80000)
 1979 0a60 52EC      		ldi r21,hhi8(0xc2c80000)
 1980 0a62 0E94 0000 		call __mulsf3
 1981 0a66 9B01      		movw r18,r22
 1982 0a68 AC01      		movw r20,r24
 1983 0a6a C601      		movw r24,r12
 1984 0a6c B501      		movw r22,r10
 1985 0a6e 0E94 0000 		call __addsf3
 1986 0a72 20E0      		ldi r18,lo8(0x42700000)
 1987 0a74 30E0      		ldi r19,hi8(0x42700000)
 1988 0a76 40E7      		ldi r20,hlo8(0x42700000)
 1989 0a78 52E4      		ldi r21,hhi8(0x42700000)
 1990 0a7a 0E94 0000 		call __divsf3
 1991 0a7e 9B01      		movw r18,r22
 1992 0a80 AC01      		movw r20,r24
 1993 0a82 C801      		movw r24,r16
 1994 0a84 B701      		movw r22,r14
 1995 0a86 0E94 0000 		call __addsf3
 1996 0a8a 7B01      		movw r14,r22
 1997 0a8c 8C01      		movw r16,r24
 1998 0a8e BE01      		movw r22,r28
 1999 0a90 8827      		clr r24
 2000 0a92 77FD      		sbrc r23,7
 2001 0a94 8095      		com r24
 2002 0a96 982F      		mov r25,r24
 2003 0a98 0E94 0000 		call __floatsisf
 2004 0a9c 9B01      		movw r18,r22
 2005 0a9e AC01      		movw r20,r24
 2006 0aa0 C801      		movw r24,r16
 2007 0aa2 B701      		movw r22,r14
 2008 0aa4 0E94 0000 		call __mulsf3
 2009               	.L122:
 2010               	/* epilogue: frame size=0 */
 2011 0aa8 DF91      		pop r29
 2012 0aaa CF91      		pop r28
 2013 0aac 1F91      		pop r17
 2014 0aae 0F91      		pop r16
 2015 0ab0 FF90      		pop r15
 2016 0ab2 EF90      		pop r14
 2017 0ab4 DF90      		pop r13
 2018 0ab6 CF90      		pop r12
 2019 0ab8 BF90      		pop r11
 2020 0aba AF90      		pop r10
 2021 0abc 0895      		ret
 2022               	/* epilogue end (size=11) */
 2023               	/* function nmeap_latitude size 107 (86) */
 2024               		.size	nmeap_latitude, .-nmeap_latitude
 2025               		.stabs	"lat:r(0,13)",64,0,59,22
 2026               		.stabs	"ns:r(0,1)",64,0,62,28
GAS LISTING /var/tmp//ccvnAEfo.s 			page 52


 2027               		.stabn	192,0,0,nmeap_latitude-nmeap_latitude
 2028               		.stabn	224,0,0,.Lscope11-nmeap_latitude
 2029               	.Lscope11:
 2030               		.stabs	"",36,0,0,.Lscope11-nmeap_latitude
 2031               		.stabd	78,0,0
 2032               		.stabs	"nmeap_longitude:F(0,13)",36,0,105,nmeap_longitude
 2033               		.stabs	"plon:P(0,16)",64,0,104,30
 2034               		.stabs	"phem:P(0,16)",64,0,104,26
 2035               	.global	nmeap_longitude
 2036               		.type	nmeap_longitude, @function
 2037               	nmeap_longitude:
 2038               		.stabd	46,0,0
 2039               		.stabn	68,0,105,.LM136-nmeap_longitude
 2040               	.LM136:
 2041               	/* prologue: frame size=0 */
 2042 0abe AF92      		push r10
 2043 0ac0 BF92      		push r11
 2044 0ac2 CF92      		push r12
 2045 0ac4 DF92      		push r13
 2046 0ac6 EF92      		push r14
 2047 0ac8 FF92      		push r15
 2048 0aca 0F93      		push r16
 2049 0acc 1F93      		push r17
 2050 0ace CF93      		push r28
 2051 0ad0 DF93      		push r29
 2052               	/* prologue end (size=10) */
 2053 0ad2 FC01      		movw r30,r24
 2054 0ad4 DB01      		movw r26,r22
 2055               		.stabn	68,0,111,.LM137-nmeap_longitude
 2056               	.LM137:
 2057 0ad6 892B      		or r24,r25
 2058 0ad8 09F4      		brne .L133
 2059               	.L146:
 2060 0ada FFCF      		rjmp .L146
 2061               	.L133:
 2062               		.stabn	68,0,112,.LM138-nmeap_longitude
 2063               	.LM138:
 2064 0adc 672B      		or r22,r23
 2065 0ade 09F4      		brne .L135
 2066               	.L147:
 2067 0ae0 FFCF      		rjmp .L147
 2068               	.L135:
 2069               		.stabn	68,0,114,.LM139-nmeap_longitude
 2070               	.LM139:
 2071 0ae2 8081      		ld r24,Z
 2072 0ae4 8823      		tst r24
 2073 0ae6 19F0      		breq .L148
 2074               		.stabn	68,0,117,.LM140-nmeap_longitude
 2075               	.LM140:
 2076 0ae8 6C91      		ld r22,X
 2077 0aea 6623      		tst r22
 2078 0aec 29F4      		brne .L140
 2079               	.L148:
 2080 0aee 60E0      		ldi r22,lo8(0x0)
 2081 0af0 70E0      		ldi r23,hi8(0x0)
 2082 0af2 80E0      		ldi r24,hlo8(0x0)
 2083 0af4 90E0      		ldi r25,hhi8(0x0)
GAS LISTING /var/tmp//ccvnAEfo.s 			page 53


 2084 0af6 43C0      		rjmp .L139
 2085               	.L140:
 2086               		.stabn	68,0,122,.LM141-nmeap_longitude
 2087               	.LM141:
 2088 0af8 6534      		cpi r22,lo8(69)
 2089 0afa 19F4      		brne .L142
 2090 0afc C1E0      		ldi r28,lo8(1)
 2091 0afe D0E0      		ldi r29,hi8(1)
 2092 0b00 02C0      		rjmp .L144
 2093               	.L142:
 2094 0b02 CFEF      		ldi r28,lo8(-1)
 2095 0b04 DFEF      		ldi r29,hi8(-1)
 2096               	.L144:
 2097               		.stabn	68,0,132,.LM142-nmeap_longitude
 2098               	.LM142:
 2099 0b06 CF01      		movw r24,r30
 2100 0b08 0E94 0000 		call atof
 2101 0b0c 5B01      		movw r10,r22
 2102 0b0e 6C01      		movw r12,r24
 2103               		.stabn	68,0,138,.LM143-nmeap_longitude
 2104               	.LM143:
 2105 0b10 20E0      		ldi r18,lo8(0x42c80000)
 2106 0b12 30E0      		ldi r19,hi8(0x42c80000)
 2107 0b14 48EC      		ldi r20,hlo8(0x42c80000)
 2108 0b16 52E4      		ldi r21,hhi8(0x42c80000)
 2109 0b18 0E94 0000 		call __divsf3
 2110 0b1c 0E94 0000 		call __fixsfsi
 2111 0b20 8827      		clr r24
 2112 0b22 77FD      		sbrc r23,7
 2113 0b24 8095      		com r24
 2114 0b26 982F      		mov r25,r24
 2115 0b28 0E94 0000 		call __floatsisf
 2116 0b2c 7B01      		movw r14,r22
 2117 0b2e 8C01      		movw r16,r24
 2118               		.stabn	68,0,141,.LM144-nmeap_longitude
 2119               	.LM144:
 2120 0b30 20E0      		ldi r18,lo8(0xc2c80000)
 2121 0b32 30E0      		ldi r19,hi8(0xc2c80000)
 2122 0b34 48EC      		ldi r20,hlo8(0xc2c80000)
 2123 0b36 52EC      		ldi r21,hhi8(0xc2c80000)
 2124 0b38 0E94 0000 		call __mulsf3
 2125 0b3c 9B01      		movw r18,r22
 2126 0b3e AC01      		movw r20,r24
 2127 0b40 C601      		movw r24,r12
 2128 0b42 B501      		movw r22,r10
 2129 0b44 0E94 0000 		call __addsf3
 2130 0b48 20E0      		ldi r18,lo8(0x42700000)
 2131 0b4a 30E0      		ldi r19,hi8(0x42700000)
 2132 0b4c 40E7      		ldi r20,hlo8(0x42700000)
 2133 0b4e 52E4      		ldi r21,hhi8(0x42700000)
 2134 0b50 0E94 0000 		call __divsf3
 2135 0b54 9B01      		movw r18,r22
 2136 0b56 AC01      		movw r20,r24
 2137 0b58 C801      		movw r24,r16
 2138 0b5a B701      		movw r22,r14
 2139 0b5c 0E94 0000 		call __addsf3
 2140 0b60 7B01      		movw r14,r22
GAS LISTING /var/tmp//ccvnAEfo.s 			page 54


 2141 0b62 8C01      		movw r16,r24
 2142 0b64 BE01      		movw r22,r28
 2143 0b66 8827      		clr r24
 2144 0b68 77FD      		sbrc r23,7
 2145 0b6a 8095      		com r24
 2146 0b6c 982F      		mov r25,r24
 2147 0b6e 0E94 0000 		call __floatsisf
 2148 0b72 9B01      		movw r18,r22
 2149 0b74 AC01      		movw r20,r24
 2150 0b76 C801      		movw r24,r16
 2151 0b78 B701      		movw r22,r14
 2152 0b7a 0E94 0000 		call __mulsf3
 2153               	.L139:
 2154               	/* epilogue: frame size=0 */
 2155 0b7e DF91      		pop r29
 2156 0b80 CF91      		pop r28
 2157 0b82 1F91      		pop r17
 2158 0b84 0F91      		pop r16
 2159 0b86 FF90      		pop r15
 2160 0b88 EF90      		pop r14
 2161 0b8a DF90      		pop r13
 2162 0b8c CF90      		pop r12
 2163 0b8e BF90      		pop r11
 2164 0b90 AF90      		pop r10
 2165 0b92 0895      		ret
 2166               	/* epilogue end (size=11) */
 2167               	/* function nmeap_longitude size 107 (86) */
 2168               		.size	nmeap_longitude, .-nmeap_longitude
 2169               		.stabs	"lon:r(0,13)",64,0,106,22
 2170               		.stabs	"ew:r(0,1)",64,0,109,28
 2171               		.stabn	192,0,0,nmeap_longitude-nmeap_longitude
 2172               		.stabn	224,0,0,.Lscope12-nmeap_longitude
 2173               	.Lscope12:
 2174               		.stabs	"",36,0,0,.Lscope12-nmeap_longitude
 2175               		.stabd	78,0,0
 2176               		.data
 2177               	.LC0:
 2178 0023 2573 00   		.string	"%s"
 2179               	.LC1:
 2180 0026 2573 3D3D 		.string	"%s==%s %02x==%02x\n"
 2180      2573 2025 
 2180      3032 783D 
 2180      3D25 3032 
 2180      780A 00
 2181               	.LC2:
 2182 0039 2564 3A25 		.string	"%d:%s\n"
 2182      730A 00
 2183               		.text
 2184               		.stabs	"nmeap_gprmc:F(0,1)",36,0,582,nmeap_gprmc
 2185               		.stabs	"context:P(0,18)",64,0,581,28
 2186               		.stabs	"sentence:P(0,21)=*(13,5)",64,0,581,10
 2187               	.global	nmeap_gprmc
 2188               		.type	nmeap_gprmc, @function
 2189               	nmeap_gprmc:
 2190               		.stabd	46,0,0
 529:nmeap01.c     ****     return status;
 530:nmeap01.c     **** }
GAS LISTING /var/tmp//ccvnAEfo.s 			page 55


 531:nmeap01.c     **** 
 532:nmeap01.c     **** /** 
 533:nmeap01.c     ****  * standard GPGGA sentence parser 
 534:nmeap01.c     ****  */
 535:nmeap01.c     **** int nmeap_gpgga(nmeap_context_t *context,nmeap_sentence_t *sentence)
 536:nmeap01.c     **** {
 537:nmeap01.c     **** #ifndef NDEBUG	
 538:nmeap01.c     ****     int i;
 539:nmeap01.c     **** #endif
 540:nmeap01.c     ****     
 541:nmeap01.c     ****     /* get pointer to sentence data */
 542:nmeap01.c     ****     nmeap_gga_t *gga = (nmeap_gga_t *)sentence->data;
 543:nmeap01.c     ****     
 544:nmeap01.c     ****     /* if there is a data element, extract data from the tokens */
 545:nmeap01.c     **** 	if (gga != 0) {
 546:nmeap01.c     **** 		gga->latitude  = nmeap_latitude(context->token[2],context->token[3]);
 547:nmeap01.c     **** 		gga->longitude = nmeap_longitude(context->token[4],context->token[5]);
 548:nmeap01.c     **** 		gga->altitude  = nmeap_altitude(context->token[9],context->token[10]);
 549:nmeap01.c     **** 		gga->time       = atoi(context->token[1]);
 550:nmeap01.c     **** 		gga->satellites = atoi(context->token[7]);
 551:nmeap01.c     **** 		gga->quality    = atoi(context->token[6]);
 552:nmeap01.c     **** 		gga->hdop       = atof(context->token[8]);
 553:nmeap01.c     **** 		gga->geoid      = nmeap_altitude(context->token[11],context->token[12]);
 554:nmeap01.c     **** 	}
 555:nmeap01.c     **** 
 556:nmeap01.c     **** #ifndef NDEBUG    
 557:nmeap01.c     ****     /* print raw input string */
 558:nmeap01.c     ****     printf("%s",context->debug_input);
 559:nmeap01.c     ****     
 560:nmeap01.c     ****     /* print some validation data */
 561:nmeap01.c     ****     printf("%s==%s %02x==%02x\n",context->input_name,sentence->name,context->icks,context->ccks);
 562:nmeap01.c     ****     
 563:nmeap01.c     ****     /* print the tokens */
 564:nmeap01.c     ****     for(i=0;i<context->tokens;i++) {
 565:nmeap01.c     ****         printf("%d:%s\n",i,context->token[i]);
 566:nmeap01.c     ****     }
 567:nmeap01.c     **** #endif   
 568:nmeap01.c     **** 
 569:nmeap01.c     ****     /* if the sentence has a callout, call it */
 570:nmeap01.c     ****     if (sentence->callout != 0) {
 571:nmeap01.c     ****         (*sentence->callout)(context,gga,context->user_data);
 572:nmeap01.c     ****     }
 573:nmeap01.c     ****     
 574:nmeap01.c     ****     return NMEAP_GPGGA;
 575:nmeap01.c     **** }
 576:nmeap01.c     **** 
 577:nmeap01.c     **** /** 
 578:nmeap01.c     ****  * standard GPRMCntence parser 
 579:nmeap01.c     ****  */
 580:nmeap01.c     **** int nmeap_gprmc(nmeap_context_t *context,nmeap_sentence_t *sentence)
 581:nmeap01.c     **** {
 582:nmeap01.c     **** #ifndef NDEBUG	
 2191               		.stabn	68,0,582,.LM145-nmeap_gprmc
 2192               	.LM145:
 2193               	/* prologue: frame size=0 */
 2194 0b94 AF92      		push r10
 2195 0b96 BF92      		push r11
GAS LISTING /var/tmp//ccvnAEfo.s 			page 56


 2196 0b98 CF92      		push r12
 2197 0b9a DF92      		push r13
 2198 0b9c EF92      		push r14
 2199 0b9e FF92      		push r15
 2200 0ba0 0F93      		push r16
 2201 0ba2 1F93      		push r17
 2202 0ba4 CF93      		push r28
 2203 0ba6 DF93      		push r29
 2204               	/* prologue end (size=10) */
 2205 0ba8 EC01      		movw r28,r24
 2206 0baa 5B01      		movw r10,r22
 583:nmeap01.c     ****     int i;
 584:nmeap01.c     **** #endif
 585:nmeap01.c     **** 
 586:nmeap01.c     ****     /* get pointer to sentence data */
 587:nmeap01.c     ****     nmeap_rmc_t *rmc = (nmeap_rmc_t *)sentence->data;
 588:nmeap01.c     ****     
 2207               		.stabn	68,0,588,.LM146-nmeap_gprmc
 2208               	.LM146:
 2209 0bac FB01      		movw r30,r22
 2210 0bae 0485      		ldd r16,Z+12
 2211 0bb0 1585      		ldd r17,Z+13
 589:nmeap01.c     **** 	/* if there is a data element, use it */
 590:nmeap01.c     **** 	if (rmc != 0) {
 591:nmeap01.c     **** 		/* extract data from the tokens */
 2212               		.stabn	68,0,591,.LM147-nmeap_gprmc
 2213               	.LM147:
 2214 0bb2 0115      		cp r16,__zero_reg__
 2215 0bb4 1105      		cpc r17,__zero_reg__
 2216 0bb6 09F4      		brne .+2
 2217 0bb8 65C0      		rjmp .L150
 592:nmeap01.c     **** 		rmc->time       = atoi(context->token[1]);
 593:nmeap01.c     **** 		rmc->warn       = *context->token[2];
 2218               		.stabn	68,0,593,.LM148-nmeap_gprmc
 2219               	.LM148:
 2220 0bba C058      		subi r28,lo8(-(384))
 2221 0bbc DE4F      		sbci r29,hi8(-(384))
 2222 0bbe 8991      		ld r24,Y+
 2223 0bc0 9991      		ld r25,Y+
 2224 0bc2 0E94 0000 		call atoi
 2225 0bc6 AA27      		clr r26
 2226 0bc8 97FD      		sbrc r25,7
 2227 0bca A095      		com r26
 2228 0bcc BA2F      		mov r27,r26
 2229 0bce F801      		movw r30,r16
 2230 0bd0 8083      		st Z,r24
 2231 0bd2 9183      		std Z+1,r25
 2232 0bd4 A283      		std Z+2,r26
 2233 0bd6 B383      		std Z+3,r27
 594:nmeap01.c     **** 		rmc->latitude  = nmeap_latitude(context->token[3],context->token[4]);
 2234               		.stabn	68,0,594,.LM149-nmeap_gprmc
 2235               	.LM149:
 2236 0bd8 E881      		ld r30,Y
 2237 0bda F981      		ldd r31,Y+1
 2238 0bdc 8081      		ld r24,Z
 2239 0bde F801      		movw r30,r16
 2240 0be0 8483      		std Z+4,r24
GAS LISTING /var/tmp//ccvnAEfo.s 			page 57


 595:nmeap01.c     **** 		rmc->longitude = nmeap_longitude(context->token[5],context->token[6]);
 2241               		.stabn	68,0,595,.LM150-nmeap_gprmc
 2242               	.LM150:
 2243 0be2 2496      		adiw r28,4
 2244 0be4 6881      		ld r22,Y
 2245 0be6 7981      		ldd r23,Y+1
 2246 0be8 9A91      		ld r25,-Y
 2247 0bea 8A91      		ld r24,-Y
 2248 0bec 0E94 0000 		call nmeap_latitude
 2249 0bf0 F801      		movw r30,r16
 2250 0bf2 6583      		std Z+5,r22
 2251 0bf4 7683      		std Z+6,r23
 2252 0bf6 8783      		std Z+7,r24
 2253 0bf8 9087      		std Z+8,r25
 596:nmeap01.c     **** 		rmc->speed      = atof(context->token[7]);
 2254               		.stabn	68,0,596,.LM151-nmeap_gprmc
 2255               	.LM151:
 2256 0bfa 2696      		adiw r28,6
 2257 0bfc 6881      		ld r22,Y
 2258 0bfe 7981      		ldd r23,Y+1
 2259 0c00 CA58      		subi r28,lo8(-(-394))
 2260 0c02 D140      		sbci r29,hi8(-(-394))
 2261 0c04 FE01      		movw r30,r28
 2262 0c06 E857      		subi r30,lo8(-(392))
 2263 0c08 FE4F      		sbci r31,hi8(-(392))
 2264 0c0a 8081      		ld r24,Z
 2265 0c0c 9181      		ldd r25,Z+1
 2266 0c0e 0E94 0000 		call nmeap_longitude
 2267 0c12 F801      		movw r30,r16
 2268 0c14 6187      		std Z+9,r22
 2269 0c16 7287      		std Z+10,r23
 2270 0c18 8387      		std Z+11,r24
 2271 0c1a 9487      		std Z+12,r25
 597:nmeap01.c     **** 		rmc->course     = atof(context->token[8]);
 2272               		.stabn	68,0,597,.LM152-nmeap_gprmc
 2273               	.LM152:
 2274 0c1c FE01      		movw r30,r28
 2275 0c1e E457      		subi r30,lo8(-(396))
 2276 0c20 FE4F      		sbci r31,hi8(-(396))
 2277 0c22 8081      		ld r24,Z
 2278 0c24 9181      		ldd r25,Z+1
 2279 0c26 0E94 0000 		call atof
 2280 0c2a F801      		movw r30,r16
 2281 0c2c 6587      		std Z+13,r22
 2282 0c2e 7687      		std Z+14,r23
 2283 0c30 8787      		std Z+15,r24
 2284 0c32 908B      		std Z+16,r25
 598:nmeap01.c     **** 		rmc->date       = atoi(context->token[9]);
 2285               		.stabn	68,0,598,.LM153-nmeap_gprmc
 2286               	.LM153:
 2287 0c34 FE01      		movw r30,r28
 2288 0c36 E257      		subi r30,lo8(-(398))
 2289 0c38 FE4F      		sbci r31,hi8(-(398))
 2290 0c3a 8081      		ld r24,Z
 2291 0c3c 9181      		ldd r25,Z+1
 2292 0c3e 0E94 0000 		call atof
 2293 0c42 F801      		movw r30,r16
GAS LISTING /var/tmp//ccvnAEfo.s 			page 58


 2294 0c44 618B      		std Z+17,r22
 2295 0c46 728B      		std Z+18,r23
 2296 0c48 838B      		std Z+19,r24
 2297 0c4a 948B      		std Z+20,r25
 599:nmeap01.c     **** 		rmc->magvar     = atof(context->token[10]);
 2298               		.stabn	68,0,599,.LM154-nmeap_gprmc
 2299               	.LM154:
 2300 0c4c FE01      		movw r30,r28
 2301 0c4e E057      		subi r30,lo8(-(400))
 2302 0c50 FE4F      		sbci r31,hi8(-(400))
 2303 0c52 8081      		ld r24,Z
 2304 0c54 9181      		ldd r25,Z+1
 2305 0c56 0E94 0000 		call atoi
 2306 0c5a AA27      		clr r26
 2307 0c5c 97FD      		sbrc r25,7
 2308 0c5e A095      		com r26
 2309 0c60 BA2F      		mov r27,r26
 2310 0c62 F801      		movw r30,r16
 2311 0c64 858B      		std Z+21,r24
 2312 0c66 968B      		std Z+22,r25
 2313 0c68 A78B      		std Z+23,r26
 2314 0c6a B08F      		std Z+24,r27
 600:nmeap01.c     **** 	}
 2315               		.stabn	68,0,600,.LM155-nmeap_gprmc
 2316               	.LM155:
 2317 0c6c FE01      		movw r30,r28
 2318 0c6e EE56      		subi r30,lo8(-(402))
 2319 0c70 FE4F      		sbci r31,hi8(-(402))
 2320 0c72 8081      		ld r24,Z
 2321 0c74 9181      		ldd r25,Z+1
 2322 0c76 0E94 0000 		call atof
 2323 0c7a F801      		movw r30,r16
 2324 0c7c 618F      		std Z+25,r22
 2325 0c7e 728F      		std Z+26,r23
 2326 0c80 838F      		std Z+27,r24
 2327 0c82 948F      		std Z+28,r25
 2328               	.L150:
 601:nmeap01.c     **** 
 602:nmeap01.c     **** #ifndef NDEBUG    
 603:nmeap01.c     ****     /* print raw input string */
 604:nmeap01.c     ****     printf("%s",context->debug_input);
 605:nmeap01.c     ****     
 2329               		.stabn	68,0,605,.LM156-nmeap_gprmc
 2330               	.LM156:
 2331 0c84 C453      		subi r28,lo8(-(460))
 2332 0c86 DE4F      		sbci r29,hi8(-(460))
 2333 0c88 DF93      		push r29
 2334 0c8a CF93      		push r28
 2335 0c8c 80E0      		ldi r24,lo8(.LC0)
 2336 0c8e 90E0      		ldi r25,hi8(.LC0)
 2337 0c90 9F93      		push r25
 2338 0c92 8F93      		push r24
 2339 0c94 0E94 0000 		call printf
 606:nmeap01.c     ****     /* print some validation data */
 607:nmeap01.c     ****     printf("%s==%s %02x==%02x\n",context->input_name,sentence->name,context->icks,context->ccks);
 608:nmeap01.c     ****     
 2340               		.stabn	68,0,608,.LM157-nmeap_gprmc
GAS LISTING /var/tmp//ccvnAEfo.s 			page 59


 2341               	.LM157:
 2342 0c98 CF54      		subi r28,lo8(-(-79))
 2343 0c9a D040      		sbci r29,hi8(-(-79))
 2344 0c9c 8881      		ld r24,Y
 2345 0c9e 9927      		clr r25
 2346 0ca0 87FD      		sbrc r24,7
 2347 0ca2 9095      		com r25
 2348 0ca4 9F93      		push r25
 2349 0ca6 8F93      		push r24
 2350 0ca8 8A91      		ld r24,-Y
 2351 0caa 9927      		clr r25
 2352 0cac 87FD      		sbrc r24,7
 2353 0cae 9095      		com r25
 2354 0cb0 9F93      		push r25
 2355 0cb2 8F93      		push r24
 2356 0cb4 BF92      		push r11
 2357 0cb6 AF92      		push r10
 2358 0cb8 2697      		sbiw r28,6
 2359 0cba DF93      		push r29
 2360 0cbc CF93      		push r28
 2361 0cbe C657      		subi r28,lo8(-(-374))
 2362 0cc0 D140      		sbci r29,hi8(-(-374))
 2363 0cc2 80E0      		ldi r24,lo8(.LC1)
 2364 0cc4 90E0      		ldi r25,hi8(.LC1)
 2365 0cc6 9F93      		push r25
 2366 0cc8 8F93      		push r24
 2367 0cca 0E94 0000 		call printf
 2368 0cce FEE7      		ldi r31,lo8(382)
 2369 0cd0 CF2E      		mov r12,r31
 2370 0cd2 F1E0      		ldi r31,hi8(382)
 2371 0cd4 DF2E      		mov r13,r31
 2372 0cd6 CC0E      		add r12,r28
 2373 0cd8 DD1E      		adc r13,r29
 2374 0cda EE24      		clr r14
 2375 0cdc FF24      		clr r15
 609:nmeap01.c     ****     /* print the tokens */
 610:nmeap01.c     ****     for(i=0;i<context->tokens;i++) {
 611:nmeap01.c     ****         printf("%d:%s\n",i,context->token[i]);
 2376               		.stabn	68,0,611,.LM158-nmeap_gprmc
 2377               	.LM158:
 2378 0cde 8DB7      		in r24,__SP_L__
 2379 0ce0 9EB7      		in r25,__SP_H__
 2380 0ce2 0E96      		adiw r24,14
 2381 0ce4 14C0      		rjmp .L158
 2382               	.L153:
 612:nmeap01.c     ****     }
 2383               		.stabn	68,0,612,.LM159-nmeap_gprmc
 2384               	.LM159:
 2385 0ce6 F601      		movw r30,r12
 2386 0ce8 8191      		ld r24,Z+
 2387 0cea 9191      		ld r25,Z+
 2388 0cec 6F01      		movw r12,r30
 2389 0cee 9F93      		push r25
 2390 0cf0 8F93      		push r24
 2391 0cf2 FF92      		push r15
 2392 0cf4 EF92      		push r14
 2393 0cf6 80E0      		ldi r24,lo8(.LC2)
GAS LISTING /var/tmp//ccvnAEfo.s 			page 60


 2394 0cf8 90E0      		ldi r25,hi8(.LC2)
 2395 0cfa 9F93      		push r25
 2396 0cfc 8F93      		push r24
 2397 0cfe 0E94 0000 		call printf
 2398               		.stabn	68,0,611,.LM160-nmeap_gprmc
 2399               	.LM160:
 2400 0d02 0894      		sec
 2401 0d04 E11C      		adc r14,__zero_reg__
 2402 0d06 F11C      		adc r15,__zero_reg__
 2403 0d08 8DB7      		in r24,__SP_L__
 2404 0d0a 9EB7      		in r25,__SP_H__
 2405 0d0c 0696      		adiw r24,6
 2406               	.L158:
 2407 0d0e 0FB6      		in __tmp_reg__,__SREG__
 2408 0d10 F894      		cli
 2409 0d12 9EBF      		out __SP_H__,r25
 2410 0d14 0FBE      		out __SREG__,__tmp_reg__
 2411 0d16 8DBF      		out __SP_L__,r24
 2412 0d18 C255      		subi r28,lo8(-(430))
 2413 0d1a DE4F      		sbci r29,hi8(-(430))
 2414 0d1c 8881      		ld r24,Y
 2415 0d1e 9981      		ldd r25,Y+1
 2416 0d20 CE5A      		subi r28,lo8(-(-430))
 2417 0d22 D140      		sbci r29,hi8(-(-430))
 2418 0d24 E816      		cp r14,r24
 2419 0d26 F906      		cpc r15,r25
 2420 0d28 F4F2      		brlt .L153
 613:nmeap01.c     **** #endif   
 614:nmeap01.c     **** 
 615:nmeap01.c     ****     /* if the sentence has a callout, call it */
 616:nmeap01.c     ****     if (sentence->callout != 0) {
 617:nmeap01.c     ****         (*sentence->callout)(context,rmc,context->user_data);
 2421               		.stabn	68,0,617,.LM161-nmeap_gprmc
 2422               	.LM161:
 2423 0d2a F501      		movw r30,r10
 2424 0d2c 2285      		ldd r18,Z+10
 2425 0d2e 3385      		ldd r19,Z+11
 2426 0d30 2115      		cp r18,__zero_reg__
 2427 0d32 3105      		cpc r19,__zero_reg__
 2428 0d34 51F0      		breq .L155
 618:nmeap01.c     ****     }
 2429               		.stabn	68,0,618,.LM162-nmeap_gprmc
 2430               	.LM162:
 2431 0d36 C453      		subi r28,lo8(-(716))
 2432 0d38 DD4F      		sbci r29,hi8(-(716))
 2433 0d3a 4881      		ld r20,Y
 2434 0d3c 5981      		ldd r21,Y+1
 2435 0d3e CC5C      		subi r28,lo8(-(-716))
 2436 0d40 D240      		sbci r29,hi8(-(-716))
 2437 0d42 B801      		movw r22,r16
 2438 0d44 CE01      		movw r24,r28
 2439 0d46 F901      		movw r30,r18
 2440 0d48 0995      		icall
 2441               	.L155:
 619:nmeap01.c     ****     
 620:nmeap01.c     ****     return NMEAP_GPRMC;
 621:nmeap01.c     **** }
GAS LISTING /var/tmp//ccvnAEfo.s 			page 61


 622:nmeap01.c     **** 
 2442               		.stabn	68,0,622,.LM163-nmeap_gprmc
 2443               	.LM163:
 2444 0d4a 82E0      		ldi r24,lo8(2)
 2445 0d4c 90E0      		ldi r25,hi8(2)
 2446               	/* epilogue: frame size=0 */
 2447 0d4e DF91      		pop r29
 2448 0d50 CF91      		pop r28
 2449 0d52 1F91      		pop r17
 2450 0d54 0F91      		pop r16
 2451 0d56 FF90      		pop r15
 2452 0d58 EF90      		pop r14
 2453 0d5a DF90      		pop r13
 2454 0d5c CF90      		pop r12
 2455 0d5e BF90      		pop r11
 2456 0d60 AF90      		pop r10
 2457 0d62 0895      		ret
 2458               	/* epilogue end (size=11) */
 2459               	/* function nmeap_gprmc size 232 (211) */
 2460               		.size	nmeap_gprmc, .-nmeap_gprmc
 2461               		.stabs	"i:r(0,1)",64,0,584,14
 2462               		.stabs	"rmc:r(0,22)=*(12,10)",64,0,588,16
 2463               		.stabn	192,0,0,nmeap_gprmc-nmeap_gprmc
 2464               		.stabn	224,0,0,.Lscope13-nmeap_gprmc
 2465               	.Lscope13:
 2466               		.stabs	"",36,0,0,.Lscope13-nmeap_gprmc
 2467               		.stabd	78,0,0
 2468               		.stabs	"nmeap_gpgga:F(0,1)",36,0,537,nmeap_gpgga
 2469               		.stabs	"context:P(0,18)",64,0,536,28
 2470               		.stabs	"sentence:P(0,21)",64,0,536,10
 2471               	.global	nmeap_gpgga
 2472               		.type	nmeap_gpgga, @function
 2473               	nmeap_gpgga:
 2474               		.stabd	46,0,0
 2475               		.stabn	68,0,537,.LM164-nmeap_gpgga
 2476               	.LM164:
 2477               	/* prologue: frame size=0 */
 2478 0d64 AF92      		push r10
 2479 0d66 BF92      		push r11
 2480 0d68 CF92      		push r12
 2481 0d6a DF92      		push r13
 2482 0d6c EF92      		push r14
 2483 0d6e FF92      		push r15
 2484 0d70 0F93      		push r16
 2485 0d72 1F93      		push r17
 2486 0d74 CF93      		push r28
 2487 0d76 DF93      		push r29
 2488               	/* prologue end (size=10) */
 2489 0d78 EC01      		movw r28,r24
 2490 0d7a 5B01      		movw r10,r22
 2491               		.stabn	68,0,543,.LM165-nmeap_gpgga
 2492               	.LM165:
 2493 0d7c FB01      		movw r30,r22
 2494 0d7e 0485      		ldd r16,Z+12
 2495 0d80 1585      		ldd r17,Z+13
 2496               		.stabn	68,0,546,.LM166-nmeap_gpgga
 2497               	.LM166:
GAS LISTING /var/tmp//ccvnAEfo.s 			page 62


 2498 0d82 0115      		cp r16,__zero_reg__
 2499 0d84 1105      		cpc r17,__zero_reg__
 2500 0d86 09F4      		brne .+2
 2501 0d88 5DC0      		rjmp .L160
 2502               		.stabn	68,0,547,.LM167-nmeap_gpgga
 2503               	.LM167:
 2504 0d8a CC57      		subi r28,lo8(-(388))
 2505 0d8c DE4F      		sbci r29,hi8(-(388))
 2506 0d8e 6881      		ld r22,Y
 2507 0d90 7981      		ldd r23,Y+1
 2508 0d92 9A91      		ld r25,-Y
 2509 0d94 8A91      		ld r24,-Y
 2510 0d96 0E94 0000 		call nmeap_latitude
 2511 0d9a F801      		movw r30,r16
 2512 0d9c 6083      		st Z,r22
 2513 0d9e 7183      		std Z+1,r23
 2514 0da0 8283      		std Z+2,r24
 2515 0da2 9383      		std Z+3,r25
 2516               		.stabn	68,0,548,.LM168-nmeap_gpgga
 2517               	.LM168:
 2518 0da4 2696      		adiw r28,6
 2519 0da6 6881      		ld r22,Y
 2520 0da8 7981      		ldd r23,Y+1
 2521 0daa 9A91      		ld r25,-Y
 2522 0dac 8A91      		ld r24,-Y
 2523 0dae 0E94 0000 		call nmeap_longitude
 2524 0db2 F801      		movw r30,r16
 2525 0db4 6483      		std Z+4,r22
 2526 0db6 7583      		std Z+5,r23
 2527 0db8 8683      		std Z+6,r24
 2528 0dba 9783      		std Z+7,r25
 2529               		.stabn	68,0,549,.LM169-nmeap_gpgga
 2530               	.LM169:
 2531 0dbc 2C96      		adiw r28,12
 2532 0dbe 6881      		ld r22,Y
 2533 0dc0 7981      		ldd r23,Y+1
 2534 0dc2 9A91      		ld r25,-Y
 2535 0dc4 8A91      		ld r24,-Y
 2536 0dc6 0E94 0000 		call nmeap_altitude
 2537 0dca F801      		movw r30,r16
 2538 0dcc 6087      		std Z+8,r22
 2539 0dce 7187      		std Z+9,r23
 2540 0dd0 8287      		std Z+10,r24
 2541 0dd2 9387      		std Z+11,r25
 2542               		.stabn	68,0,550,.LM170-nmeap_gpgga
 2543               	.LM170:
 2544 0dd4 6097      		sbiw r28,16
 2545 0dd6 8881      		ld r24,Y
 2546 0dd8 9981      		ldd r25,Y+1
 2547 0dda 0E94 0000 		call atoi
 2548 0dde AA27      		clr r26
 2549 0de0 97FD      		sbrc r25,7
 2550 0de2 A095      		com r26
 2551 0de4 BA2F      		mov r27,r26
 2552 0de6 F801      		movw r30,r16
 2553 0de8 8487      		std Z+12,r24
 2554 0dea 9587      		std Z+13,r25
GAS LISTING /var/tmp//ccvnAEfo.s 			page 63


 2555 0dec A687      		std Z+14,r26
 2556 0dee B787      		std Z+15,r27
 2557               		.stabn	68,0,551,.LM171-nmeap_gpgga
 2558               	.LM171:
 2559 0df0 2C96      		adiw r28,12
 2560 0df2 8881      		ld r24,Y
 2561 0df4 9981      		ldd r25,Y+1
 2562 0df6 0E94 0000 		call atoi
 2563 0dfa F801      		movw r30,r16
 2564 0dfc 918B      		std Z+17,r25
 2565 0dfe 808B      		std Z+16,r24
 2566               		.stabn	68,0,552,.LM172-nmeap_gpgga
 2567               	.LM172:
 2568 0e00 9A91      		ld r25,-Y
 2569 0e02 8A91      		ld r24,-Y
 2570 0e04 0E94 0000 		call atoi
 2571 0e08 F801      		movw r30,r16
 2572 0e0a 938B      		std Z+19,r25
 2573 0e0c 828B      		std Z+18,r24
 2574               		.stabn	68,0,553,.LM173-nmeap_gpgga
 2575               	.LM173:
 2576 0e0e 2496      		adiw r28,4
 2577 0e10 8881      		ld r24,Y
 2578 0e12 9981      		ldd r25,Y+1
 2579 0e14 0E94 0000 		call atof
 2580 0e18 F801      		movw r30,r16
 2581 0e1a 648B      		std Z+20,r22
 2582 0e1c 758B      		std Z+21,r23
 2583 0e1e 868B      		std Z+22,r24
 2584 0e20 978B      		std Z+23,r25
 2585               		.stabn	68,0,554,.LM174-nmeap_gpgga
 2586               	.LM174:
 2587 0e22 2896      		adiw r28,8
 2588 0e24 6881      		ld r22,Y
 2589 0e26 7981      		ldd r23,Y+1
 2590 0e28 C659      		subi r28,lo8(-(-406))
 2591 0e2a D140      		sbci r29,hi8(-(-406))
 2592 0e2c FE01      		movw r30,r28
 2593 0e2e EC56      		subi r30,lo8(-(404))
 2594 0e30 FE4F      		sbci r31,hi8(-(404))
 2595 0e32 8081      		ld r24,Z
 2596 0e34 9181      		ldd r25,Z+1
 2597 0e36 0E94 0000 		call nmeap_altitude
 2598 0e3a F801      		movw r30,r16
 2599 0e3c 608F      		std Z+24,r22
 2600 0e3e 718F      		std Z+25,r23
 2601 0e40 828F      		std Z+26,r24
 2602 0e42 938F      		std Z+27,r25
 2603               	.L160:
 2604               		.stabn	68,0,559,.LM175-nmeap_gpgga
 2605               	.LM175:
 2606 0e44 C453      		subi r28,lo8(-(460))
 2607 0e46 DE4F      		sbci r29,hi8(-(460))
 2608 0e48 DF93      		push r29
 2609 0e4a CF93      		push r28
 2610 0e4c 80E0      		ldi r24,lo8(.LC0)
 2611 0e4e 90E0      		ldi r25,hi8(.LC0)
GAS LISTING /var/tmp//ccvnAEfo.s 			page 64


 2612 0e50 9F93      		push r25
 2613 0e52 8F93      		push r24
 2614 0e54 0E94 0000 		call printf
 2615               		.stabn	68,0,562,.LM176-nmeap_gpgga
 2616               	.LM176:
 2617 0e58 CF54      		subi r28,lo8(-(-79))
 2618 0e5a D040      		sbci r29,hi8(-(-79))
 2619 0e5c 8881      		ld r24,Y
 2620 0e5e 9927      		clr r25
 2621 0e60 87FD      		sbrc r24,7
 2622 0e62 9095      		com r25
 2623 0e64 9F93      		push r25
 2624 0e66 8F93      		push r24
 2625 0e68 8A91      		ld r24,-Y
 2626 0e6a 9927      		clr r25
 2627 0e6c 87FD      		sbrc r24,7
 2628 0e6e 9095      		com r25
 2629 0e70 9F93      		push r25
 2630 0e72 8F93      		push r24
 2631 0e74 BF92      		push r11
 2632 0e76 AF92      		push r10
 2633 0e78 2697      		sbiw r28,6
 2634 0e7a DF93      		push r29
 2635 0e7c CF93      		push r28
 2636 0e7e C657      		subi r28,lo8(-(-374))
 2637 0e80 D140      		sbci r29,hi8(-(-374))
 2638 0e82 80E0      		ldi r24,lo8(.LC1)
 2639 0e84 90E0      		ldi r25,hi8(.LC1)
 2640 0e86 9F93      		push r25
 2641 0e88 8F93      		push r24
 2642 0e8a 0E94 0000 		call printf
 2643 0e8e AEE7      		ldi r26,lo8(382)
 2644 0e90 CA2E      		mov r12,r26
 2645 0e92 A1E0      		ldi r26,hi8(382)
 2646 0e94 DA2E      		mov r13,r26
 2647 0e96 CC0E      		add r12,r28
 2648 0e98 DD1E      		adc r13,r29
 2649 0e9a EE24      		clr r14
 2650 0e9c FF24      		clr r15
 2651               		.stabn	68,0,565,.LM177-nmeap_gpgga
 2652               	.LM177:
 2653 0e9e 8DB7      		in r24,__SP_L__
 2654 0ea0 9EB7      		in r25,__SP_H__
 2655 0ea2 0E96      		adiw r24,14
 2656 0ea4 14C0      		rjmp .L168
 2657               	.L163:
 2658               		.stabn	68,0,566,.LM178-nmeap_gpgga
 2659               	.LM178:
 2660 0ea6 F601      		movw r30,r12
 2661 0ea8 8191      		ld r24,Z+
 2662 0eaa 9191      		ld r25,Z+
 2663 0eac 6F01      		movw r12,r30
 2664 0eae 9F93      		push r25
 2665 0eb0 8F93      		push r24
 2666 0eb2 FF92      		push r15
 2667 0eb4 EF92      		push r14
 2668 0eb6 80E0      		ldi r24,lo8(.LC2)
GAS LISTING /var/tmp//ccvnAEfo.s 			page 65


 2669 0eb8 90E0      		ldi r25,hi8(.LC2)
 2670 0eba 9F93      		push r25
 2671 0ebc 8F93      		push r24
 2672 0ebe 0E94 0000 		call printf
 2673               		.stabn	68,0,565,.LM179-nmeap_gpgga
 2674               	.LM179:
 2675 0ec2 0894      		sec
 2676 0ec4 E11C      		adc r14,__zero_reg__
 2677 0ec6 F11C      		adc r15,__zero_reg__
 2678 0ec8 8DB7      		in r24,__SP_L__
 2679 0eca 9EB7      		in r25,__SP_H__
 2680 0ecc 0696      		adiw r24,6
 2681               	.L168:
 2682 0ece 0FB6      		in __tmp_reg__,__SREG__
 2683 0ed0 F894      		cli
 2684 0ed2 9EBF      		out __SP_H__,r25
 2685 0ed4 0FBE      		out __SREG__,__tmp_reg__
 2686 0ed6 8DBF      		out __SP_L__,r24
 2687 0ed8 C255      		subi r28,lo8(-(430))
 2688 0eda DE4F      		sbci r29,hi8(-(430))
 2689 0edc 8881      		ld r24,Y
 2690 0ede 9981      		ldd r25,Y+1
 2691 0ee0 CE5A      		subi r28,lo8(-(-430))
 2692 0ee2 D140      		sbci r29,hi8(-(-430))
 2693 0ee4 E816      		cp r14,r24
 2694 0ee6 F906      		cpc r15,r25
 2695 0ee8 F4F2      		brlt .L163
 2696               		.stabn	68,0,571,.LM180-nmeap_gpgga
 2697               	.LM180:
 2698 0eea F501      		movw r30,r10
 2699 0eec 2285      		ldd r18,Z+10
 2700 0eee 3385      		ldd r19,Z+11
 2701 0ef0 2115      		cp r18,__zero_reg__
 2702 0ef2 3105      		cpc r19,__zero_reg__
 2703 0ef4 51F0      		breq .L165
 2704               		.stabn	68,0,572,.LM181-nmeap_gpgga
 2705               	.LM181:
 2706 0ef6 C453      		subi r28,lo8(-(716))
 2707 0ef8 DD4F      		sbci r29,hi8(-(716))
 2708 0efa 4881      		ld r20,Y
 2709 0efc 5981      		ldd r21,Y+1
 2710 0efe CC5C      		subi r28,lo8(-(-716))
 2711 0f00 D240      		sbci r29,hi8(-(-716))
 2712 0f02 B801      		movw r22,r16
 2713 0f04 CE01      		movw r24,r28
 2714 0f06 F901      		movw r30,r18
 2715 0f08 0995      		icall
 2716               	.L165:
 2717               		.stabn	68,0,576,.LM182-nmeap_gpgga
 2718               	.LM182:
 2719 0f0a 81E0      		ldi r24,lo8(1)
 2720 0f0c 90E0      		ldi r25,hi8(1)
 2721               	/* epilogue: frame size=0 */
 2722 0f0e DF91      		pop r29
 2723 0f10 CF91      		pop r28
 2724 0f12 1F91      		pop r17
 2725 0f14 0F91      		pop r16
GAS LISTING /var/tmp//ccvnAEfo.s 			page 66


 2726 0f16 FF90      		pop r15
 2727 0f18 EF90      		pop r14
 2728 0f1a DF90      		pop r13
 2729 0f1c CF90      		pop r12
 2730 0f1e BF90      		pop r11
 2731 0f20 AF90      		pop r10
 2732 0f22 0895      		ret
 2733               	/* epilogue end (size=11) */
 2734               	/* function nmeap_gpgga size 224 (203) */
 2735               		.size	nmeap_gpgga, .-nmeap_gpgga
 2736               		.stabs	"i:r(0,1)",64,0,539,14
 2737               		.stabs	"gga:r(0,23)=*(12,8)",64,0,543,16
 2738               		.stabn	192,0,0,nmeap_gpgga-nmeap_gpgga
 2739               		.stabn	224,0,0,.Lscope14-nmeap_gpgga
 2740               	.Lscope14:
 2741               		.stabs	"",36,0,0,.Lscope14-nmeap_gpgga
 2742               		.stabd	78,0,0
 2743               		.stabs	"nmeap_init:F(0,1)",36,0,177,nmeap_init
 2744               		.stabs	"context:P(0,18)",64,0,176,30
 2745               		.stabs	"user_data:P(13,4)",64,0,176,22
 2746               	.global	nmeap_init
 2747               		.type	nmeap_init, @function
 2748               	nmeap_init:
 2749               		.stabd	46,0,0
 2750               		.stabn	68,0,177,.LM183-nmeap_init
 2751               	.LM183:
 2752               	/* prologue: frame size=0 */
 2753               	/* prologue end (size=0) */
 2754 0f24 FC01      		movw r30,r24
 2755               		.stabn	68,0,178,.LM184-nmeap_init
 2756               	.LM184:
 2757 0f26 892B      		or r24,r25
 2758 0f28 09F4      		brne .L170
 2759               	.L173:
 2760 0f2a FFCF      		rjmp .L173
 2761               	.L170:
 2762               		.stabn	68,0,180,.LM185-nmeap_init
 2763               	.LM185:
 2764 0f2c 8EEC      		ldi r24,lo8(718)
 2765 0f2e 92E0      		ldi r25,hi8(718)
 2766 0f30 DF01      		movw r26,r30
 2767 0f32 1D92      		st X+,__zero_reg__
 2768 0f34 0197      		sbiw r24,1
 2769 0f36 E9F7      		brne .-6
 2770               		.stabn	68,0,182,.LM186-nmeap_init
 2771               	.LM186:
 2772 0f38 E453      		subi r30,lo8(-(716))
 2773 0f3a FD4F      		sbci r31,hi8(-(716))
 2774 0f3c 7183      		std Z+1,r23
 2775 0f3e 6083      		st Z,r22
 2776               		.stabn	68,0,185,.LM187-nmeap_init
 2777               	.LM187:
 2778 0f40 80E0      		ldi r24,lo8(0)
 2779 0f42 90E0      		ldi r25,hi8(0)
 2780               	/* epilogue: frame size=0 */
 2781 0f44 0895      		ret
 2782               	/* epilogue end (size=1) */
GAS LISTING /var/tmp//ccvnAEfo.s 			page 67


 2783               	/* function nmeap_init size 17 (16) */
 2784               		.size	nmeap_init, .-nmeap_init
 2785               	.Lscope15:
 2786               		.stabs	"",36,0,0,.Lscope15-nmeap_init
 2787               		.stabd	78,0,0
 2788               		.stabs	"nmeap_addParser:F(0,1)",36,0,197,nmeap_addParser
 2789               		.stabs	"context:P(0,18)",64,0,191,30
 2790               		.stabs	"sentence_name:P(0,16)",64,0,192,22
 2791               		.stabs	"sentence_parser:P(12,4)",64,0,193,28
 2792               		.stabs	"sentence_callout:P(12,1)",64,0,194,14
 2793               		.stabs	"sentence_data:P(13,4)",64,0,196,12
 2794               	.global	nmeap_addParser
 2795               		.type	nmeap_addParser, @function
 2796               	nmeap_addParser:
 2797               		.stabd	46,0,0
 2798               		.stabn	68,0,197,.LM188-nmeap_addParser
 2799               	.LM188:
 2800               	/* prologue: frame size=0 */
 2801 0f46 CF92      		push r12
 2802 0f48 DF92      		push r13
 2803 0f4a EF92      		push r14
 2804 0f4c FF92      		push r15
 2805 0f4e 0F93      		push r16
 2806 0f50 1F93      		push r17
 2807 0f52 CF93      		push r28
 2808 0f54 DF93      		push r29
 2809               	/* prologue end (size=8) */
 2810 0f56 FC01      		movw r30,r24
 2811 0f58 EA01      		movw r28,r20
 2812 0f5a 7901      		movw r14,r18
 2813 0f5c 6801      		movw r12,r16
 2814               		.stabn	68,0,201,.LM189-nmeap_addParser
 2815               	.LM189:
 2816 0f5e 0097      		sbiw r24,0
 2817 0f60 09F4      		brne .L175
 2818               	.L181:
 2819 0f62 FFCF      		rjmp .L181
 2820               	.L175:
 2821               		.stabn	68,0,204,.LM190-nmeap_addParser
 2822               	.LM190:
 2823 0f64 DC01      		movw r26,r24
 2824 0f66 A059      		subi r26,lo8(-(112))
 2825 0f68 BF4F      		sbci r27,hi8(-(112))
 2826 0f6a 2D91      		ld r18,X+
 2827 0f6c 3C91      		ld r19,X
 2828 0f6e 1197      		sbiw r26,1
 2829 0f70 2830      		cpi r18,8
 2830 0f72 3105      		cpc r19,__zero_reg__
 2831 0f74 1CF0      		brlt .L177
 2832 0f76 8FEF      		ldi r24,lo8(-1)
 2833 0f78 9FEF      		ldi r25,hi8(-1)
 2834 0f7a 22C0      		rjmp .L179
 2835               	.L177:
 2836               		.stabn	68,0,209,.LM191-nmeap_addParser
 2837               	.LM191:
 2838 0f7c 8EE0      		ldi r24,lo8(14)
 2839 0f7e 90E0      		ldi r25,hi8(14)
GAS LISTING /var/tmp//ccvnAEfo.s 			page 68


 2840 0f80 289F      		mul r18,r24
 2841 0f82 8001      		movw r16,r0
 2842 0f84 299F      		mul r18,r25
 2843 0f86 100D      		add r17,r0
 2844 0f88 389F      		mul r19,r24
 2845 0f8a 100D      		add r17,r0
 2846 0f8c 1124      		clr r1
 2847 0f8e 0E0F      		add r16,r30
 2848 0f90 1F1F      		adc r17,r31
 2849               		.stabn	68,0,212,.LM192-nmeap_addParser
 2850               	.LM192:
 2851 0f92 2F5F      		subi r18,lo8(-(1))
 2852 0f94 3F4F      		sbci r19,hi8(-(1))
 2853 0f96 2D93      		st X+,r18
 2854 0f98 3C93      		st X,r19
 2855               		.stabn	68,0,215,.LM193-nmeap_addParser
 2856               	.LM193:
 2857 0f9a 8EE0      		ldi r24,lo8(14)
 2858 0f9c F801      		movw r30,r16
 2859 0f9e 1192      		st Z+,__zero_reg__
 2860 0fa0 8A95      	        dec r24
 2861 0fa2 E9F7      		brne .-6
 2862               		.stabn	68,0,218,.LM194-nmeap_addParser
 2863               	.LM194:
 2864 0fa4 45E0      		ldi r20,lo8(5)
 2865 0fa6 50E0      		ldi r21,hi8(5)
 2866 0fa8 C801      		movw r24,r16
 2867 0faa 0E94 0000 		call strncpy
 2868               		.stabn	68,0,221,.LM195-nmeap_addParser
 2869               	.LM195:
 2870 0fae F801      		movw r30,r16
 2871 0fb0 D187      		std Z+9,r29
 2872 0fb2 C087      		std Z+8,r28
 2873               		.stabn	68,0,224,.LM196-nmeap_addParser
 2874               	.LM196:
 2875 0fb4 F386      		std Z+11,r15
 2876 0fb6 E286      		std Z+10,r14
 2877               		.stabn	68,0,227,.LM197-nmeap_addParser
 2878               	.LM197:
 2879 0fb8 D586      		std Z+13,r13
 2880 0fba C486      		std Z+12,r12
 2881 0fbc 80E0      		ldi r24,lo8(0)
 2882 0fbe 90E0      		ldi r25,hi8(0)
 2883               	.L179:
 2884               	/* epilogue: frame size=0 */
 2885 0fc0 DF91      		pop r29
 2886 0fc2 CF91      		pop r28
 2887 0fc4 1F91      		pop r17
 2888 0fc6 0F91      		pop r16
 2889 0fc8 FF90      		pop r15
 2890 0fca EF90      		pop r14
 2891 0fcc DF90      		pop r13
 2892 0fce CF90      		pop r12
 2893 0fd0 0895      		ret
 2894               	/* epilogue end (size=9) */
 2895               	/* function nmeap_addParser size 70 (53) */
 2896               		.size	nmeap_addParser, .-nmeap_addParser
GAS LISTING /var/tmp//ccvnAEfo.s 			page 69


 2897               		.stabs	"s:r(0,21)",64,0,198,16
 2898               		.stabn	192,0,0,nmeap_addParser-nmeap_addParser
 2899               		.stabn	224,0,0,.Lscope16-nmeap_addParser
 2900               	.Lscope16:
 2901               		.stabs	"",36,0,0,.Lscope16-nmeap_addParser
 2902               		.stabd	78,0,0
 2903               		.section	.progmem.data
 2904               		.type	__c.2378, @object
 2905               		.size	__c.2378, 12
 2906               	__c.2378:
 2907 000f 0D0A 7365 		.string	"\r\nsent i2c!"
 2907      6E74 2069 
 2907      3263 2100 
 2908               		.type	__c.2376, @object
 2909               		.size	__c.2376, 3
 2910               	__c.2376:
 2911 001b 2E0D 00   		.string	".\r"
 2912               		.type	__c.2365, @object
 2913               		.size	__c.2365, 3
 2914               	__c.2365:
 2915 001e 0D0A 00   		.string	"\r\n"
 2916               		.type	__c.2363, @object
 2917               		.size	__c.2363, 16
 2918               	__c.2363:
 2919 0021 6767 612E 		.string	"gga.latitude = "
 2919      6C61 7469 
 2919      7475 6465 
 2919      203D 2000 
 2920               		.type	__c.2361, @object
 2921               		.size	__c.2361, 18
 2922               	__c.2361:
 2923 0031 6E6D 6561 		.string	"nmeap_add RMC %d\n"
 2923      705F 6164 
 2923      6420 524D 
 2923      4320 2564 
 2923      0A00 
 2924               		.type	__c.2359, @object
 2925               		.size	__c.2359, 18
 2926               	__c.2359:
 2927 0043 6E6D 6561 		.string	"nmeap_add GGA %d\n"
 2927      705F 6164 
 2927      6420 4747 
 2927      4120 2564 
 2927      0A00 
 2928               		.type	__c.2357, @object
 2929               		.size	__c.2357, 15
 2930               	__c.2357:
 2931 0055 6E6D 6561 		.string	"nmeap_init %d\n"
 2931      705F 696E 
 2931      6974 2025 
 2931      640A 00
 2932               		.type	__c.2355, @object
 2933               		.size	__c.2355, 14
 2934               	__c.2355:
 2935 0064 7365 7420 		.string	"set handler\r\n"
 2935      6861 6E64 
 2935      6C65 720D 
GAS LISTING /var/tmp//ccvnAEfo.s 			page 70


 2935      0A00 
 2936               		.data
 2937               	.LC3:
 2938 0040 4750 4747 		.string	"GPGGA"
 2938      4100 
 2939               	.LC4:
 2940 0046 4750 524D 		.string	"GPRMC"
 2940      4300 
 2941               		.text
 2942               		.stabs	"main:F(0,1)",36,0,54,main
 2943               	.global	main
 2944               		.type	main, @function
 2945               	main:
 2946               		.stabd	46,0,0
 2947               		.stabs	"gpstest.c",132,0,0,.Ltext5
 2948               	.Ltext5:
 2949               		.stabn	68,0,54,.LM198-main
 2950               	.LM198:
 2951               	/* prologue: frame size=0 */
 2952 0fd2 C0E0      		ldi r28,lo8(__stack - 0)
 2953 0fd4 D0E0      		ldi r29,hi8(__stack - 0)
 2954 0fd6 DEBF      		out __SP_H__,r29
 2955 0fd8 CDBF      		out __SP_L__,r28
 2956               	/* prologue end (size=4) */
 2957               		.stabn	68,0,66,.LM199-main
 2958               	.LM199:
 2959 0fda 1092 0000 		sts message_sent,__zero_reg__
 2960               		.stabn	68,0,73,.LM200-main
 2961               	.LM200:
 2962 0fde 0E94 0000 		call uartInit
 2963               		.stabn	68,0,75,.LM201-main
 2964               	.LM201:
 2965 0fe2 60E6      		ldi r22,lo8(2400)
 2966 0fe4 79E0      		ldi r23,hi8(2400)
 2967 0fe6 80E0      		ldi r24,hlo8(2400)
 2968 0fe8 90E0      		ldi r25,hhi8(2400)
 2969 0fea 0E94 0000 		call uartSetBaudRate
 2970               		.stabn	68,0,77,.LM202-main
 2971               	.LM202:
 2972 0fee 80E0      		ldi r24,lo8(pm(uartSendByte))
 2973 0ff0 90E0      		ldi r25,hi8(pm(uartSendByte))
 2974 0ff2 0E94 0000 		call rprintfInit
 2975               		.stabn	68,0,78,.LM203-main
 2976               	.LM203:
 2977 0ff6 0E94 0000 		call initVideo
 2978               		.stabn	68,0,80,.LM204-main
 2979               	.LM204:
 2980 0ffa 60EC      		ldi r22,lo8(4800)
 2981 0ffc 72E1      		ldi r23,hi8(4800)
 2982 0ffe 80E0      		ldi r24,hlo8(4800)
 2983 1000 90E0      		ldi r25,hhi8(4800)
 2984 1002 0E94 0000 		call uartSetBaudRate
 2985               		.stabn	68,0,82,.LM205-main
 2986               	.LM205:
 2987 1006 80E0      		ldi r24,lo8(pm(uartSendByte))
 2988 1008 90E0      		ldi r25,hi8(pm(uartSendByte))
 2989 100a 0E94 0000 		call rprintfInit
GAS LISTING /var/tmp//ccvnAEfo.s 			page 71


 2990               		.stabn	68,0,84,.LM206-main
 2991               	.LM206:
 2992 100e 0E94 0000 		call timerInit
 2993               		.stabn	68,0,96,.LM207-main
 2994               	.LM207:
 2995 1012 0E94 0000 		call timerInit
 2996               		.stabn	68,0,97,.LM208-main
 2997               	.LM208:
 2998 1016 84EF      		ldi r24,lo8(500)
 2999 1018 91E0      		ldi r25,hi8(500)
 3000 101a 0E94 0000 		call timerPause
 3001               		.stabn	68,0,102,.LM209-main
 3002               	.LM209:
 3003 101e 0E94 0000 		call i2cInit
 3004               		.stabn	68,0,104,.LM210-main
 3005               	.LM210:
 3006 1022 6FEF      		ldi r22,lo8(-1)
 3007 1024 80EA      		ldi r24,lo8(-96)
 3008 1026 0E94 0000 		call i2cSetLocalDeviceAddr
 3009               		.stabn	68,0,108,.LM211-main
 3010               	.LM211:
 3011 102a 80E0      		ldi r24,lo8(pm(i2cSlaveReceiveService))
 3012 102c 90E0      		ldi r25,hi8(pm(i2cSlaveReceiveService))
 3013 102e 0E94 0000 		call i2cSetSlaveReceiveHandler
 3014               		.stabn	68,0,112,.LM212-main
 3015               	.LM212:
 3016 1032 80E0      		ldi r24,lo8(pm(i2cSlaveTransmitService))
 3017 1034 90E0      		ldi r25,hi8(pm(i2cSlaveTransmitService))
 3018 1036 0E94 0000 		call i2cSetSlaveTransmitHandler
 3019               		.stabn	68,0,116,.LM213-main
 3020               	.LM213:
 3021 103a 40E8      		ldi r20,lo8(128)
 3022 103c 50E0      		ldi r21,hi8(128)
 3023 103e 60E0      		ldi r22,lo8(gpsBufferData)
 3024 1040 70E0      		ldi r23,hi8(gpsBufferData)
 3025 1042 80E0      		ldi r24,lo8(gpsBuffer)
 3026 1044 90E0      		ldi r25,hi8(gpsBuffer)
 3027 1046 0E94 0000 		call bufferInit
 3028               		.stabn	68,0,118,.LM214-main
 3029               	.LM214:
 3030 104a 80E0      		ldi r24,lo8(pm(addToBuffer))
 3031 104c 90E0      		ldi r25,hi8(pm(addToBuffer))
 3032 104e 0E94 0000 		call uartSetRxHandler
 3033               		.stabn	68,0,120,.LM215-main
 3034               	.LM215:
 3035 1052 80E0      		ldi r24,lo8(__c.2355)
 3036 1054 90E0      		ldi r25,hi8(__c.2355)
 3037 1056 9F93      		push r25
 3038 1058 8F93      		push r24
 3039 105a 11E0      		ldi r17,lo8(1)
 3040 105c F12E      		mov r15,r17
 3041 105e FF92      		push r15
 3042 1060 0E94 0000 		call rprintf1RamRom
 3043               		.stabn	68,0,123,.LM216-main
 3044               	.LM216:
 3045 1064 60E0      		ldi r22,lo8(user_data)
 3046 1066 70E0      		ldi r23,hi8(user_data)
GAS LISTING /var/tmp//ccvnAEfo.s 			page 72


 3047 1068 80E0      		ldi r24,lo8(nmea)
 3048 106a 90E0      		ldi r25,hi8(nmea)
 3049 106c 0E94 0000 		call nmeap_init
 3050               		.stabn	68,0,124,.LM217-main
 3051               	.LM217:
 3052 1070 0F90      		pop __tmp_reg__
 3053 1072 0F90      		pop __tmp_reg__
 3054 1074 0F90      	 	pop __tmp_reg__
 3055 1076 0097      		sbiw r24,0
 3056 1078 71F0      		breq .L183
 3057               		.stabn	68,0,125,.LM218-main
 3058               	.LM218:
 3059 107a 9F93      		push r25
 3060 107c 8F93      		push r24
 3061 107e 80E0      		ldi r24,lo8(__c.2357)
 3062 1080 90E0      		ldi r25,hi8(__c.2357)
 3063 1082 9F93      		push r25
 3064 1084 8F93      		push r24
 3065 1086 FF92      		push r15
 3066 1088 0E94 0000 		call rprintf1RamRom
 3067 108c 0F90      		pop __tmp_reg__
 3068 108e 0F90      		pop __tmp_reg__
 3069 1090 0F90      		pop __tmp_reg__
 3070 1092 0F90      		pop __tmp_reg__
 3071 1094 0F90      		pop __tmp_reg__
 3072               	.L183:
 3073               		.stabn	68,0,128,.LM219-main
 3074               	.LM219:
 3075 1096 00E0      		ldi r16,lo8(gga)
 3076 1098 10E0      		ldi r17,hi8(gga)
 3077 109a 20E0      		ldi r18,lo8(0)
 3078 109c 30E0      		ldi r19,hi8(0)
 3079 109e 40E0      		ldi r20,lo8(pm(nmeap_gpgga))
 3080 10a0 50E0      		ldi r21,hi8(pm(nmeap_gpgga))
 3081 10a2 60E0      		ldi r22,lo8(.LC3)
 3082 10a4 70E0      		ldi r23,hi8(.LC3)
 3083 10a6 80E0      		ldi r24,lo8(nmea)
 3084 10a8 90E0      		ldi r25,hi8(nmea)
 3085 10aa 0E94 0000 		call nmeap_addParser
 3086               		.stabn	68,0,129,.LM220-main
 3087               	.LM220:
 3088 10ae 0097      		sbiw r24,0
 3089 10b0 71F0      		breq .L185
 3090               		.stabn	68,0,130,.LM221-main
 3091               	.LM221:
 3092 10b2 9F93      		push r25
 3093 10b4 8F93      		push r24
 3094 10b6 80E0      		ldi r24,lo8(__c.2359)
 3095 10b8 90E0      		ldi r25,hi8(__c.2359)
 3096 10ba 9F93      		push r25
 3097 10bc 8F93      		push r24
 3098 10be FF92      		push r15
 3099 10c0 0E94 0000 		call rprintf1RamRom
 3100 10c4 0F90      		pop __tmp_reg__
 3101 10c6 0F90      		pop __tmp_reg__
 3102 10c8 0F90      		pop __tmp_reg__
 3103 10ca 0F90      		pop __tmp_reg__
GAS LISTING /var/tmp//ccvnAEfo.s 			page 73


 3104 10cc 0F90      		pop __tmp_reg__
 3105               	.L185:
 3106               		.stabn	68,0,132,.LM222-main
 3107               	.LM222:
 3108 10ce 00E0      		ldi r16,lo8(rmc)
 3109 10d0 10E0      		ldi r17,hi8(rmc)
 3110 10d2 20E0      		ldi r18,lo8(0)
 3111 10d4 30E0      		ldi r19,hi8(0)
 3112 10d6 40E0      		ldi r20,lo8(pm(nmeap_gprmc))
 3113 10d8 50E0      		ldi r21,hi8(pm(nmeap_gprmc))
 3114 10da 60E0      		ldi r22,lo8(.LC4)
 3115 10dc 70E0      		ldi r23,hi8(.LC4)
 3116 10de 80E0      		ldi r24,lo8(nmea)
 3117 10e0 90E0      		ldi r25,hi8(nmea)
 3118 10e2 0E94 0000 		call nmeap_addParser
 3119               		.stabn	68,0,133,.LM223-main
 3120               	.LM223:
 3121 10e6 0097      		sbiw r24,0
 3122 10e8 71F0      		breq .L187
 3123               		.stabn	68,0,134,.LM224-main
 3124               	.LM224:
 3125 10ea 9F93      		push r25
 3126 10ec 8F93      		push r24
 3127 10ee 80E0      		ldi r24,lo8(__c.2361)
 3128 10f0 90E0      		ldi r25,hi8(__c.2361)
 3129 10f2 9F93      		push r25
 3130 10f4 8F93      		push r24
 3131 10f6 FF92      		push r15
 3132 10f8 0E94 0000 		call rprintf1RamRom
 3133 10fc 0F90      		pop __tmp_reg__
 3134 10fe 0F90      		pop __tmp_reg__
 3135 1100 0F90      		pop __tmp_reg__
 3136 1102 0F90      		pop __tmp_reg__
 3137 1104 0F90      		pop __tmp_reg__
 3138               	.L187:
 3139               		.stabn	68,0,137,.LM225-main
 3140               	.LM225:
 3141 1106 80E0      		ldi r24,lo8(__c.2363)
 3142 1108 90E0      		ldi r25,hi8(__c.2363)
 3143 110a 9F93      		push r25
 3144 110c 8F93      		push r24
 3145 110e FF92      		push r15
 3146 1110 0E94 0000 		call rprintf1RamRom
 3147               		.stabn	68,0,138,.LM226-main
 3148               	.LM226:
 3149 1114 4091 0000 		lds r20,gga
 3150 1118 5091 0000 		lds r21,(gga)+1
 3151 111c 6091 0000 		lds r22,(gga)+2
 3152 1120 7091 0000 		lds r23,(gga)+3
 3153 1124 88E0      		ldi r24,lo8(8)
 3154 1126 0E94 0000 		call rprintfFloat
 3155               		.stabn	68,0,139,.LM227-main
 3156               	.LM227:
 3157 112a 80E0      		ldi r24,lo8(__c.2365)
 3158 112c 90E0      		ldi r25,hi8(__c.2365)
 3159 112e 9F93      		push r25
 3160 1130 8F93      		push r24
GAS LISTING /var/tmp//ccvnAEfo.s 			page 74


 3161 1132 FF92      		push r15
 3162 1134 0E94 0000 		call rprintf1RamRom
 3163 1138 8DB7      		in r24,__SP_L__
 3164 113a 9EB7      		in r25,__SP_H__
 3165 113c 0696      		adiw r24,6
 3166 113e 0FB6      		in __tmp_reg__,__SREG__
 3167 1140 F894      		cli
 3168 1142 9EBF      		out __SP_H__,r25
 3169 1144 0FBE      		out __SREG__,__tmp_reg__
 3170 1146 8DBF      		out __SP_L__,r24
 3171               	.L209:
 3172               	.LBB2:
 3173               		.stabn	68,0,145,.LM228-main
 3174               	.LM228:
 3175 1148 80E0      		ldi r24,lo8(gpsBuffer)
 3176 114a 90E0      		ldi r25,hi8(gpsBuffer)
 3177 114c 0E94 0000 		call bufferGetFromFront
 3178 1150 682F      		mov r22,r24
 3179               		.stabn	68,0,146,.LM229-main
 3180               	.LM229:
 3181 1152 8823      		tst r24
 3182 1154 09F4      		brne .+2
 3183 1156 6DC0      		rjmp .L190
 3184               		.stabn	68,0,148,.LM230-main
 3185               	.LM230:
 3186 1158 80E0      		ldi r24,lo8(nmea)
 3187 115a 90E0      		ldi r25,hi8(nmea)
 3188 115c 0E94 0000 		call nmeap_parse
 3189               		.stabn	68,0,149,.LM231-main
 3190               	.LM231:
 3191 1160 8130      		cpi r24,1
 3192 1162 9105      		cpc r25,__zero_reg__
 3193 1164 19F0      		breq .L193
 3194 1166 0297      		sbiw r24,2
 3195 1168 09F0      		breq .+2
 3196 116a 63C0      		rjmp .L190
 3197               	.L193:
 3198               		.stabn	68,0,177,.LM232-main
 3199               	.LM232:
 3200 116c A090 0000 		lds r10,gga+8
 3201 1170 B090 0000 		lds r11,(gga+8)+1
 3202 1174 C090 0000 		lds r12,(gga+8)+2
 3203 1178 D090 0000 		lds r13,(gga+8)+3
 3204 117c 2091 0000 		lds r18,gga+12
 3205 1180 3091 0000 		lds r19,(gga+12)+1
 3206 1184 4091 0000 		lds r20,(gga+12)+2
 3207 1188 5091 0000 		lds r21,(gga+12)+3
 3208 118c 57FD      		sbrc r21,7
 3209 118e 05C0      		rjmp .L197
 3210 1190 CA01      		movw r24,r20
 3211 1192 B901      		movw r22,r18
 3212 1194 0E94 0000 		call __floatsisf
 3213 1198 14C0      		rjmp .L206
 3214               	.L197:
 3215 119a CA01      		movw r24,r20
 3216 119c B901      		movw r22,r18
 3217 119e 6170      		andi r22,lo8(1)
GAS LISTING /var/tmp//ccvnAEfo.s 			page 75


 3218 11a0 7070      		andi r23,hi8(1)
 3219 11a2 8070      		andi r24,hlo8(1)
 3220 11a4 9070      		andi r25,hhi8(1)
 3221 11a6 5695      		lsr r21
 3222 11a8 4795      		ror r20
 3223 11aa 3795      		ror r19
 3224 11ac 2795      		ror r18
 3225 11ae 622B      		or r22,r18
 3226 11b0 732B      		or r23,r19
 3227 11b2 842B      		or r24,r20
 3228 11b4 952B      		or r25,r21
 3229 11b6 0E94 0000 		call __floatsisf
 3230 11ba 9B01      		movw r18,r22
 3231 11bc AC01      		movw r20,r24
 3232 11be 0E94 0000 		call __addsf3
 3233               	.L206:
 3234 11c2 3B01      		movw r6,r22
 3235 11c4 4C01      		movw r8,r24
 3236 11c6 2091 0000 		lds r18,gga+4
 3237 11ca 3091 0000 		lds r19,(gga+4)+1
 3238 11ce 4091 0000 		lds r20,(gga+4)+2
 3239 11d2 5091 0000 		lds r21,(gga+4)+3
 3240 11d6 6091 0000 		lds r22,gga
 3241 11da 7091 0000 		lds r23,(gga)+1
 3242 11de 8091 0000 		lds r24,(gga)+2
 3243 11e2 9091 0000 		lds r25,(gga)+3
 3244 11e6 EEE6      		ldi r30,lo8(110)
 3245 11e8 EF93      		push r30
 3246 11ea E090 0000 		lds r14,rmc+13
 3247 11ee F090 0000 		lds r15,(rmc+13)+1
 3248 11f2 0091 0000 		lds r16,(rmc+13)+2
 3249 11f6 1091 0000 		lds r17,(rmc+13)+3
 3250 11fa 1F93      		push r17
 3251 11fc 0F93      		push r16
 3252 11fe FF92      		push r15
 3253 1200 EF92      		push r14
 3254 1202 E090 0000 		lds r14,rmc+17
 3255 1206 F090 0000 		lds r15,(rmc+17)+1
 3256 120a 0091 0000 		lds r16,(rmc+17)+2
 3257 120e 1091 0000 		lds r17,(rmc+17)+3
 3258 1212 1F93      		push r17
 3259 1214 0F93      		push r16
 3260 1216 FF92      		push r15
 3261 1218 EF92      		push r14
 3262 121a 8401      		movw r16,r8
 3263 121c 7301      		movw r14,r6
 3264 121e 0E94 0000 		call writeVideoScreen
 3265 1222 8DB7      		in r24,__SP_L__
 3266 1224 9EB7      		in r25,__SP_H__
 3267 1226 0996      		adiw r24,9
 3268 1228 0FB6      		in __tmp_reg__,__SREG__
 3269 122a F894      		cli
 3270 122c 9EBF      		out __SP_H__,r25
 3271 122e 0FBE      		out __SREG__,__tmp_reg__
 3272 1230 8DBF      		out __SP_L__,r24
 3273               	.L190:
 3274               		.stabn	68,0,205,.LM233-main
GAS LISTING /var/tmp//ccvnAEfo.s 			page 76


 3275               	.LM233:
 3276 1232 80E0      		ldi r24,lo8(__c.2376)
 3277 1234 90E0      		ldi r25,hi8(__c.2376)
 3278 1236 9F93      		push r25
 3279 1238 8F93      		push r24
 3280 123a 11E0      		ldi r17,lo8(1)
 3281 123c 1F93      		push r17
 3282 123e 0E94 0000 		call rprintf1RamRom
 3283               		.stabn	68,0,207,.LM234-main
 3284               	.LM234:
 3285 1242 0F90      		pop __tmp_reg__
 3286 1244 0F90      		pop __tmp_reg__
 3287 1246 0F90      	 	pop __tmp_reg__
 3288 1248 8091 0000 		lds r24,message_sent
 3289 124c 8823      		tst r24
 3290 124e 09F4      		brne .+2
 3291 1250 7BCF      		rjmp .L209
 3292               		.stabn	68,0,209,.LM235-main
 3293               	.LM235:
 3294 1252 1093 0000 		sts message_sent,r17
 3295               		.stabn	68,0,210,.LM236-main
 3296               	.LM236:
 3297 1256 80E0      		ldi r24,lo8(__c.2378)
 3298 1258 90E0      		ldi r25,hi8(__c.2378)
 3299 125a 9F93      		push r25
 3300 125c 8F93      		push r24
 3301 125e 1F93      		push r17
 3302 1260 0E94 0000 		call rprintf1RamRom
 3303 1264 0F90      		pop __tmp_reg__
 3304 1266 0F90      		pop __tmp_reg__
 3305 1268 0F90      	 	pop __tmp_reg__
 3306 126a 6ECF      		rjmp .L209
 3307               	.LBE2:
 3308               	/* epilogue: frame size=0 */
 3309               	/* epilogue: noreturn */
 3310               	/* epilogue end (size=0) */
 3311               	/* function main size 334 (330) */
 3312               		.size	main, .-main
 3313               		.stabs	"status:r(0,1)",64,0,55,24
 3314               		.stabn	192,0,0,main-main
 3315               		.stabn	224,0,0,.Lscope17-main
 3316               	.Lscope17:
 3317               		.stabs	"",36,0,0,.Lscope17-main
 3318               		.stabd	78,0,0
 3319               		.stabs	"nmea:S(13,11)",40,0,31,nmea
 3320               		.stabs	"user_data:S(0,1)",40,0,32,user_data
 3321               		.stabs	"gga:S(12,8)",40,0,33,gga
 3322               		.stabs	"rmc:S(12,10)",40,0,34,rmc
 3323               		.stabs	"gpsBuffer:S(8,3)",40,0,36,gpsBuffer
 3324               		.stabs	"gpsBufferData:S(0,24)=ar(13,3);0;127;(0,2)",40,0,37,gpsBufferData
 3325               		.stabs	"localBuffer:G(0,25)=ar(13,3);0;33;(0,11)",32,0,28,0
 3326               		.stabs	"localBufferLength:G(0,11)",32,0,29,0
 3327               		.stabs	"message_sent:G(7,1)",32,0,43,0
 3328               		.stabs	"stackem:G(0,26)=ar(13,3);0;31;(7,1)",32,0,48,0
 3329               		.stabs	"stackem_pointer:G(7,1)",32,0,49,0
 3330               		.comm stackem,32,1
 3331               		.comm message_sent,1,1
GAS LISTING /var/tmp//ccvnAEfo.s 			page 77


 3332               		.lcomm gpsBufferData,128
 3333               		.lcomm gpsBuffer,8
 3334               		.lcomm rmc,29
 3335               		.lcomm gga,28
 3336               		.lcomm user_data,2
 3337               		.lcomm nmea,718
 3338               		.stabs	"",100,0,0,.Letext0
 3339               	.Letext0:
 3340               	/* File "gpstest.c": code 2360 = 0x0938 (2074), prologues 139, epilogues 147 */
GAS LISTING /var/tmp//ccvnAEfo.s 			page 78


DEFINED SYMBOLS
                            *ABS*:00000000 gpstest.c
/var/tmp//ccvnAEfo.s:3      *ABS*:0000003f __SREG__
/var/tmp//ccvnAEfo.s:4      *ABS*:0000003e __SP_H__
/var/tmp//ccvnAEfo.s:5      *ABS*:0000003d __SP_L__
/var/tmp//ccvnAEfo.s:6      *ABS*:00000000 __tmp_reg__
/var/tmp//ccvnAEfo.s:7      *ABS*:00000001 __zero_reg__
/var/tmp//ccvnAEfo.s:160    .bss:00000000 stackem_pointer
/var/tmp//ccvnAEfo.s:166    .data:00000000 localBufferLength
/var/tmp//ccvnAEfo.s:171    .data:00000001 localBuffer
/var/tmp//ccvnAEfo.s:179    .text:00000000 nmeap_altitude
/var/tmp//ccvnAEfo.s:242    .text:0000003a nmeap_tokenize
/var/tmp//ccvnAEfo.s:339    .text:00000096 nmeap_process
/var/tmp//ccvnAEfo.s:462    .text:0000013a nmeap_parse
/var/tmp//ccvnAEfo.s:975    .text:00000424 nmeap_parseBuffer
/var/tmp//ccvnAEfo.s:1068   .text:00000492 dist
/var/tmp//ccvnAEfo.s:1312   .text:00000678 bearing
/var/tmp//ccvnAEfo.s:1543   .text:0000083e addToBuffer
/var/tmp//ccvnAEfo.s:3332   .bss:00000081 gpsBuffer
/var/tmp//ccvnAEfo.s:1570   .text:0000084a i2cSlaveReceiveService
/var/tmp//ccvnAEfo.s:1617   .progmem.data:00000000 __c.2439
/var/tmp//ccvnAEfo.s:1621   .progmem.data:00000003 __c.2436
/var/tmp//ccvnAEfo.s:1625   .progmem.data:00000006 __c.2433
/var/tmp//ccvnAEfo.s:1629   .progmem.data:00000009 __c.2430
/var/tmp//ccvnAEfo.s:1633   .progmem.data:0000000c __c.2426
/var/tmp//ccvnAEfo.s:1641   .text:00000870 i2cSlaveTransmitService
/var/tmp//ccvnAEfo.s:1847   .text:000009c4 print_to_string
/var/tmp//ccvnAEfo.s:3334   .bss:000000a6 gga
/var/tmp//ccvnAEfo.s:3333   .bss:00000089 rmc
                            *COM*:00000020 stackem
/var/tmp//ccvnAEfo.s:1891   .text:000009e8 nmeap_latitude
/var/tmp//ccvnAEfo.s:2037   .text:00000abe nmeap_longitude
/var/tmp//ccvnAEfo.s:2189   .text:00000b94 nmeap_gprmc
/var/tmp//ccvnAEfo.s:2473   .text:00000d64 nmeap_gpgga
/var/tmp//ccvnAEfo.s:2748   .text:00000f24 nmeap_init
/var/tmp//ccvnAEfo.s:2796   .text:00000f46 nmeap_addParser
/var/tmp//ccvnAEfo.s:2906   .progmem.data:0000000f __c.2378
/var/tmp//ccvnAEfo.s:2910   .progmem.data:0000001b __c.2376
/var/tmp//ccvnAEfo.s:2914   .progmem.data:0000001e __c.2365
/var/tmp//ccvnAEfo.s:2918   .progmem.data:00000021 __c.2363
/var/tmp//ccvnAEfo.s:2922   .progmem.data:00000031 __c.2361
/var/tmp//ccvnAEfo.s:2926   .progmem.data:00000043 __c.2359
/var/tmp//ccvnAEfo.s:2930   .progmem.data:00000055 __c.2357
/var/tmp//ccvnAEfo.s:2934   .progmem.data:00000064 __c.2355
/var/tmp//ccvnAEfo.s:2945   .text:00000fd2 main
                            *COM*:00000001 message_sent
                             .bss:00000001 gpsBufferData
/var/tmp//ccvnAEfo.s:3335   .bss:000000c2 user_data
/var/tmp//ccvnAEfo.s:3336   .bss:000000c4 nmea

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
atof
__mulsf3
strncpy
strncmp
GAS LISTING /var/tmp//ccvnAEfo.s 			page 79


isalnum
isxdigit
__divsf3
__subsf3
sin
cos
__addsf3
sqrt
atan2
bufferAddToEnd
rprintfInit
rprintf1RamRom
__floatsisf
rprintfFloat
uartSendByte
__fixsfsi
atoi
printf
__stack
uartInit
uartSetBaudRate
initVideo
timerInit
timerPause
i2cInit
i2cSetLocalDeviceAddr
i2cSetSlaveReceiveHandler
i2cSetSlaveTransmitHandler
bufferInit
uartSetRxHandler
bufferGetFromFront
writeVideoScreen
