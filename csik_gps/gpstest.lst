GAS LISTING /var/tmp//cc4EqHDQ.s 			page 1


   1               		.file	"gpstest.c"
   2               		.arch atmega32
   3               	__SREG__ = 0x3f
   4               	__SP_H__ = 0x3e
   5               	__SP_L__ = 0x3d
   6               	__tmp_reg__ = 0
   7               	__zero_reg__ = 1
   8               		.global __do_copy_data
   9               		.global __do_clear_bss
  10               		.stabs	"/opt/local/avr/avrlib/freedomflies/csik_gps/",100,0,2,.Ltext0
  11               		.stabs	"gpstest.c",100,0,2,.Ltext0
  12               		.text
  13               	.Ltext0:
  14               		.stabs	"gcc2_compiled.",60,0,0,0
  15               		.stabs	"int:t(0,1)=r(0,1);-32768;32767;",128,0,0,0
  16               		.stabs	"char:t(0,2)=r(0,2);0;127;",128,0,0,0
  17               		.stabs	"long int:t(0,3)=@s32;r(0,3);020000000000;017777777777;",128,0,0,0
  18               		.stabs	"unsigned int:t(0,4)=r(0,4);0;0177777;",128,0,0,0
  19               		.stabs	"long unsigned int:t(0,5)=@s32;r(0,5);0;037777777777;",128,0,0,0
  20               		.stabs	"long long int:t(0,6)=@s64;r(0,6);01000000000000000000000;0777777777777777777777;",128,0,0,
  21               		.stabs	"long long unsigned int:t(0,7)=@s64;r(0,7);0;01777777777777777777777;",128,0,0,0
  22               		.stabs	"short int:t(0,8)=r(0,8);-32768;32767;",128,0,0,0
  23               		.stabs	"short unsigned int:t(0,9)=r(0,9);0;0177777;",128,0,0,0
  24               		.stabs	"signed char:t(0,10)=@s8;r(0,10);-128;127;",128,0,0,0
  25               		.stabs	"unsigned char:t(0,11)=@s8;r(0,11);0;255;",128,0,0,0
  26               		.stabs	"float:t(0,12)=r(0,1);4;0;",128,0,0,0
  27               		.stabs	"double:t(0,13)=r(0,1);4;0;",128,0,0,0
  28               		.stabs	"long double:t(0,14)=r(0,1);4;0;",128,0,0,0
  29               		.stabs	"void:t(0,15)=(0,15)",128,0,0,0
  30               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/../../../../avr/include/avr/io.h",130,0,0,0
  31               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/../../../../avr/include/avr/sfr_defs.h",130,0,0,0
  32               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/../../../../avr/include/inttypes.h",130,0,0,0
  33               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/../../../../avr/include/stdint.h",130,0,0,0
  34               		.stabs	"int8_t:t(4,1)=(0,10)",128,0,116,0
  35               		.stabs	"uint8_t:t(4,2)=(0,11)",128,0,117,0
  36               		.stabs	"int16_t:t(4,3)=(0,1)",128,0,118,0
  37               		.stabs	"uint16_t:t(4,4)=(0,4)",128,0,119,0
  38               		.stabs	"int32_t:t(4,5)=(0,3)",128,0,120,0
  39               		.stabs	"uint32_t:t(4,6)=(0,5)",128,0,121,0
  40               		.stabs	"int64_t:t(4,7)=(0,6)",128,0,122,0
  41               		.stabs	"uint64_t:t(4,8)=(0,7)",128,0,123,0
  42               		.stabs	"intptr_t:t(4,9)=(4,3)",128,0,135,0
  43               		.stabs	"uintptr_t:t(4,10)=(4,4)",128,0,140,0
  44               		.stabs	"int_least8_t:t(4,11)=(4,1)",128,0,152,0
  45               		.stabs	"uint_least8_t:t(4,12)=(4,2)",128,0,157,0
  46               		.stabs	"int_least16_t:t(4,13)=(4,3)",128,0,162,0
  47               		.stabs	"uint_least16_t:t(4,14)=(4,4)",128,0,167,0
  48               		.stabs	"int_least32_t:t(4,15)=(4,5)",128,0,172,0
  49               		.stabs	"uint_least32_t:t(4,16)=(4,6)",128,0,177,0
  50               		.stabs	"int_least64_t:t(4,17)=(4,7)",128,0,182,0
  51               		.stabs	"uint_least64_t:t(4,18)=(4,8)",128,0,187,0
  52               		.stabs	"int_fast8_t:t(4,19)=(4,1)",128,0,200,0
  53               		.stabs	"uint_fast8_t:t(4,20)=(4,2)",128,0,205,0
  54               		.stabs	"int_fast16_t:t(4,21)=(4,3)",128,0,210,0
  55               		.stabs	"uint_fast16_t:t(4,22)=(4,4)",128,0,215,0
  56               		.stabs	"int_fast32_t:t(4,23)=(4,5)",128,0,220,0
  57               		.stabs	"uint_fast32_t:t(4,24)=(4,6)",128,0,225,0
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 2


  58               		.stabs	"int_fast64_t:t(4,25)=(4,7)",128,0,230,0
  59               		.stabs	"uint_fast64_t:t(4,26)=(4,8)",128,0,235,0
  60               		.stabs	"intmax_t:t(4,27)=(4,7)",128,0,249,0
  61               		.stabs	"uintmax_t:t(4,28)=(4,8)",128,0,254,0
  62               		.stabn	162,0,0,0
  63               		.stabs	"int_farptr_t:t(3,1)=(4,5)",128,0,76,0
  64               		.stabs	"uint_farptr_t:t(3,2)=(4,6)",128,0,80,0
  65               		.stabn	162,0,0,0
  66               		.stabn	162,0,0,0
  67               		.stabn	162,0,0,0
  68               		.stabs	"/opt/local/avr/sixcode/uart.h",130,0,0,0
  69               		.stabs	"./global.h",130,0,0,0
  70               		.stabs	"/opt/local/avr/sixcode/avrlibtypes.h",130,0,0,0
  71               		.stabs	"u08:t(7,1)=(0,11)",128,0,32,0
  72               		.stabs	"s08:t(7,2)=(0,10)",128,0,33,0
  73               		.stabs	"u16:t(7,3)=(0,9)",128,0,34,0
  74               		.stabs	"s16:t(7,4)=(0,8)",128,0,35,0
  75               		.stabs	"u32:t(7,5)=(0,5)",128,0,36,0
  76               		.stabs	"s32:t(7,6)=(0,3)",128,0,37,0
  77               		.stabs	"u64:t(7,7)=(0,7)",128,0,38,0
  78               		.stabs	"s64:t(7,8)=(0,6)",128,0,39,0
  79               		.stabs	"BOOL:t(7,9)=(0,11)",128,0,69,0
  80               		.stabs	"BYTE:t(7,10)=(0,11)",128,0,70,0
  81               		.stabs	"WORD:t(7,11)=(0,4)",128,0,71,0
  82               		.stabs	"DWORD:t(7,12)=(0,5)",128,0,72,0
  83               		.stabs	"UCHAR:t(7,13)=(0,11)",128,0,74,0
  84               		.stabs	"UINT:t(7,14)=(0,4)",128,0,75,0
  85               		.stabs	"USHORT:t(7,15)=(0,9)",128,0,76,0
  86               		.stabs	"ULONG:t(7,16)=(0,5)",128,0,77,0
  87               		.stabs	"CHAR:t(7,17)=(0,2)",128,0,79,0
  88               		.stabs	"INT:t(7,18)=(0,1)",128,0,80,0
  89               		.stabs	"LONG:t(7,19)=(0,3)",128,0,81,0
  90               		.stabn	162,0,0,0
  91               		.stabn	162,0,0,0
  92               		.stabs	"/opt/local/avr/sixcode/buffer.h",130,0,0,0
  93               		.stabs	"struct_cBuffer:T(8,1)=s8dataptr:(8,2)=*(0,11),0,16;size:(0,9),16,16;datalength:(0,9),32,16
  94               		.stabs	"cBuffer:t(8,3)=(8,1)",128,0,47,0
  95               		.stabn	162,0,0,0
  96               		.stabn	162,0,0,0
  97               		.stabs	"/opt/local/avr/sixcode/rprintf.h",130,0,0,0
  98               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/../../../../avr/include/avr/pgmspace.h",130,0,0,0
  99               		.stabs	"/opt/local/lib/gcc/avr/4.0.2/include/stddef.h",130,0,0,0
 100               		.stabs	"size_t:t(11,1)=(0,4)",128,0,214,0
 101               		.stabn	162,0,0,0
 102               		.stabs	"prog_void:t(10,1)=(10,2)=(10,2)",128,0,203,0
 103               		.stabs	"prog_char:t(10,3)=(10,4)=@s8;r(10,4);-128;127;",128,0,204,0
 104               		.stabs	"prog_uchar:t(10,5)=(10,6)=@s8;r(10,6);0;255;",128,0,205,0
 105               		.stabs	"prog_int8_t:t(10,7)=(10,4)",128,0,207,0
 106               		.stabs	"prog_uint8_t:t(10,8)=(10,6)",128,0,208,0
 107               		.stabs	"prog_int16_t:t(10,9)=(10,10)=(0,1)",128,0,209,0
 108               		.stabs	"prog_uint16_t:t(10,11)=(10,12)=(0,4)",128,0,210,0
 109               		.stabs	"prog_int32_t:t(10,13)=(10,14)=(0,3)",128,0,211,0
 110               		.stabs	"prog_uint32_t:t(10,15)=(10,16)=(0,5)",128,0,212,0
 111               		.stabs	"prog_int64_t:t(10,17)=(10,18)=(0,6)",128,0,213,0
 112               		.stabs	"prog_uint64_t:t(10,19)=(10,20)=(0,7)",128,0,214,0
 113               		.stabn	162,0,0,0
 114               		.stabn	162,0,0,0
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 3


 115               		.stabs	"nmeap.h",130,0,0,0
 116               		.stabs	"nmeap_callout_t:t(12,1)=(12,2)=*(12,3)=f(0,15)",128,0,79,0
 117               		.stabs	"nmeap_sentence_parser_t:t(12,4)=(12,5)=*(12,6)=f(0,1)",128,0,91,0
 118               		.stabs	"nmeap_def.h",130,0,0,0
 119               		.stabs	"nmeap_sentence:T(13,1)=s14name:(13,2)=ar(13,3)=r(13,3);0;0177777;;0;5;(0,2),0,48;id:(0,1),
 120               		.stabs	"nmeap_sentence_t:t(13,5)=(13,1)",128,0,34,0
 121               		.stabs	"nmeap_context:T(13,6)=s718sentence:(13,7)=ar(13,3);0;7;(13,5),0,896;sentence_count:(0,1),8
 122               		.stabs	"nmeap_context_t:t(13,11)=(13,6)",128,0,70,0
 123               		.stabn	162,0,0,0
 124               		.stabs	"nmeap_gga:T(12,7)=s28latitude:(0,13),0,32;longitude:(0,13),32,32;altitude:(0,13),64,32;tim
 125               		.stabs	"nmeap_gga_t:t(12,8)=(12,7)",128,0,118,0
 126               		.stabs	"nmeap_rmc:T(12,9)=s25time:(13,10),0,16;warn:(0,2),16,8;latitude:(0,13),24,32;longitude:(0,
 127               		.stabs	"nmeap_rmc_t:t(12,10)=(12,9)",128,0,132,0
 128               		.stabn	162,0,0,0
 129               		.stabs	"gpsmath.c",130,0,0,0
 130               		.stabs	"./gpsmath.h",130,0,0,0
 131               		.stabs	"waypoint:T(15,1)=s8lat:(0,13),0,32;lon:(0,13),32,32;;",128,0,0,0
 132               		.stabn	162,0,0,0
 133               		.stabn	162,0,0,0
 134               		.stabs	"/opt/local/avr/sixcode/i2c.h",130,0,0,0
 135               		.stabs	" :T(16,1)=eI2C_IDLE:0,I2C_BUSY:1,I2C_MASTER_TX:2,I2C_MASTER_RX:3,I2C_SLAVE_TX:4,I2C_SLAVE_
 136               		.stabs	"eI2cStateType:t(16,2)=(16,1)",128,0,124,0
 137               		.stabn	162,0,0,0
 138               	.global	stackem_pointer
 139               	.global	stackem_pointer
 140               		.section .bss
 141               		.type	stackem_pointer, @object
 142               		.size	stackem_pointer, 1
 143               	stackem_pointer:
 144 0000 00        		.skip 1,0
 145               	.global	localBufferLength
 146               		.data
 147               		.type	localBufferLength, @object
 148               		.size	localBufferLength, 1
 149               	localBufferLength:
 150 0000 20        		.byte	32
 151               	.global	localBuffer
 152               		.type	localBuffer, @object
 153               		.size	localBuffer, 34
 154               	localBuffer:
 155 0001 5468 6973 		.string	"This should be filling with data!"
 155      2073 686F 
 155      756C 6420 
 155      6265 2066 
 155      696C 6C69 
 156               		.text
 157               		.stabs	"dist:F(0,13)",36,0,4,dist
 158               		.stabs	"from:p(15,1)",160,0,4,1
 159               		.stabs	"to:p(15,1)",160,0,4,9
 160               	.global	dist
 161               		.type	dist, @function
 162               	dist:
 163               		.stabd	46,0,0
 164               		.stabs	"gpsmath.c",132,0,0,.Ltext1
 165               	.Ltext1:
   1:gpsmath.c     **** #include <gpsmath.h>
   2:gpsmath.c     **** 
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 4


   3:gpsmath.c     **** 
   4:gpsmath.c     **** double dist(struct waypoint from, struct waypoint to){
 166               		.stabn	68,0,4,.LM0-dist
 167               	.LM0:
 168               	/* prologue: frame size=20 */
 169 0000 2F92      		push r2
 170 0002 3F92      		push r3
 171 0004 4F92      		push r4
 172 0006 5F92      		push r5
 173 0008 6F92      		push r6
 174 000a 7F92      		push r7
 175 000c 8F92      		push r8
 176 000e 9F92      		push r9
 177 0010 AF92      		push r10
 178 0012 BF92      		push r11
 179 0014 CF92      		push r12
 180 0016 DF92      		push r13
 181 0018 EF92      		push r14
 182 001a FF92      		push r15
 183 001c 0F93      		push r16
 184 001e 1F93      		push r17
 185 0020 CF93      		push r28
 186 0022 DF93      		push r29
 187 0024 CDB7      		in r28,__SP_L__
 188 0026 DEB7      		in r29,__SP_H__
 189 0028 6497      		sbiw r28,20
 190 002a 0FB6      		in __tmp_reg__,__SREG__
 191 002c F894      		cli
 192 002e DEBF      		out __SP_H__,r29
 193 0030 0FBE      		out __SREG__,__tmp_reg__
 194 0032 CDBF      		out __SP_L__,r28
 195               	/* prologue end (size=26) */
 196 0034 2983      		std Y+1,r18
 197 0036 3A83      		std Y+2,r19
 198 0038 4B83      		std Y+3,r20
 199 003a 5C83      		std Y+4,r21
 200 003c 6D83      		std Y+5,r22
 201 003e 7E83      		std Y+6,r23
 202 0040 8F83      		std Y+7,r24
 203 0042 9887      		std Y+8,r25
 204 0044 A986      		std Y+9,r10
 205 0046 BA86      		std Y+10,r11
 206 0048 CB86      		std Y+11,r12
 207 004a DC86      		std Y+12,r13
 208 004c ED86      		std Y+13,r14
 209 004e FE86      		std Y+14,r15
 210 0050 0F87      		std Y+15,r16
 211 0052 188B      		std Y+16,r17
   5:gpsmath.c     ****     double a, delta_lat, delta_lon;
   6:gpsmath.c     **** 
   7:gpsmath.c     ****     from.lat = from.lat* M_PI / 180;
 212               		.stabn	68,0,7,.LM1-dist
 213               	.LM1:
 214 0054 6981      		ldd r22,Y+1
 215 0056 7A81      		ldd r23,Y+2
 216 0058 8B81      		ldd r24,Y+3
 217 005a 9C81      		ldd r25,Y+4
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 5


 218 005c 2BED      		ldi r18,lo8(0x40490fdb)
 219 005e 3FE0      		ldi r19,hi8(0x40490fdb)
 220 0060 49E4      		ldi r20,hlo8(0x40490fdb)
 221 0062 50E4      		ldi r21,hhi8(0x40490fdb)
 222 0064 0E94 0000 		call __mulsf3
 223 0068 20E0      		ldi r18,lo8(0x43340000)
 224 006a 30E0      		ldi r19,hi8(0x43340000)
 225 006c 44E3      		ldi r20,hlo8(0x43340000)
 226 006e 53E4      		ldi r21,hhi8(0x43340000)
 227 0070 0E94 0000 		call __divsf3
 228 0074 698B      		std Y+17,r22
 229 0076 7A8B      		std Y+18,r23
 230 0078 8B8B      		std Y+19,r24
 231 007a 9C8B      		std Y+20,r25
   8:gpsmath.c     ****     to.lat = to.lat*M_PI/180;
 232               		.stabn	68,0,8,.LM2-dist
 233               	.LM2:
 234 007c 6985      		ldd r22,Y+9
 235 007e 7A85      		ldd r23,Y+10
 236 0080 8B85      		ldd r24,Y+11
 237 0082 9C85      		ldd r25,Y+12
 238 0084 2BED      		ldi r18,lo8(0x40490fdb)
 239 0086 3FE0      		ldi r19,hi8(0x40490fdb)
 240 0088 49E4      		ldi r20,hlo8(0x40490fdb)
 241 008a 50E4      		ldi r21,hhi8(0x40490fdb)
 242 008c 0E94 0000 		call __mulsf3
 243 0090 20E0      		ldi r18,lo8(0x43340000)
 244 0092 30E0      		ldi r19,hi8(0x43340000)
 245 0094 44E3      		ldi r20,hlo8(0x43340000)
 246 0096 53E4      		ldi r21,hhi8(0x43340000)
 247 0098 0E94 0000 		call __divsf3
 248 009c 1B01      		movw r2,r22
 249 009e 2C01      		movw r4,r24
   9:gpsmath.c     ****     from.lon = from.lon*M_PI/180;
  10:gpsmath.c     ****     to.lon = to.lon*M_PI/180;
  11:gpsmath.c     ****     
  12:gpsmath.c     ****     delta_lat = to.lat - from.lat;
  13:gpsmath.c     ****     delta_lon = to.lon - from.lon;
  14:gpsmath.c     ****     
  15:gpsmath.c     ****     a = sin(delta_lat/2) * sin(delta_lat/2) + cos(from.lat) * cos(to.lat) * sin(delta_lon/2) * sin(
 250               		.stabn	68,0,15,.LM3-dist
 251               	.LM3:
 252 00a0 2989      		ldd r18,Y+17
 253 00a2 3A89      		ldd r19,Y+18
 254 00a4 4B89      		ldd r20,Y+19
 255 00a6 5C89      		ldd r21,Y+20
 256 00a8 0E94 0000 		call __subsf3
 257 00ac 20E0      		ldi r18,lo8(0x3f000000)
 258 00ae 30E0      		ldi r19,hi8(0x3f000000)
 259 00b0 40E0      		ldi r20,hlo8(0x3f000000)
 260 00b2 5FE3      		ldi r21,hhi8(0x3f000000)
 261 00b4 0E94 0000 		call __mulsf3
 262 00b8 0E94 0000 		call sin
 263 00bc 3B01      		movw r6,r22
 264 00be 4C01      		movw r8,r24
 265 00c0 6D85      		ldd r22,Y+13
 266 00c2 7E85      		ldd r23,Y+14
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 6


 267 00c4 8F85      		ldd r24,Y+15
 268 00c6 9889      		ldd r25,Y+16
 269 00c8 2BED      		ldi r18,lo8(0x40490fdb)
 270 00ca 3FE0      		ldi r19,hi8(0x40490fdb)
 271 00cc 49E4      		ldi r20,hlo8(0x40490fdb)
 272 00ce 50E4      		ldi r21,hhi8(0x40490fdb)
 273 00d0 0E94 0000 		call __mulsf3
 274 00d4 20E0      		ldi r18,lo8(0x43340000)
 275 00d6 30E0      		ldi r19,hi8(0x43340000)
 276 00d8 44E3      		ldi r20,hlo8(0x43340000)
 277 00da 53E4      		ldi r21,hhi8(0x43340000)
 278 00dc 0E94 0000 		call __divsf3
 279 00e0 7B01      		movw r14,r22
 280 00e2 8C01      		movw r16,r24
 281 00e4 6D81      		ldd r22,Y+5
 282 00e6 7E81      		ldd r23,Y+6
 283 00e8 8F81      		ldd r24,Y+7
 284 00ea 9885      		ldd r25,Y+8
 285 00ec 2BED      		ldi r18,lo8(0x40490fdb)
 286 00ee 3FE0      		ldi r19,hi8(0x40490fdb)
 287 00f0 49E4      		ldi r20,hlo8(0x40490fdb)
 288 00f2 50E4      		ldi r21,hhi8(0x40490fdb)
 289 00f4 0E94 0000 		call __mulsf3
 290 00f8 20E0      		ldi r18,lo8(0x43340000)
 291 00fa 30E0      		ldi r19,hi8(0x43340000)
 292 00fc 44E3      		ldi r20,hlo8(0x43340000)
 293 00fe 53E4      		ldi r21,hhi8(0x43340000)
 294 0100 0E94 0000 		call __divsf3
 295 0104 9B01      		movw r18,r22
 296 0106 AC01      		movw r20,r24
 297 0108 C801      		movw r24,r16
 298 010a B701      		movw r22,r14
 299 010c 0E94 0000 		call __subsf3
 300 0110 20E0      		ldi r18,lo8(0x3f000000)
 301 0112 30E0      		ldi r19,hi8(0x3f000000)
 302 0114 40E0      		ldi r20,hlo8(0x3f000000)
 303 0116 5FE3      		ldi r21,hhi8(0x3f000000)
 304 0118 0E94 0000 		call __mulsf3
 305 011c 0E94 0000 		call sin
 306 0120 5B01      		movw r10,r22
 307 0122 6C01      		movw r12,r24
 308 0124 A401      		movw r20,r8
 309 0126 9301      		movw r18,r6
 310 0128 C401      		movw r24,r8
 311 012a B301      		movw r22,r6
 312 012c 0E94 0000 		call __mulsf3
 313 0130 3B01      		movw r6,r22
 314 0132 4C01      		movw r8,r24
 315 0134 6989      		ldd r22,Y+17
 316 0136 7A89      		ldd r23,Y+18
 317 0138 8B89      		ldd r24,Y+19
 318 013a 9C89      		ldd r25,Y+20
 319 013c 0E94 0000 		call cos
 320 0140 7B01      		movw r14,r22
 321 0142 8C01      		movw r16,r24
 322 0144 C201      		movw r24,r4
 323 0146 B101      		movw r22,r2
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 7


 324 0148 0E94 0000 		call cos
 325 014c 9B01      		movw r18,r22
 326 014e AC01      		movw r20,r24
 327 0150 C801      		movw r24,r16
 328 0152 B701      		movw r22,r14
 329 0154 0E94 0000 		call __mulsf3
 330 0158 A601      		movw r20,r12
 331 015a 9501      		movw r18,r10
 332 015c 0E94 0000 		call __mulsf3
 333 0160 A601      		movw r20,r12
 334 0162 9501      		movw r18,r10
 335 0164 0E94 0000 		call __mulsf3
 336 0168 9B01      		movw r18,r22
 337 016a AC01      		movw r20,r24
 338 016c C401      		movw r24,r8
 339 016e B301      		movw r22,r6
 340 0170 0E94 0000 		call __addsf3
 341 0174 5B01      		movw r10,r22
 342 0176 6C01      		movw r12,r24
  16:gpsmath.c     ****     a = 2 * atan2(sqrt(a), sqrt(1-a));
 343               		.stabn	68,0,16,.LM4-dist
 344               	.LM4:
 345 0178 9B01      		movw r18,r22
 346 017a AC01      		movw r20,r24
 347 017c 60E0      		ldi r22,lo8(0x3f800000)
 348 017e 70E0      		ldi r23,hi8(0x3f800000)
 349 0180 80E8      		ldi r24,hlo8(0x3f800000)
 350 0182 9FE3      		ldi r25,hhi8(0x3f800000)
 351 0184 0E94 0000 		call __subsf3
 352 0188 0E94 0000 		call sqrt
 353 018c 7B01      		movw r14,r22
 354 018e 8C01      		movw r16,r24
 355 0190 C601      		movw r24,r12
 356 0192 B501      		movw r22,r10
 357 0194 0E94 0000 		call sqrt
 358 0198 A801      		movw r20,r16
 359 019a 9701      		movw r18,r14
 360 019c 0E94 0000 		call atan2
 361 01a0 9B01      		movw r18,r22
 362 01a2 AC01      		movw r20,r24
 363 01a4 0E94 0000 		call __addsf3
 364 01a8 20E0      		ldi r18,lo8(0x45c71800)
 365 01aa 38E1      		ldi r19,hi8(0x45c71800)
 366 01ac 47EC      		ldi r20,hlo8(0x45c71800)
 367 01ae 55E4      		ldi r21,hhi8(0x45c71800)
 368 01b0 0E94 0000 		call __mulsf3
 369               	/* epilogue: frame size=20 */
 370 01b4 6496      		adiw r28,20
 371 01b6 0FB6      		in __tmp_reg__,__SREG__
 372 01b8 F894      		cli
 373 01ba DEBF      		out __SP_H__,r29
 374 01bc 0FBE      		out __SREG__,__tmp_reg__
 375 01be CDBF      		out __SP_L__,r28
 376 01c0 DF91      		pop r29
 377 01c2 CF91      		pop r28
 378 01c4 1F91      		pop r17
 379 01c6 0F91      		pop r16
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 8


 380 01c8 FF90      		pop r15
 381 01ca EF90      		pop r14
 382 01cc DF90      		pop r13
 383 01ce CF90      		pop r12
 384 01d0 BF90      		pop r11
 385 01d2 AF90      		pop r10
 386 01d4 9F90      		pop r9
 387 01d6 8F90      		pop r8
 388 01d8 7F90      		pop r7
 389 01da 6F90      		pop r6
 390 01dc 5F90      		pop r5
 391 01de 4F90      		pop r4
 392 01e0 3F90      		pop r3
 393 01e2 2F90      		pop r2
 394 01e4 0895      		ret
 395               	/* epilogue end (size=25) */
 396               	/* function dist size 243 (192) */
 397               		.size	dist, .-dist
 398               	.Lscope0:
 399               		.stabs	"",36,0,0,.Lscope0-dist
 400               		.stabd	78,0,0
 401               		.stabs	"bearing:F(0,13)",36,0,22,bearing
 402               		.stabs	"from:p(15,1)",160,0,22,1
 403               		.stabs	"to:p(15,1)",160,0,22,9
 404               	.global	bearing
 405               		.type	bearing, @function
 406               	bearing:
 407               		.stabd	46,0,0
  17:gpsmath.c     ****     a = R * a;
  18:gpsmath.c     ****     
  19:gpsmath.c     ****     return a; //in km
  20:gpsmath.c     **** }
  21:gpsmath.c     **** 
  22:gpsmath.c     **** double bearing(struct waypoint from, struct waypoint to){
 408               		.stabn	68,0,22,.LM5-bearing
 409               	.LM5:
 410               	/* prologue: frame size=20 */
 411 01e6 2F92      		push r2
 412 01e8 3F92      		push r3
 413 01ea 4F92      		push r4
 414 01ec 5F92      		push r5
 415 01ee 6F92      		push r6
 416 01f0 7F92      		push r7
 417 01f2 8F92      		push r8
 418 01f4 9F92      		push r9
 419 01f6 AF92      		push r10
 420 01f8 BF92      		push r11
 421 01fa CF92      		push r12
 422 01fc DF92      		push r13
 423 01fe EF92      		push r14
 424 0200 FF92      		push r15
 425 0202 0F93      		push r16
 426 0204 1F93      		push r17
 427 0206 CF93      		push r28
 428 0208 DF93      		push r29
 429 020a CDB7      		in r28,__SP_L__
 430 020c DEB7      		in r29,__SP_H__
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 9


 431 020e 6497      		sbiw r28,20
 432 0210 0FB6      		in __tmp_reg__,__SREG__
 433 0212 F894      		cli
 434 0214 DEBF      		out __SP_H__,r29
 435 0216 0FBE      		out __SREG__,__tmp_reg__
 436 0218 CDBF      		out __SP_L__,r28
 437               	/* prologue end (size=26) */
 438 021a 2983      		std Y+1,r18
 439 021c 3A83      		std Y+2,r19
 440 021e 4B83      		std Y+3,r20
 441 0220 5C83      		std Y+4,r21
 442 0222 6D83      		std Y+5,r22
 443 0224 7E83      		std Y+6,r23
 444 0226 8F83      		std Y+7,r24
 445 0228 9887      		std Y+8,r25
 446 022a A986      		std Y+9,r10
 447 022c BA86      		std Y+10,r11
 448 022e CB86      		std Y+11,r12
 449 0230 DC86      		std Y+12,r13
 450 0232 ED86      		std Y+13,r14
 451 0234 FE86      		std Y+14,r15
 452 0236 0F87      		std Y+15,r16
 453 0238 188B      		std Y+16,r17
  23:gpsmath.c     ****     double a,b;
  24:gpsmath.c     ****     
  25:gpsmath.c     ****     from.lat = from.lat* M_PI / 180;
 454               		.stabn	68,0,25,.LM6-bearing
 455               	.LM6:
 456 023a 6981      		ldd r22,Y+1
 457 023c 7A81      		ldd r23,Y+2
 458 023e 8B81      		ldd r24,Y+3
 459 0240 9C81      		ldd r25,Y+4
 460 0242 2BED      		ldi r18,lo8(0x40490fdb)
 461 0244 3FE0      		ldi r19,hi8(0x40490fdb)
 462 0246 49E4      		ldi r20,hlo8(0x40490fdb)
 463 0248 50E4      		ldi r21,hhi8(0x40490fdb)
 464 024a 0E94 0000 		call __mulsf3
 465 024e 20E0      		ldi r18,lo8(0x43340000)
 466 0250 30E0      		ldi r19,hi8(0x43340000)
 467 0252 44E3      		ldi r20,hlo8(0x43340000)
 468 0254 53E4      		ldi r21,hhi8(0x43340000)
 469 0256 0E94 0000 		call __divsf3
 470 025a 698B      		std Y+17,r22
 471 025c 7A8B      		std Y+18,r23
 472 025e 8B8B      		std Y+19,r24
 473 0260 9C8B      		std Y+20,r25
  26:gpsmath.c     ****     to.lat = to.lat*M_PI/180;
 474               		.stabn	68,0,26,.LM7-bearing
 475               	.LM7:
 476 0262 6985      		ldd r22,Y+9
 477 0264 7A85      		ldd r23,Y+10
 478 0266 8B85      		ldd r24,Y+11
 479 0268 9C85      		ldd r25,Y+12
 480 026a 2BED      		ldi r18,lo8(0x40490fdb)
 481 026c 3FE0      		ldi r19,hi8(0x40490fdb)
 482 026e 49E4      		ldi r20,hlo8(0x40490fdb)
 483 0270 50E4      		ldi r21,hhi8(0x40490fdb)
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 10


 484 0272 0E94 0000 		call __mulsf3
 485 0276 20E0      		ldi r18,lo8(0x43340000)
 486 0278 30E0      		ldi r19,hi8(0x43340000)
 487 027a 44E3      		ldi r20,hlo8(0x43340000)
 488 027c 53E4      		ldi r21,hhi8(0x43340000)
 489 027e 0E94 0000 		call __divsf3
 490 0282 5B01      		movw r10,r22
 491 0284 6C01      		movw r12,r24
  27:gpsmath.c     ****     from.lon = from.lon*M_PI/180;
  28:gpsmath.c     ****     to.lon = to.lon*M_PI/180;
  29:gpsmath.c     ****     
  30:gpsmath.c     ****     a = sin(to.lon - from.lon)*cos(to.lat);
 492               		.stabn	68,0,30,.LM8-bearing
 493               	.LM8:
 494 0286 6D85      		ldd r22,Y+13
 495 0288 7E85      		ldd r23,Y+14
 496 028a 8F85      		ldd r24,Y+15
 497 028c 9889      		ldd r25,Y+16
 498 028e 2BED      		ldi r18,lo8(0x40490fdb)
 499 0290 3FE0      		ldi r19,hi8(0x40490fdb)
 500 0292 49E4      		ldi r20,hlo8(0x40490fdb)
 501 0294 50E4      		ldi r21,hhi8(0x40490fdb)
 502 0296 0E94 0000 		call __mulsf3
 503 029a 20E0      		ldi r18,lo8(0x43340000)
 504 029c 30E0      		ldi r19,hi8(0x43340000)
 505 029e 44E3      		ldi r20,hlo8(0x43340000)
 506 02a0 53E4      		ldi r21,hhi8(0x43340000)
 507 02a2 0E94 0000 		call __divsf3
 508 02a6 7B01      		movw r14,r22
 509 02a8 8C01      		movw r16,r24
 510 02aa 6D81      		ldd r22,Y+5
 511 02ac 7E81      		ldd r23,Y+6
 512 02ae 8F81      		ldd r24,Y+7
 513 02b0 9885      		ldd r25,Y+8
 514 02b2 2BED      		ldi r18,lo8(0x40490fdb)
 515 02b4 3FE0      		ldi r19,hi8(0x40490fdb)
 516 02b6 49E4      		ldi r20,hlo8(0x40490fdb)
 517 02b8 50E4      		ldi r21,hhi8(0x40490fdb)
 518 02ba 0E94 0000 		call __mulsf3
 519 02be 20E0      		ldi r18,lo8(0x43340000)
 520 02c0 30E0      		ldi r19,hi8(0x43340000)
 521 02c2 44E3      		ldi r20,hlo8(0x43340000)
 522 02c4 53E4      		ldi r21,hhi8(0x43340000)
 523 02c6 0E94 0000 		call __divsf3
 524 02ca 9B01      		movw r18,r22
 525 02cc AC01      		movw r20,r24
 526 02ce C801      		movw r24,r16
 527 02d0 B701      		movw r22,r14
 528 02d2 0E94 0000 		call __subsf3
 529 02d6 3B01      		movw r6,r22
 530 02d8 4C01      		movw r8,r24
 531 02da C601      		movw r24,r12
 532 02dc B501      		movw r22,r10
 533 02de 0E94 0000 		call cos
 534 02e2 1B01      		movw r2,r22
 535 02e4 2C01      		movw r4,r24
  31:gpsmath.c     ****     b = cos(from.lat)*sin(to.lat) - sin(from.lat)*cos(to.lat)*cos(to.lon-from.lon);
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 11


 536               		.stabn	68,0,31,.LM9-bearing
 537               	.LM9:
 538 02e6 6989      		ldd r22,Y+17
 539 02e8 7A89      		ldd r23,Y+18
 540 02ea 8B89      		ldd r24,Y+19
 541 02ec 9C89      		ldd r25,Y+20
 542 02ee 0E94 0000 		call cos
 543 02f2 7B01      		movw r14,r22
 544 02f4 8C01      		movw r16,r24
 545 02f6 C601      		movw r24,r12
 546 02f8 B501      		movw r22,r10
 547 02fa 0E94 0000 		call sin
 548 02fe 9B01      		movw r18,r22
 549 0300 AC01      		movw r20,r24
 550 0302 C801      		movw r24,r16
 551 0304 B701      		movw r22,r14
 552 0306 0E94 0000 		call __mulsf3
 553 030a 5B01      		movw r10,r22
 554 030c 6C01      		movw r12,r24
 555 030e 6989      		ldd r22,Y+17
 556 0310 7A89      		ldd r23,Y+18
 557 0312 8B89      		ldd r24,Y+19
 558 0314 9C89      		ldd r25,Y+20
 559 0316 0E94 0000 		call sin
 560 031a A201      		movw r20,r4
 561 031c 9101      		movw r18,r2
 562 031e 0E94 0000 		call __mulsf3
 563 0322 7B01      		movw r14,r22
 564 0324 8C01      		movw r16,r24
 565 0326 C401      		movw r24,r8
 566 0328 B301      		movw r22,r6
 567 032a 0E94 0000 		call cos
 568 032e 9B01      		movw r18,r22
 569 0330 AC01      		movw r20,r24
 570 0332 C801      		movw r24,r16
 571 0334 B701      		movw r22,r14
 572 0336 0E94 0000 		call __mulsf3
 573 033a 9B01      		movw r18,r22
 574 033c AC01      		movw r20,r24
 575 033e C601      		movw r24,r12
 576 0340 B501      		movw r22,r10
 577 0342 0E94 0000 		call __subsf3
 578 0346 7B01      		movw r14,r22
 579 0348 8C01      		movw r16,r24
 580               		.stabn	68,0,30,.LM10-bearing
 581               	.LM10:
 582 034a C401      		movw r24,r8
 583 034c B301      		movw r22,r6
 584 034e 0E94 0000 		call sin
 585 0352 A201      		movw r20,r4
 586 0354 9101      		movw r18,r2
 587 0356 0E94 0000 		call __mulsf3
 588 035a A801      		movw r20,r16
 589 035c 9701      		movw r18,r14
 590 035e 0E94 0000 		call atan2
 591 0362 20E0      		ldi r18,lo8(0x43340000)
 592 0364 30E0      		ldi r19,hi8(0x43340000)
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 12


 593 0366 44E3      		ldi r20,hlo8(0x43340000)
 594 0368 53E4      		ldi r21,hhi8(0x43340000)
 595 036a 0E94 0000 		call __mulsf3
 596 036e 2BED      		ldi r18,lo8(0x40490fdb)
 597 0370 3FE0      		ldi r19,hi8(0x40490fdb)
 598 0372 49E4      		ldi r20,hlo8(0x40490fdb)
 599 0374 50E4      		ldi r21,hhi8(0x40490fdb)
 600 0376 0E94 0000 		call __divsf3
 601               	/* epilogue: frame size=20 */
 602 037a 6496      		adiw r28,20
 603 037c 0FB6      		in __tmp_reg__,__SREG__
 604 037e F894      		cli
 605 0380 DEBF      		out __SP_H__,r29
 606 0382 0FBE      		out __SREG__,__tmp_reg__
 607 0384 CDBF      		out __SP_L__,r28
 608 0386 DF91      		pop r29
 609 0388 CF91      		pop r28
 610 038a 1F91      		pop r17
 611 038c 0F91      		pop r16
 612 038e FF90      		pop r15
 613 0390 EF90      		pop r14
 614 0392 DF90      		pop r13
 615 0394 CF90      		pop r12
 616 0396 BF90      		pop r11
 617 0398 AF90      		pop r10
 618 039a 9F90      		pop r9
 619 039c 8F90      		pop r8
 620 039e 7F90      		pop r7
 621 03a0 6F90      		pop r6
 622 03a2 5F90      		pop r5
 623 03a4 4F90      		pop r4
 624 03a6 3F90      		pop r3
 625 03a8 2F90      		pop r2
 626 03aa 0895      		ret
 627               	/* epilogue end (size=25) */
 628               	/* function bearing size 227 (176) */
 629               		.size	bearing, .-bearing
 630               	.Lscope1:
 631               		.stabs	"",36,0,0,.Lscope1-bearing
 632               		.stabd	78,0,0
 633               		.stabs	"uartswInitBuffers:F(0,15)",36,0,92,uartswInitBuffers
 634               	.global	uartswInitBuffers
 635               		.type	uartswInitBuffers, @function
 636               	uartswInitBuffers:
 637               		.stabd	46,0,0
 638               		.stabs	"uartsw.c",132,0,0,.Ltext2
 639               	.Ltext2:
   1:uartsw.c      **** /*! \file uartsw.c \brief Software Interrupt-driven UART Driver. */
   2:uartsw.c      **** //*****************************************************************************
   3:uartsw.c      **** //
   4:uartsw.c      **** // File Name	: 'uartsw.c'
   5:uartsw.c      **** // Title		: Software Interrupt-driven UART Driver
   6:uartsw.c      **** // Author		: Pascal Stang - Copyright (C) 2002-2004
   7:uartsw.c      **** // Created		: 7/20/2002
   8:uartsw.c      **** // Revised		: 4/27/2004
   9:uartsw.c      **** // Version		: 0.1
  10:uartsw.c      **** // Target MCU	: Atmel AVR Series (intended for the ATmega16 and ATmega32)
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 13


  11:uartsw.c      **** // Editor Tabs	: 4
  12:uartsw.c      **** //
  13:uartsw.c      **** // This code is distributed under the GNU Public License
  14:uartsw.c      **** //		which can be found at http://www.gnu.org/licenses/gpl.txt
  15:uartsw.c      **** //
  16:uartsw.c      **** //*****************************************************************************
  17:uartsw.c      **** 
  18:uartsw.c      **** #include <avr/io.h>
  19:uartsw.c      **** #include <avr/interrupt.h>
  20:uartsw.c      **** 
  21:uartsw.c      **** #include "global.h"
  22:uartsw.c      **** #include "timer.h"
  23:uartsw.c      **** #include "uartsw.h"
  24:uartsw.c      **** 
  25:uartsw.c      **** // Program ROM constants
  26:uartsw.c      **** 
  27:uartsw.c      **** // Global variables
  28:uartsw.c      **** 
  29:uartsw.c      **** // uartsw transmit status and data variables
  30:uartsw.c      **** static volatile u08 UartswTxBusy;
  31:uartsw.c      **** static volatile u08 UartswTxData;
  32:uartsw.c      **** static volatile u08 UartswTxBitNum;
  33:uartsw.c      **** 
  34:uartsw.c      **** // baud rate common to transmit and receive
  35:uartsw.c      **** static volatile u16 UartswBaudRateDiv;
  36:uartsw.c      **** 
  37:uartsw.c      **** // uartsw receive status and data variables
  38:uartsw.c      **** static volatile u08 UartswRxBusy;
  39:uartsw.c      **** static volatile u08 UartswRxData;
  40:uartsw.c      **** static volatile u08 UartswRxBitNum;
  41:uartsw.c      **** // receive buffer
  42:uartsw.c      **** static cBuffer uartswRxBuffer;               ///< uartsw receive buffer
  43:uartsw.c      **** // automatically allocate space in ram for each buffer
  44:uartsw.c      **** static char uartswRxData[UARTSW_RX_BUFFER_SIZE];
  45:uartsw.c      **** static char sentence[20];
  46:uartsw.c      **** 
  47:uartsw.c      **** // functions
  48:uartsw.c      **** 
  49:uartsw.c      **** //! enable and initialize the software uart
  50:uartsw.c      **** void uartswInit(void)
  51:uartsw.c      **** {
  52:uartsw.c      ****     // initialize the buffers
  53:uartsw.c      **** 	uartswInitBuffers();
  54:uartsw.c      **** 	// initialize the ports
  55:uartsw.c      **** 	sbi(UARTSW_TX_DDR, UARTSW_TX_PIN);
  56:uartsw.c      **** 	cbi(UARTSW_RX_DDR, UARTSW_RX_PIN);
  57:uartsw.c      **** 	cbi(UARTSW_RX_PORT, UARTSW_RX_PIN);
  58:uartsw.c      **** 	// initialize baud rate
  59:uartsw.c      **** 	uartswSetBaudRate(19200);
  60:uartsw.c      **** 
  61:uartsw.c      **** 	// setup the transmitter
  62:uartsw.c      **** 	UartswTxBusy = FALSE;
  63:uartsw.c      **** 	// disable OC1A interrupt
  64:uartsw.c      **** 	cbi(TIMSK, OCIE1A);
  65:uartsw.c      **** 	// attach TxBit service routine to OC1A
  66:uartsw.c      **** 	timerAttach(TIMER1OUTCOMPAREA_INT, uartswTxBitService);
  67:uartsw.c      **** 
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 14


  68:uartsw.c      **** 	// setup the receiver
  69:uartsw.c      **** 	UartswRxBusy = FALSE;
  70:uartsw.c      **** 	// disable OC1B interrupt
  71:uartsw.c      **** 	cbi(TIMSK, OCIE1B);
  72:uartsw.c      **** 	// attach RxBit service routine to OC1B
  73:uartsw.c      **** 	timerAttach(TIMER1OUTCOMPAREB_INT, uartswRxBitService);
  74:uartsw.c      **** 	// attach RxBit service routine to ICP
  75:uartsw.c      **** 	timerAttach(TIMER1INPUTCAPTURE_INT, uartswRxBitService);
  76:uartsw.c      **** 	#ifdef UARTSW_INVERT 
  77:uartsw.c      **** 	// trigger on rising edge 
  78:uartsw.c      **** 	sbi(TCCR1B, ICES1); 
  79:uartsw.c      **** 	#else 
  80:uartsw.c      **** 	// trigger on falling edge 
  81:uartsw.c      **** 	cbi(TCCR1B, ICES1); 
  82:uartsw.c      **** 	#endif	
  83:uartsw.c      **** 	// enable ICP interrupt
  84:uartsw.c      **** 	sbi(TIMSK, TICIE1);
  85:uartsw.c      **** 
  86:uartsw.c      **** 	// turn on interrupts
  87:uartsw.c      **** 	sei();
  88:uartsw.c      **** }
  89:uartsw.c      **** 
  90:uartsw.c      **** //! create and initialize the uart buffers
  91:uartsw.c      **** void uartswInitBuffers(void)
  92:uartsw.c      **** {
 640               		.stabn	68,0,92,.LM11-uartswInitBuffers
 641               	.LM11:
 642               	/* prologue: frame size=0 */
 643               	/* prologue end (size=0) */
  93:uartsw.c      **** 	// initialize the UART receive buffer
  94:uartsw.c      **** 	bufferInit(&uartswRxBuffer, uartswRxData, UARTSW_RX_BUFFER_SIZE);
 644               		.stabn	68,0,94,.LM12-uartswInitBuffers
 645               	.LM12:
 646 03ac 40E2      		ldi r20,lo8(32)
 647 03ae 50E0      		ldi r21,hi8(32)
 648 03b0 60E0      		ldi r22,lo8(uartswRxData)
 649 03b2 70E0      		ldi r23,hi8(uartswRxData)
 650 03b4 80E0      		ldi r24,lo8(uartswRxBuffer)
 651 03b6 90E0      		ldi r25,hi8(uartswRxBuffer)
 652 03b8 0E94 0000 		call bufferInit
 653               	/* epilogue: frame size=0 */
 654 03bc 0895      		ret
 655               	/* epilogue end (size=1) */
 656               	/* function uartswInitBuffers size 9 (8) */
 657               		.size	uartswInitBuffers, .-uartswInitBuffers
 658               	.Lscope2:
 659               		.stabs	"",36,0,0,.Lscope2-uartswInitBuffers
 660               		.stabd	78,0,0
 661               		.stabs	"uartswOff:F(0,15)",36,0,99,uartswOff
 662               	.global	uartswOff
 663               		.type	uartswOff, @function
 664               	uartswOff:
 665               		.stabd	46,0,0
  95:uartsw.c      **** }
  96:uartsw.c      **** 
  97:uartsw.c      **** //! turns off software UART
  98:uartsw.c      **** void uartswOff(void)
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 15


  99:uartsw.c      **** {
 666               		.stabn	68,0,99,.LM13-uartswOff
 667               	.LM13:
 668               	/* prologue: frame size=0 */
 669               	/* prologue end (size=0) */
 100:uartsw.c      **** 	// disable interrupts
 101:uartsw.c      **** 	cbi(TIMSK, OCIE1A);
 670               		.stabn	68,0,101,.LM14-uartswOff
 671               	.LM14:
 672 03be 89B7      		in r24,89-0x20
 673 03c0 8F7E      		andi r24,lo8(-17)
 674 03c2 89BF      		out 89-0x20,r24
 102:uartsw.c      **** 	cbi(TIMSK, OCIE1B);
 675               		.stabn	68,0,102,.LM15-uartswOff
 676               	.LM15:
 677 03c4 89B7      		in r24,89-0x20
 678 03c6 877F      		andi r24,lo8(-9)
 679 03c8 89BF      		out 89-0x20,r24
 103:uartsw.c      **** 	cbi(TIMSK, TICIE1);
 680               		.stabn	68,0,103,.LM16-uartswOff
 681               	.LM16:
 682 03ca 89B7      		in r24,89-0x20
 683 03cc 8F7D      		andi r24,lo8(-33)
 684 03ce 89BF      		out 89-0x20,r24
 104:uartsw.c      **** 	// detach the service routines
 105:uartsw.c      **** 	timerDetach(TIMER1OUTCOMPAREA_INT);
 685               		.stabn	68,0,105,.LM17-uartswOff
 686               	.LM17:
 687 03d0 82E0      		ldi r24,lo8(2)
 688 03d2 0E94 0000 		call timerDetach
 106:uartsw.c      **** 	timerDetach(TIMER1OUTCOMPAREB_INT);
 689               		.stabn	68,0,106,.LM18-uartswOff
 690               	.LM18:
 691 03d6 83E0      		ldi r24,lo8(3)
 692 03d8 0E94 0000 		call timerDetach
 107:uartsw.c      **** 	timerDetach(TIMER1INPUTCAPTURE_INT);
 693               		.stabn	68,0,107,.LM19-uartswOff
 694               	.LM19:
 695 03dc 84E0      		ldi r24,lo8(4)
 696 03de 0E94 0000 		call timerDetach
 697               	/* epilogue: frame size=0 */
 698 03e2 0895      		ret
 699               	/* epilogue end (size=1) */
 700               	/* function uartswOff size 19 (18) */
 701               		.size	uartswOff, .-uartswOff
 702               	.Lscope3:
 703               		.stabs	"",36,0,0,.Lscope3-uartswOff
 704               		.stabd	78,0,0
 705               		.stabs	"uartswSetBaudRate:F(0,15)",36,0,111,uartswSetBaudRate
 706               		.stabs	"baudrate:P(7,5)",64,0,110,14
 707               	.global	uartswSetBaudRate
 708               		.type	uartswSetBaudRate, @function
 709               	uartswSetBaudRate:
 710               		.stabd	46,0,0
 108:uartsw.c      **** }
 109:uartsw.c      **** 
 110:uartsw.c      **** void uartswSetBaudRate(u32 baudrate)
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 16


 111:uartsw.c      **** {
 711               		.stabn	68,0,111,.LM20-uartswSetBaudRate
 712               	.LM20:
 713               	/* prologue: frame size=0 */
 714 03e4 EF92      		push r14
 715 03e6 FF92      		push r15
 716 03e8 0F93      		push r16
 717 03ea 1F93      		push r17
 718               	/* prologue end (size=4) */
 719 03ec 7B01      		movw r14,r22
 720 03ee 8C01      		movw r16,r24
 112:uartsw.c      **** 	// set timer prescaler
 113:uartsw.c      **** 	timer1SetPrescaler(TIMER_CLK_DIV1);
 721               		.stabn	68,0,113,.LM21-uartswSetBaudRate
 722               	.LM21:
 723 03f0 81E0      		ldi r24,lo8(1)
 724 03f2 0E94 0000 		call timer1SetPrescaler
 114:uartsw.c      **** 	// calculate division factor for requested baud rate, and set it
 115:uartsw.c      **** 	UartswBaudRateDiv = (u16)((F_CPU+(baudrate/2L))/(baudrate*1L));
 725               		.stabn	68,0,115,.LM22-uartswSetBaudRate
 726               	.LM22:
 727 03f6 C801      		movw r24,r16
 728 03f8 B701      		movw r22,r14
 729 03fa 9695      		lsr r25
 730 03fc 8795      		ror r24
 731 03fe 7795      		ror r23
 732 0400 6795      		ror r22
 733 0402 6050      		subi r22,lo8(-(16000000))
 734 0404 7C4D      		sbci r23,hi8(-(16000000))
 735 0406 8B40      		sbci r24,hlo8(-(16000000))
 736 0408 9F4F      		sbci r25,hhi8(-(16000000))
 737 040a A801      		movw r20,r16
 738 040c 9701      		movw r18,r14
 739 040e 0E94 0000 		call __udivmodsi4
 740 0412 3093 0000 		sts (UartswBaudRateDiv)+1,r19
 741 0416 2093 0000 		sts UartswBaudRateDiv,r18
 742               	/* epilogue: frame size=0 */
 743 041a 1F91      		pop r17
 744 041c 0F91      		pop r16
 745 041e FF90      		pop r15
 746 0420 EF90      		pop r14
 747 0422 0895      		ret
 748               	/* epilogue end (size=5) */
 749               	/* function uartswSetBaudRate size 32 (23) */
 750               		.size	uartswSetBaudRate, .-uartswSetBaudRate
 751               	.Lscope4:
 752               		.stabs	"",36,0,0,.Lscope4-uartswSetBaudRate
 753               		.stabd	78,0,0
 754               		.stabs	"uartswInit:F(0,15)",36,0,51,uartswInit
 755               	.global	uartswInit
 756               		.type	uartswInit, @function
 757               	uartswInit:
 758               		.stabd	46,0,0
 759               		.stabn	68,0,51,.LM23-uartswInit
 760               	.LM23:
 761               	/* prologue: frame size=0 */
 762 0424 0F93      		push r16
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 17


 763 0426 1F93      		push r17
 764               	/* prologue end (size=2) */
 765               		.stabn	68,0,53,.LM24-uartswInit
 766               	.LM24:
 767 0428 0E94 0000 		call uartswInitBuffers
 768               		.stabn	68,0,55,.LM25-uartswInit
 769               	.LM25:
 770 042c 8D9A      		sbi 49-0x20,5
 771               		.stabn	68,0,56,.LM26-uartswInit
 772               	.LM26:
 773 042e 8E98      		cbi 49-0x20,6
 774               		.stabn	68,0,57,.LM27-uartswInit
 775               	.LM27:
 776 0430 9698      		cbi 50-0x20,6
 777               		.stabn	68,0,59,.LM28-uartswInit
 778               	.LM28:
 779 0432 60E0      		ldi r22,lo8(19200)
 780 0434 7BE4      		ldi r23,hi8(19200)
 781 0436 80E0      		ldi r24,hlo8(19200)
 782 0438 90E0      		ldi r25,hhi8(19200)
 783 043a 0E94 0000 		call uartswSetBaudRate
 784               		.stabn	68,0,62,.LM29-uartswInit
 785               	.LM29:
 786 043e 1092 0000 		sts UartswTxBusy,__zero_reg__
 787               		.stabn	68,0,64,.LM30-uartswInit
 788               	.LM30:
 789 0442 89B7      		in r24,89-0x20
 790 0444 8F7E      		andi r24,lo8(-17)
 791 0446 89BF      		out 89-0x20,r24
 792               		.stabn	68,0,66,.LM31-uartswInit
 793               	.LM31:
 794 0448 60E0      		ldi r22,lo8(pm(uartswTxBitService))
 795 044a 70E0      		ldi r23,hi8(pm(uartswTxBitService))
 796 044c 82E0      		ldi r24,lo8(2)
 797 044e 0E94 0000 		call timerAttach
 798               		.stabn	68,0,69,.LM32-uartswInit
 799               	.LM32:
 800 0452 1092 0000 		sts UartswRxBusy,__zero_reg__
 801               		.stabn	68,0,71,.LM33-uartswInit
 802               	.LM33:
 803 0456 89B7      		in r24,89-0x20
 804 0458 877F      		andi r24,lo8(-9)
 805 045a 89BF      		out 89-0x20,r24
 806               		.stabn	68,0,73,.LM34-uartswInit
 807               	.LM34:
 808 045c 00E0      		ldi r16,lo8(pm(uartswRxBitService))
 809 045e 10E0      		ldi r17,hi8(pm(uartswRxBitService))
 810 0460 B801      		movw r22,r16
 811 0462 83E0      		ldi r24,lo8(3)
 812 0464 0E94 0000 		call timerAttach
 813               		.stabn	68,0,75,.LM35-uartswInit
 814               	.LM35:
 815 0468 B801      		movw r22,r16
 816 046a 84E0      		ldi r24,lo8(4)
 817 046c 0E94 0000 		call timerAttach
 818               		.stabn	68,0,81,.LM36-uartswInit
 819               	.LM36:
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 18


 820 0470 8EB5      		in r24,78-0x20
 821 0472 8F7B      		andi r24,lo8(-65)
 822 0474 8EBD      		out 78-0x20,r24
 823               		.stabn	68,0,84,.LM37-uartswInit
 824               	.LM37:
 825 0476 89B7      		in r24,89-0x20
 826 0478 8062      		ori r24,lo8(32)
 827 047a 89BF      		out 89-0x20,r24
 828               		.stabn	68,0,87,.LM38-uartswInit
 829               	.LM38:
 830               	/* #APP */
 831 047c 7894      		sei
 832               	/* #NOAPP */
 833               	/* epilogue: frame size=0 */
 834 047e 1F91      		pop r17
 835 0480 0F91      		pop r16
 836 0482 0895      		ret
 837               	/* epilogue end (size=3) */
 838               	/* function uartswInit size 49 (44) */
 839               		.size	uartswInit, .-uartswInit
 840               	.Lscope5:
 841               		.stabs	"",36,0,0,.Lscope5-uartswInit
 842               		.stabd	78,0,0
 843               		.stabs	"uartswGetRxBuffer:F(0,16)=*(8,3)",36,0,120,uartswGetRxBuffer
 844               	.global	uartswGetRxBuffer
 845               		.type	uartswGetRxBuffer, @function
 846               	uartswGetRxBuffer:
 847               		.stabd	46,0,0
 116:uartsw.c      **** }
 117:uartsw.c      **** 
 118:uartsw.c      **** //! returns the receive buffer structure 
 119:uartsw.c      **** cBuffer* uartswGetRxBuffer(void)
 120:uartsw.c      **** {
 848               		.stabn	68,0,120,.LM39-uartswGetRxBuffer
 849               	.LM39:
 850               	/* prologue: frame size=0 */
 851               	/* prologue end (size=0) */
 121:uartsw.c      **** 	// return rx buffer pointer
 122:uartsw.c      **** 	return &uartswRxBuffer;
 123:uartsw.c      **** }
 852               		.stabn	68,0,123,.LM40-uartswGetRxBuffer
 853               	.LM40:
 854 0484 80E0      		ldi r24,lo8(uartswRxBuffer)
 855 0486 90E0      		ldi r25,hi8(uartswRxBuffer)
 856               	/* epilogue: frame size=0 */
 857 0488 0895      		ret
 858               	/* epilogue end (size=1) */
 859               	/* function uartswGetRxBuffer size 3 (2) */
 860               		.size	uartswGetRxBuffer, .-uartswGetRxBuffer
 861               	.Lscope6:
 862               		.stabs	"",36,0,0,.Lscope6-uartswGetRxBuffer
 863               		.stabd	78,0,0
 864               		.stabs	"uartswSendByte:F(0,15)",36,0,126,uartswSendByte
 865               		.stabs	"data:P(7,1)",64,0,125,25
 866               	.global	uartswSendByte
 867               		.type	uartswSendByte, @function
 868               	uartswSendByte:
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 19


 869               		.stabd	46,0,0
 124:uartsw.c      **** 
 125:uartsw.c      **** void uartswSendByte(u08 data)
 126:uartsw.c      **** {
 870               		.stabn	68,0,126,.LM41-uartswSendByte
 871               	.LM41:
 872               	/* prologue: frame size=0 */
 873               	/* prologue end (size=0) */
 874 048a 982F      		mov r25,r24
 875               	.L17:
 127:uartsw.c      **** 	// wait until uart is ready
 128:uartsw.c      **** 	while(UartswTxBusy);
 876               		.stabn	68,0,128,.LM42-uartswSendByte
 877               	.LM42:
 878 048c 8091 0000 		lds r24,UartswTxBusy
 879 0490 8823      		tst r24
 880 0492 E1F7      		brne .L17
 129:uartsw.c      **** 	// set busy flag
 130:uartsw.c      **** 	UartswTxBusy = TRUE;
 881               		.stabn	68,0,130,.LM43-uartswSendByte
 882               	.LM43:
 883 0494 8FEF      		ldi r24,lo8(-1)
 884 0496 8093 0000 		sts UartswTxBusy,r24
 131:uartsw.c      **** 	// save data
 132:uartsw.c      **** 	UartswTxData = data;
 885               		.stabn	68,0,132,.LM44-uartswSendByte
 886               	.LM44:
 887 049a 9093 0000 		sts UartswTxData,r25
 133:uartsw.c      **** 	// set number of bits (+1 for stop bit)
 134:uartsw.c      **** 	UartswTxBitNum = 9;
 888               		.stabn	68,0,134,.LM45-uartswSendByte
 889               	.LM45:
 890 049e 89E0      		ldi r24,lo8(9)
 891 04a0 8093 0000 		sts UartswTxBitNum,r24
 135:uartsw.c      **** 	
 136:uartsw.c      **** 	// set the start bit
 137:uartsw.c      **** 	#ifdef UARTSW_INVERT
 138:uartsw.c      **** 	sbi(UARTSW_TX_PORT, UARTSW_TX_PIN);
 139:uartsw.c      **** 	#else
 140:uartsw.c      **** 	cbi(UARTSW_TX_PORT, UARTSW_TX_PIN);
 892               		.stabn	68,0,140,.LM46-uartswSendByte
 893               	.LM46:
 894 04a4 9598      		cbi 50-0x20,5
 141:uartsw.c      **** 	#endif
 142:uartsw.c      **** 
 143:uartsw.c      **** 	// schedule the next bit
 144:uartsw.c      **** 	outw(OCR1A, inw(TCNT1) + UartswBaudRateDiv);
 895               		.stabn	68,0,144,.LM47-uartswSendByte
 896               	.LM47:
 897 04a6 8CB5      		in r24,76-0x20
 898 04a8 9DB5      		in r25,(76)+1-0x20
 899 04aa 2091 0000 		lds r18,UartswBaudRateDiv
 900 04ae 3091 0000 		lds r19,(UartswBaudRateDiv)+1
 901 04b2 820F      		add r24,r18
 902 04b4 931F      		adc r25,r19
 903 04b6 9BBD      		out (74)+1-0x20,r25
 904 04b8 8ABD      		out 74-0x20,r24
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 20


 145:uartsw.c      **** 	// enable OC1A interrupt
 146:uartsw.c      **** 	sbi(TIMSK, OCIE1A);
 905               		.stabn	68,0,146,.LM48-uartswSendByte
 906               	.LM48:
 907 04ba 89B7      		in r24,89-0x20
 908 04bc 8061      		ori r24,lo8(16)
 909 04be 89BF      		out 89-0x20,r24
 910               	/* epilogue: frame size=0 */
 911 04c0 0895      		ret
 912               	/* epilogue end (size=1) */
 913               	/* function uartswSendByte size 28 (27) */
 914               		.size	uartswSendByte, .-uartswSendByte
 915               	.Lscope7:
 916               		.stabs	"",36,0,0,.Lscope7-uartswSendByte
 917               		.stabd	78,0,0
 918               		.stabs	"uartswReceiveByte:F(7,1)",36,0,151,uartswReceiveByte
 919               		.stabs	"rxData:P(0,17)=*(7,1)",64,0,150,28
 920               	.global	uartswReceiveByte
 921               		.type	uartswReceiveByte, @function
 922               	uartswReceiveByte:
 923               		.stabd	46,0,0
 147:uartsw.c      **** }
 148:uartsw.c      **** 
 149:uartsw.c      **** //! gets a byte (if available) from the uart receive buffer
 150:uartsw.c      **** u08 uartswReceiveByte(u08* rxData)
 151:uartsw.c      **** {
 924               		.stabn	68,0,151,.LM49-uartswReceiveByte
 925               	.LM49:
 926               	/* prologue: frame size=0 */
 927 04c2 CF93      		push r28
 928 04c4 DF93      		push r29
 929               	/* prologue end (size=2) */
 930 04c6 EC01      		movw r28,r24
 152:uartsw.c      **** 	// make sure we have a receive buffer
 153:uartsw.c      **** 	if(uartswRxBuffer.size)
 931               		.stabn	68,0,153,.LM50-uartswReceiveByte
 932               	.LM50:
 933 04c8 8091 0000 		lds r24,uartswRxBuffer+2
 934 04cc 9091 0000 		lds r25,(uartswRxBuffer+2)+1
 935 04d0 892B      		or r24,r25
 936 04d2 71F0      		breq .L23
 154:uartsw.c      **** 	{
 155:uartsw.c      **** 		// make sure we have data
 156:uartsw.c      **** 		if(uartswRxBuffer.datalength)
 937               		.stabn	68,0,156,.LM51-uartswReceiveByte
 938               	.LM51:
 939 04d4 8091 0000 		lds r24,uartswRxBuffer+4
 940 04d8 9091 0000 		lds r25,(uartswRxBuffer+4)+1
 941 04dc 892B      		or r24,r25
 942 04de 41F0      		breq .L23
 157:uartsw.c      **** 		{
 158:uartsw.c      **** 			// get byte from beginning of buffer
 159:uartsw.c      **** 			*rxData = bufferGetFromFront(&uartswRxBuffer);
 943               		.stabn	68,0,159,.LM52-uartswReceiveByte
 944               	.LM52:
 945 04e0 80E0      		ldi r24,lo8(uartswRxBuffer)
 946 04e2 90E0      		ldi r25,hi8(uartswRxBuffer)
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 21


 947 04e4 0E94 0000 		call bufferGetFromFront
 948 04e8 8883      		st Y,r24
 949 04ea 8FEF      		ldi r24,lo8(255)
 950 04ec 90E0      		ldi r25,hi8(255)
 951 04ee 02C0      		rjmp .L26
 952               	.L23:
 160:uartsw.c      **** 			return TRUE;
 953               		.stabn	68,0,160,.LM53-uartswReceiveByte
 954               	.LM53:
 955 04f0 80E0      		ldi r24,lo8(0)
 956 04f2 90E0      		ldi r25,hi8(0)
 957               	.L26:
 958               	/* epilogue: frame size=0 */
 959 04f4 DF91      		pop r29
 960 04f6 CF91      		pop r28
 961 04f8 0895      		ret
 962               	/* epilogue end (size=3) */
 963               	/* function uartswReceiveByte size 28 (23) */
 964               		.size	uartswReceiveByte, .-uartswReceiveByte
 965               	.Lscope8:
 966               		.stabs	"",36,0,0,.Lscope8-uartswReceiveByte
 967               		.stabd	78,0,0
 968               		.stabs	"uartswTxBitService:F(0,15)",36,0,176,uartswTxBitService
 969               	.global	uartswTxBitService
 970               		.type	uartswTxBitService, @function
 971               	uartswTxBitService:
 972               		.stabd	46,0,0
 161:uartsw.c      **** 		}
 162:uartsw.c      **** 		else
 163:uartsw.c      **** 		{
 164:uartsw.c      **** 			// no data
 165:uartsw.c      **** 			return FALSE;
 166:uartsw.c      **** 		}
 167:uartsw.c      **** 	}
 168:uartsw.c      **** 	else
 169:uartsw.c      **** 	{
 170:uartsw.c      **** 		// no buffer
 171:uartsw.c      **** 		return FALSE;
 172:uartsw.c      **** 	}
 173:uartsw.c      **** }
 174:uartsw.c      **** 
 175:uartsw.c      **** void uartswTxBitService(void)
 176:uartsw.c      **** {
 973               		.stabn	68,0,176,.LM54-uartswTxBitService
 974               	.LM54:
 975               	/* prologue: frame size=0 */
 976               	/* prologue end (size=0) */
 177:uartsw.c      **** 	if(UartswTxBitNum)
 977               		.stabn	68,0,177,.LM55-uartswTxBitService
 978               	.LM55:
 979 04fa 8091 0000 		lds r24,UartswTxBitNum
 980 04fe 8823      		tst r24
 981 0500 11F1      		breq .L29
 178:uartsw.c      **** 	{
 179:uartsw.c      **** 		// there are bits still waiting to be transmitted
 180:uartsw.c      **** 		if(UartswTxBitNum > 1)
 982               		.stabn	68,0,180,.LM56-uartswTxBitService
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 22


 983               	.LM56:
 984 0502 8091 0000 		lds r24,UartswTxBitNum
 985 0506 8230      		cpi r24,lo8(2)
 986 0508 68F0      		brlo .L31
 181:uartsw.c      **** 		{
 182:uartsw.c      **** 			// transmit data bits (inverted, LSB first)
 183:uartsw.c      **** 			#ifdef UARTSW_INVERT
 184:uartsw.c      **** 			if( !(UartswTxData & 0x01) )
 185:uartsw.c      **** 			#else
 186:uartsw.c      **** 			if( (UartswTxData & 0x01) )
 987               		.stabn	68,0,186,.LM57-uartswTxBitService
 988               	.LM57:
 989 050a 8091 0000 		lds r24,UartswTxData
 990 050e 80FF      		sbrs r24,0
 991 0510 02C0      		rjmp .L33
 187:uartsw.c      **** 			#endif
 188:uartsw.c      **** 				sbi(UARTSW_TX_PORT, UARTSW_TX_PIN);
 992               		.stabn	68,0,188,.LM58-uartswTxBitService
 993               	.LM58:
 994 0512 959A      		sbi 50-0x20,5
 995 0514 01C0      		rjmp .L35
 996               	.L33:
 189:uartsw.c      **** 			else
 190:uartsw.c      **** 				cbi(UARTSW_TX_PORT, UARTSW_TX_PIN);
 997               		.stabn	68,0,190,.LM59-uartswTxBitService
 998               	.LM59:
 999 0516 9598      		cbi 50-0x20,5
 1000               	.L35:
 191:uartsw.c      **** 			// shift bits down
 192:uartsw.c      **** 			UartswTxData = UartswTxData>>1;
 1001               		.stabn	68,0,192,.LM60-uartswTxBitService
 1002               	.LM60:
 1003 0518 8091 0000 		lds r24,UartswTxData
 1004 051c 8695      		lsr r24
 1005 051e 8093 0000 		sts UartswTxData,r24
 1006 0522 01C0      		rjmp .L36
 1007               	.L31:
 193:uartsw.c      **** 		}
 194:uartsw.c      **** 		else
 195:uartsw.c      **** 		{
 196:uartsw.c      **** 			// transmit stop bit
 197:uartsw.c      **** 			#ifdef UARTSW_INVERT
 198:uartsw.c      **** 			cbi(UARTSW_TX_PORT, UARTSW_TX_PIN);
 199:uartsw.c      **** 			#else
 200:uartsw.c      **** 			sbi(UARTSW_TX_PORT, UARTSW_TX_PIN);
 1008               		.stabn	68,0,200,.LM61-uartswTxBitService
 1009               	.LM61:
 1010 0524 959A      		sbi 50-0x20,5
 1011               	.L36:
 201:uartsw.c      **** 			#endif
 202:uartsw.c      **** 		}
 203:uartsw.c      **** 		// schedule the next bit
 204:uartsw.c      **** 		outw(OCR1A, inw(OCR1A) + UartswBaudRateDiv);
 1012               		.stabn	68,0,204,.LM62-uartswTxBitService
 1013               	.LM62:
 1014 0526 8AB5      		in r24,74-0x20
 1015 0528 9BB5      		in r25,(74)+1-0x20
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 23


 1016 052a 2091 0000 		lds r18,UartswBaudRateDiv
 1017 052e 3091 0000 		lds r19,(UartswBaudRateDiv)+1
 1018 0532 820F      		add r24,r18
 1019 0534 931F      		adc r25,r19
 1020 0536 9BBD      		out (74)+1-0x20,r25
 1021 0538 8ABD      		out 74-0x20,r24
 205:uartsw.c      **** 		// count down
 206:uartsw.c      **** 		UartswTxBitNum--;
 1022               		.stabn	68,0,206,.LM63-uartswTxBitService
 1023               	.LM63:
 1024 053a 8091 0000 		lds r24,UartswTxBitNum
 1025 053e 8150      		subi r24,lo8(-(-1))
 1026 0540 8093 0000 		sts UartswTxBitNum,r24
 1027 0544 0895      		ret
 1028               	.L29:
 207:uartsw.c      **** 	}
 208:uartsw.c      **** 	else
 209:uartsw.c      **** 	{
 210:uartsw.c      **** 		// transmission is done
 211:uartsw.c      **** 		// clear busy flag
 212:uartsw.c      **** 		UartswTxBusy = FALSE;
 1029               		.stabn	68,0,212,.LM64-uartswTxBitService
 1030               	.LM64:
 1031 0546 1092 0000 		sts UartswTxBusy,__zero_reg__
 1032 054a 0895      		ret
 1033               	/* epilogue: frame size=0 */
 1034               	/* epilogue: noreturn */
 1035               	/* epilogue end (size=0) */
 1036               	/* function uartswTxBitService size 41 (41) */
 1037               		.size	uartswTxBitService, .-uartswTxBitService
 1038               	.Lscope9:
 1039               		.stabs	"",36,0,0,.Lscope9-uartswTxBitService
 1040               		.stabd	78,0,0
 1041               		.stabs	"uartswRxBitService:F(0,15)",36,0,217,uartswRxBitService
 1042               	.global	uartswRxBitService
 1043               		.type	uartswRxBitService, @function
 1044               	uartswRxBitService:
 1045               		.stabd	46,0,0
 213:uartsw.c      **** 	}
 214:uartsw.c      **** }
 215:uartsw.c      **** 
 216:uartsw.c      **** void uartswRxBitService(void)
 217:uartsw.c      **** {
 1046               		.stabn	68,0,217,.LM65-uartswRxBitService
 1047               	.LM65:
 1048               	/* prologue: frame size=0 */
 1049 054c 1F93      		push r17
 1050 054e CF93      		push r28
 1051 0550 DF93      		push r29
 1052               	/* prologue end (size=3) */
 218:uartsw.c      **** 	// this function runs on either:
 219:uartsw.c      **** 	// - a rising edge interrupt
 220:uartsw.c      **** 	// - OC1B
 221:uartsw.c      **** 	u08 c=0;
 222:uartsw.c      **** 	u08 string_length;
 223:uartsw.c      **** 	
 224:uartsw.c      **** 	if(!UartswRxBusy)
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 24


 1053               		.stabn	68,0,224,.LM66-uartswRxBitService
 1054               	.LM66:
 1055 0552 8091 0000 		lds r24,UartswRxBusy
 1056 0556 8823      		tst r24
 1057 0558 19F5      		brne .L40
 225:uartsw.c      **** 	{
 226:uartsw.c      **** 		// this is a start bit
 227:uartsw.c      **** 		// disable ICP interrupt
 228:uartsw.c      **** 		cbi(TIMSK, TICIE1);
 1058               		.stabn	68,0,228,.LM67-uartswRxBitService
 1059               	.LM67:
 1060 055a 89B7      		in r24,89-0x20
 1061 055c 8F7D      		andi r24,lo8(-33)
 1062 055e 89BF      		out 89-0x20,r24
 229:uartsw.c      **** 		// schedule data bit sampling 1.5 bit periods from now
 230:uartsw.c      **** 		outw(OCR1B, inw(TCNT1) + UartswBaudRateDiv + UartswBaudRateDiv/2);
 1063               		.stabn	68,0,230,.LM68-uartswRxBitService
 1064               	.LM68:
 1065 0560 2CB5      		in r18,76-0x20
 1066 0562 3DB5      		in r19,(76)+1-0x20
 1067 0564 4091 0000 		lds r20,UartswBaudRateDiv
 1068 0568 5091 0000 		lds r21,(UartswBaudRateDiv)+1
 1069 056c 8091 0000 		lds r24,UartswBaudRateDiv
 1070 0570 9091 0000 		lds r25,(UartswBaudRateDiv)+1
 1071 0574 240F      		add r18,r20
 1072 0576 351F      		adc r19,r21
 1073 0578 9695      		lsr r25
 1074 057a 8795      		ror r24
 1075 057c 280F      		add r18,r24
 1076 057e 391F      		adc r19,r25
 1077 0580 39BD      		out (72)+1-0x20,r19
 1078 0582 28BD      		out 72-0x20,r18
 231:uartsw.c      **** 		// clear OC1B interrupt flag
 232:uartsw.c      **** 		sbi(TIFR, OCF1B);
 1079               		.stabn	68,0,232,.LM69-uartswRxBitService
 1080               	.LM69:
 1081 0584 88B7      		in r24,88-0x20
 1082 0586 8860      		ori r24,lo8(8)
 1083 0588 88BF      		out 88-0x20,r24
 233:uartsw.c      **** 		// enable OC1B interrupt
 234:uartsw.c      **** 		sbi(TIMSK, OCIE1B);
 1084               		.stabn	68,0,234,.LM70-uartswRxBitService
 1085               	.LM70:
 1086 058a 89B7      		in r24,89-0x20
 1087 058c 8860      		ori r24,lo8(8)
 1088 058e 89BF      		out 89-0x20,r24
 235:uartsw.c      **** 		// set start bit flag
 236:uartsw.c      **** 		UartswRxBusy = TRUE;
 1089               		.stabn	68,0,236,.LM71-uartswRxBitService
 1090               	.LM71:
 1091 0590 8FEF      		ldi r24,lo8(-1)
 1092 0592 8093 0000 		sts UartswRxBusy,r24
 237:uartsw.c      **** 		// reset bit counter
 238:uartsw.c      **** 		UartswRxBitNum = 0;
 1093               		.stabn	68,0,238,.LM72-uartswRxBitService
 1094               	.LM72:
 1095 0596 1092 0000 		sts UartswRxBitNum,__zero_reg__
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 25


 239:uartsw.c      **** 		// reset data
 240:uartsw.c      **** 		UartswRxData = 0;
 1096               		.stabn	68,0,240,.LM73-uartswRxBitService
 1097               	.LM73:
 1098 059a 1092 0000 		sts UartswRxData,__zero_reg__
 1099 059e 72C0      		rjmp .L56
 1100               	.L40:
 241:uartsw.c      **** 	}
 242:uartsw.c      **** 	else
 243:uartsw.c      **** 	{
 244:uartsw.c      **** 		// start bit has already been received
 245:uartsw.c      **** 		// we're in the data bits
 246:uartsw.c      **** 		
 247:uartsw.c      **** 		// shift data byte to make room for new bit
 248:uartsw.c      **** 		UartswRxData = UartswRxData>>1;
 1101               		.stabn	68,0,248,.LM74-uartswRxBitService
 1102               	.LM74:
 1103 05a0 8091 0000 		lds r24,UartswRxData
 1104 05a4 8695      		lsr r24
 1105 05a6 8093 0000 		sts UartswRxData,r24
 249:uartsw.c      **** 
 250:uartsw.c      **** 		// sample the data line
 251:uartsw.c      **** 		#ifdef UARTSW_INVERT
 252:uartsw.c      **** 		if( !(inb(UARTSW_RX_PORTIN) & (1<<UARTSW_RX_PIN)) )
 253:uartsw.c      **** 		#else
 254:uartsw.c      **** 		if( (inb(UARTSW_RX_PORTIN) & (1<<UARTSW_RX_PIN)) )
 1106               		.stabn	68,0,254,.LM75-uartswRxBitService
 1107               	.LM75:
 1108 05aa 869B      		sbis 48-0x20,6
 1109 05ac 05C0      		rjmp .L43
 255:uartsw.c      **** 		#endif
 256:uartsw.c      **** 		{
 257:uartsw.c      **** 			// serial line is marking
 258:uartsw.c      **** 			// record '1' bit
 259:uartsw.c      **** 			UartswRxData |= 0x80;
 1110               		.stabn	68,0,259,.LM76-uartswRxBitService
 1111               	.LM76:
 1112 05ae 8091 0000 		lds r24,UartswRxData
 1113 05b2 8068      		ori r24,lo8(-128)
 1114 05b4 8093 0000 		sts UartswRxData,r24
 1115               	.L43:
 260:uartsw.c      **** 		}
 261:uartsw.c      **** 
 262:uartsw.c      **** 		// increment bit counter
 263:uartsw.c      **** 		UartswRxBitNum++;
 1116               		.stabn	68,0,263,.LM77-uartswRxBitService
 1117               	.LM77:
 1118 05b8 8091 0000 		lds r24,UartswRxBitNum
 1119 05bc 8F5F      		subi r24,lo8(-(1))
 1120 05be 8093 0000 		sts UartswRxBitNum,r24
 264:uartsw.c      **** 		// schedule next bit sample
 265:uartsw.c      **** 		outw(OCR1B, inw(OCR1B) + UartswBaudRateDiv);
 1121               		.stabn	68,0,265,.LM78-uartswRxBitService
 1122               	.LM78:
 1123 05c2 88B5      		in r24,72-0x20
 1124 05c4 99B5      		in r25,(72)+1-0x20
 1125 05c6 2091 0000 		lds r18,UartswBaudRateDiv
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 26


 1126 05ca 3091 0000 		lds r19,(UartswBaudRateDiv)+1
 1127 05ce 820F      		add r24,r18
 1128 05d0 931F      		adc r25,r19
 1129 05d2 99BD      		out (72)+1-0x20,r25
 1130 05d4 88BD      		out 72-0x20,r24
 266:uartsw.c      **** 
 267:uartsw.c      **** 		// check if we have a full byte
 268:uartsw.c      **** 		if(UartswRxBitNum >= 8)
 1131               		.stabn	68,0,268,.LM79-uartswRxBitService
 1132               	.LM79:
 1133 05d6 8091 0000 		lds r24,UartswRxBitNum
 1134 05da 8830      		cpi r24,lo8(8)
 1135 05dc 08F4      		brsh .+2
 1136 05de 52C0      		rjmp .L56
 269:uartsw.c      **** 		{
 270:uartsw.c      **** 			// save data in receive buffer
 271:uartsw.c      **** 			// if \r then add to our 'sentence' buffer
 272:uartsw.c      **** 			if(UartswRxData == ',')
 1137               		.stabn	68,0,272,.LM80-uartswRxBitService
 1138               	.LM80:
 1139 05e0 8091 0000 		lds r24,UartswRxData
 1140 05e4 8C32      		cpi r24,lo8(44)
 1141 05e6 D9F4      		brne .L46
 273:uartsw.c      **** 			{
 274:uartsw.c      **** 				if(uartswRxBuffer.datalength<8)
 1142               		.stabn	68,0,274,.LM81-uartswRxBitService
 1143               	.LM81:
 1144 05e8 8091 0000 		lds r24,uartswRxBuffer+4
 1145 05ec 9091 0000 		lds r25,(uartswRxBuffer+4)+1
 1146 05f0 0897      		sbiw r24,8
 1147 05f2 40F4      		brsh .L48
 275:uartsw.c      **** 				{
 276:uartsw.c      **** 					bufferAddToEnd(&uartswRxBuffer, UartswRxData);
 1148               		.stabn	68,0,276,.LM82-uartswRxBitService
 1149               	.LM82:
 1150 05f4 6091 0000 		lds r22,UartswRxData
 1151 05f8 80E0      		ldi r24,lo8(uartswRxBuffer)
 1152 05fa 90E0      		ldi r25,hi8(uartswRxBuffer)
 1153 05fc 0E94 0000 		call bufferAddToEnd
 277:uartsw.c      **** 					bufferAddToEnd(&uartswRxBuffer, 'q');
 1154               		.stabn	68,0,277,.LM83-uartswRxBitService
 1155               	.LM83:
 1156 0600 61E7      		ldi r22,lo8(113)
 1157 0602 07C0      		rjmp .L60
 1158               	.L48:
 278:uartsw.c      **** 					bufferAddToEnd(&uartswRxBuffer, ' ');
 279:uartsw.c      **** 				}
 280:uartsw.c      **** 				else
 281:uartsw.c      **** 				{
 282:uartsw.c      **** 					bufferAddToEnd(&uartswRxBuffer, UartswRxData);
 1159               		.stabn	68,0,282,.LM84-uartswRxBitService
 1160               	.LM84:
 1161 0604 6091 0000 		lds r22,UartswRxData
 1162 0608 80E0      		ldi r24,lo8(uartswRxBuffer)
 1163 060a 90E0      		ldi r25,hi8(uartswRxBuffer)
 1164 060c 0E94 0000 		call bufferAddToEnd
 283:uartsw.c      **** 					bufferAddToEnd(&uartswRxBuffer, 'w');
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 27


 1165               		.stabn	68,0,283,.LM85-uartswRxBitService
 1166               	.LM85:
 1167 0610 67E7      		ldi r22,lo8(119)
 1168               	.L60:
 1169 0612 80E0      		ldi r24,lo8(uartswRxBuffer)
 1170 0614 90E0      		ldi r25,hi8(uartswRxBuffer)
 1171 0616 0E94 0000 		call bufferAddToEnd
 284:uartsw.c      **** 					bufferAddToEnd(&uartswRxBuffer, ' ');
 1172               		.stabn	68,0,284,.LM86-uartswRxBitService
 1173               	.LM86:
 1174 061a 60E2      		ldi r22,lo8(32)
 1175 061c 24C0      		rjmp .L59
 1176               	.L46:
 285:uartsw.c      **** 				}
 286:uartsw.c      **** 			}
 287:uartsw.c      **** 			//Since device sends /r/n, /r is used to xfer all data to the storage buffer (sentence)
 288:uartsw.c      **** 			//This would be a good place to store them into a variable instead, and parse
 289:uartsw.c      **** 			//But for now it would save time to fix it in the python instead.
 290:uartsw.c      **** 			else if(UartswRxData == '\r') 
 1177               		.stabn	68,0,290,.LM87-uartswRxBitService
 1178               	.LM87:
 1179 061e 8091 0000 		lds r24,UartswRxData
 1180 0622 8D30      		cpi r24,lo8(13)
 1181 0624 D1F4      		brne .L51
 291:uartsw.c      **** 			{
 292:uartsw.c      **** 				string_length = uartswRxBuffer.datalength;
 1182               		.stabn	68,0,292,.LM88-uartswRxBitService
 1183               	.LM88:
 1184 0626 1091 0000 		lds r17,uartswRxBuffer+4
 1185 062a C0E0      		ldi r28,lo8(0)
 1186 062c D0E0      		ldi r29,hi8(0)
 1187               	.L53:
 293:uartsw.c      **** 				for(c=0;c<=string_length;++c)
 294:uartsw.c      **** 				{
 295:uartsw.c      **** 					sentence[c] = bufferGetFromFront(&uartswRxBuffer);
 1188               		.stabn	68,0,295,.LM89-uartswRxBitService
 1189               	.LM89:
 1190 062e 80E0      		ldi r24,lo8(uartswRxBuffer)
 1191 0630 90E0      		ldi r25,hi8(uartswRxBuffer)
 1192 0632 0E94 0000 		call bufferGetFromFront
 1193 0636 EC2F      		mov r30,r28
 1194 0638 FF27      		clr r31
 1195 063a E050      		subi r30,lo8(-(sentence))
 1196 063c F040      		sbci r31,hi8(-(sentence))
 1197 063e 8083      		st Z,r24
 1198 0640 2196      		adiw r28,1
 1199               		.stabn	68,0,293,.LM90-uartswRxBitService
 1200               	.LM90:
 1201 0642 1C17      		cp r17,r28
 1202 0644 A0F7      		brsh .L53
 296:uartsw.c      **** 				}
 297:uartsw.c      **** 				sentence[c] = '\0';
 1203               		.stabn	68,0,297,.LM91-uartswRxBitService
 1204               	.LM91:
 1205 0646 EC2F      		mov r30,r28
 1206 0648 FF27      		clr r31
 1207 064a E050      		subi r30,lo8(-(sentence))
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 28


 1208 064c F040      		sbci r31,hi8(-(sentence))
 1209 064e 1082      		st Z,__zero_reg__
 298:uartsw.c      **** 				bufferFlush(&uartswRxBuffer);
 1210               		.stabn	68,0,298,.LM92-uartswRxBitService
 1211               	.LM92:
 1212 0650 80E0      		ldi r24,lo8(uartswRxBuffer)
 1213 0652 90E0      		ldi r25,hi8(uartswRxBuffer)
 1214 0654 0E94 0000 		call bufferFlush
 1215 0658 0AC0      		rjmp .L50
 1216               	.L51:
 299:uartsw.c      **** 				
 300:uartsw.c      **** 			}
 301:uartsw.c      **** 			else
 302:uartsw.c      **** 				if(UartswRxData != '\n') bufferAddToEnd(&uartswRxBuffer, UartswRxData); // save data in receive
 1217               		.stabn	68,0,302,.LM93-uartswRxBitService
 1218               	.LM93:
 1219 065a 8091 0000 		lds r24,UartswRxData
 1220 065e 8A30      		cpi r24,lo8(10)
 1221 0660 31F0      		breq .L50
 1222 0662 6091 0000 		lds r22,UartswRxData
 1223               	.L59:
 1224 0666 80E0      		ldi r24,lo8(uartswRxBuffer)
 1225 0668 90E0      		ldi r25,hi8(uartswRxBuffer)
 1226 066a 0E94 0000 		call bufferAddToEnd
 1227               	.L50:
 303:uartsw.c      **** 			// disable OC1B interrupt
 304:uartsw.c      **** 			cbi(TIMSK, OCIE1B);
 1228               		.stabn	68,0,304,.LM94-uartswRxBitService
 1229               	.LM94:
 1230 066e 89B7      		in r24,89-0x20
 1231 0670 877F      		andi r24,lo8(-9)
 1232 0672 89BF      		out 89-0x20,r24
 305:uartsw.c      **** 			// clear ICP interrupt flag
 306:uartsw.c      **** 			sbi(TIFR, ICF1);
 1233               		.stabn	68,0,306,.LM95-uartswRxBitService
 1234               	.LM95:
 1235 0674 88B7      		in r24,88-0x20
 1236 0676 8062      		ori r24,lo8(32)
 1237 0678 88BF      		out 88-0x20,r24
 307:uartsw.c      **** 			// enable ICP interrupt
 308:uartsw.c      **** 			sbi(TIMSK, TICIE1);
 1238               		.stabn	68,0,308,.LM96-uartswRxBitService
 1239               	.LM96:
 1240 067a 89B7      		in r24,89-0x20
 1241 067c 8062      		ori r24,lo8(32)
 1242 067e 89BF      		out 89-0x20,r24
 309:uartsw.c      **** 			// clear start bit flag
 310:uartsw.c      **** 			UartswRxBusy = FALSE;
 1243               		.stabn	68,0,310,.LM97-uartswRxBitService
 1244               	.LM97:
 1245 0680 1092 0000 		sts UartswRxBusy,__zero_reg__
 1246               	.L56:
 1247               	/* epilogue: frame size=0 */
 1248 0684 DF91      		pop r29
 1249 0686 CF91      		pop r28
 1250 0688 1F91      		pop r17
 1251 068a 0895      		ret
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 29


 1252               	/* epilogue end (size=4) */
 1253               	/* function uartswRxBitService size 161 (154) */
 1254               		.size	uartswRxBitService, .-uartswRxBitService
 1255               		.stabs	"string_length:r(7,1)",64,0,222,17
 1256               		.stabn	192,0,0,uartswRxBitService-uartswRxBitService
 1257               		.stabn	224,0,0,.Lscope10-uartswRxBitService
 1258               	.Lscope10:
 1259               		.stabs	"",36,0,0,.Lscope10-uartswRxBitService
 1260               		.stabd	78,0,0
 1261               		.section	.progmem.data,"a",@progbits
 1262               		.type	__c.1996, @object
 1263               		.size	__c.1996, 46
 1264               	__c.1996:
 1265 0000 0D0A 2057 		.string	"\r\n We come in peace!  We mean you no harm.\r\n "
 1265      6520 636F 
 1265      6D65 2069 
 1265      6E20 7065 
 1265      6163 6521 
 1266               		.type	__c.1993, @object
 1267               		.size	__c.1993, 46
 1268               	__c.1993:
 1269 002e 0D0A 2057 		.string	"\r\n We come in peace!  We mean you no harm.\r\n "
 1269      6520 636F 
 1269      6D65 2069 
 1269      6E20 7065 
 1269      6163 6521 
 1270               		.type	__c.1990, @object
 1271               		.size	__c.1990, 131
 1272               	__c.1990:
 1273 005c 0D0A 5768 		.ascii	"\r\nWhat do we want?  Heybeas corpuss!  When do we want it? "
 1273      6174 2064 
 1273      6F20 7765 
 1273      2077 616E 
 1273      743F 2020 
 1274 0096 2057 6520 		.ascii	" We alre"
 1274      616C 7265 
 1275 009e 6164 7920 		.string	"ady have the right, but the right is being illegaly violated!\r\n "
 1275      6861 7665 
 1275      2074 6865 
 1275      2072 6967 
 1275      6874 2C20 
 1276               		.type	__c.1987, @object
 1277               		.size	__c.1987, 88
 1278               	__c.1987:
 1279 00df 0D0A 2043 		.ascii	"\r\n Close Guantanamo Now"
 1279      6C6F 7365 
 1279      2047 7561 
 1279      6E74 616E 
 1279      616D 6F20 
 1280 00f6 2120 2049 		.string	"!  It is illegal, immoral, and hurting our national security!\r\n "
 1280      7420 6973 
 1280      2069 6C6C 
 1280      6567 616C 
 1280      2C20 696D 
 1281               		.type	__c.1983, @object
 1282               		.size	__c.1983, 49
 1283               	__c.1983:
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 30


 1284 0137 0D0A 2052 		.string	"\r\n Restore heybeas corpuss! Stop the torture!\r\n "
 1284      6573 746F 
 1284      7265 2068 
 1284      6579 6265 
 1284      6173 2063 
 1285               		.text
 1286               		.stabs	"sendTextMessage:F(0,15)",36,0,257,sendTextMessage
 1287               		.stabs	"theMessage:P(0,11)",64,0,256,24
 1288               	.global	sendTextMessage
 1289               		.type	sendTextMessage, @function
 1290               	sendTextMessage:
 1291               		.stabd	46,0,0
 1292               		.stabs	"gpstest.c",132,0,0,.Ltext3
 1293               	.Ltext3:
   1:gpstest.c     **** //Integration test of GPs nmea parse code with No.6
   2:gpstest.c     **** //Last Modified 19Sep06 jlev
   3:gpstest.c     ****  
   4:gpstest.c     **** //----- Include Files ---------------------------------------------------------
   5:gpstest.c     **** #include <avr/io.h>		// include I/O definitions (port names, pin names, etc)
   6:gpstest.c     **** #include <avr/signal.h>	// include "signal" names (interrupt names)
   7:gpstest.c     **** #include <avr/interrupt.h>	// include interrupt support
   8:gpstest.c     **** #include "uart.h"		// include uart function library
   9:gpstest.c     **** #include "rprintf.h"	// include printf function library
  10:gpstest.c     **** #include "timer.h"		// include timer function library
  11:gpstest.c     **** #include "global.h"		// include our global settings
  12:gpstest.c     **** #include "string.h"		// use for strlen()
  13:gpstest.c     **** #include "video.h"  //user video thingy
  14:gpstest.c     **** 
  15:gpstest.c     **** 
  16:gpstest.c     **** //our nmea includes
  17:gpstest.c     **** #include "nmeap.h"
  18:gpstest.c     **** //#include "nmeap_def.h"
  19:gpstest.c     **** //#include "nmeap01.c"
  20:gpstest.c     **** #include "gpsmath.c"
  21:gpstest.c     **** 
  22:gpstest.c     **** //software uart includes
  23:gpstest.c     **** #include "uartswconf.h"
  24:gpstest.c     **** #include "uartsw.h"
  25:gpstest.c     **** #include "uartsw.c"
  26:gpstest.c     **** 
  27:gpstest.c     **** //i2c includes
  28:gpstest.c     **** #include "i2c.h"		// include i2c support
  29:gpstest.c     **** #define LOCAL_ADDR		0xA0
  30:gpstest.c     **** //#define RPRINTF_FLOAT	TRUE	//This allows rprintf to print floats -- useful for lats/longs
  31:gpstest.c     **** 
  32:gpstest.c     **** //#define USE_VID_CARD
  33:gpstest.c     **** #define USE_VOICE_BOX
  34:gpstest.c     **** unsigned char voiceBoxCue;
  35:gpstest.c     **** 
  36:gpstest.c     **** unsigned char localBuffer[] = "This should be filling with data!";
  37:gpstest.c     **** unsigned char localBufferLength = 0x20;
  38:gpstest.c     **** 
  39:gpstest.c     **** static nmeap_context_t nmea;	//parser context
  40:gpstest.c     **** static int user_data;			//not sure what this is for...
  41:gpstest.c     **** static nmeap_gga_t     gga;     //data buffer for GGA sentences
  42:gpstest.c     **** static nmeap_rmc_t     rmc;     //data buffer for RMC sentences
  43:gpstest.c     **** 
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 31


  44:gpstest.c     **** static cBuffer gpsBuffer; //serial receive buffer
  45:gpstest.c     **** static char gpsBufferData[UART_RX_BUFFER_SIZE]; //allocate space in ram for buffer
  46:gpstest.c     **** void addToBuffer(unsigned char ch); //the interrupt handler
  47:gpstest.c     **** 
  48:gpstest.c     **** //i2c routines
  49:gpstest.c     **** void i2cSlaveReceiveService(u08 receiveDataLength, u08* receiveData);
  50:gpstest.c     **** u08 i2cSlaveTransmitService(u08 transmitDataLengthMax, u08* transmitData);
  51:gpstest.c     **** u08 message_sent;
  52:gpstest.c     **** void initVoiceBox(void);
  53:gpstest.c     **** 
  54:gpstest.c     **** //printing to array routines.  these are used to print floats to the i2c, since sprintf doesn't wor
  55:gpstest.c     **** //instead, we set rprintfinit(print_to_string), then at the end have a string that we send to the i
  56:gpstest.c     **** #define stackem_length 0x20
  57:gpstest.c     **** u08 stackem[stackem_length];
  58:gpstest.c     **** u08 stackem_pointer = 0;
  59:gpstest.c     **** void print_to_string(u08 the_char);
  60:gpstest.c     **** void sendTextMessage(u08);
  61:gpstest.c     **** 
  62:gpstest.c     **** //For voice box
  63:gpstest.c     **** #define CTRLA = 0x01
  64:gpstest.c     **** 
  65:gpstest.c     **** //----- Begin Code ------------------------------------------------------------
  66:gpstest.c     **** int main(void)
  67:gpstest.c     **** {
  68:gpstest.c     **** 	int status;
  69:gpstest.c     ****     // Test of csik's gps math code
  70:gpstest.c     ****     struct waypoint from,to;
  71:gpstest.c     ****     //from.lat = 50.0912;
  72:gpstest.c     ****     //from.lon = -001.50;
  73:gpstest.c     ****     // set when we get valid GPS
  74:gpstest.c     **** 	to.lat = 42.359051;
  75:gpstest.c     ****     to.lon = -71.093355;
  76:gpstest.c     **** 	// 77 Mass Ave, taken off Google Maps
  77:gpstest.c     ****     
  78:gpstest.c     **** 	//initialize i2c message_sent to 0 to see if we're getting messages...
  79:gpstest.c     **** 	message_sent = 0;
  80:gpstest.c     ****  
  81:gpstest.c     ****    
  82:gpstest.c     ****     //set uart receive rate to output from GPS
  83:gpstest.c     **** 
  84:gpstest.c     **** 	// initialize our libraries
  85:gpstest.c     **** 	// initialize the UART (serial port)
  86:gpstest.c     **** 	uartInit();
  87:gpstest.c     **** 	timerInit();
  88:gpstest.c     ****  	timerPause(500);
  89:gpstest.c     **** 
  90:gpstest.c     **** 
  91:gpstest.c     **** #ifdef USE_VOICE_BOX
  92:gpstest.c     **** 	////PRE_INIT FOR THE V8699A VOICE SYNTH//////////////////////////////
  93:gpstest.c     **** 	uartSetBaudRate(4800);
  94:gpstest.c     **** 	// make all rprintf statements use uart for output
  95:gpstest.c     **** 	rprintfInit(uartSendByte);
  96:gpstest.c     **** 	initVoiceBox();
  97:gpstest.c     **** 	voiceBoxCue = 'x';
  98:gpstest.c     **** #endif /* USE_VOICE_BOX */
  99:gpstest.c     **** 
 100:gpstest.c     **** ////// initialize the timer system
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 32


 101:gpstest.c     **** 
 102:gpstest.c     **** 
 103:gpstest.c     **** #ifdef USE_VIDEO_CARD
 104:gpstest.c     **** 	////PRE_INIT FOR THE VIDEO CARD//////////////////////////////
 105:gpstest.c     **** 	uartSetBaudRate(2400);
 106:gpstest.c     **** 	// make all rprintf statements use uart for output
 107:gpstest.c     **** 	rprintfInit(uartSendByte);
 108:gpstest.c     **** 	initVideo();
 109:gpstest.c     **** 	//////////////////////////////////////////////////////////////
 110:gpstest.c     **** 	uartSetBaudRate(4800);
 111:gpstest.c     **** 	// make all rprintf statements use uart for output
 112:gpstest.c     **** 	rprintfInit(uartSendByte);
 113:gpstest.c     **** 	// initialize the timer syste
 114:gpstest.c     **** #endif /* USE_VIDEO_CARD */
 115:gpstest.c     **** 	
 116:gpstest.c     **** 	// print a little intro message so we know things are working
 117:gpstest.c     **** #ifndef USE_VID_CARD 
 118:gpstest.c     **** 	// print an intro message
 119:gpstest.c     **** 	rprintf("\r\nWelcome to GPS subsystem!\r\n");
 120:gpstest.c     **** #endif /* USE_VID_CARD */
 121:gpstest.c     **** 
 122:gpstest.c     **** 
 123:gpstest.c     **** 
 124:gpstest.c     **** ////// initialize software uart
 125:gpstest.c     **** 	uartswInit();
 126:gpstest.c     **** 	uartswSetBaudRate(19200);
 127:gpstest.c     **** 
 128:gpstest.c     **** ////// initialize i2c///////////////////////////////////////////////////////////////////
 129:gpstest.c     **** 	// initialize i2c function library
 130:gpstest.c     **** 	i2cInit();
 131:gpstest.c     **** 	// set local device address and allow response to general call
 132:gpstest.c     **** 	i2cSetLocalDeviceAddr(LOCAL_ADDR, TRUE);
 133:gpstest.c     **** 	// set the Slave Receive Handler function
 134:gpstest.c     **** 	// (this function will run whenever a master somewhere else on the bus
 135:gpstest.c     **** 	//  writes data to us as a slave)
 136:gpstest.c     **** 	i2cSetSlaveReceiveHandler( i2cSlaveReceiveService );
 137:gpstest.c     **** 	// set the Slave Transmit Handler function
 138:gpstest.c     **** 	// (this function will run whenever a master somewhere else on the bus
 139:gpstest.c     **** 	//  attempts to read data from us as a slave)
 140:gpstest.c     **** 	i2cSetSlaveTransmitHandler( i2cSlaveTransmitService );
 141:gpstest.c     **** 	
 142:gpstest.c     **** 	
 143:gpstest.c     ****    	//initialize the gps receive buffer
 144:gpstest.c     ****    	bufferInit(&gpsBuffer,gpsBufferData,UART_RX_BUFFER_SIZE);
 145:gpstest.c     **** 
 146:gpstest.c     **** 	uartSetRxHandler(addToBuffer); //custom handler	
 147:gpstest.c     **** 	
 148:gpstest.c     **** 	//rprintf("set handler\r\n");
 149:gpstest.c     **** 	
 150:gpstest.c     **** 	//initialize gps library
 151:gpstest.c     **** 	status = nmeap_init(&nmea,&user_data);
 152:gpstest.c     **** 	if (status != 0) {
 153:gpstest.c     ****         rprintf("nmeap_init %d\n",status);
 154:gpstest.c     ****     }
 155:gpstest.c     ****    	// initialize gps parsers 
 156:gpstest.c     **** 	status = nmeap_addParser(&nmea,"GPGGA",nmeap_gpgga,0,&gga);
 157:gpstest.c     **** 	if (status != 0) {
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 33


 158:gpstest.c     ****         rprintf("nmeap_add GGA %d\n",status);
 159:gpstest.c     ****     }
 160:gpstest.c     ****     status = nmeap_addParser(&nmea,"GPRMC",nmeap_gprmc,0,&rmc);
 161:gpstest.c     ****     if (status != 0) {
 162:gpstest.c     ****         rprintf("nmeap_add RMC %d\n",status);
 163:gpstest.c     ****     }
 164:gpstest.c     **** 	// WHAT IS THIS?????
 165:gpstest.c     **** 	//rprintf("gga.latitude = ");
 166:gpstest.c     **** 	//rprintfFloat(8,gga.latitude);
 167:gpstest.c     **** 	//rprintf("\r\n");
 168:gpstest.c     **** 	
 169:gpstest.c     **** 	for(;;) {
 170:gpstest.c     **** 		//set up variables for access by spi routine
 171:gpstest.c     **** 		float latitude, longitude, altitude, speed;
 172:gpstest.c     **** 		//make sure we have data
 173:gpstest.c     **** 		char ch = bufferGetFromFront(&gpsBuffer);
 174:gpstest.c     **** 		if(ch != 0) {
 175:gpstest.c     **** 				//rprintf("%c",ch); //debug
 176:gpstest.c     **** 				status = nmeap_parse(&nmea,ch);
 177:gpstest.c     **** 				switch(status) {
 178:gpstest.c     **** 					case NMEAP_GPGGA:
 179:gpstest.c     **** #ifdef USE_VID_CARD
 180:gpstest.c     **** 						writeVideoScreen(gga.latitude, gga.longitude, gga.time, gga.altitude, rmc.course, rmc.speed, 
 181:gpstest.c     **** #endif /* end USE_VID_CARD*/
 182:gpstest.c     **** #ifdef USE_TERMINAL
 183:gpstest.c     **** 						rprintf("GGA");
 184:gpstest.c     **** 						rprintf("\tLat: ");
 185:gpstest.c     **** 						rprintfFloat(8,gga.latitude);
 186:gpstest.c     **** 						rprintf(" Lon: ");
 187:gpstest.c     **** 						rprintfFloat(8,gga.longitude);
 188:gpstest.c     **** 						rprintf(" Alt: ");
 189:gpstest.c     **** 						rprintfFloat(8,gga.altitude);
 190:gpstest.c     **** 						rprintf("\r\n");
 191:gpstest.c     **** 						
 192:gpstest.c     **** 						//print distance to 77 Mass Ave
 193:gpstest.c     **** 						from.lat = gga.latitude;
 194:gpstest.c     **** 						from.lon = gga.longitude;
 195:gpstest.c     **** 						rprintf("Dist to 77 (km): ");
 196:gpstest.c     **** 						rprintfFloat(8,dist(from,to));
 197:gpstest.c     **** 						rprintf("\r\n");
 198:gpstest.c     **** 						rprintf("Bearing to 77 (deg): ");
 199:gpstest.c     **** 						rprintfFloat(8,bearing(from,to));
 200:gpstest.c     **** 						rprintf("\r\n\r\n");
 201:gpstest.c     **** #endif /* end USE_TERMINAL */
 202:gpstest.c     **** 						break;
 203:gpstest.c     **** 					case NMEAP_GPRMC:
 204:gpstest.c     **** #ifdef USE_VID_CARD
 205:gpstest.c     **** 						writeVideoScreen(gga.latitude, gga.longitude, gga.time, gga.altitude, rmc.course, rmc.speed, 
 206:gpstest.c     **** #endif /* USE_VID_CARD */
 207:gpstest.c     **** 
 208:gpstest.c     **** #ifdef USE_TERMINAL
 209:gpstest.c     **** 						rprintf("RMC");
 210:gpstest.c     **** 						//rprintf("\tLat: ");
 211:gpstest.c     **** 						//rprintfFloat(8,rmc.latitude);
 212:gpstest.c     **** 						//rprintf(" Lon: ");
 213:gpstest.c     **** 						//rprintfFloat(8,rmc.longitude);
 214:gpstest.c     **** 						rprintf(" Vel (kt): ");
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 34


 215:gpstest.c     **** 						rprintfFloat(8,rmc.speed);
 216:gpstest.c     **** 						rprintf(" Course over ground (deg): ");
 217:gpstest.c     **** 						rprintfFloat(8,rmc.course);
 218:gpstest.c     **** 						rprintf("\r\n");
 219:gpstest.c     **** #endif /* end using terminal */
 220:gpstest.c     **** 						break;
 221:gpstest.c     **** 					default:
 222:gpstest.c     **** 						break;
 223:gpstest.c     **** 			        } //end switch	
 224:gpstest.c     **** 			
 225:gpstest.c     **** 			}//	end if(ch != 0)
 226:gpstest.c     **** 			
 227:gpstest.c     **** 			//  here one would write to the video and the i2c buffer... set a mutex?  in other words, we wan
 228:gpstest.c     **** 			// use two data objects, write back and forth and switch in a single operation?
 229:gpstest.c     **** 			// write a make a readable write b make b readable
 230:gpstest.c     **** 			// writeVideoScreen(gga.latitude, gga.longitude, gga.altitude, speed, char ERROR)
 231:gpstest.c     **** 			
 232:gpstest.c     **** 			// OR, should the master give a character and then receive a value?
 233:gpstest.c     **** 			// that would seem to make more sense, but it means sort of immediate updates...
 234:gpstest.c     **** 			//rprintf("%c\r\n",voiceBoxCue);
 235:gpstest.c     **** 			//This should cue for the voice box...
 236:gpstest.c     **** 			if(voiceBoxCue != 'x')
 237:gpstest.c     **** 			{
 238:gpstest.c     **** 				sendTextMessage(voiceBoxCue);
 239:gpstest.c     **** 			}
 240:gpstest.c     **** 
 241:gpstest.c     **** 			if(message_sent != 0)
 242:gpstest.c     **** 			{
 243:gpstest.c     **** 				message_sent = 1;
 244:gpstest.c     **** 				rprintf("\r\nsent i2c!");
 245:gpstest.c     **** 			}
 246:gpstest.c     **** 	} //end for
 247:gpstest.c     **** 	
 248:gpstest.c     **** 	return 0;
 249:gpstest.c     **** }
 250:gpstest.c     **** /*
 251:gpstest.c     **** #define  h "Restore Habeas Corpus Now!"
 252:gpstest.c     **** #define  m "Close Guantanamo Now!  It is illegal, immoral, and hurting our national security!"
 253:gpstest.c     **** #define  n "What do we want?  Heybeas corpuss!  When do we want it?  We already have the right, but
 254:gpstest.c     **** #define  p "We come in peace!  We mean you no harm."
 255:gpstest.c     **** */
 256:gpstest.c     **** void sendTextMessage(unsigned char theMessage)
 257:gpstest.c     **** {	
 1294               		.stabn	68,0,257,.LM98-sendTextMessage
 1295               	.LM98:
 1296               	/* prologue: frame size=0 */
 1297               	/* prologue end (size=0) */
 258:gpstest.c     **** 	switch(theMessage)
 1298               		.stabn	68,0,258,.LM99-sendTextMessage
 1299               	.LM99:
 1300 068c 8D36      		cpi r24,lo8(109)
 1301 068e 79F0      		breq .L65
 1302               		.stabn	68,0,258,.LM100-sendTextMessage
 1303               	.LM100:
 1304 0690 8E36      		cpi r24,lo8(110)
 1305 0692 28F4      		brsh .L68
 1306 0694 8631      		cpi r24,lo8(22)
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 35


 1307 0696 A1F0      		breq .L63
 1308 0698 8836      		cpi r24,lo8(104)
 1309 069a E9F4      		brne .L62
 1310 069c 05C0      		rjmp .L64
 1311               	.L68:
 1312 069e 8E36      		cpi r24,lo8(110)
 1313 06a0 49F0      		breq .L66
 1314 06a2 8037      		cpi r24,lo8(112)
 1315 06a4 C1F4      		brne .L62
 1316 06a6 09C0      		rjmp .L67
 1317               	.L64:
 259:gpstest.c     **** 	{
 260:gpstest.c     **** 		case 'h':
 261:gpstest.c     **** 			rprintf("\r\n Restore heybeas corpuss! Stop the torture!\r\n ");
 1318               		.stabn	68,0,261,.LM101-sendTextMessage
 1319               	.LM101:
 1320 06a8 80E0      		ldi r24,lo8(__c.1983)
 1321 06aa 90E0      		ldi r25,hi8(__c.1983)
 1322 06ac 0BC0      		rjmp .L70
 1323               	.L65:
 262:gpstest.c     **** 			break;
 263:gpstest.c     **** 		case 'm':
 264:gpstest.c     **** 			rprintf("\r\n Close Guantanamo Now!  It is illegal, immoral, and hurting our national security!\
 1324               		.stabn	68,0,264,.LM102-sendTextMessage
 1325               	.LM102:
 1326 06ae 80E0      		ldi r24,lo8(__c.1987)
 1327 06b0 90E0      		ldi r25,hi8(__c.1987)
 1328 06b2 08C0      		rjmp .L70
 1329               	.L66:
 265:gpstest.c     **** 			break;
 266:gpstest.c     **** 		case 'n':
 267:gpstest.c     **** 			rprintf("\r\nWhat do we want?  Heybeas corpuss!  When do we want it?  We already have the right,
 1330               		.stabn	68,0,267,.LM103-sendTextMessage
 1331               	.LM103:
 1332 06b4 80E0      		ldi r24,lo8(__c.1990)
 1333 06b6 90E0      		ldi r25,hi8(__c.1990)
 1334 06b8 05C0      		rjmp .L70
 1335               	.L67:
 268:gpstest.c     **** 			break;
 269:gpstest.c     **** 		case 'p':
 270:gpstest.c     **** 			rprintf("\r\n We come in peace!  We mean you no harm.\r\n ");
 1336               		.stabn	68,0,270,.LM104-sendTextMessage
 1337               	.LM104:
 1338 06ba 80E0      		ldi r24,lo8(__c.1993)
 1339 06bc 90E0      		ldi r25,hi8(__c.1993)
 1340 06be 02C0      		rjmp .L70
 1341               	.L63:
 271:gpstest.c     **** 			break;
 272:gpstest.c     **** 		case 22:
 273:gpstest.c     **** 			rprintf("\r\n We come in peace!  We mean you no harm.\r\n ");
 1342               		.stabn	68,0,273,.LM105-sendTextMessage
 1343               	.LM105:
 1344 06c0 80E0      		ldi r24,lo8(__c.1996)
 1345 06c2 90E0      		ldi r25,hi8(__c.1996)
 1346               	.L70:
 1347 06c4 9F93      		push r25
 1348 06c6 8F93      		push r24
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 36


 1349 06c8 81E0      		ldi r24,lo8(1)
 1350 06ca 8F93      		push r24
 1351 06cc 0E94 0000 		call rprintf1RamRom
 1352 06d0 0F90      		pop __tmp_reg__
 1353 06d2 0F90      		pop __tmp_reg__
 1354 06d4 0F90      	 	pop __tmp_reg__
 1355               	.L62:
 274:gpstest.c     **** 			break;
 275:gpstest.c     **** 		default:
 276:gpstest.c     **** 			break;
 277:gpstest.c     **** 	}
 278:gpstest.c     **** 	voiceBoxCue = 'x';
 1356               		.stabn	68,0,278,.LM106-sendTextMessage
 1357               	.LM106:
 1358 06d6 88E7      		ldi r24,lo8(120)
 1359 06d8 8093 0000 		sts voiceBoxCue,r24
 1360               	/* epilogue: frame size=0 */
 1361 06dc 0895      		ret
 1362               	/* epilogue end (size=1) */
 1363               	/* function sendTextMessage size 41 (40) */
 1364               		.size	sendTextMessage, .-sendTextMessage
 1365               	.Lscope11:
 1366               		.stabs	"",36,0,0,.Lscope11-sendTextMessage
 1367               		.stabd	78,0,0
 1368               		.section	.progmem.data
 1369               		.type	__c.2014, @object
 1370               		.size	__c.2014, 26
 1371               	__c.2014:
 1372 0168 5265 7374 		.string	"Restore heybeas corpuss\r\n"
 1372      6F72 6520 
 1372      6865 7962 
 1372      6561 7320 
 1372      636F 7270 
 1373               		.type	__c.2012, @object
 1374               		.size	__c.2012, 7
 1375               	__c.2012:
 1376 0182 2563 3250 		.string	"%c2P\r\n"
 1376      0D0A 00
 1377               		.type	__c.2010, @object
 1378               		.size	__c.2010, 7
 1379               	__c.2010:
 1380 0189 2563 344F 		.string	"%c4O\r\n"
 1380      0D0A 00
 1381               		.type	__c.2008, @object
 1382               		.size	__c.2008, 24
 1383               	__c.2008:
 1384 0190 436C 6F73 		.string	"Close Guantanamo now!\r\n"
 1384      6520 4775 
 1384      616E 7461 
 1384      6E61 6D6F 
 1384      206E 6F77 
 1385               		.type	__c.2006, @object
 1386               		.size	__c.2006, 5
 1387               	__c.2006:
 1388 01a8 3250 0D0A 		.string	"2P\r\n"
 1388      00
 1389               		.type	__c.2004, @object
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 37


 1390               		.size	__c.2004, 5
 1391               	__c.2004:
 1392 01ad 344F 0D0A 		.string	"4O\r\n"
 1392      00
 1393               		.text
 1394               		.stabs	"initVoiceBox:F(0,15)",36,0,282,initVoiceBox
 1395               	.global	initVoiceBox
 1396               		.type	initVoiceBox, @function
 1397               	initVoiceBox:
 1398               		.stabd	46,0,0
 279:gpstest.c     **** }
 280:gpstest.c     **** 
 281:gpstest.c     **** 
 282:gpstest.c     **** void initVoiceBox(void){
 1399               		.stabn	68,0,282,.LM107-initVoiceBox
 1400               	.LM107:
 1401               	/* prologue: frame size=0 */
 1402 06de FF92      		push r15
 1403 06e0 0F93      		push r16
 1404 06e2 1F93      		push r17
 1405               	/* prologue end (size=3) */
 283:gpstest.c     **** 	rprintfCRLF();
 1406               		.stabn	68,0,283,.LM108-initVoiceBox
 1407               	.LM108:
 1408 06e4 0E94 0000 		call rprintfCRLF
 284:gpstest.c     **** 	rprintfu08(1);//rprintfu08(small);((u08) 1);  //ctrl A = ascii code 1 -- sets voicebox to accept a
 1409               		.stabn	68,0,284,.LM109-initVoiceBox
 1410               	.LM109:
 1411 06e8 81E0      		ldi r24,lo8(1)
 1412 06ea 0E94 0000 		call rprintfu08
 285:gpstest.c     **** 	rprintf("4O\r\n"); //4o is the voice to use -- richochet randy!
 1413               		.stabn	68,0,285,.LM110-initVoiceBox
 1414               	.LM110:
 1415 06ee 80E0      		ldi r24,lo8(__c.2004)
 1416 06f0 90E0      		ldi r25,hi8(__c.2004)
 1417 06f2 9F93      		push r25
 1418 06f4 8F93      		push r24
 1419 06f6 51E0      		ldi r21,lo8(1)
 1420 06f8 F52E      		mov r15,r21
 1421 06fa FF92      		push r15
 1422 06fc 0E94 0000 		call rprintf1RamRom
 286:gpstest.c     **** 	rprintfu08(1); //rprintfChar((u08) 1);  //ctrl A = ascii code 1 -- sets voicebox to accept a comma
 1423               		.stabn	68,0,286,.LM111-initVoiceBox
 1424               	.LM111:
 1425 0700 81E0      		ldi r24,lo8(1)
 1426 0702 0E94 0000 		call rprintfu08
 287:gpstest.c     **** 	rprintf("2P\r\n"); //4o is the voice to use -- richochet randy!
 1427               		.stabn	68,0,287,.LM112-initVoiceBox
 1428               	.LM112:
 1429 0706 80E0      		ldi r24,lo8(__c.2006)
 1430 0708 90E0      		ldi r25,hi8(__c.2006)
 1431 070a 9F93      		push r25
 1432 070c 8F93      		push r24
 1433 070e FF92      		push r15
 1434 0710 0E94 0000 		call rprintf1RamRom
 288:gpstest.c     **** 	
 289:gpstest.c     **** 	rprintf("Close Guantanamo now!\r\n");
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 38


 1435               		.stabn	68,0,289,.LM113-initVoiceBox
 1436               	.LM113:
 1437 0714 80E0      		ldi r24,lo8(__c.2008)
 1438 0716 90E0      		ldi r25,hi8(__c.2008)
 1439 0718 9F93      		push r25
 1440 071a 8F93      		push r24
 1441 071c FF92      		push r15
 1442 071e 0E94 0000 		call rprintf1RamRom
 290:gpstest.c     **** 	rprintfCRLF();
 1443               		.stabn	68,0,290,.LM114-initVoiceBox
 1444               	.LM114:
 1445 0722 0E94 0000 		call rprintfCRLF
 291:gpstest.c     **** 	rprintf("%c4O\r\n",0x01);
 1446               		.stabn	68,0,291,.LM115-initVoiceBox
 1447               	.LM115:
 1448 0726 01E0      		ldi r16,lo8(1)
 1449 0728 10E0      		ldi r17,hi8(1)
 1450 072a 1F93      		push r17
 1451 072c 0F93      		push r16
 1452 072e 80E0      		ldi r24,lo8(__c.2010)
 1453 0730 90E0      		ldi r25,hi8(__c.2010)
 1454 0732 9F93      		push r25
 1455 0734 8F93      		push r24
 1456 0736 FF92      		push r15
 1457 0738 0E94 0000 		call rprintf1RamRom
 292:gpstest.c     **** 	rprintf("%c2P\r\n",0x01);
 1458               		.stabn	68,0,292,.LM116-initVoiceBox
 1459               	.LM116:
 1460 073c 1F93      		push r17
 1461 073e 0F93      		push r16
 1462 0740 80E0      		ldi r24,lo8(__c.2012)
 1463 0742 90E0      		ldi r25,hi8(__c.2012)
 1464 0744 9F93      		push r25
 1465 0746 8F93      		push r24
 1466 0748 FF92      		push r15
 1467 074a 0E94 0000 		call rprintf1RamRom
 293:gpstest.c     **** 	rprintf("Restore heybeas corpuss\r\n");
 1468               		.stabn	68,0,293,.LM117-initVoiceBox
 1469               	.LM117:
 1470 074e 80E0      		ldi r24,lo8(__c.2014)
 1471 0750 90E0      		ldi r25,hi8(__c.2014)
 1472 0752 9F93      		push r25
 1473 0754 8F93      		push r24
 1474 0756 FF92      		push r15
 1475 0758 0E94 0000 		call rprintf1RamRom
 1476 075c 8DB7      		in r24,__SP_L__
 1477 075e 9EB7      		in r25,__SP_H__
 1478 0760 4696      		adiw r24,22
 1479 0762 0FB6      		in __tmp_reg__,__SREG__
 1480 0764 F894      		cli
 1481 0766 9EBF      		out __SP_H__,r25
 1482 0768 0FBE      		out __SREG__,__tmp_reg__
 1483 076a 8DBF      		out __SP_L__,r24
 1484               	/* epilogue: frame size=0 */
 1485 076c 1F91      		pop r17
 1486 076e 0F91      		pop r16
 1487 0770 FF90      		pop r15
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 39


 1488 0772 0895      		ret
 1489               	/* epilogue end (size=4) */
 1490               	/* function initVoiceBox size 75 (68) */
 1491               		.size	initVoiceBox, .-initVoiceBox
 1492               	.Lscope12:
 1493               		.stabs	"",36,0,0,.Lscope12-initVoiceBox
 1494               		.stabd	78,0,0
 1495               		.section	.progmem.data
 1496               		.type	__c.1966, @object
 1497               		.size	__c.1966, 12
 1498               	__c.1966:
 1499 01b2 0D0A 7365 		.string	"\r\nsent i2c!"
 1499      6E74 2069 
 1499      3263 2100 
 1500               		.type	__c.1955, @object
 1501               		.size	__c.1955, 18
 1502               	__c.1955:
 1503 01be 6E6D 6561 		.string	"nmeap_add RMC %d\n"
 1503      705F 6164 
 1503      6420 524D 
 1503      4320 2564 
 1503      0A00 
 1504               		.type	__c.1953, @object
 1505               		.size	__c.1953, 18
 1506               	__c.1953:
 1507 01d0 6E6D 6561 		.string	"nmeap_add GGA %d\n"
 1507      705F 6164 
 1507      6420 4747 
 1507      4120 2564 
 1507      0A00 
 1508               		.type	__c.1951, @object
 1509               		.size	__c.1951, 15
 1510               	__c.1951:
 1511 01e2 6E6D 6561 		.string	"nmeap_init %d\n"
 1511      705F 696E 
 1511      6974 2025 
 1511      640A 00
 1512               		.type	__c.1949, @object
 1513               		.size	__c.1949, 30
 1514               	__c.1949:
 1515 01f1 0D0A 5765 		.string	"\r\nWelcome to GPS subsystem!\r\n"
 1515      6C63 6F6D 
 1515      6520 746F 
 1515      2047 5053 
 1515      2073 7562 
 1516               		.data
 1517               	.LC0:
 1518 0023 4750 4747 		.string	"GPGGA"
 1518      4100 
 1519               	.LC1:
 1520 0029 4750 524D 		.string	"GPRMC"
 1520      4300 
 1521               		.text
 1522               		.stabs	"main:F(0,1)",36,0,67,main
 1523               	.global	main
 1524               		.type	main, @function
 1525               	main:
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 40


 1526               		.stabd	46,0,0
 1527               		.stabn	68,0,67,.LM118-main
 1528               	.LM118:
 1529               	/* prologue: frame size=0 */
 1530 0774 C0E0      		ldi r28,lo8(__stack - 0)
 1531 0776 D0E0      		ldi r29,hi8(__stack - 0)
 1532 0778 DEBF      		out __SP_H__,r29
 1533 077a CDBF      		out __SP_L__,r28
 1534               	/* prologue end (size=4) */
 1535               		.stabn	68,0,79,.LM119-main
 1536               	.LM119:
 1537 077c 1092 0000 		sts message_sent,__zero_reg__
 1538               		.stabn	68,0,86,.LM120-main
 1539               	.LM120:
 1540 0780 0E94 0000 		call uartInit
 1541               		.stabn	68,0,87,.LM121-main
 1542               	.LM121:
 1543 0784 0E94 0000 		call timerInit
 1544               		.stabn	68,0,88,.LM122-main
 1545               	.LM122:
 1546 0788 84EF      		ldi r24,lo8(500)
 1547 078a 91E0      		ldi r25,hi8(500)
 1548 078c 0E94 0000 		call timerPause
 1549               		.stabn	68,0,93,.LM123-main
 1550               	.LM123:
 1551 0790 60EC      		ldi r22,lo8(4800)
 1552 0792 72E1      		ldi r23,hi8(4800)
 1553 0794 80E0      		ldi r24,hlo8(4800)
 1554 0796 90E0      		ldi r25,hhi8(4800)
 1555 0798 0E94 0000 		call uartSetBaudRate
 1556               		.stabn	68,0,95,.LM124-main
 1557               	.LM124:
 1558 079c 80E0      		ldi r24,lo8(pm(uartSendByte))
 1559 079e 90E0      		ldi r25,hi8(pm(uartSendByte))
 1560 07a0 0E94 0000 		call rprintfInit
 1561               		.stabn	68,0,96,.LM125-main
 1562               	.LM125:
 1563 07a4 0E94 0000 		call initVoiceBox
 1564               		.stabn	68,0,97,.LM126-main
 1565               	.LM126:
 1566 07a8 88E7      		ldi r24,lo8(120)
 1567 07aa 8093 0000 		sts voiceBoxCue,r24
 1568               		.stabn	68,0,119,.LM127-main
 1569               	.LM127:
 1570 07ae 80E0      		ldi r24,lo8(__c.1949)
 1571 07b0 90E0      		ldi r25,hi8(__c.1949)
 1572 07b2 9F93      		push r25
 1573 07b4 8F93      		push r24
 1574 07b6 61E0      		ldi r22,lo8(1)
 1575 07b8 F62E      		mov r15,r22
 1576 07ba FF92      		push r15
 1577 07bc 0E94 0000 		call rprintf1RamRom
 1578               		.stabn	68,0,125,.LM128-main
 1579               	.LM128:
 1580 07c0 0E94 0000 		call uartswInit
 1581               		.stabn	68,0,126,.LM129-main
 1582               	.LM129:
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 41


 1583 07c4 60E0      		ldi r22,lo8(19200)
 1584 07c6 7BE4      		ldi r23,hi8(19200)
 1585 07c8 80E0      		ldi r24,hlo8(19200)
 1586 07ca 90E0      		ldi r25,hhi8(19200)
 1587 07cc 0E94 0000 		call uartswSetBaudRate
 1588               		.stabn	68,0,130,.LM130-main
 1589               	.LM130:
 1590 07d0 0E94 0000 		call i2cInit
 1591               		.stabn	68,0,132,.LM131-main
 1592               	.LM131:
 1593 07d4 6FEF      		ldi r22,lo8(-1)
 1594 07d6 80EA      		ldi r24,lo8(-96)
 1595 07d8 0E94 0000 		call i2cSetLocalDeviceAddr
 1596               		.stabn	68,0,136,.LM132-main
 1597               	.LM132:
 1598 07dc 80E0      		ldi r24,lo8(pm(i2cSlaveReceiveService))
 1599 07de 90E0      		ldi r25,hi8(pm(i2cSlaveReceiveService))
 1600 07e0 0E94 0000 		call i2cSetSlaveReceiveHandler
 1601               		.stabn	68,0,140,.LM133-main
 1602               	.LM133:
 1603 07e4 80E0      		ldi r24,lo8(pm(i2cSlaveTransmitService))
 1604 07e6 90E0      		ldi r25,hi8(pm(i2cSlaveTransmitService))
 1605 07e8 0E94 0000 		call i2cSetSlaveTransmitHandler
 1606               		.stabn	68,0,144,.LM134-main
 1607               	.LM134:
 1608 07ec 40E8      		ldi r20,lo8(128)
 1609 07ee 50E0      		ldi r21,hi8(128)
 1610 07f0 60E0      		ldi r22,lo8(gpsBufferData)
 1611 07f2 70E0      		ldi r23,hi8(gpsBufferData)
 1612 07f4 80E0      		ldi r24,lo8(gpsBuffer)
 1613 07f6 90E0      		ldi r25,hi8(gpsBuffer)
 1614 07f8 0E94 0000 		call bufferInit
 1615               		.stabn	68,0,146,.LM135-main
 1616               	.LM135:
 1617 07fc 80E0      		ldi r24,lo8(pm(addToBuffer))
 1618 07fe 90E0      		ldi r25,hi8(pm(addToBuffer))
 1619 0800 0E94 0000 		call uartSetRxHandler
 1620               		.stabn	68,0,151,.LM136-main
 1621               	.LM136:
 1622 0804 60E0      		ldi r22,lo8(user_data)
 1623 0806 70E0      		ldi r23,hi8(user_data)
 1624 0808 80E0      		ldi r24,lo8(nmea)
 1625 080a 90E0      		ldi r25,hi8(nmea)
 1626 080c 0E94 0000 		call nmeap_init
 1627               		.stabn	68,0,152,.LM137-main
 1628               	.LM137:
 1629 0810 0F90      		pop __tmp_reg__
 1630 0812 0F90      		pop __tmp_reg__
 1631 0814 0F90      	 	pop __tmp_reg__
 1632 0816 0097      		sbiw r24,0
 1633 0818 71F0      		breq .L74
 1634               		.stabn	68,0,153,.LM138-main
 1635               	.LM138:
 1636 081a 9F93      		push r25
 1637 081c 8F93      		push r24
 1638 081e 80E0      		ldi r24,lo8(__c.1951)
 1639 0820 90E0      		ldi r25,hi8(__c.1951)
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 42


 1640 0822 9F93      		push r25
 1641 0824 8F93      		push r24
 1642 0826 FF92      		push r15
 1643 0828 0E94 0000 		call rprintf1RamRom
 1644 082c 0F90      		pop __tmp_reg__
 1645 082e 0F90      		pop __tmp_reg__
 1646 0830 0F90      		pop __tmp_reg__
 1647 0832 0F90      		pop __tmp_reg__
 1648 0834 0F90      		pop __tmp_reg__
 1649               	.L74:
 1650               		.stabn	68,0,156,.LM139-main
 1651               	.LM139:
 1652 0836 00E0      		ldi r16,lo8(gga)
 1653 0838 10E0      		ldi r17,hi8(gga)
 1654 083a 20E0      		ldi r18,lo8(0)
 1655 083c 30E0      		ldi r19,hi8(0)
 1656 083e 40E0      		ldi r20,lo8(pm(nmeap_gpgga))
 1657 0840 50E0      		ldi r21,hi8(pm(nmeap_gpgga))
 1658 0842 60E0      		ldi r22,lo8(.LC0)
 1659 0844 70E0      		ldi r23,hi8(.LC0)
 1660 0846 80E0      		ldi r24,lo8(nmea)
 1661 0848 90E0      		ldi r25,hi8(nmea)
 1662 084a 0E94 0000 		call nmeap_addParser
 1663               		.stabn	68,0,157,.LM140-main
 1664               	.LM140:
 1665 084e 0097      		sbiw r24,0
 1666 0850 71F0      		breq .L76
 1667               		.stabn	68,0,158,.LM141-main
 1668               	.LM141:
 1669 0852 9F93      		push r25
 1670 0854 8F93      		push r24
 1671 0856 80E0      		ldi r24,lo8(__c.1953)
 1672 0858 90E0      		ldi r25,hi8(__c.1953)
 1673 085a 9F93      		push r25
 1674 085c 8F93      		push r24
 1675 085e FF92      		push r15
 1676 0860 0E94 0000 		call rprintf1RamRom
 1677 0864 0F90      		pop __tmp_reg__
 1678 0866 0F90      		pop __tmp_reg__
 1679 0868 0F90      		pop __tmp_reg__
 1680 086a 0F90      		pop __tmp_reg__
 1681 086c 0F90      		pop __tmp_reg__
 1682               	.L76:
 1683               		.stabn	68,0,160,.LM142-main
 1684               	.LM142:
 1685 086e 00E0      		ldi r16,lo8(rmc)
 1686 0870 10E0      		ldi r17,hi8(rmc)
 1687 0872 20E0      		ldi r18,lo8(0)
 1688 0874 30E0      		ldi r19,hi8(0)
 1689 0876 40E0      		ldi r20,lo8(pm(nmeap_gprmc))
 1690 0878 50E0      		ldi r21,hi8(pm(nmeap_gprmc))
 1691 087a 60E0      		ldi r22,lo8(.LC1)
 1692 087c 70E0      		ldi r23,hi8(.LC1)
 1693 087e 80E0      		ldi r24,lo8(nmea)
 1694 0880 90E0      		ldi r25,hi8(nmea)
 1695 0882 0E94 0000 		call nmeap_addParser
 1696               		.stabn	68,0,161,.LM143-main
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 43


 1697               	.LM143:
 1698 0886 0097      		sbiw r24,0
 1699 0888 71F0      		breq .L92
 1700               		.stabn	68,0,162,.LM144-main
 1701               	.LM144:
 1702 088a 9F93      		push r25
 1703 088c 8F93      		push r24
 1704 088e 80E0      		ldi r24,lo8(__c.1955)
 1705 0890 90E0      		ldi r25,hi8(__c.1955)
 1706 0892 9F93      		push r25
 1707 0894 8F93      		push r24
 1708 0896 FF92      		push r15
 1709 0898 0E94 0000 		call rprintf1RamRom
 1710 089c 0F90      		pop __tmp_reg__
 1711 089e 0F90      		pop __tmp_reg__
 1712 08a0 0F90      		pop __tmp_reg__
 1713 08a2 0F90      		pop __tmp_reg__
 1714 08a4 0F90      		pop __tmp_reg__
 1715               	.L92:
 1716               	.LBB2:
 1717               		.stabn	68,0,173,.LM145-main
 1718               	.LM145:
 1719 08a6 80E0      		ldi r24,lo8(gpsBuffer)
 1720 08a8 90E0      		ldi r25,hi8(gpsBuffer)
 1721 08aa 0E94 0000 		call bufferGetFromFront
 1722 08ae 682F      		mov r22,r24
 1723               		.stabn	68,0,174,.LM146-main
 1724               	.LM146:
 1725 08b0 8823      		tst r24
 1726 08b2 21F0      		breq .L80
 1727               		.stabn	68,0,176,.LM147-main
 1728               	.LM147:
 1729 08b4 80E0      		ldi r24,lo8(nmea)
 1730 08b6 90E0      		ldi r25,hi8(nmea)
 1731 08b8 0E94 0000 		call nmeap_parse
 1732               	.L80:
 1733               		.stabn	68,0,236,.LM148-main
 1734               	.LM148:
 1735 08bc 8091 0000 		lds r24,voiceBoxCue
 1736 08c0 8837      		cpi r24,lo8(120)
 1737 08c2 11F0      		breq .L82
 1738               		.stabn	68,0,238,.LM149-main
 1739               	.LM149:
 1740 08c4 0E94 0000 		call sendTextMessage
 1741               	.L82:
 1742               		.stabn	68,0,241,.LM150-main
 1743               	.LM150:
 1744 08c8 8091 0000 		lds r24,message_sent
 1745 08cc 8823      		tst r24
 1746 08ce 59F3      		breq .L92
 1747               		.stabn	68,0,243,.LM151-main
 1748               	.LM151:
 1749 08d0 21E0      		ldi r18,lo8(1)
 1750 08d2 2093 0000 		sts message_sent,r18
 1751               		.stabn	68,0,244,.LM152-main
 1752               	.LM152:
 1753 08d6 80E0      		ldi r24,lo8(__c.1966)
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 44


 1754 08d8 90E0      		ldi r25,hi8(__c.1966)
 1755 08da 9F93      		push r25
 1756 08dc 8F93      		push r24
 1757 08de 2F93      		push r18
 1758 08e0 0E94 0000 		call rprintf1RamRom
 1759 08e4 0F90      		pop __tmp_reg__
 1760 08e6 0F90      		pop __tmp_reg__
 1761 08e8 0F90      	 	pop __tmp_reg__
 1762 08ea DDCF      		rjmp .L92
 1763               	.LBE2:
 1764               	/* epilogue: frame size=0 */
 1765               	/* epilogue: noreturn */
 1766               	/* epilogue end (size=0) */
 1767               	/* function main size 188 (184) */
 1768               		.size	main, .-main
 1769               		.stabs	"status:r(0,1)",64,0,68,24
 1770               		.stabn	192,0,0,main-main
 1771               		.stabn	224,0,0,.Lscope13-main
 1772               	.Lscope13:
 1773               		.stabs	"",36,0,0,.Lscope13-main
 1774               		.stabd	78,0,0
 1775               		.stabs	"addToBuffer:F(0,15)",36,0,296,addToBuffer
 1776               		.stabs	"ch:P(0,11)",64,0,296,24
 1777               	.global	addToBuffer
 1778               		.type	addToBuffer, @function
 1779               	addToBuffer:
 1780               		.stabd	46,0,0
 294:gpstest.c     **** }
 295:gpstest.c     **** 
 296:gpstest.c     **** void addToBuffer(unsigned char ch) {
 1781               		.stabn	68,0,296,.LM153-addToBuffer
 1782               	.LM153:
 1783               	/* prologue: frame size=0 */
 1784               	/* prologue end (size=0) */
 297:gpstest.c     **** 	bufferAddToEnd(&gpsBuffer,ch);
 1785               		.stabn	68,0,297,.LM154-addToBuffer
 1786               	.LM154:
 1787 08ec 682F      		mov r22,r24
 1788 08ee 80E0      		ldi r24,lo8(gpsBuffer)
 1789 08f0 90E0      		ldi r25,hi8(gpsBuffer)
 1790 08f2 0E94 0000 		call bufferAddToEnd
 1791               	/* epilogue: frame size=0 */
 1792 08f6 0895      		ret
 1793               	/* epilogue end (size=1) */
 1794               	/* function addToBuffer size 6 (5) */
 1795               		.size	addToBuffer, .-addToBuffer
 1796               	.Lscope14:
 1797               		.stabs	"",36,0,0,.Lscope14-addToBuffer
 1798               		.stabd	78,0,0
 1799               		.stabs	"i2cSlaveReceiveService:F(0,15)",36,0,302,i2cSlaveReceiveService
 1800               		.stabs	"receiveDataLength:P(7,1)",64,0,301,25
 1801               		.stabs	"receiveData:P(0,17)",64,0,301,26
 1802               	.global	i2cSlaveReceiveService
 1803               		.type	i2cSlaveReceiveService, @function
 1804               	i2cSlaveReceiveService:
 1805               		.stabd	46,0,0
 298:gpstest.c     **** }
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 45


 299:gpstest.c     **** 
 300:gpstest.c     **** // slave operations
 301:gpstest.c     **** void i2cSlaveReceiveService(u08 receiveDataLength, u08* receiveData)
 302:gpstest.c     **** {
 1806               		.stabn	68,0,302,.LM155-i2cSlaveReceiveService
 1807               	.LM155:
 1808               	/* prologue: frame size=0 */
 1809               	/* prologue end (size=0) */
 1810 08f8 982F      		mov r25,r24
 1811 08fa DB01      		movw r26,r22
 303:gpstest.c     **** 	u08 i;
 304:gpstest.c     **** 
 305:gpstest.c     **** 	// this function will run when a master somewhere else on the bus
 306:gpstest.c     **** 	// addresses us and wishes to write data to us
 307:gpstest.c     **** 
 308:gpstest.c     **** 	//showByte(*receiveData);
 309:gpstest.c     **** 	cbi(PORTB, PB6);
 1812               		.stabn	68,0,309,.LM156-i2cSlaveReceiveService
 1813               	.LM156:
 1814 08fc C698      		cbi 56-0x20,6
 1815 08fe 20E0      		ldi r18,lo8(0)
 1816 0900 30E0      		ldi r19,hi8(0)
 1817 0902 07C0      		rjmp .L96
 1818               	.L97:
 310:gpstest.c     **** 
 311:gpstest.c     **** 	// copy the received data to a local buffer
 312:gpstest.c     **** 	for(i=0; i<receiveDataLength; i++)
 313:gpstest.c     **** 	{
 314:gpstest.c     **** 		localBuffer[i] = *receiveData++;
 1819               		.stabn	68,0,314,.LM157-i2cSlaveReceiveService
 1820               	.LM157:
 1821 0904 8D91      		ld r24,X+
 1822 0906 FF27      		clr r31
 1823 0908 E050      		subi r30,lo8(-(localBuffer))
 1824 090a F040      		sbci r31,hi8(-(localBuffer))
 1825 090c 8083      		st Z,r24
 1826 090e 2F5F      		subi r18,lo8(-(1))
 1827 0910 3F4F      		sbci r19,hi8(-(1))
 1828               	.L96:
 1829 0912 E22F      		mov r30,r18
 1830               		.stabn	68,0,312,.LM158-i2cSlaveReceiveService
 1831               	.LM158:
 1832 0914 2917      		cp r18,r25
 1833 0916 B0F3      		brlo .L97
 315:gpstest.c     **** 	}
 316:gpstest.c     **** 	localBufferLength = receiveDataLength;
 1834               		.stabn	68,0,316,.LM159-i2cSlaveReceiveService
 1835               	.LM159:
 1836 0918 9093 0000 		sts localBufferLength,r25
 1837               	/* epilogue: frame size=0 */
 1838 091c 0895      		ret
 1839               	/* epilogue end (size=1) */
 1840               	/* function i2cSlaveReceiveService size 19 (18) */
 1841               		.size	i2cSlaveReceiveService, .-i2cSlaveReceiveService
 1842               		.stabs	"i:r(7,1)",64,0,303,30
 1843               		.stabn	192,0,0,i2cSlaveReceiveService-i2cSlaveReceiveService
 1844               		.stabn	224,0,0,.Lscope15-i2cSlaveReceiveService
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 46


 1845               	.Lscope15:
 1846               		.stabs	"",36,0,0,.Lscope15-i2cSlaveReceiveService
 1847               		.stabd	78,0,0
 1848               		.section	.progmem.data
 1849               		.type	__c.2068, @object
 1850               		.size	__c.2068, 3
 1851               	__c.2068:
 1852 020f 7020 00   		.string	"p "
 1853               		.type	__c.2065, @object
 1854               		.size	__c.2065, 3
 1855               	__c.2065:
 1856 0212 6D20 00   		.string	"m "
 1857               		.type	__c.2062, @object
 1858               		.size	__c.2062, 3
 1859               	__c.2062:
 1860 0215 6E20 00   		.string	"n "
 1861               		.type	__c.2059, @object
 1862               		.size	__c.2059, 3
 1863               	__c.2059:
 1864 0218 6820 00   		.string	"h "
 1865               		.type	__c.2056, @object
 1866               		.size	__c.2056, 3
 1867               	__c.2056:
 1868 021b 6720 00   		.string	"g "
 1869               		.type	__c.2053, @object
 1870               		.size	__c.2053, 3
 1871               	__c.2053:
 1872 021e 7420 00   		.string	"t "
 1873               		.type	__c.2050, @object
 1874               		.size	__c.2050, 2
 1875               	__c.2050:
 1876 0221 6300      		.string	"c"
 1877               		.type	__c.2047, @object
 1878               		.size	__c.2047, 3
 1879               	__c.2047:
 1880 0223 6420 00   		.string	"d "
 1881               		.type	__c.2044, @object
 1882               		.size	__c.2044, 3
 1883               	__c.2044:
 1884 0226 6F20 00   		.string	"o "
 1885               		.type	__c.2040, @object
 1886               		.size	__c.2040, 3
 1887               	__c.2040:
 1888 0229 6120 00   		.string	"a "
 1889               		.text
 1890               		.stabs	"i2cSlaveTransmitService:F(7,1)",36,0,340,i2cSlaveTransmitService
 1891               		.stabs	"transmitDataLengthMax:P(7,1)",64,0,339,24
 1892               		.stabs	"transmitData:P(0,17)",64,0,339,28
 1893               	.global	i2cSlaveTransmitService
 1894               		.type	i2cSlaveTransmitService, @function
 1895               	i2cSlaveTransmitService:
 1896               		.stabd	46,0,0
 317:gpstest.c     **** 	
 318:gpstest.c     **** }
 319:gpstest.c     **** 
 320:gpstest.c     **** /*
 321:gpstest.c     **** #define	 q "pitch" #external (hmr3300) module
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 47


 322:gpstest.c     **** #define	 w "Roll" #external (hmr3300) module
 323:gpstest.c     **** #define	 c "Heading" #external (hmr3300) module heading
 324:gpstest.c     **** #define  d	"Direction" #The gps' heading
 325:gpstest.c     **** #define	 a "Latitude" 
 326:gpstest.c     **** #define	 o "Longitude"
 327:gpstest.c     **** #define	 z "Altitude"
 328:gpstest.c     **** #define	 b "Battery"
 329:gpstest.c     **** #define  t	"dateTime"
 330:gpstest.c     **** #define	 f "Fuel"
 331:gpstest.c     **** #define	 s "Airspeed"
 332:gpstest.c     **** #define	 g "Groundspeed"
 333:gpstest.c     **** #define  h "Restore Habeas Corpus Now!"
 334:gpstest.c     **** #define  m "Close Guantanamo Now!  It is illegal, immoral, and hurting our national security!"
 335:gpstest.c     **** #define  n "What do we want?  Heybeas corpuss!  When do we want it?  We already have the right, but
 336:gpstest.c     **** #define  p "We come in peace!  We mean you no harm."
 337:gpstest.c     **** */
 338:gpstest.c     **** 
 339:gpstest.c     **** u08 i2cSlaveTransmitService(u08 transmitDataLengthMax, u08* transmitData)
 340:gpstest.c     **** {
 1897               		.stabn	68,0,340,.LM160-i2cSlaveTransmitService
 1898               	.LM160:
 1899               	/* prologue: frame size=0 */
 1900 091e CF93      		push r28
 1901 0920 DF93      		push r29
 1902               	/* prologue end (size=2) */
 1903 0922 EB01      		movw r28,r22
 341:gpstest.c     **** 	u08 i;
 342:gpstest.c     **** 	// this function will run when a master somewhere else on the bus
 343:gpstest.c     **** 	// addresses us and wishes to read data from us
 344:gpstest.c     **** 	
 345:gpstest.c     **** 	// I believe that this might be the place to load the response...
 346:gpstest.c     **** 	
 347:gpstest.c     **** 	//showByte(*transmitData);	
 348:gpstest.c     **** 	cbi(PORTB, PB7);
 1904               		.stabn	68,0,348,.LM161-i2cSlaveTransmitService
 1905               	.LM161:
 1906 0924 C798      		cbi 56-0x20,7
 349:gpstest.c     **** 	rprintfInit(print_to_string);
 1907               		.stabn	68,0,349,.LM162-i2cSlaveTransmitService
 1908               	.LM162:
 1909 0926 80E0      		ldi r24,lo8(pm(print_to_string))
 1910 0928 90E0      		ldi r25,hi8(pm(print_to_string))
 1911 092a 0E94 0000 		call rprintfInit
 350:gpstest.c     **** 	// temp for debugging.... CHANGE!
 351:gpstest.c     **** 	float test = -71.093355;  //MIT position
 352:gpstest.c     **** 	double test2 = 42.359051; //MIT position
 353:gpstest.c     **** 	stackem_pointer = 0;
 1912               		.stabn	68,0,353,.LM163-i2cSlaveTransmitService
 1913               	.LM163:
 1914 092e 1092 0000 		sts stackem_pointer,__zero_reg__
 354:gpstest.c     **** 	switch(localBuffer[0])
 1915               		.stabn	68,0,354,.LM164-i2cSlaveTransmitService
 1916               	.LM164:
 1917 0932 8091 0000 		lds r24,localBuffer
 1918 0936 8836      		cpi r24,lo8(104)
 1919 0938 09F4      		brne .+2
 1920 093a 88C0      		rjmp .L106
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 48


 1921               		.stabn	68,0,354,.LM165-i2cSlaveTransmitService
 1922               	.LM165:
 1923 093c 8936      		cpi r24,lo8(105)
 1924 093e 78F4      		brsh .L112
 1925 0940 8336      		cpi r24,lo8(99)
 1926 0942 09F4      		brne .+2
 1927 0944 52C0      		rjmp .L103
 1928 0946 8436      		cpi r24,lo8(100)
 1929 0948 20F4      		brsh .L113
 1930 094a 8136      		cpi r24,lo8(97)
 1931 094c 09F0      		breq .+2
 1932 094e 9BC0      		rjmp .L101
 1933 0950 18C0      		rjmp .L102
 1934               	.L113:
 1935 0952 8436      		cpi r24,lo8(100)
 1936 0954 C9F1      		breq .L104
 1937 0956 8736      		cpi r24,lo8(103)
 1938 0958 09F0      		breq .+2
 1939 095a 95C0      		rjmp .L101
 1940 095c 63C0      		rjmp .L105
 1941               	.L112:
 1942 095e 8F36      		cpi r24,lo8(111)
 1943 0960 09F1      		breq .L109
 1944 0962 8037      		cpi r24,lo8(112)
 1945 0964 38F4      		brsh .L114
 1946 0966 8D36      		cpi r24,lo8(109)
 1947 0968 09F4      		brne .+2
 1948 096a 7AC0      		rjmp .L107
 1949 096c 8E36      		cpi r24,lo8(110)
 1950 096e 09F0      		breq .+2
 1951 0970 8AC0      		rjmp .L101
 1952 0972 71C0      		rjmp .L108
 1953               	.L114:
 1954 0974 8037      		cpi r24,lo8(112)
 1955 0976 09F4      		brne .+2
 1956 0978 78C0      		rjmp .L110
 1957 097a 8437      		cpi r24,lo8(116)
 1958 097c 09F0      		breq .+2
 1959 097e 83C0      		rjmp .L101
 1960 0980 42C0      		rjmp .L111
 1961               	.L102:
 355:gpstest.c     **** 	{
 356:gpstest.c     **** 		case 'a': //latitude
 357:gpstest.c     **** 			rprintf("a ");
 1962               		.stabn	68,0,357,.LM166-i2cSlaveTransmitService
 1963               	.LM166:
 1964 0982 80E0      		ldi r24,lo8(__c.2040)
 1965 0984 90E0      		ldi r25,hi8(__c.2040)
 1966 0986 9F93      		push r25
 1967 0988 8F93      		push r24
 1968 098a 81E0      		ldi r24,lo8(1)
 1969 098c 8F93      		push r24
 1970 098e 0E94 0000 		call rprintf1RamRom
 358:gpstest.c     **** 			rprintfFloat(8,gga.latitude);
 1971               		.stabn	68,0,358,.LM167-i2cSlaveTransmitService
 1972               	.LM167:
 1973 0992 4091 0000 		lds r20,gga
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 49


 1974 0996 5091 0000 		lds r21,(gga)+1
 1975 099a 6091 0000 		lds r22,(gga)+2
 1976 099e 7091 0000 		lds r23,(gga)+3
 1977 09a2 10C0      		rjmp .L123
 1978               	.L109:
 359:gpstest.c     **** 			//rprintfFloat(8,test2);	
 360:gpstest.c     **** 			break;
 361:gpstest.c     **** 		case 'o': //longitude
 362:gpstest.c     **** 			rprintf("o ");
 1979               		.stabn	68,0,362,.LM168-i2cSlaveTransmitService
 1980               	.LM168:
 1981 09a4 80E0      		ldi r24,lo8(__c.2044)
 1982 09a6 90E0      		ldi r25,hi8(__c.2044)
 1983 09a8 9F93      		push r25
 1984 09aa 8F93      		push r24
 1985 09ac 81E0      		ldi r24,lo8(1)
 1986 09ae 8F93      		push r24
 1987 09b0 0E94 0000 		call rprintf1RamRom
 363:gpstest.c     **** 			rprintfFloat(8,gga.longitude);
 1988               		.stabn	68,0,363,.LM169-i2cSlaveTransmitService
 1989               	.LM169:
 1990 09b4 4091 0000 		lds r20,gga+4
 1991 09b8 5091 0000 		lds r21,(gga+4)+1
 1992 09bc 6091 0000 		lds r22,(gga+4)+2
 1993 09c0 7091 0000 		lds r23,(gga+4)+3
 1994               	.L123:
 1995 09c4 88E0      		ldi r24,lo8(8)
 1996 09c6 3FC0      		rjmp .L120
 1997               	.L104:
 364:gpstest.c     **** 			//rprintfFloat(8,test);	
 365:gpstest.c     **** 			break;
 366:gpstest.c     **** 		case 'd':
 367:gpstest.c     **** 			rprintf("d ");
 1998               		.stabn	68,0,367,.LM170-i2cSlaveTransmitService
 1999               	.LM170:
 2000 09c8 80E0      		ldi r24,lo8(__c.2047)
 2001 09ca 90E0      		ldi r25,hi8(__c.2047)
 2002 09cc 9F93      		push r25
 2003 09ce 8F93      		push r24
 2004 09d0 81E0      		ldi r24,lo8(1)
 2005 09d2 8F93      		push r24
 2006 09d4 0E94 0000 		call rprintf1RamRom
 368:gpstest.c     **** 			rprintfFloat(4,rmc.course);
 2007               		.stabn	68,0,368,.LM171-i2cSlaveTransmitService
 2008               	.LM171:
 2009 09d8 4091 0000 		lds r20,rmc+15
 2010 09dc 5091 0000 		lds r21,(rmc+15)+1
 2011 09e0 6091 0000 		lds r22,(rmc+15)+2
 2012 09e4 7091 0000 		lds r23,(rmc+15)+3
 2013 09e8 2DC0      		rjmp .L124
 2014               	.L103:
 369:gpstest.c     **** 			break;
 370:gpstest.c     **** 		case 'c':  // RETURNS compass, roll, and pitch
 371:gpstest.c     **** 			rprintf("c"); //ghetto -- no space before the data for some annoying reason -- blame uartsw.c
 2015               		.stabn	68,0,371,.LM172-i2cSlaveTransmitService
 2016               	.LM172:
 2017 09ea 80E0      		ldi r24,lo8(__c.2050)
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 50


 2018 09ec 90E0      		ldi r25,hi8(__c.2050)
 2019 09ee 9F93      		push r25
 2020 09f0 8F93      		push r24
 2021 09f2 81E0      		ldi r24,lo8(1)
 2022 09f4 8F93      		push r24
 2023 09f6 0E94 0000 		call rprintf1RamRom
 372:gpstest.c     **** 			sentence[0] = ' ';
 2024               		.stabn	68,0,372,.LM173-i2cSlaveTransmitService
 2025               	.LM173:
 2026 09fa 80E2      		ldi r24,lo8(32)
 2027 09fc 8093 0000 		sts sentence,r24
 373:gpstest.c     **** 			rprintfStr(sentence);
 2028               		.stabn	68,0,373,.LM174-i2cSlaveTransmitService
 2029               	.LM174:
 2030 0a00 80E0      		ldi r24,lo8(sentence)
 2031 0a02 90E0      		ldi r25,hi8(sentence)
 2032 0a04 0CC0      		rjmp .L121
 2033               	.L111:
 374:gpstest.c     **** 			break;
 375:gpstest.c     **** 		case 't':
 376:gpstest.c     **** 			rprintf("t ");
 2034               		.stabn	68,0,376,.LM175-i2cSlaveTransmitService
 2035               	.LM175:
 2036 0a06 80E0      		ldi r24,lo8(__c.2053)
 2037 0a08 90E0      		ldi r25,hi8(__c.2053)
 2038 0a0a 9F93      		push r25
 2039 0a0c 8F93      		push r24
 2040 0a0e 81E0      		ldi r24,lo8(1)
 2041 0a10 8F93      		push r24
 2042 0a12 0E94 0000 		call rprintf1RamRom
 377:gpstest.c     **** 			//rprintfu32(rmc.time);
 378:gpstest.c     **** 			rprintfStr(rmc.time);  //not float, rather hhmmss
 2043               		.stabn	68,0,378,.LM176-i2cSlaveTransmitService
 2044               	.LM176:
 2045 0a16 8091 0000 		lds r24,rmc
 2046 0a1a 9091 0000 		lds r25,(rmc)+1
 2047               	.L121:
 2048 0a1e 0E94 0000 		call rprintfStr
 2049 0a22 2EC0      		rjmp .L119
 2050               	.L105:
 379:gpstest.c     **** 			//rprintfFloat(6,rmc.time);
 380:gpstest.c     **** 			break;
 381:gpstest.c     **** 		case 'g':  // groundspeed is speed from gps -- prone to errors
 382:gpstest.c     **** 			rprintf("g ");
 2051               		.stabn	68,0,382,.LM177-i2cSlaveTransmitService
 2052               	.LM177:
 2053 0a24 80E0      		ldi r24,lo8(__c.2056)
 2054 0a26 90E0      		ldi r25,hi8(__c.2056)
 2055 0a28 9F93      		push r25
 2056 0a2a 8F93      		push r24
 2057 0a2c 81E0      		ldi r24,lo8(1)
 2058 0a2e 8F93      		push r24
 2059 0a30 0E94 0000 		call rprintf1RamRom
 383:gpstest.c     **** 			rprintfFloat(4,rmc.speed);
 2060               		.stabn	68,0,383,.LM178-i2cSlaveTransmitService
 2061               	.LM178:
 2062 0a34 4091 0000 		lds r20,rmc+11
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 51


 2063 0a38 5091 0000 		lds r21,(rmc+11)+1
 2064 0a3c 6091 0000 		lds r22,(rmc+11)+2
 2065 0a40 7091 0000 		lds r23,(rmc+11)+3
 2066               	.L124:
 2067 0a44 84E0      		ldi r24,lo8(4)
 2068               	.L120:
 2069 0a46 0E94 0000 		call rprintfFloat
 2070 0a4a 1AC0      		rjmp .L119
 2071               	.L106:
 384:gpstest.c     **** 			break;
 385:gpstest.c     **** 		case 'h':
 386:gpstest.c     **** 			voiceBoxCue = 'h';
 2072               		.stabn	68,0,386,.LM179-i2cSlaveTransmitService
 2073               	.LM179:
 2074 0a4c 8093 0000 		sts voiceBoxCue,r24
 387:gpstest.c     **** 			rprintf("h ");
 2075               		.stabn	68,0,387,.LM180-i2cSlaveTransmitService
 2076               	.LM180:
 2077 0a50 80E0      		ldi r24,lo8(__c.2059)
 2078 0a52 90E0      		ldi r25,hi8(__c.2059)
 2079 0a54 0FC0      		rjmp .L122
 2080               	.L108:
 388:gpstest.c     **** 			break;
 389:gpstest.c     **** 		case 'n':
 390:gpstest.c     **** 			voiceBoxCue = 'n';
 2081               		.stabn	68,0,390,.LM181-i2cSlaveTransmitService
 2082               	.LM181:
 2083 0a56 8093 0000 		sts voiceBoxCue,r24
 391:gpstest.c     **** 			rprintf("n ");
 2084               		.stabn	68,0,391,.LM182-i2cSlaveTransmitService
 2085               	.LM182:
 2086 0a5a 80E0      		ldi r24,lo8(__c.2062)
 2087 0a5c 90E0      		ldi r25,hi8(__c.2062)
 2088 0a5e 0AC0      		rjmp .L122
 2089               	.L107:
 392:gpstest.c     **** 			break;
 393:gpstest.c     **** 		case 'm':
 394:gpstest.c     **** 			voiceBoxCue = 'm';
 2090               		.stabn	68,0,394,.LM183-i2cSlaveTransmitService
 2091               	.LM183:
 2092 0a60 8093 0000 		sts voiceBoxCue,r24
 395:gpstest.c     **** 			rprintf("m ");
 2093               		.stabn	68,0,395,.LM184-i2cSlaveTransmitService
 2094               	.LM184:
 2095 0a64 80E0      		ldi r24,lo8(__c.2065)
 2096 0a66 90E0      		ldi r25,hi8(__c.2065)
 2097 0a68 05C0      		rjmp .L122
 2098               	.L110:
 396:gpstest.c     **** 			break;
 397:gpstest.c     **** 		case 'p':
 398:gpstest.c     **** 			voiceBoxCue = 22;
 2099               		.stabn	68,0,398,.LM185-i2cSlaveTransmitService
 2100               	.LM185:
 2101 0a6a 86E1      		ldi r24,lo8(22)
 2102 0a6c 8093 0000 		sts voiceBoxCue,r24
 399:gpstest.c     **** 			rprintf("p ");
 2103               		.stabn	68,0,399,.LM186-i2cSlaveTransmitService
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 52


 2104               	.LM186:
 2105 0a70 80E0      		ldi r24,lo8(__c.2068)
 2106 0a72 90E0      		ldi r25,hi8(__c.2068)
 2107               	.L122:
 2108 0a74 9F93      		push r25
 2109 0a76 8F93      		push r24
 2110 0a78 81E0      		ldi r24,lo8(1)
 2111 0a7a 8F93      		push r24
 2112 0a7c 0E94 0000 		call rprintf1RamRom
 2113               	.L119:
 2114 0a80 0F90      		pop __tmp_reg__
 2115 0a82 0F90      		pop __tmp_reg__
 2116 0a84 0F90      	 	pop __tmp_reg__
 2117               	.L101:
 400:gpstest.c     **** 			break;
 401:gpstest.c     **** 		default:
 402:gpstest.c     **** 		//	rprintf(" E");  //CE = Command Error
 403:gpstest.c     **** 			break;
 404:gpstest.c     **** 	}
 405:gpstest.c     **** 	rprintfInit(uartSendByte);
 2118               		.stabn	68,0,405,.LM187-i2cSlaveTransmitService
 2119               	.LM187:
 2120 0a86 80E0      		ldi r24,lo8(pm(uartSendByte))
 2121 0a88 90E0      		ldi r25,hi8(pm(uartSendByte))
 2122 0a8a 0E94 0000 		call rprintfInit
 2123 0a8e DE01      		movw r26,r28
 2124 0a90 05C0      		rjmp .L115
 2125               	.L116:
 406:gpstest.c     **** 	//sprintf(temp_buffer, "%f,%f",gga.latitude,gga.longitude);
 407:gpstest.c     **** 	
 408:gpstest.c     **** 	// copy the local buffer to the transmit buffer -- this buffer size is set in i2c.conf
 409:gpstest.c     **** 	for(i=0; i<=stackem_pointer; i++)
 410:gpstest.c     **** 	{
 411:gpstest.c     **** 		*transmitData++ = stackem[i];
 2126               		.stabn	68,0,411,.LM188-i2cSlaveTransmitService
 2127               	.LM188:
 2128 0a92 FF27      		clr r31
 2129 0a94 E050      		subi r30,lo8(-(stackem))
 2130 0a96 F040      		sbci r31,hi8(-(stackem))
 2131 0a98 8081      		ld r24,Z
 2132 0a9a 8D93      		st X+,r24
 2133               	.L115:
 2134 0a9c EA2F      		mov r30,r26
 2135 0a9e EC1B      		sub r30,r28
 2136               		.stabn	68,0,409,.LM189-i2cSlaveTransmitService
 2137               	.LM189:
 2138 0aa0 8091 0000 		lds r24,stackem_pointer
 2139 0aa4 8E17      		cp r24,r30
 2140 0aa6 A8F7      		brsh .L116
 2141 0aa8 8F5F      		subi r24,lo8(-(1))
 412:gpstest.c     **** 	}
 413:gpstest.c     **** 	
 414:gpstest.c     **** 	
 415:gpstest.c     **** 	//localBuffer[0]++;
 416:gpstest.c     **** 	//message_sent = 1;
 417:gpstest.c     **** 
 418:gpstest.c     **** 	return stackem_pointer+1;
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 53


 419:gpstest.c     **** }
 2142               		.stabn	68,0,419,.LM190-i2cSlaveTransmitService
 2143               	.LM190:
 2144 0aaa 9927      		clr r25
 2145               	/* epilogue: frame size=0 */
 2146 0aac DF91      		pop r29
 2147 0aae CF91      		pop r28
 2148 0ab0 0895      		ret
 2149               	/* epilogue end (size=3) */
 2150               	/* function i2cSlaveTransmitService size 202 (197) */
 2151               		.size	i2cSlaveTransmitService, .-i2cSlaveTransmitService
 2152               		.stabs	"i:r(7,1)",64,0,341,30
 2153               		.stabn	192,0,0,i2cSlaveTransmitService-i2cSlaveTransmitService
 2154               		.stabn	224,0,0,.Lscope16-i2cSlaveTransmitService
 2155               	.Lscope16:
 2156               		.stabs	"",36,0,0,.Lscope16-i2cSlaveTransmitService
 2157               		.stabd	78,0,0
 2158               		.stabs	"print_to_string:F(0,15)",36,0,421,print_to_string
 2159               		.stabs	"the_char:P(7,1)",64,0,420,24
 2160               	.global	print_to_string
 2161               		.type	print_to_string, @function
 2162               	print_to_string:
 2163               		.stabd	46,0,0
 420:gpstest.c     **** void print_to_string(u08 the_char)
 421:gpstest.c     **** {
 2164               		.stabn	68,0,421,.LM191-print_to_string
 2165               	.LM191:
 2166               	/* prologue: frame size=0 */
 2167               	/* prologue end (size=0) */
 422:gpstest.c     **** 	if(stackem_pointer<(stackem_length-1))  //-1 to allow for null char to still fit
 2168               		.stabn	68,0,422,.LM192-print_to_string
 2169               	.LM192:
 2170 0ab2 9091 0000 		lds r25,stackem_pointer
 2171 0ab6 9F31      		cpi r25,lo8(31)
 2172 0ab8 68F4      		brsh .L128
 423:gpstest.c     **** 	{
 424:gpstest.c     **** 		stackem[stackem_pointer] = the_char;
 2173               		.stabn	68,0,424,.LM193-print_to_string
 2174               	.LM193:
 2175 0aba E92F      		mov r30,r25
 2176 0abc FF27      		clr r31
 2177 0abe E050      		subi r30,lo8(-(stackem))
 2178 0ac0 F040      		sbci r31,hi8(-(stackem))
 2179 0ac2 8083      		st Z,r24
 425:gpstest.c     **** 		stackem_pointer++;
 2180               		.stabn	68,0,425,.LM194-print_to_string
 2181               	.LM194:
 2182 0ac4 E92F      		mov r30,r25
 2183 0ac6 EF5F      		subi r30,lo8(-(1))
 2184 0ac8 E093 0000 		sts stackem_pointer,r30
 426:gpstest.c     **** 		stackem[stackem_pointer] = 0;
 2185               		.stabn	68,0,426,.LM195-print_to_string
 2186               	.LM195:
 2187 0acc FF27      		clr r31
 2188 0ace E050      		subi r30,lo8(-(stackem))
 2189 0ad0 F040      		sbci r31,hi8(-(stackem))
 2190 0ad2 1082      		st Z,__zero_reg__
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 54


 2191               	.L128:
 2192 0ad4 0895      		ret
 2193               	/* epilogue: frame size=0 */
 2194               	/* epilogue: noreturn */
 2195               	/* epilogue end (size=0) */
 2196               	/* function print_to_string size 18 (18) */
 2197               		.size	print_to_string, .-print_to_string
 2198               	.Lscope17:
 2199               		.stabs	"",36,0,0,.Lscope17-print_to_string
 2200               		.stabd	78,0,0
 2201               		.stabs	"getCompass:F(0,15)",36,0,432,getCompass
 2202               	.global	getCompass
 2203               		.type	getCompass, @function
 2204               	getCompass:
 2205               		.stabd	46,0,0
 427:gpstest.c     **** 	}
 428:gpstest.c     **** }
 429:gpstest.c     **** 
 430:gpstest.c     **** //I think this is unused?
 431:gpstest.c     **** void getCompass(void)
 432:gpstest.c     **** {
 2206               		.stabn	68,0,432,.LM196-getCompass
 2207               	.LM196:
 2208               	/* prologue: frame size=1 */
 2209 0ad6 CF93      		push r28
 2210 0ad8 DF93      		push r29
 2211 0ada CDB7      		in r28,__SP_L__
 2212 0adc DEB7      		in r29,__SP_H__
 2213 0ade 2197      		sbiw r28,1
 2214 0ae0 0FB6      		in __tmp_reg__,__SREG__
 2215 0ae2 F894      		cli
 2216 0ae4 DEBF      		out __SP_H__,r29
 2217 0ae6 0FBE      		out __SREG__,__tmp_reg__
 2218 0ae8 CDBF      		out __SP_L__,r28
 2219               	/* prologue end (size=10) */
 2220               	.L139:
 433:gpstest.c     **** 	u08 data;
 434:gpstest.c     **** 	
 435:gpstest.c     **** 	while(1)
 436:gpstest.c     **** 	{
 437:gpstest.c     **** 		if(uartswReceiveByte(&data))
 2221               		.stabn	68,0,437,.LM197-getCompass
 2222               	.LM197:
 2223 0aea CE01      		movw r24,r28
 2224 0aec 0196      		adiw r24,1
 2225 0aee 0E94 0000 		call uartswReceiveByte
 2226 0af2 8823      		tst r24
 2227 0af4 D1F3      		breq .L139
 438:gpstest.c     **** 			rprintfChar(data);
 2228               		.stabn	68,0,438,.LM198-getCompass
 2229               	.LM198:
 2230 0af6 8981      		ldd r24,Y+1
 2231 0af8 0E94 0000 		call rprintfChar
 2232 0afc F6CF      		rjmp .L139
 2233               	/* epilogue: frame size=1 */
 2234               	/* epilogue: noreturn */
 2235               	/* epilogue end (size=0) */
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 55


 2236               	/* function getCompass size 20 (10) */
 2237               		.size	getCompass, .-getCompass
 2238               		.stabs	"data:(7,1)",128,0,433,1
 2239               		.stabn	192,0,0,getCompass-getCompass
 2240               		.stabn	224,0,0,.Lscope18-getCompass
 2241               	.Lscope18:
 2242               		.stabs	"",36,0,0,.Lscope18-getCompass
 2243               		.stabd	78,0,0
 2244               		.section	.progmem.data
 2245               		.type	__c.2108, @object
 2246               		.size	__c.2108, 3
 2247               	__c.2108:
 2248 022c 0D0A 00   		.string	"\r\n"
 2249               		.text
 2250               		.stabs	"setCompassBaud:F(0,15)",36,0,443,setCompassBaud
 2251               	.global	setCompassBaud
 2252               		.type	setCompassBaud, @function
 2253               	setCompassBaud:
 2254               		.stabd	46,0,0
 439:gpstest.c     **** 	}
 440:gpstest.c     **** }
 441:gpstest.c     **** 
 442:gpstest.c     **** void setCompassBaud(void)
 443:gpstest.c     **** {
 2255               		.stabn	68,0,443,.LM199-setCompassBaud
 2256               	.LM199:
 2257               	/* prologue: frame size=0 */
 2258               	/* prologue end (size=0) */
 444:gpstest.c     **** 	sentence[0]=' ';
 2259               		.stabn	68,0,444,.LM200-setCompassBaud
 2260               	.LM200:
 2261 0afe 80E2      		ldi r24,lo8(32)
 2262 0b00 8093 0000 		sts sentence,r24
 445:gpstest.c     **** 	//uartswSetBaudRate(cmdlineGetArgInt(1));
 446:gpstest.c     **** 	rprintfStr(sentence);
 2263               		.stabn	68,0,446,.LM201-setCompassBaud
 2264               	.LM201:
 2265 0b04 80E0      		ldi r24,lo8(sentence)
 2266 0b06 90E0      		ldi r25,hi8(sentence)
 2267 0b08 0E94 0000 		call rprintfStr
 447:gpstest.c     **** 	rprintf("\r\n");
 2268               		.stabn	68,0,447,.LM202-setCompassBaud
 2269               	.LM202:
 2270 0b0c 80E0      		ldi r24,lo8(__c.2108)
 2271 0b0e 90E0      		ldi r25,hi8(__c.2108)
 2272 0b10 9F93      		push r25
 2273 0b12 8F93      		push r24
 2274 0b14 81E0      		ldi r24,lo8(1)
 2275 0b16 8F93      		push r24
 2276 0b18 0E94 0000 		call rprintf1RamRom
 2277 0b1c 0F90      		pop __tmp_reg__
 2278 0b1e 0F90      		pop __tmp_reg__
 2279 0b20 0F90      	 	pop __tmp_reg__
 2280               	/* epilogue: frame size=0 */
 2281 0b22 0895      		ret
 2282               	/* epilogue end (size=1) */
 2283               	/* function setCompassBaud size 19 (18) */
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 56


 2284               		.size	setCompassBaud, .-setCompassBaud
 2285               	.Lscope19:
 2286               		.stabs	"",36,0,0,.Lscope19-setCompassBaud
 2287               		.stabd	78,0,0
 2288               		.stabs	"UartswTxBusy:S(0,18)=B(7,1)",40,0,30,UartswTxBusy
 2289               		.stabs	"UartswTxData:S(0,18)",40,0,31,UartswTxData
 2290               		.stabs	"UartswTxBitNum:S(0,18)",40,0,32,UartswTxBitNum
 2291               		.stabs	"UartswBaudRateDiv:S(0,19)=B(7,3)",40,0,35,UartswBaudRateDiv
 2292               		.stabs	"UartswRxBusy:S(0,18)",40,0,38,UartswRxBusy
 2293               		.stabs	"UartswRxData:S(0,18)",40,0,39,UartswRxData
 2294               		.stabs	"UartswRxBitNum:S(0,18)",40,0,40,UartswRxBitNum
 2295               		.stabs	"uartswRxBuffer:S(8,3)",40,0,42,uartswRxBuffer
 2296               		.stabs	"uartswRxData:S(0,20)=ar(13,3);0;31;(0,2)",40,0,44,uartswRxData
 2297               		.stabs	"sentence:S(0,21)=ar(13,3);0;19;(0,2)",40,0,45,sentence
 2298               		.stabs	"nmea:S(13,11)",40,0,39,nmea
 2299               		.stabs	"user_data:S(0,1)",40,0,40,user_data
 2300               		.stabs	"gga:S(12,8)",40,0,41,gga
 2301               		.stabs	"rmc:S(12,10)",40,0,42,rmc
 2302               		.stabs	"gpsBuffer:S(8,3)",40,0,44,gpsBuffer
 2303               		.stabs	"gpsBufferData:S(0,22)=ar(13,3);0;127;(0,2)",40,0,45,gpsBufferData
 2304               		.stabs	"voiceBoxCue:G(0,11)",32,0,34,0
 2305               		.stabs	"localBuffer:G(0,23)=ar(13,3);0;33;(0,11)",32,0,36,0
 2306               		.stabs	"localBufferLength:G(0,11)",32,0,37,0
 2307               		.stabs	"message_sent:G(7,1)",32,0,51,0
 2308               		.stabs	"stackem:G(0,24)=ar(13,3);0;31;(7,1)",32,0,57,0
 2309               		.stabs	"stackem_pointer:G(7,1)",32,0,58,0
 2310               		.comm stackem,32,1
 2311               		.comm message_sent,1,1
 2312               		.comm voiceBoxCue,1,1
 2313               		.lcomm gpsBufferData,128
 2314               		.lcomm gpsBuffer,8
 2315               		.lcomm rmc,25
 2316               		.lcomm gga,28
 2317               		.lcomm user_data,2
 2318               		.lcomm nmea,718
 2319               		.lcomm sentence,20
 2320               		.lcomm uartswRxData,32
 2321               		.lcomm uartswRxBuffer,8
 2322               		.lcomm UartswRxBitNum,1
 2323               		.lcomm UartswRxData,1
 2324               		.lcomm UartswRxBusy,1
 2325               		.lcomm UartswBaudRateDiv,2
 2326               		.lcomm UartswTxBitNum,1
 2327               		.lcomm UartswTxData,1
 2328               		.lcomm UartswTxBusy,1
 2329               		.stabs	"",100,0,0,.Letext0
 2330               	.Letext0:
 2331               	/* File "gpstest.c": code 1428 = 0x0594 (1266), prologues  82, epilogues  80 */
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 57


DEFINED SYMBOLS
                            *ABS*:00000000 gpstest.c
/var/tmp//cc4EqHDQ.s:3      *ABS*:0000003f __SREG__
/var/tmp//cc4EqHDQ.s:4      *ABS*:0000003e __SP_H__
/var/tmp//cc4EqHDQ.s:5      *ABS*:0000003d __SP_L__
/var/tmp//cc4EqHDQ.s:6      *ABS*:00000000 __tmp_reg__
/var/tmp//cc4EqHDQ.s:7      *ABS*:00000001 __zero_reg__
/var/tmp//cc4EqHDQ.s:143    .bss:00000000 stackem_pointer
/var/tmp//cc4EqHDQ.s:149    .data:00000000 localBufferLength
/var/tmp//cc4EqHDQ.s:154    .data:00000001 localBuffer
/var/tmp//cc4EqHDQ.s:162    .text:00000000 dist
/var/tmp//cc4EqHDQ.s:406    .text:000001e6 bearing
/var/tmp//cc4EqHDQ.s:636    .text:000003ac uartswInitBuffers
/var/tmp//cc4EqHDQ.s:2319   .bss:000003a2 uartswRxData
/var/tmp//cc4EqHDQ.s:2320   .bss:000003c2 uartswRxBuffer
/var/tmp//cc4EqHDQ.s:664    .text:000003be uartswOff
/var/tmp//cc4EqHDQ.s:709    .text:000003e4 uartswSetBaudRate
/var/tmp//cc4EqHDQ.s:2324   .bss:000003cd UartswBaudRateDiv
/var/tmp//cc4EqHDQ.s:757    .text:00000424 uartswInit
/var/tmp//cc4EqHDQ.s:2327   .bss:000003d1 UartswTxBusy
/var/tmp//cc4EqHDQ.s:971    .text:000004fa uartswTxBitService
/var/tmp//cc4EqHDQ.s:2323   .bss:000003cc UartswRxBusy
/var/tmp//cc4EqHDQ.s:1044   .text:0000054c uartswRxBitService
/var/tmp//cc4EqHDQ.s:846    .text:00000484 uartswGetRxBuffer
/var/tmp//cc4EqHDQ.s:868    .text:0000048a uartswSendByte
/var/tmp//cc4EqHDQ.s:2326   .bss:000003d0 UartswTxData
/var/tmp//cc4EqHDQ.s:2325   .bss:000003cf UartswTxBitNum
/var/tmp//cc4EqHDQ.s:922    .text:000004c2 uartswReceiveByte
/var/tmp//cc4EqHDQ.s:2321   .bss:000003ca UartswRxBitNum
/var/tmp//cc4EqHDQ.s:2322   .bss:000003cb UartswRxData
/var/tmp//cc4EqHDQ.s:2318   .bss:0000038e sentence
/var/tmp//cc4EqHDQ.s:1264   .progmem.data:00000000 __c.1996
/var/tmp//cc4EqHDQ.s:1268   .progmem.data:0000002e __c.1993
/var/tmp//cc4EqHDQ.s:1272   .progmem.data:0000005c __c.1990
/var/tmp//cc4EqHDQ.s:1278   .progmem.data:000000df __c.1987
/var/tmp//cc4EqHDQ.s:1283   .progmem.data:00000137 __c.1983
/var/tmp//cc4EqHDQ.s:1290   .text:0000068c sendTextMessage
                            *COM*:00000001 voiceBoxCue
/var/tmp//cc4EqHDQ.s:1371   .progmem.data:00000168 __c.2014
/var/tmp//cc4EqHDQ.s:1375   .progmem.data:00000182 __c.2012
/var/tmp//cc4EqHDQ.s:1379   .progmem.data:00000189 __c.2010
/var/tmp//cc4EqHDQ.s:1383   .progmem.data:00000190 __c.2008
/var/tmp//cc4EqHDQ.s:1387   .progmem.data:000001a8 __c.2006
/var/tmp//cc4EqHDQ.s:1391   .progmem.data:000001ad __c.2004
/var/tmp//cc4EqHDQ.s:1397   .text:000006de initVoiceBox
/var/tmp//cc4EqHDQ.s:1498   .progmem.data:000001b2 __c.1966
/var/tmp//cc4EqHDQ.s:1502   .progmem.data:000001be __c.1955
/var/tmp//cc4EqHDQ.s:1506   .progmem.data:000001d0 __c.1953
/var/tmp//cc4EqHDQ.s:1510   .progmem.data:000001e2 __c.1951
/var/tmp//cc4EqHDQ.s:1514   .progmem.data:000001f1 __c.1949
/var/tmp//cc4EqHDQ.s:1525   .text:00000774 main
                            *COM*:00000001 message_sent
/var/tmp//cc4EqHDQ.s:1804   .text:000008f8 i2cSlaveReceiveService
/var/tmp//cc4EqHDQ.s:1895   .text:0000091e i2cSlaveTransmitService
                             .bss:00000001 gpsBufferData
/var/tmp//cc4EqHDQ.s:2313   .bss:00000081 gpsBuffer
/var/tmp//cc4EqHDQ.s:1779   .text:000008ec addToBuffer
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 58


/var/tmp//cc4EqHDQ.s:2316   .bss:000000be user_data
/var/tmp//cc4EqHDQ.s:2317   .bss:000000c0 nmea
/var/tmp//cc4EqHDQ.s:2315   .bss:000000a2 gga
/var/tmp//cc4EqHDQ.s:2314   .bss:00000089 rmc
/var/tmp//cc4EqHDQ.s:1851   .progmem.data:0000020f __c.2068
/var/tmp//cc4EqHDQ.s:1855   .progmem.data:00000212 __c.2065
/var/tmp//cc4EqHDQ.s:1859   .progmem.data:00000215 __c.2062
/var/tmp//cc4EqHDQ.s:1863   .progmem.data:00000218 __c.2059
/var/tmp//cc4EqHDQ.s:1867   .progmem.data:0000021b __c.2056
/var/tmp//cc4EqHDQ.s:1871   .progmem.data:0000021e __c.2053
/var/tmp//cc4EqHDQ.s:1875   .progmem.data:00000221 __c.2050
/var/tmp//cc4EqHDQ.s:1879   .progmem.data:00000223 __c.2047
/var/tmp//cc4EqHDQ.s:1883   .progmem.data:00000226 __c.2044
/var/tmp//cc4EqHDQ.s:1887   .progmem.data:00000229 __c.2040
/var/tmp//cc4EqHDQ.s:2162   .text:00000ab2 print_to_string
                            *COM*:00000020 stackem
/var/tmp//cc4EqHDQ.s:2204   .text:00000ad6 getCompass
/var/tmp//cc4EqHDQ.s:2247   .progmem.data:0000022c __c.2108
/var/tmp//cc4EqHDQ.s:2253   .text:00000afe setCompassBaud

UNDEFINED SYMBOLS
__do_copy_data
__do_clear_bss
__mulsf3
__divsf3
__subsf3
sin
cos
__addsf3
sqrt
atan2
bufferInit
timerDetach
timer1SetPrescaler
__udivmodsi4
timerAttach
bufferGetFromFront
bufferAddToEnd
bufferFlush
rprintf1RamRom
rprintfCRLF
rprintfu08
__stack
uartInit
timerInit
timerPause
uartSetBaudRate
uartSendByte
rprintfInit
i2cInit
i2cSetLocalDeviceAddr
i2cSetSlaveReceiveHandler
i2cSetSlaveTransmitHandler
uartSetRxHandler
nmeap_init
nmeap_gpgga
nmeap_addParser
GAS LISTING /var/tmp//cc4EqHDQ.s 			page 59


nmeap_gprmc
nmeap_parse
rprintfStr
rprintfFloat
rprintfChar
